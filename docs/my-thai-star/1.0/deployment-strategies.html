<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: Devonfw.github.io Docs</title>
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../_/css/site.css">
    <script>var uiRootPath = '../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../..">Devonfw.github.io Docs</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="my-thai-star" data-version="1.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-explore is-active" data-panel="explore">
  <div class="context">
    <span class="title">My-thai-star</span>
    <span class="version">1.0</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../../architecture-guidelines/1.0/index.html">Architecture-guidelines</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../architecture-guidelines/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../cicdgen/1.0/index.html">Cicdgen</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../cicdgen/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../cobigen/1.0/index.html">Cobigen</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../cobigen/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../dashboard/1.0/index.html">Dashboard</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../dashboard/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../devon4j/1.0/index.html">Devon4j</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../devon4j/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../devon4net/1.0/index.html">Devon4net</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../devon4net/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../devon4ng/1.0/index.html">Devon4ng</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../devon4ng/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../devon4node/1.0/index.html">Devon4node</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../devon4node/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../devon4quarkus/1.0/index.html">Devon4quarkus</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../devon4quarkus/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../devon4ts/1.0/index.html">Devon4ts</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../devon4ts/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../devonfw.github.io/1.0/index.html">devonfw.github.io</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../devonfw.github.io/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../getting-started/1.0/index.html">Getting-started</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../getting-started/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../github/1.0/index.html">Github</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../github/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../hangar/1.0/index.html">Hangar</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../hangar/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../ide/1.0/index.html">IDE</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../ide/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../jump-the-queue/1.0/index.html">Jump-the-queue</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../jump-the-queue/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../mrchecker/1.0/index.html">Mrchecker</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../mrchecker/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="index.html">My-thai-star</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../production-line/1.0/index.html">Production-line</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../production-line/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../shop-floor/1.0/index.html">Shop-floor</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../shop-floor/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../solicitor/1.0/index.html">Solicitor</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../solicitor/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../sonar-devon4j-plugin/1.0/index.html">Sonar-devon4j-plugin</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../sonar-devon4j-plugin/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../devonfw.github.io/1.0/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
</nav>
  <div class="edit-this-page"><a href="https://github.com/MarvDan/my-thai-star/edit/develop/modules/ROOT/pages/deployment-strategies.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<div id="toc" class="toc">
<div id="toctitle" class="title">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_deployment_strategies">Deployment Strategies</a></li>
<li><a href="#_independent_docker_containers">Independent Docker containers</a></li>
<li><a href="#_docker_compose">Docker Compose</a></li>
<li><a href="#_project_adjustment">Project adjustment</a></li>
</ul>
</div>
<div class="sect1">
<h2 id="_deployment_strategies"><a class="anchor" href="#_deployment_strategies"></a>Deployment Strategies</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this chapter different way of deploying My Thai Star are explained. Everything will be based in Docker.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_independent_docker_containers"><a class="anchor" href="#_independent_docker_containers"></a>Independent Docker containers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The first way of deployment will use isolated Docker containers. That means that if the client-side container is deployed, it does not affect the server-side container&#8217;s life cycle and vice versa.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s show how the containers will behave during their life cycle.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>0) Copy everything you need into the Deployment Server directory</p>
</li>
<li>
<p>1) Remove existing container (Nginx or Tomcat)</p>
<div class="imageblock">
<div class="content">
<a class="image" href="container1.png"><img src="_images/images/ci/angular/container1.png" alt="container1"></a>
</div>
</div>
</li>
<li>
<p>2) Run new one from the Docker images collection of the external Deployment Server.</p>
<div class="imageblock">
<div class="content">
<a class="image" href="container2.png"><img src="_images/images/ci/angular/container2.png" alt="container2"></a>
</div>
</div>
</li>
<li>
<p>3) Add the artifact <code>/dist</code> to the "deployable" folder of the Docker container (<code>/usr/share/nginx/html/</code>)</p>
<div class="imageblock">
<div class="content">
<a class="image" href="container3.png"><img src="_images/images/ci/angular/container3.png" alt="container3"></a>
</div>
</div>
<div class="paragraph">
<p>Now, let&#8217;s see how it&#8217;s being executed in the command line (simplified due to documentation purposes). The next block of code represents what is inside of the last stage of the Pipeline.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">sshagent (credentials: ['my_ssh_token']) {
    sh """
        // Copy artifact from workspace to deployment server

        // Manage container:
        docker rm -f [mts-container]
        docker run -itd --name=[mts-container] [base_image]
        docker exec [mts-container] bash -C \\"rm [container_deployment_folder]/*\\"
        docker cp [artifact] [mts-container]:[container_deployment_folder]
    """
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For every operation performed in the external Deployment Server, it is necessary to define <em>where</em> those commands are going to be executed. So, for each one of previous <code>docker</code> commands, this should appear before:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>`ssh -o StrictHostKeyChecking=no root@10.40.235.244`</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_docker_compose"><a class="anchor" href="#_docker_compose"></a>Docker Compose</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The second way of deployment will be by orchestrating both elements of the application: The Angular client-side and the Java server-side. Both elements will be running in Docker containers as well, but in this case they won&#8217;t be independent anymore. <strong>Docker Compose</strong> will be in charge of keeping both containers up, or to put them down.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_project_adjustment"><a class="anchor" href="#_project_adjustment"></a>Project adjustment</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In order to perform this second way of deployment, some files will be created in the project. The first one is the <strong>Dockerfile</strong> for the Angular client-side. This file will pull (if necessary) an <strong>Nginx</strong> Docker image and copy the Angular artifact (<code>/dist</code> folder) inside of the deployment folder of the image. It will be located in the main directory of the Angular client-side project.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="dockerfile-angular.PNG"><img src="_images/images/ci/deployment/dockerfile-angular.PNG" alt="dockerfile angular"></a>
</div>
</div>
<div class="paragraph">
<p>The second file is the <strong>Dockerfile</strong> for the Java server-side. Its function will be quite similar to the Angular one. It will run a <strong>tomcat</strong> Docker image and copy the Java artifact (<code>mythaistar.war</code> file) in its deployment folder.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="dockerfile-java.PNG"><img src="_images/images/ci/deployment/dockerfile-java.PNG" alt="dockerfile java"></a>
</div>
</div>
<div class="paragraph">
<p>Finally, as long as the <strong>docker-compose</strong> is being used, a file containing its configuration will be necessary as well. A new folder one the main My That Star&#8217;s directory is created, and it&#8217;s called <code>/docker</code>. Inside there is just a <code>docker-compose.yml</code> file. It contains all the information needed to orchestrate the deployment process. For example, which port both containers are going to be published on, and so on. This way of deployment will allow the application to be published or not just with one action.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>docker-compose rm -f            # down
docker-compose up --build -d    # up fresh containers</pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="docker-compose.PNG"><img src="_images/images/ci/deployment/docker-compose.PNG" alt="docker compose"></a>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s have a look at the file itself:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">version: '3'
services:
  client_compose:
    build: "angular"
    ports:
      - "8091:80"
    depends_on:
      - server_compose
  server_compose:
    build: "java"
    ports:
      - "9091:8080"</code></pre>
</div>
</div>
<div class="paragraph">
<p>This Orchestrated Deployment will offer some interesting possibilities for <a href="future-deployment">the future of the application</a>.</p>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
