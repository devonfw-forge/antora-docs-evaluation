<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: Devonfw.github.io Docs</title>
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../..">Devonfw.github.io Docs</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="devon4ts" data-version="1.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-explore is-active" data-panel="explore">
  <div class="context">
    <span class="title">Devon4ts</span>
    <span class="version">1.0</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../../../architecture-guidelines/1.0/index.html">Architecture-guidelines</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../architecture-guidelines/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../cicdgen/1.0/index.html">Cicdgen</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../cicdgen/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../cobigen/1.0/index.html">Cobigen</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../cobigen/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../dashboard/1.0/index.html">Dashboard</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../dashboard/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../devon4j/1.0/index.html">Devon4j</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../devon4j/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../devon4net/1.0/index.html">Devon4net</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../devon4net/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../devon4ng/1.0/index.html">Devon4ng</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../devon4ng/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../devon4node/1.0/index.html">Devon4node</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../devon4node/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../devon4quarkus/1.0/index.html">Devon4quarkus</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../devon4quarkus/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="../index.html">Devon4ts</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../devonfw.github.io/1.0/index.html">devonfw.github.io</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../devonfw.github.io/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../getting-started/1.0/index.html">Getting-started</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../getting-started/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../github/1.0/index.html">Github</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../github/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../hangar/1.0/index.html">Hangar</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../hangar/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../ide/1.0/index.html">IDE</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../ide/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../jump-the-queue/1.0/index.html">Jump-the-queue</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../jump-the-queue/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../mrchecker/1.0/index.html">Mrchecker</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../mrchecker/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../my-thai-star/1.0/index.html">My-thai-star</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../my-thai-star/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../production-line/1.0/index.html">Production-line</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../production-line/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../shop-floor/1.0/index.html">Shop-floor</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../shop-floor/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../solicitor/1.0/index.html">Solicitor</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../solicitor/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../sonar-devon4j-plugin/1.0/index.html">Sonar-devon4j-plugin</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../sonar-devon4j-plugin/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../devonfw.github.io/1.0/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
</nav>
  <div class="edit-this-page"><a href="https://github.com/MarvDan/devon4ts/edit/master/modules/ROOT/pages/angular/guide-cypress.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<div id="toc" class="toc">
<div id="toctitle" class="title">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#testing-e2e-with-cypress">Testing e2e with Cypress</a></li>
<li><a href="#setup">Setup</a></li>
<li><a href="#files-structure">Files / Structure</a></li>
<li><a href="#">== =</a></li>
<li><a href="#-2">== =</a></li>
<li><a href="#tests">Tests</a></li>
<li><a href="#fixtures">Fixtures</a></li>
<li><a href="#request-route">Request / Route</a></li>
<li><a href="#route">Route</a></li>
<li><a href="#request">Request</a></li>
<li><a href="#custom-commands">Custom commands</a></li>
<li><a href="#cross-browser-testing">Cross browser testing</a></li>
<li><a href="#viewport">Viewport</a></li>
<li><a href="#test-retries">Test retries</a></li>
<li><a href="#reporter">Reporter</a></li>
<li><a href="#mochawesome">Mochawesome</a></li>
</ul>
</div>
<div class="sect1">
<h2 id="testing-e2e-with-cypress"><a class="anchor" href="#testing-e2e-with-cypress"></a>Testing e2e with Cypress</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This guide will cover the basics of e2e testing using Cypress.</p>
</div>
<div class="paragraph">
<p>Cypress is a framework “all in one” that provides the necessary libraries to write specific e2e tests, without the need of Selenium.</p>
</div>
<div class="paragraph">
<p>Why Cypress?</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Uses JavaScript</p>
</li>
<li>
<p>It works directly with the browser so the compatibility with the front-end framework the project uses (in this case Angular) is not a problem.</p>
</li>
<li>
<p>Easy cross browser testing</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="setup"><a class="anchor" href="#setup"></a>Setup</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>Install</strong>
First of all we need to install it, we can use <code>npm install</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ npm install -D cypress</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or we can install it with <code>yarn</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ yarn add -D cypress</code></pre>
</div>
</div>
<div class="paragraph">
<p>We need to run Cypress in order to get the folder tree downloaded, then create a <code>tsconfig.json</code> file inside <code>cypress folder</code> to add the typescript configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ . /node_modules/.bin/cypress open</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Listing 1. <code>tsconfig.json</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "compilerOptions": {
    "strict": true,
    "baseUrl": "../node_modules",
    "target": "es5",
    "lib": ["es5", "dom"],
    "types": ["cypress"]
  },
  "include": [
    "**/*.ts"
  ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong><code>BaseUrl</code></strong></p>
</div>
<div class="paragraph">
<p>Let&#8217;s setup the base URL so when we run the tests cypress will "navigate" to the right place, go to <code>cypress.json</code> on the root of the project.</p>
</div>
<div class="listingblock">
<div class="title">Listing 2. cypress.json</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "baseUrl": "http://localhost:4200"
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="files-structure"><a class="anchor" href="#files-structure"></a>Files / Structure</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">/cypress
  tsconfig.json
  /fixtures
    - example.json
  /integration
    - button.spec.ts
    - test.spec.ts
    /examples
  /plugins
    - index.js
  /support
    - commands.js
    - index.js</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>tsconfig.json</code> for typescript configuration.</p>
</div>
<div class="paragraph">
<p><code>fixtures</code> to store our mock data or files (images, mp3&#8230;&#8203;) to use on our tests.</p>
</div>
<div class="paragraph">
<p><code>integration</code> is where our tests go, by default it comes with an examples folder with tested samples.</p>
</div>
<div class="paragraph">
<p><code>plugins</code> is where the configuration files of the plugins go.</p>
</div>
<div class="paragraph">
<p><code>support</code> to add custom commands.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id=""><a class="anchor" href="#"></a>== =</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you are using Nx, it automatically generates a e2e cypress project for every project that you generate. So you already get the configuration files like <code>tsconfig.json</code> and <code>cypress.json</code> and also get the folder structure described above. This helps you focus more on writing your tests rather than setting up Cypress.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="-2"><a class="anchor" href="#-2"></a>== =</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="tests"><a class="anchor" href="#tests"></a>Tests</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The structure is the same than Mocha.</p>
</div>
<div class="paragraph">
<p>First, we create a file, for example <code>form.spec.ts</code>, inside we define a context to group all our tests referred to the same subject.</p>
</div>
<div class="listingblock">
<div class="title">Listing 3. form.spec.ts</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">context('Button page', () =&gt; {
  beforeEach(() =&gt; {
    cy.visit('/');
  });
  it('should have button',()=&gt;{
    cy.get('button').should('exist');
  });
  it('should contain PRESS',()=&gt;{
    cy.contains('button', 'PRESS');
  });
});</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title"><code>beforeEach</code></div>
<p>Visit '/' before every test.</p>
</div>
<div class="paragraph">
<div class="title">it</div>
<p>Inside we write the test.</p>
</div>
<div class="paragraph">
<p>The result:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/cypress/contextImg.jpg" alt="contextImg">
</div>
</div>
<div class="paragraph">
<p>For more info check <a href="docs.cypress.io/guides/core-concepts/writing-and-organizing-tests.html#Folder-Structure">Cypress documentation</a></p>
</div>
<div class="paragraph">
<p>On <a href="https://github.com/cypress-io/cypress-example-kitchensink">kitchensink</a>
you can find an official cypress demo with all the commands being used.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="fixtures"><a class="anchor" href="#fixtures"></a>Fixtures</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We use fixtures to mock data, it can be a json, an image, video&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "name": "Dummy name",
  "phone": 999 99 99 99,
  "body": "Mock data"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can store multiple mocks on the same fixture file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "create":{"name": "e2etestBox"},
  "boxFruit":{
    "uuid":"3376339576e33dfb9145362426a33333",
    "name":"e2etestBox",
    "visibility":true,
    "items":[
      {"name":"apple","units":3},
      {"name":"kiwi","units":2},
    ]
  },
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To access data we don&#8217;t need to import any file, we just call <code>cy.fixture(filename)</code> inside the <code>**.spec.ts</code>. We can name it as we want.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">cy.fixture('box.json').as('fruitBox')</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>cy.fixture('box.json')</code> we get access to <code>box.json</code>
<code>.as(fruitBox)</code> is used to create an alias <code>(fruitBox)</code> to the fixture.</p>
</div>
<div class="paragraph">
<p>For more info check <a href="https://docs.cypress.io/api/commands/fixture.html#Syntax">Fixtures documentation</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="request-route"><a class="anchor" href="#request-route"></a>Request / Route</h2>
<div class="sectionbody">
<div class="paragraph">
<p>With cypress you can test your application with real data or with mocks.</p>
</div>
<div class="paragraph">
<p>Not using mocks guarantees that your tests are real e2e test but makes them vulnerable to external issues.
When you mock data you don&#8217;t know exactly if the data and the structure received from the backend is correct because you are forcing a mock on the response, but you can avoid external issues, run test faster and have better control on the structure and status.</p>
</div>
<div class="paragraph">
<p>To get more information go to <a href="https://docs.cypress.io/guides/guides/network-requests.html#Testing-Strategies">Testing Strategies</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="route"><a class="anchor" href="#route"></a>Route</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Cypress can intercept a XHR request and interact with it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">cy.server();
cy.route(
  'GET',
  '/apiUrl/list',
  [{"name":"apple", "units":3},{"name":"kiwi", "units":2}]
)</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>cy.server(options)</code> start a server to interact with the responses.</p>
</div>
<div class="ulist">
<div class="title"><code>cy.route(options)</code> intercepts a <code>XMLHttpRequests</code></div>
<ul>
<li>
<p>method <code>GET</code></p>
</li>
<li>
<p>URL <code>/apiUrl/list'</code></p>
</li>
<li>
<p>response <code>[{"name":"apple", "units":3},{"name":"kiwi", "units":2}]</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Waits</strong></p>
</div>
<div class="paragraph">
<p>Every cypress action has a default await time to avoid asynchronous issues, but this time can be short for some particular actions like API calls, for those cases we can use <code>cy.wait()</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">cy.server();
cy.route('/apiUrl/list').as('list');
cy.visit('/boxList');
cy.wait('@list');</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can find more information about <code>cy.wait()</code> <a href="https://docs.cypress.io/guides/guides/network-requests.html#Waiting">here</a></p>
</div>
<div class="paragraph">
<p>To mock data with fixtures:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">cy.fixture('box')
  .then(({boxFruit}) =&gt; {
    cy.route(
      'GET',
      '/apiUrl/list',
      boxFruit
    ).as('boxFruit');
    cy.get('#button').click();
    cy.wait('@journalsList');
    cy.get('#list').contains('apple');
  })</code></pre>
</div>
</div>
<div class="paragraph">
<p>We get <code>boxFruit</code> data from the box fixture and then we mock the API call with it so now the response of the call is <code>boxFruit</code> object.
When the button is clicked, it waits to receive the response of the call and then checks if the list contains one of the elements of the <code>fruitBox</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="request"><a class="anchor" href="#request"></a>Request</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Make a HTTP request.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">cy.server();
cy.request('http://localhost:4200/')
  .its('body')
  .should('include', '&lt;h1&gt;Welcome to Devon4ngAngularElementsTest!&lt;/h1&gt;');</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we have <code>'http://localhost:4200'</code> as <code>baseUrl</code> on <code>cypress.json</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">cy.server();
cy.request('/')
  .its('body')
  .should('include', '&lt;h1&gt;Welcome to Devon4ngAngularElementsTest!&lt;/h1&gt;');
// Goes to http://localhost:4200/</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can add other options, like we can send the body of a form.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">cy.server();
cy.request({
  method: 'POST',
  url: '/send',
  form: true,
  body: {
    name: 'name task',
    description: 'description of the task'
  }
});</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="custom-commands"><a class="anchor" href="#custom-commands"></a>Custom commands</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you see yourself writing the same test more than once (login is a common one), you can create a custom command to make things faster.</p>
</div>
<div class="paragraph">
<p><code>Cypress.Commands.add('name', ()&#8658;{})</code> to create the test.</p>
</div>
<div class="listingblock">
<div class="title">Listing 4. commands.ts</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">Cypress.Commands.add('checkPlaceholder', (name) =&gt; {
  cy.get(`[name='${name}']`).click();
  cy.get('mat-form-field.mat-focused').should('exist');
});</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">index.ts</div>
<p>To use the commands we need to import the files on support/index.ts</p>
</div>
<div class="listingblock">
<div class="title">Listing 5. index.ts</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">import './commands'
import './file1'
import './folder/file2'</code></pre>
</div>
</div>
<div class="paragraph">
<p>index.ts is where all our custom commands files unite so Cypress knows where to find them.</p>
</div>
<div class="paragraph">
<p>And as we are using typescript we need to define a <code>namespace</code>, <code>interface</code> and define our function.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>index.d.ts</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>declare namespace Cypress {
  interface Chainable&lt;Subject&gt; {
    checkPlaceholder(name:string):Chainable&lt;void&gt;
  }
}</pre>
</div>
</div>
<div class="paragraph">
<p>Check <a href="https://docs.cypress.io/guides/tooling/typescript-support.html#Types-for-custom-commands">typescript custom commands</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cross-browser-testing"><a class="anchor" href="#cross-browser-testing"></a>Cross browser testing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default the browser used by Cypress is Chrome, it has compatibility with it&#8217;s family browsers (including Microsoft Edge) and has beta support for Mozilla Firefox.</p>
</div>
<div class="paragraph">
<p>To change the browser on the panel we can do it by selecting the desired one on the browsers tab before running the spec file.</p>
</div>
<div class="paragraph">
<p><code>Cypress will detect and display, except electron, only the browsers that you have already installed on your machine.</code></p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/cypress/browserTab.jpg" alt="browserTab">
</div>
</div>
<div class="paragraph">
<p>Once the browser is selected, you can run your tests.</p>
</div>
<div class="paragraph">
<p>To change the browser on the automatic test run, you can add a flag on the node command</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cypress run --browser edge</code></pre>
</div>
</div>
<div class="paragraph">
<p>Only if we use the <code>cypress run</code> command.</p>
</div>
<div class="paragraph">
<p>Or we can change the script file.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>cypress/script.js</code></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">const runTests= async ()=&gt;{
  ...
  const {totalFailed} = await cypress.run({browser:'edge'});
  ...
};</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="https://docs.cypress.io/guides/guides/cross-browser-testing.html#Continuous-Integration-Strategies">Cypress documentation</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="viewport"><a class="anchor" href="#viewport"></a>Viewport</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Cypress allow us to create tests depending on the Viewport, so we can test responsiveness.</p>
</div>
<div class="paragraph">
<p>There are different ways to use it:</p>
</div>
<div class="paragraph">
<p>Inside a test case</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Typescript hljs" data-lang="Typescript">it('should change title when viewport is less than 320px', ()=&gt;{
  cy.get('.title-l').should('be.visible');
  cy.get('.title-s').should('not.be.visible');
  cy.viewport(320, 480);
  cy.get('.title-l').should('not.be.visible');
  cy.get('.title-s').should('be.visible');
})</code></pre>
</div>
</div>
<div class="paragraph">
<p>Passing the configuration as an option</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Typescript hljs" data-lang="Typescript">describe('page display on medium size screen', {
  viewportHeight: 1000,
  viewportWidth: 400
}, () =&gt; {
  ...
})</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or we can set a default</p>
</div>
<div class="ulist">
<ul>
<li>
<p>cypress.json</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>...
{
 "viewportHeight": 1000
 "viewportWidth": 400,
}
...</pre>
</div>
</div>
<div class="paragraph">
<p><a href="https://docs.cypress.io/api/commands/viewport.html#Syntax">Viewport documentation</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="test-retries"><a class="anchor" href="#test-retries"></a>Test retries</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We can get false negatives intermittently due external issues that can affect our tests, because of that we can add, in the configuration, a retries entry so Cypress can run again a certain failed test the selected number of times to verify that the error is real.</p>
</div>
<div class="paragraph">
<p>We can set retries for run or open mode.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>cypress.json</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>...
"retries": {
    "runMode": 3,
    "openMode": 3
  }
...</pre>
</div>
</div>
<div class="paragraph">
<p>The retries can be configured on the <code>cypress.json</code> or directly on a specific test.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Typescript hljs" data-lang="Typescript">it('should get button', {
  retries: {
    runMode: 2,
    openMode: 2
  }
}, () =&gt; {
  ...
})</code></pre>
</div>
</div>
<div class="paragraph">
<p>This retries those not shown on the test log.</p>
</div>
<div class="paragraph">
<p>Check more on <a href="https://docs.cypress.io/guides/guides/test-retries.html#Introduction">retries documentation</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="reporter"><a class="anchor" href="#reporter"></a>Reporter</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The tests results appear on the terminal, but to have a more friendly view we can add a reporter.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/cypress/reporter.jpg" alt="reporter">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="mochawesome"><a class="anchor" href="#mochawesome"></a>Mochawesome</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this case we are going to use Mochawesome, initially its a Mocha reporter but as Cypress uses Mocha it works the same.</p>
</div>
<div class="paragraph">
<p><strong>Install</strong></p>
</div>
<div class="paragraph">
<p>npm</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">npm install --save-dev mochawesome</code></pre>
</div>
</div>
<div class="paragraph">
<p>yarn</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">yarn add -D mochawesome</code></pre>
</div>
</div>
<div class="paragraph">
<p>To run the reporter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cypress run --reporter mochawesome</code></pre>
</div>
</div>
<div class="paragraph">
<p>Mochawesome saves by default the generated files on <em>`./mochawesome-report/`</em> but we can add options to change this behavior.</p>
</div>
<div class="paragraph">
<p>Options can be passed to the reporter in two ways</p>
</div>
<div class="paragraph">
<p>Using a flag</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cypress run --reporter mochawesome --reporter-options reportDir=report</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or on <em>cypress.json</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "baseUrl": "http://localhost:4200",
  "reporter": "mochawesome",
  "reporterOptions": {
    "overwrite": false,
    "html": false,
    "json": true,
    "reportDir": "cypress/report"
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>Overwrite:false</code> to not overwrite every **:spec.ts test report, we want them to create a merged version later.</p>
</div>
<div class="paragraph">
<p><code>reportDir</code> to set a custom directory.</p>
</div>
<div class="paragraph">
<p><code>html:false</code> because we don&#8217;t need it.</p>
</div>
<div class="paragraph">
<p><code>json:true</code> to save them on json.</p>
</div>
<div class="paragraph">
<p>Mochawesome only creates the html file of the last .spec.ts file that the tests run, that&#8217;s why we don&#8217;t generate html reports directly, in order to stack them all on the same final html we need to merge the reports.</p>
</div>
<div class="paragraph">
<p>Check the <a href="https://www.npmjs.com/package/mochawesome-report-generator">mochawesome documentation</a></p>
</div>
<div class="paragraph">
<p><strong><code>mochawesome-merge</code></strong></p>
</div>
<div class="paragraph">
<p><code>Mochawesome-merge</code> is a library that helps us to merge the different json.</p>
</div>
<div class="paragraph">
<p>npm</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">npm install --save-dev mochawesome-merge
npm install --save-dev mochawesome-report-generator</code></pre>
</div>
</div>
<div class="paragraph">
<p>yarn</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">yarn add -D mochawesome-merge
yarn add -D mochawesome-report-generator</code></pre>
</div>
</div>
<div class="paragraph">
<p>To merge the files we execute this command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mochawesome-merge cypress/report/*.json &gt; cypress/reportFinal.json</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>reportFinal.json</code> is the result of this merge, whit that we have the data of all the spec files in one json.</p>
</div>
<div class="paragraph">
<p>We can also automate the test, merge and conversion to html using a script.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">const cypress = require('cypress');
const fse = require('fs-extra');
const { merge } = require('mochawesome-merge');
const generator = require('mochawesome-report-generator');
const runTests= async ()=&gt;{
  await fse.remove('mochawesome-report');
  await fse.remove('cypress/report');
  const {totalFailed} = await cypress.run();
  const reporterOptions = {
    files: ["cypress/report/*.json"]
  };
  await generateReport(reporterOptions);
  if(totalFailed !==  0){
    process.exit(2);
  };
};
const generateReport = (options)=&gt; {
  return merge(options).then((jsonReport)=&gt;{
    generator.create(jsonReport).then(()=&gt;{
      process.exit();
    });
  });
};
runTests();</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>fse.remove()</code> to remove older reports data.</p>
</div>
<div class="paragraph">
<p><code>cypress.run()</code> to run the tests.</p>
</div>
<div class="paragraph">
<p><code>merge(options)</code> we merge the <code>json</code> output from running the tests.</p>
</div>
<div class="paragraph">
<p><code>generator.create(jsonReport)</code> then we generate the html view of the report.</p>
</div>
<div class="paragraph">
<p>Check the <a href="https://www.npmjs.com/package/mochawesome-merge"><code>mochawesome-merge</code> documentation</a></p>
</div>
<div class="paragraph">
<p>On <a href="https://github.com/cypress-io/cypress-example-kitchensink">kitchensink</a>
you can find an official cypress demo with all the commands being used.</p>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
