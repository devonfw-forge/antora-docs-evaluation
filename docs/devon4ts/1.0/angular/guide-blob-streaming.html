<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: Devonfw.github.io Docs</title>
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../..">Devonfw.github.io Docs</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="devon4ts" data-version="1.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-explore is-active" data-panel="explore">
  <div class="context">
    <span class="title">Devon4ts</span>
    <span class="version">1.0</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../../../architecture-guidelines/1.0/index.html">Architecture-guidelines</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../architecture-guidelines/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../cicdgen/1.0/index.html">Cicdgen</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../cicdgen/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../cobigen/1.0/index.html">Cobigen</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../cobigen/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../dashboard/1.0/index.html">Dashboard</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../dashboard/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../devon4j/1.0/index.html">Devon4j</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../devon4j/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../devon4net/1.0/index.html">Devon4net</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../devon4net/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../devon4ng/1.0/index.html">Devon4ng</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../devon4ng/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../devon4node/1.0/index.html">Devon4node</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../devon4node/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../devon4quarkus/1.0/index.html">Devon4quarkus</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../devon4quarkus/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="../index.html">Devon4ts</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../devonfw.github.io/1.0/index.html">devonfw.github.io</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../devonfw.github.io/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../getting-started/1.0/index.html">Getting-started</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../getting-started/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../github/1.0/index.html">Github</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../github/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../hangar/1.0/index.html">Hangar</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../hangar/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../ide/1.0/index.html">IDE</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../ide/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../jump-the-queue/1.0/index.html">Jump-the-queue</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../jump-the-queue/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../mrchecker/1.0/index.html">Mrchecker</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../mrchecker/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../my-thai-star/1.0/index.html">My-thai-star</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../my-thai-star/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../production-line/1.0/index.html">Production-line</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../production-line/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../shop-floor/1.0/index.html">Shop-floor</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../shop-floor/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../solicitor/1.0/index.html">Solicitor</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../solicitor/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../sonar-devon4j-plugin/1.0/index.html">Sonar-devon4j-plugin</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../sonar-devon4j-plugin/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../devonfw.github.io/1.0/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
</nav>
  <div class="edit-this-page"><a href="https://github.com/MarvDan/devon4ts/edit/master/modules/ROOT/pages/angular/guide-blob-streaming.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<div class="sect1">
<h2 id="_angular_file_uploading"><a class="anchor" href="#_angular_file_uploading"></a>Angular File Uploading</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This sample demonstrates how to upload a file to a server. For this, we will need to use an Angular form. In this case we have chosen a simple template-driven form, as the goal of this sample is just to show the process to upload a file. You can learn more about Forms in Angular in the <a href="https://angular.io/guide/forms-overview">official documentation</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The back-end implementation for this sample is located here: <a href="https://github.com/devonfw-sample/devon4j-blob-streaming">
devon4j-blob-streaming</a>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_formdata"><a class="anchor" href="#_formdata"></a><code>FormData</code></h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>FormData</code> is an object where you can store key-value pairs that allows you to send through <code>XMLHttpRequest</code>. You can create a <code>FormData</code> object as simply as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">....
const formData = new FormData();
formData.append('key', value);
....</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lets_begin"><a class="anchor" href="#_lets_begin"></a>Let&#8217;s begin</h2>
<div class="sectionbody">
<div class="paragraph">
<p>I assume you already have your angular application running, if not, you can have a look to our  <code>AngularBasicPWA</code> sample
Unresolved include directive in modules/ROOT/pages/angular/guide-blob-streaming.adoc - include::guide-angular-pwa[]</p>
</div>
<div class="paragraph">
<p>We are going to use Angular Material components, so it is necessary to install the dependency with the following command:</p>
</div>
<div class="paragraph">
<p><code>npm install --save @angular/material @angular/cdk @angular/animations</code></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_importing_necessary_components"><a class="anchor" href="#_importing_necessary_components"></a>Importing necessary components</h2>
<div class="sectionbody">
<div class="paragraph">
<p>These are the component I am going to use for our sample, are material HTML components. For use the template-driven form you do not need to import any component. I am going to create a module called Core where I place the needed imports. After that, I will import Core module on my main App module, and I be able to use these components in any part of my application.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">....
@NgModule({
  declarations: [],
  imports: [CommonModule],
  exports: [
    MatButtonModule,
    MatFormFieldModule,
    MatInputModule,
    FormsModule,
    MatProgressBarModule,
  ],
})
export class CoreModule {}
....</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>FormsModule</code> Will allow us data binding through html and component.</p>
</div>
<div class="paragraph">
<p>The next step will be to create a component to place the uploading component:
<code>ng generate component uploader</code></p>
</div>
<div class="paragraph">
<p>So this will be our project structure so far:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/blob-streaming/folder-structure.PNG" alt="folder structure" width="300">
</div>
</div>
<div class="paragraph">
<p>Then, in the app.component.html we need to add the selector for our new component, so it will be represented there. We are not going to create any route for this sample. We can also modify the values for the toolbar.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">....
&lt;div class="toolbar" role="banner"&gt;
  &lt;img
    width="40"
    alt="Angular Logo"
    src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNTAgMjUwIj4KICAgIDxwYXRoIGZpbGw9IiNERDAwMzEiIGQ9Ik0xMjUgMzBMMzEuOSA2My4ybDE0LjIgMTIzLjFMMTI1IDIzMGw3OC45LTQzLjcgMTQuMi0xMjMuMXoiIC8+CiAgICA8cGF0aCBmaWxsPSIjQzMwMDJGIiBkPSJNMTI1IDMwdjIyLjItLjFWMjMwbDc4LjktNDMuNyAxNC4yLTEyMy4xTDEyNSAzMHoiIC8+CiAgICA8cGF0aCAgZmlsbD0iI0ZGRkZGRiIgZD0iTTEyNSA1Mi4xTDY2LjggMTgyLjZoMjEuN2wxMS43LTI5LjJoNDkuNGwxMS43IDI5LjJIMTgzTDEyNSA1Mi4xem0xNyA4My4zaC0zNGwxNy00MC45IDE3IDQwLjl6IiAvPgogIDwvc3ZnPg== "
  /&gt;
  &lt;span&gt;File uploader&lt;/span&gt;
&lt;/div&gt;

&lt;app-uploader&gt;&lt;/app-uploader&gt;

&lt;router-outlet&gt;&lt;/router-outlet&gt;
....</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, our new component <code>uploader</code> will be loaded in the root page. Let&#8217;s add some code to it.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_uploader_component"><a class="anchor" href="#_uploader_component"></a>Uploader component</h2>
<div class="sectionbody">
<div class="paragraph">
<p>I will begin editing the html file. First thing we need is an input component, which will allow us to select the file to upload. Furthermore, I added a button which will be the responsible of calling the upload file window. Apart from this, there is also two labels and a progress bar. Labels will give feedback about file upload request, both with an <code>if</code> clause with <code>uploadSuccess</code> and <code>uploadFail</code> global variables that will be in <code>uploader.component.ts</code>. The progress bar will show the progress of the file being uploaded.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">....
  &lt;div class="upload"&gt;
    &lt;div&gt;
      &lt;button mat-raised-button (click)="upload()"&gt;Upload file&lt;/button&gt;
    &lt;/div&gt;
        &lt;label mat-label *ngIf="uploadSuccess"
      &gt;The file was upload succesfully!&lt;/label
    &gt;
    &lt;label mat-label *ngIf="uploadFail"
      &gt;There was an error uploading the file&lt;/label
    &gt;
    &lt;input
      type="file"
      #fileUpload
      name="fileUpload"
      accept="*"
      style="display: none"
    /&gt;
  &lt;/div&gt;
    &lt;mat-progress-bar
    *ngIf="fileInProgress"
    [value]="fileProgress"
  &gt;&lt;/mat-progress-bar&gt;
&lt;/div&gt;
....</code></pre>
</div>
</div>
<div class="paragraph">
<p>The button will call the upload() method in our <code>uploader.component.ts</code>, and as we can see, I assigned an identifier for the input, <code>#fileUpload</code>, so we can reference it from <code>uploader.component.ts</code>. It accepts any file, and the display none style is because it will be called when we click the button, so it is no necessary to be present in the view.</p>
</div>
<div class="paragraph">
<p>Our html view should look something similar to this:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/blob-streaming/html-view-1.PNG" alt="html view 1" width="600">
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s start in our .ts file. In order to interact with the input <code>#fileUpload</code>, it is necessary to declare it like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">....
@ViewChild('fileUpload') fileUpload: ElementRef;
constructor() {}
....</code></pre>
</div>
</div>
<div class="paragraph">
<p>And then, the upload() method that the button in html is calling:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">....
 upload(): void {
    this.fileUpload.nativeElement.click();

    this.fileUpload.nativeElement.onchange = () =&gt; {
      const file = this.fileUpload.nativeElement.files[0];
      this.uploadFile(file);
    };
  }
....</code></pre>
</div>
</div>
<div class="paragraph">
<p>The click method at first line will open the file explorer in order to select the desired file to upload, and on change method will be called when a new file is selected, so a change is detected. Then, <code>uploadFile(&#8230;&#8203;)</code> method will be called.</p>
</div>
<div class="paragraph">
<p>Before explain this <code>uploadFile(&#8230;&#8203;)</code> method, there is something still missing, a service to communicate with back-end through HTTP.
I am going to place the service in a service folder inside our <code>uploader</code> component folder.
Execute the following command <code>ng generate service data</code> and paste the following code</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">....
export class DataService {
  SERVER_URL = 'http://localhost:8081/services/rest/binary/v1/';

  constructor(private httpClient: HttpClient) {}

  uploadFile(formdData: FormData): Observable&lt;HttpEvent&lt;BinaryObject&gt;&gt; {
    const headers = new HttpHeaders({
      'Content-Type': 'multipart/form-data',
    });

    return this.httpClient.post&lt;BinaryObject&gt;(
      this.SERVER_URL + 'binaryobject',
      formdData,
      {
        headers,
        reportProgress: true,
        observe: 'events',
      }
    );
  }
}
....</code></pre>
</div>
</div>
<div class="paragraph">
<p>We have declared the URL as a global variable. Also is necessary to set the content-type as multipart/form-data in the headers sections, that will be the body of the request. There is also two options to talk about:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>reportProgress</code>: to have a feedback about the file upload so we can show percentage on the view.</p>
</li>
<li>
<p>observe: ' events' in order to receive this type of events information.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In <code>uploader.component.ts</code> is missing <code>uploadFile(&#8230;&#8203;)</code> method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">....
  uploadFile(file: File): void {
    const formDataBody = this.getFormData(file);
    this.dataService.uploadFile(formDataBody).subscribe(
      (event) =&gt; {
        if (event.type == HttpEventType.UploadProgress) {
          this.fileProgress = Math.round((100 * event.loaded) / event.total);
        } else if (event instanceof HttpResponse) {
          this.fileInProgress = false;
          this.uploadSuccess = true;
        }
      },
      (err) =&gt; {
        console.log('Could not upload the file!');
        this.uploadFail = true;
      }
    );
  }
....</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that whether we have a correct response, or an error response, we set the variable <code>this.uploadSuccess</code> or <code>this.uploadFail</code> to show the labels in the html giving feedback.
Once we call the service to do the HTTP request, we expect two types of response(three if we count the error), the first one is the progress of the upload, and will update the progress bar through <code>this.fileProgress</code> variable. The second one is a response when the request is finished.
That is why the type of the response is checked between <code>HttpEventType</code> or <code>HttpResponse</code>.</p>
</div>
<div class="paragraph">
<p>Now, if you have your back-end running, you should be able to upload a file, and check in DB that all the process worked fine.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Download method is not implemented yet.
</td>
</tr>
</table>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
