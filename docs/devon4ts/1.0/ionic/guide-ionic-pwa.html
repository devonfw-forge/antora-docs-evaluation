<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: Devonfw.github.io Docs</title>
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../..">Devonfw.github.io Docs</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="devon4ts" data-version="1.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-explore is-active" data-panel="explore">
  <div class="context">
    <span class="title">Devon4ts</span>
    <span class="version">1.0</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../../../architecture-guidelines/1.0/index.html">Architecture-guidelines</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../architecture-guidelines/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../cicdgen/1.0/index.html">Cicdgen</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../cicdgen/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../cobigen/1.0/index.html">Cobigen</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../cobigen/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../dashboard/1.0/index.html">Dashboard</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../dashboard/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../devon4j/1.0/index.html">Devon4j</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../devon4j/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../devon4net/1.0/index.html">Devon4net</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../devon4net/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../devon4ng/1.0/index.html">Devon4ng</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../devon4ng/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../devon4node/1.0/index.html">Devon4node</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../devon4node/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../devon4quarkus/1.0/index.html">Devon4quarkus</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../devon4quarkus/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="../index.html">Devon4ts</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../devonfw.github.io/1.0/index.html">devonfw.github.io</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../devonfw.github.io/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../getting-started/1.0/index.html">Getting-started</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../getting-started/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../github/1.0/index.html">Github</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../github/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../hangar/1.0/index.html">Hangar</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../hangar/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../ide/1.0/index.html">IDE</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../ide/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../jump-the-queue/1.0/index.html">Jump-the-queue</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../jump-the-queue/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../mrchecker/1.0/index.html">Mrchecker</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../mrchecker/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../my-thai-star/1.0/index.html">My-thai-star</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../my-thai-star/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../production-line/1.0/index.html">Production-line</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../production-line/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../shop-floor/1.0/index.html">Shop-floor</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../shop-floor/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../solicitor/1.0/index.html">Solicitor</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../solicitor/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../sonar-devon4j-plugin/1.0/index.html">Sonar-devon4j-plugin</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../sonar-devon4j-plugin/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../devonfw.github.io/1.0/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
</nav>
  <div class="edit-this-page"><a href="https://github.com/MarvDan/devon4ts/edit/master/modules/ROOT/pages/ionic/guide-ionic-pwa.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<div id="toc" class="toc">
<div id="toctitle" class="title">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#ionic-progressive-web-app">Ionic Progressive Web App</a></li>
<li><a href="#assumptions">Assumptions</a></li>
<li><a href="#sample-application">Sample Application</a></li>
<li><a href="#step-1-create-a-new-project">Step 1: Create a new project</a></li>
<li><a href="#step-2-structures-and-styles">Step 2: Structures and styles</a></li>
<li><a href="#step-3-add-functionality">Step 3: Add functionality</a></li>
<li><a href="#step-4-pwa-elements">Step 4: PWA Elements</a></li>
<li><a href="#step-5-make-it-progressive">Step 5: Make it Progressive.</a></li>
<li><a href="#step-6-configure-the-app">Step 6: Configure the app</a></li>
<li><a href="#step-7-check-that-your-app-is-a-pwa">Step 7: Check that your app is a PWA</a></li>
</ul>
</div>
<div class="sect1">
<h2 id="ionic-progressive-web-app"><a class="anchor" href="#ionic-progressive-web-app"></a>Ionic Progressive Web App</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This guide is a continuation of the guide <a href="guide-angular-pwa">Angular PWAs</a>, therefore, valid concepts explained there are still valid in this page but focused on Ionic.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="assumptions"><a class="anchor" href="#assumptions"></a>Assumptions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This guide assumes that you already have installed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Node.js</p>
</li>
<li>
<p>npm package manager</p>
</li>
<li>
<p>Angular CLI</p>
</li>
<li>
<p>Ionic 5 CLI</p>
</li>
<li>
<p>Capacitor</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Also, it is a good idea to read the document about PWA using Angular.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sample-application"><a class="anchor" href="#sample-application"></a>Sample Application</h2>
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="../_images/images/ionic/ionic-pwa/base.png" alt="Ionic 5 PWA Base" width="250 link="images/ionic/ionic-pwa/base.png"">
</div>
<div class="title">Figure 1. Basic ionic PWA.</div>
</div>
<div class="paragraph">
<p>To explain how to build progressive web apps (PWA) using Ionic, a basic application is going to be built. This app will be able to take photos even without network using PWA elements.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="step-1-create-a-new-project"><a class="anchor" href="#step-1-create-a-new-project"></a>Step 1: Create a new project</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This step can be completed with one simple command: <code>ionic start &lt;name&gt; &lt;template&gt;</code>, where &lt;name&gt; is the name and &lt;template&gt; a model for the app. In this case, the app is going to be named <code><strong>basic-ion-pwa</strong></code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="step-2-structures-and-styles"><a class="anchor" href="#step-2-structures-and-styles"></a>Step 2: Structures and styles</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The styles (scss) and structures (html) do not have anything specially relevant, just colors and ionic web components. The code can be found in <a href="https://github.com/devonfw/devon4ng/tree/master/samples/IonicBasicPWA">devon4ng samples</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="step-3-add-functionality"><a class="anchor" href="#step-3-add-functionality"></a>Step 3: Add functionality</h2>
<div class="sectionbody">
<div class="paragraph">
<p>After this step, the app will allow users take photos and display them in the main screen.
First we have to import three important elements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>DomSanitizer</code>: Sanitizes values to be safe to use.</p>
</li>
<li>
<p><code>SafeResourceUrl</code>: Interface for values that are safe to use as URL.</p>
</li>
<li>
<p>Plugins: Capacitor constant value used to access to the device&#8217;s camera and toast dialogs.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>  import { DomSanitizer, SafeResourceUrl } from '@angular/platform-browser';
  import { Plugins, CameraResultType } from '@capacitor/core';
  const { Camera, Toast } = Plugins;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The process of taking a picture is enclosed in a <strong>takePicture</strong> method. takePicture calls the Camera&#8217;s <em>getPhoto</em> function which returns an URL or an exception. If a photo is taken then the image displayed in the main page will be changed for the new picture, else, if the app is closed without changing it, a toast message will be displayed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>  export class HomePage {
    image: SafeResourceUrl;
    ...

    async takePicture() {
      try {
        const image = await Camera.getPhoto({
          quality: 90,
          allowEditing: true,
          resultType: CameraResultType.Uri,
        });

        // Change last picture shown
        this.image = this.sanitizer.bypassSecurityTrustResourceUrl(image.webPath);
      } catch (e) {
        this.show('Closing camera');
      }
    }

    async show(message: string) {
      await Toast.show({
        text: message,
      });
    }
  }</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="step-4-pwa-elements"><a class="anchor" href="#step-4-pwa-elements"></a>Step 4: PWA Elements</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When Ionic apps are not running natively, some resources like Camera do not work by default but can be enabled using PWA Elements. To use Capacitor&#8217;s PWA elements run <code>npm install @ionic/pwa-elements</code> and modify src/main.ts as shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>...

// Import for PWA elements
import { defineCustomElements } from '@ionic/pwa-elements/loader';

if (environment.production) {
  enableProdMode();
}

platformBrowserDynamic().bootstrapModule(AppModule)
  .catch(err =&gt; console.log(err));

// Call the element loader after the platform has been bootstrapped
defineCustomElements(window);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="step-5-make-it-progressive"><a class="anchor" href="#step-5-make-it-progressive"></a>Step 5: Make it Progressive.</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Turning an Ionic 5 app into a PWA is pretty easy, the same module used to turn Angular apps into PWAs has to be added, to do so, run: <code>ng add @angular/pwa</code>. This command also creates an <strong>icons</strong> folder inside <strong>src/assets</strong> and contains angular icons for multiple resolutions. If you want use other images, be sure that they have the same resolution, the names can be different but the file <strong>manifest.json</strong> has to be changed accordingly.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="step-6-configure-the-app"><a class="anchor" href="#step-6-configure-the-app"></a>Step 6: Configure the app</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>manifest.json</strong></p>
</div>
<div class="paragraph">
<p>Default configuration.</p>
</div>
<div class="paragraph">
<p><strong>ngsw-config.json</strong></p>
</div>
<div class="paragraph">
<p>At <em>assetGroups &#8594; resources</em> add a URLs field and a pattern to match PWA Elements scripts and other resources (images, styles, &#8230;&#8203;):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>  "urls": ["https://unpkg.com/@ionic/pwa-elements@1.0.2/dist/**"]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="step-7-check-that-your-app-is-a-pwa"><a class="anchor" href="#step-7-check-that-your-app-is-a-pwa"></a>Step 7: Check that your app is a PWA</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To check if an app is a PWA lets compare its normal behaviour against itself but built for production. Run in the project&#8217;s root folder the commands below:</p>
</div>
<div class="paragraph">
<p><code>ionic build --prod</code> to build the app using production settings.</p>
</div>
<div class="paragraph">
<p><code>npm install http-server</code> to install an npm module that can serve your built application. Documentation <a href="https://www.npmjs.com/package/http-server">here</a>. A good alternative is also <code>npm install serve</code>. It can be checked <a href="https://github.com/zeit/serve">here</a>.</p>
</div>
<div class="paragraph">
<p>Go to the <code><strong>www</strong></code> folder running <code>cd www</code>.</p>
</div>
<div class="paragraph">
<p><code>http-server -o</code> or <code>serve</code> to serve your built app.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In order not to install anything not necessary <code>npx</code> can be used directly to serve the app. i.e run <code>npx serve [folder]</code> will automatically download and run this HTTP server without installing it in the project dependencies.
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/ionic/ionic-pwa/http-server.png" alt="Http server running" width="600 link="images/ionic/ionic-pwa/http-server.png"">
</div>
<div class="title">Figure 2. Http server running on localhost:8081.</div>
</div>
<div class="paragraph">
<p>&#160;<br>
In another console instance run <code>ionic serve</code> to open the common app (not built).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/ionic/ionic-pwa/ionic-serve.png" alt="Ionic serve on Visual Studio Code console" width="600 link="images/ionic/ionic-pwa/ionic-serve.png"">
</div>
<div class="title">Figure 3. Ionic server running on localhost:8100.</div>
</div>
<div class="paragraph">
<p>&#160;<br>
The first difference can be found on <em>Developer tools &#8594; application</em>, here it is seen that the PWA application (left) has a service worker and the common one does not.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/ionic/ionic-pwa/pwa-nopwa-app.png" alt="Application comparison" width="800 link="images/ionic/ionic-pwa/pwa-nopwa-app.png"">
</div>
<div class="title">Figure 4. Application service worker comparison.</div>
</div>
<div class="paragraph">
<p>&#160;<br>
If the "offline" box is checked, it will force a disconnection from network. In situations where users do not have connectivity or have a slow, one the PWA can still be accessed and used.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/ionic/ionic-pwa/online-offline.png" alt="Online offline apps" width="800 link="images/ionic/ionic-pwa/online-offline.png"">
</div>
<div class="title">Figure 5. Offline application.</div>
</div>
<div class="paragraph">
<p>&#160;<br>
Finally, plugins like <a href="https://chrome.google.com/webstore/detail/lighthouse/blipmdconlkpinefehnmjammfjpmpbjk">Lighthouse</a> can be used to test whether an application is progressive or not.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/ionic/ionic-pwa/lighthouse.png" alt="Lighthouse report" width="800 link="images/ionic/ionic-pwa/lighthouse.png"">
</div>
<div class="title">Figure 6. Lighthouse report.</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
