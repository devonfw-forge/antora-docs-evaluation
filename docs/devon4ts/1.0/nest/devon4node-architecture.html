<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: Devonfw.github.io Docs</title>
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../..">Devonfw.github.io Docs</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="devon4ts" data-version="1.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-explore is-active" data-panel="explore">
  <div class="context">
    <span class="title">Devon4ts</span>
    <span class="version">1.0</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../../../architecture-guidelines/1.0/index.html">Architecture-guidelines</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../architecture-guidelines/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../cicdgen/1.0/index.html">Cicdgen</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../cicdgen/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../cobigen/1.0/index.html">Cobigen</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../cobigen/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../dashboard/1.0/index.html">Dashboard</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../dashboard/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../devon4j/1.0/index.html">Devon4j</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../devon4j/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../devon4net/1.0/index.html">Devon4net</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../devon4net/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../devon4ng/1.0/index.html">Devon4ng</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../devon4ng/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../devon4node/1.0/index.html">Devon4node</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../devon4node/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../devon4quarkus/1.0/index.html">Devon4quarkus</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../devon4quarkus/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="../index.html">Devon4ts</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../devonfw.github.io/1.0/index.html">devonfw.github.io</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../devonfw.github.io/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../getting-started/1.0/index.html">Getting-started</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../getting-started/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../github/1.0/index.html">Github</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../github/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../hangar/1.0/index.html">Hangar</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../hangar/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../ide/1.0/index.html">IDE</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../ide/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../jump-the-queue/1.0/index.html">Jump-the-queue</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../jump-the-queue/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../mrchecker/1.0/index.html">Mrchecker</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../mrchecker/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../my-thai-star/1.0/index.html">My-thai-star</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../my-thai-star/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../production-line/1.0/index.html">Production-line</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../production-line/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../shop-floor/1.0/index.html">Shop-floor</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../shop-floor/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../solicitor/1.0/index.html">Solicitor</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../solicitor/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../sonar-devon4j-plugin/1.0/index.html">Sonar-devon4j-plugin</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../sonar-devon4j-plugin/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../devonfw.github.io/1.0/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
</nav>
  <div class="edit-this-page"><a href="https://github.com/MarvDan/devon4ts/edit/master/modules/ROOT/pages/nest/devon4node-architecture.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<div id="toc" class="toc">
<div id="toctitle" class="title">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#devon4node-architecture">devon4node Architecture</a></li>
<li><a href="#http-layer">HTTP layer</a></li>
<li><a href="#devon4node-layers">devon4node layers</a></li>
<li><a href="#devon4node-application-structure">devon4node application structure</a></li>
<li><a href="#modules">Modules</a></li>
<li><a href="#folder-structure">Folder structure</a></li>
<li><a href="#nestjs-components">NestJS components</a></li>
</ul>
</div>
<div class="sect1">
<h2 id="devon4node-architecture"><a class="anchor" href="#devon4node-architecture"></a>devon4node Architecture</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As we have mentioned in the introduction, devon4node is based on <a href="https://nestjs.com/">NestJS</a>. Nest (NestJS) is a framework for building efficient, scalable Node.js server-side applications.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="http-layer"><a class="anchor" href="#http-layer"></a>HTTP layer</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By using <a href="https://nestjs.com/">NestJS</a>, devon4node is a platform-agnostic framework. NestJS focuses only on the logical layer, and delegates the transport layer to another framework, such as ExpressJS. You can see it in the following diagram:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/devon4node-architecture.png" alt="devon4node architecture">
</div>
</div>
<div class="paragraph">
<p>As you can see, NestJS do not listen directly for incoming request. It has an adapter to communicate with ExpressJS and ExpressJS is the responsible for that. ExpressJS is only one of the frameworks that NestJS can work with. We have also another adapter available out-of-the-box: the <a href="https://www.fastify.io/">Fastify</a> adapter. With that, you can replace ExpressJS for Fastify But you can still use all your NestJS components. You can also create your own adapter to make NestJS work with other HTTP framework.</p>
</div>
<div class="paragraph">
<p>At this point, you may think: why is NestJS (and devon4node) using ExpressJS by default instead of Fastify? Because, as you can see in the previous diagram, there is a component that is dependent on the HTTP framework: the middleware. As ExpressJS is the most widely used framework, there exists a lot of middleware for it, so, in order to reuse them in our NestJS applications, NestJS use ExpressJS by default. Anyway, you may think which HTTP framework best fits your requirements.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="devon4node-layers"><a class="anchor" href="#devon4node-layers"></a>devon4node layers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As other devonfw technologies, devon4node separates the application into layers.</p>
</div>
<div class="paragraph">
<p>Those layers are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="layer-controller">Controller layer</a></p>
</li>
<li>
<p><a href="layer-service">Service layer</a></p>
</li>
<li>
<p><a href="layer-dataaccess">Data Access layer</a></p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/plantuml/layers.png" alt="layers">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="devon4node-application-structure"><a class="anchor" href="#devon4node-application-structure"></a>devon4node application structure</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Although there are many frameworks to create backend applications in NodeJS, none of them effectively solve the main problem of - Architecture. This is the main reason we have chosen NestJS for the devon4node applications. Besides, NestJS is highly inspired by <a href="https://angular.io/">Angular</a>, therefore a developer who knows Angular can use his already acquired knowledge to write devon4node applications.</p>
</div>
<div class="paragraph">
<p>NestJS adopts various Angular concepts, such as dependency injection, piping, interceptors and modularity, among others. By using modularity we can reuse some of our modules between applications. One example that devon4node provide is the <a href="guides-mailer">mailer module</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="modules"><a class="anchor" href="#modules"></a>Modules</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Create a application module is simple, you only need to create an empty class with the decorator <code>Module</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">@Module({})
export class AppModule {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the module you can define:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Imports: the list of imported modules that export the providers which are required in this module</p>
</li>
<li>
<p>Controllers: the set of controllers defined in this module which have to be instantiated</p>
</li>
<li>
<p>Providers: the providers that will be instantiated by the Nest injector and that may be shared at least across this module</p>
</li>
<li>
<p>Exports: the subset of providers that are provided by this module and should be available in other modules which import this module</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The main difference between Angular and NestJS is NestJS modules encapsulates providers by default. This means that it&#8217;s impossible to inject providers that are neither directly part of the current module nor exported from the imported modules. Thus, you may consider the exported providers from a module as the module&#8217;s public interface, or API. Example of modules graph:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/plantuml/modules.png" alt="modules">
</div>
</div>
<div class="paragraph">
<p>In devon4node we three different kind of modules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>AppModule</code>: this is the root module. Everything that our application need must be imported here.</p>
</li>
<li>
<p>Global Modules: this is a special kind of modules. When you make a module global, it&#8217;s accessible for every module in your application. Your can see it in the next diagram. It&#8217;s the same as the previous one, but now the <code>CoreModule</code> is global:</p>
<div class="imageblock">
<div class="content">
<img src="../_images/images/plantuml/module2.png" alt="module2">
</div>
</div>
<div class="paragraph">
<p>One example of global module is the <code>CoreModule</code>. In the <code>CoreModule</code> you must import every module which have providers that needs to be accessible in all modules of you application</p>
</div>
</li>
<li>
<p>Feature (or application) modules: modules which contains the logic of our application. We must import it in the <code>AppModule</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information about modules, see <a href="https://docs.nestjs.com/modules">NestJS documentation page</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="folder-structure"><a class="anchor" href="#folder-structure"></a>Folder structure</h2>
<div class="sectionbody">
<div class="paragraph">
<p>devon4node defines a folder structure that every devon4node application must follow. The folder structure is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>├───src
│   ├───app
│   │   ├───core
│   │   │   ├───auth
│   │   │   ├───configuration
│   │   │   ├───user
│   │   │   └───core.module.ts
│   │   ├───shared
│   │   └───feature
│   │       ├───sub-module
│   │       │   ├───controllers
│   │       │   ├───...
│   │       │   ├───services
│   │       │   └───sub-module.module.ts
│   │       ├───controllers
│   │       ├───interceptors
│   │       ├───pipes
│   │       ├───guards
│   │       ├───filters
│   │       ├───middlewares
│   │       ├───model
│   │       │   ├───dto
│   │       │   └───entities
│   │       ├───services
│   │       └───feature.module.ts
│   ├───config
│   └───migration
├───test
└───package.json</pre>
</div>
</div>
<div class="paragraph">
<p><a href="guides-code-generation">devon4node schematics</a> ensures this folder structure so, please, do not create files by your own, use the <a href="guides-code-generation">devon4node schematics</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="nestjs-components"><a class="anchor" href="#nestjs-components"></a>NestJS components</h2>
<div class="sectionbody">
<div class="paragraph">
<p>NestJS provides several components that you can use in your application:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.nestjs.com/controllers">Controllers</a></p>
</li>
<li>
<p><a href="https://docs.nestjs.com/providers">Providers</a></p>
</li>
<li>
<p><a href="https://docs.nestjs.com/middleware">Middleware</a></p>
</li>
<li>
<p><a href="https://docs.nestjs.com/guards">Guards</a></p>
</li>
<li>
<p><a href="https://docs.nestjs.com/interceptors">Interceptors</a></p>
</li>
<li>
<p><a href="https://docs.nestjs.com/pipes">Pipes</a></p>
</li>
<li>
<p><a href="https://docs.nestjs.com/exception-filters">Exception filters</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the <a href="https://docs.nestjs.com">NestJS documentation</a> you can find all information about each component. But, something that is missing in the documentation is the execution order. Every component can be defined in different levels: globally, in the controller or in the handler. As middleware is part of the HTTP server we can define it in a different way: globally or in the module.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/plantuml/components.png" alt="components">
</div>
</div>
<div class="paragraph">
<p>It is not necessary to have defined components in every level. For example, you can have defined a interceptor globally but you do not have any other in the controller or handler level. If nothing is defined in some level, the request will continue to the next component.</p>
</div>
<div class="paragraph">
<p>As you can see in the previous image, the first component which receive the request is the global defined middleware. Then, it send the request to the module middleware. Each of them can return a response to the client, without passing the request to the next level.</p>
</div>
<div class="paragraph">
<p>Then, the request continue to the guards: first the global guard, next to controller guard and finally to the handler guard. At this point, we can throw an exception in all components and the exception filter will catch it and send a proper error message to the client. We do not paint the filters in the graphic in order to simplify it.</p>
</div>
<div class="paragraph">
<p>After the guards, is time to interceptors: global interceptors, controller interceptors and handler interceptors. And last, before arrive to the handler inside the controller, the request pass through the pipes.</p>
</div>
<div class="paragraph">
<p>When the handler has the response ready to send to the client, it does not go directly to the client. It come again to the interceptors, so we can also intercept the response. The order this time is the reverse: handler interceptors, controller interceptors and global interceptors. After that, we can finally send the response to the client.</p>
</div>
<div class="paragraph">
<p>Now, with this in mind, you are able to create the components in a better way.</p>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
