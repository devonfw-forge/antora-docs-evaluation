<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: Devonfw.github.io Docs</title>
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../..">Devonfw.github.io Docs</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="devon4ts" data-version="1.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-explore is-active" data-panel="explore">
  <div class="context">
    <span class="title">Devon4ts</span>
    <span class="version">1.0</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../../../architecture-guidelines/1.0/index.html">Architecture-guidelines</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../architecture-guidelines/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../cicdgen/1.0/index.html">Cicdgen</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../cicdgen/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../cobigen/1.0/index.html">Cobigen</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../cobigen/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../dashboard/1.0/index.html">Dashboard</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../dashboard/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../devon4j/1.0/index.html">Devon4j</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../devon4j/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../devon4net/1.0/index.html">Devon4net</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../devon4net/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../devon4ng/1.0/index.html">Devon4ng</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../devon4ng/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../devon4node/1.0/index.html">Devon4node</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../devon4node/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../devon4quarkus/1.0/index.html">Devon4quarkus</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../devon4quarkus/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="../index.html">Devon4ts</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../devonfw.github.io/1.0/index.html">devonfw.github.io</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../devonfw.github.io/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../getting-started/1.0/index.html">Getting-started</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../getting-started/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../github/1.0/index.html">Github</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../github/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../hangar/1.0/index.html">Hangar</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../hangar/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../ide/1.0/index.html">IDE</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../ide/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../jump-the-queue/1.0/index.html">Jump-the-queue</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../jump-the-queue/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../mrchecker/1.0/index.html">Mrchecker</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../mrchecker/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../my-thai-star/1.0/index.html">My-thai-star</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../my-thai-star/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../production-line/1.0/index.html">Production-line</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../production-line/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../shop-floor/1.0/index.html">Shop-floor</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../shop-floor/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../solicitor/1.0/index.html">Solicitor</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../solicitor/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../sonar-devon4j-plugin/1.0/index.html">Sonar-devon4j-plugin</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../sonar-devon4j-plugin/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../devonfw.github.io/1.0/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
</nav>
  <div class="edit-this-page"><a href="https://github.com/MarvDan/devon4ts/edit/master/modules/ROOT/pages/nest/guides-mailer.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<div id="toc" class="toc">
<div id="toctitle" class="title">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#mailer-module">Mailer Module</a></li>
<li><a href="#installing">Installing</a></li>
<li><a href="#configuring">Configuring</a></li>
<li><a href="#forroot"><code>forRoot()</code></a></li>
<li><a href="#forrootasync"><code>forRootAsync()</code></a></li>
<li><a href="#usage">Usage</a></li>
<li><a href="#mailerservice-methods"><code>MailerService</code> methods</a></li>
<li><a href="#sendplainmail">==  <code>sendPlainMail</code></a></li>
<li><a href="#sendtemplatemail">==  <code>sendTemplateMail</code></a></li>
<li><a href="#addtemplate">==  <code>addTemplate</code></a></li>
<li><a href="#registerpartial">==  <code>registerPartial</code></a></li>
<li><a href="#registerhelper">==  <code>registerHelper</code></a></li>
<li><a href="#handlebars-templates">Handlebars templates</a></li>
<li><a href="#local-development">Local development</a></li>
</ul>
</div>
<div class="sect1">
<h2 id="mailer-module"><a class="anchor" href="#mailer-module"></a>Mailer Module</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This module enables you to send emails in devon4node. It also provides a template engine using Handlebars.</p>
</div>
<div class="paragraph">
<p>It is a NestJS module that inject into your application a <code>MailerService</code>, which is the responsible to send the emails using the nodemailer library.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="installing"><a class="anchor" href="#installing"></a>Installing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Execute the following command in a devon4node project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">yarn add @devon4node/mailer</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuring"><a class="anchor" href="#configuring"></a>Configuring</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To configure the mailer module, you only need to import it in your application into another module. Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">@Module({
  ...
  imports: [
    MailerModule.forRoot(),
  ],
  ...
})</code></pre>
</div>
</div>
<div class="paragraph">
<p>Your must pass the configuration using the <code>forRoot</code> or <code>forRootAsync</code> methods.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="forroot"><a class="anchor" href="#forroot"></a><code>forRoot()</code></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>forRoot</code> method receives an <code>MailerModuleOptions</code> object as parameter. It configures the <code>MailerModule</code> using the input <code>MailerModuleOptions</code> object.</p>
</div>
<div class="paragraph">
<p>The structure of <code>MailerModuleOptions</code> is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">{
  hbsOptions?: {
    templatesDir: string;
    extension?: string;
    partialsDir?: string;
    helpers?: IHelperFunction[];
    compilerOptions?: ICompileOptions;
  },
  mailOptions?: nodemailerSmtpTransportOptions;
  emailFrom: string;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, you need to specify the <a href="https://handlebarsjs.com/api-reference/compilation.html#handlebars-compile-template-options">Handlebars compile options</a>, the <a href="https://nodemailer.com/smtp">nodemailer transport options</a> and the email address which will send the emails.
Then, you need to call to <code>forRoot</code> function in the module imports. Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">@Module({
  ...
  imports: [
    MailerModule.forRoot({
      mailOptions: {
        host: 'localhost',
        port: 1025,
        secure: false,
        tls: {
          rejectUnauthorized: false,
        },
      },
      emailFrom: 'noreply@capgemini.com',
      hbsOptions: {
        templatesDir: join(__dirname, '../..', 'templates/views'),
        partialsDir: join(__dirname, '../..', 'templates/partials'),
        helpers: [{
          name: 'fullname',
          func: person =&gt; `${person.name} ${person.surname}`,s
        }],
      },
    }),
  ...
})</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="forrootasync"><a class="anchor" href="#forrootasync"></a><code>forRootAsync()</code></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The method <code>forRootAsync</code> enables you to get the mailer configuration in a asynchronous way. It is useful when you need to get the configuration using, for example, a service (e.g. <code>ConfigurationService</code>).</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">@Module({
  ...
  imports: [
    MailerModule.forRootAsync({
      imports: [ConfigurationModule],
      useFactory: (config: ConfigurationService) =&gt; {
        return config.mailerConfig;
      },
      inject: [ConfigurationService],
    }),
  ...
})</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, we use the <code>ConfigurationService</code> in order to get the <code>MailerModuleOptions</code> (the same as <code>forRoot</code>)</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="usage"><a class="anchor" href="#usage"></a>Usage</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In order to use, you only need to inject using the dependency injection the <code>MailerService</code>.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">@Injectable()
export class CatsService {
  constructor(private readonly mailer: MailerService) {}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, you only need to use the methods provided by the <code>MailerService</code> in your service. Take into account that you can inject it in every place that support NestJS dependency injection.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="mailerservice-methods"><a class="anchor" href="#mailerservice-methods"></a><code>MailerService</code> methods</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="sendplainmail"><a class="anchor" href="#sendplainmail"></a>==  <code>sendPlainMail</code></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The method <code>sendPlainMail</code> receive a string sends a email.</p>
</div>
<div class="paragraph">
<p>The method signatures are:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">sendPlainMail(emailOptions: SendMailOptions): Promise&lt;SentMessageInfo&gt;;
sendPlainMail(to: string, subject: string, mail: string): Promise&lt;SentMessageInfo&gt;;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">this.mailer.sendPlainMail({
  to: 'example@example.com',
  subject: 'This is a subject',
  html: '&lt;h1&gt;Hello world&lt;/h1&gt;'
});
this.mailer.sendPlainMail('example@example.com', 'This is a subject', '&lt;h1&gt;Hello world&lt;/h1&gt;');</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sendtemplatemail"><a class="anchor" href="#sendtemplatemail"></a>==  <code>sendTemplateMail</code></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The method <code>sendTemplateMail</code> sends a email based on a Handlebars template. The templates are registered using the <code>templatesDir</code> option or using the <code>addTemplate</code> method.
The template name is the name of the template (without extension) or the first parameter of the method <code>addTemplate</code>.</p>
</div>
<div class="paragraph">
<p>The method signatures are:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">sendTemplateMail(emailOptions: SendMailOptions, templateName: string, emailData: any, hbsOptions?: RuntimeOptions): Promise&lt;SentMessageInfo&gt;;
sendTemplateMail(to: string, subject: string, templateName: string, emailData: any, hbsOptions?: RuntimeOptions): Promise&lt;SentMessageInfo&gt;;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">this.mailer.sendTemplateMail({
  to: 'example@example.com',
  subject: 'This is a subject',
  html: '&lt;h1&gt;Hello world&lt;/h1&gt;'
}, 'template1', { person: {name: 'Dario', surname: 'Rodriguez'}});
this.mailer.sendTemplateMail('example@example.com', 'This is a subject', 'template1', { person: {name: 'Dario', surname: 'Rodriguez'}});</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="addtemplate"><a class="anchor" href="#addtemplate"></a>==  <code>addTemplate</code></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Adds a new template to the <code>MailerService</code>.</p>
</div>
<div class="paragraph">
<p>Method signature:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">addTemplate(name: string, template: string, options?: CompileOptions): void;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">this.mailer.addTemplate('newTemplate', '&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;{{&gt;partial1}}&lt;/body&gt;&lt;/html&gt;')</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="registerpartial"><a class="anchor" href="#registerpartial"></a>==  <code>registerPartial</code></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Register a new partial in Handlebars.</p>
</div>
<div class="paragraph">
<p>Method signature:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">registerPartial(name: string, partial: Handlebars.Template&lt;any&gt;): void;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">this.mailer.registerPartial('partial', '&lt;h1&gt;Hello World&lt;/h1&gt;')</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="registerhelper"><a class="anchor" href="#registerhelper"></a>==  <code>registerHelper</code></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Register a new helper in Handlebars.</p>
</div>
<div class="paragraph">
<p>Method signature:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">registerHelper(name: string, helper: Handlebars.HelperDelegate): void;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">this.mailer.registerHelper('fullname', person =&gt; `${person.name} ${person.surname}`)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="handlebars-templates"><a class="anchor" href="#handlebars-templates"></a>Handlebars templates</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As mentioned above, this module allow you to use Handlebars as template engine, but it is optional. If you do not need the Handlebars, you just need to keep the <code>hbsOptions</code> undefined.</p>
</div>
<div class="paragraph">
<p>In order to get the templates form the file system, you can specify the template folder, the partials folder and the helpers.
At the moment of module initialization, it will read the content of the template folder, and will register every file with the name (without extension) and the content as Handlebars template. It will do the same for the partials.</p>
</div>
<div class="paragraph">
<p>You can specify the extension of template files using the <code>extension</code> parameter. The default value is <code>.handlebars</code></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="local-development"><a class="anchor" href="#local-development"></a>Local development</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you want to work with this module but you don&#8217;t have a SMTP server, you can use the <code>streamTransport</code>. Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">{
  mailOptions: {
    streamTransport: true,
    newline: 'windows',
  },
  emailFrom: ...
  hbsOptions: ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, you need to get the <code>sendPlainMail</code> or <code>sendTemplateMail</code> result, and print the email to the standard output (<code>STDOUT</code>). Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">const mail = await this.mailer.sendTemplateMail(...);

mail.message.pipe(process.stdout);</code></pre>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
