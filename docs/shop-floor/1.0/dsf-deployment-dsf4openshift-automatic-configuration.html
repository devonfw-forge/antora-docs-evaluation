<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: Devonfw.github.io Docs</title>
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../_/css/site.css">
    <script>var uiRootPath = '../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../..">Devonfw.github.io Docs</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="shop-floor" data-version="1.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-explore is-active" data-panel="explore">
  <div class="context">
    <span class="title">Shop-floor</span>
    <span class="version">1.0</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../../architecture-guidelines/1.0/index.html">Architecture-guidelines</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../architecture-guidelines/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../cicdgen/1.0/index.html">Cicdgen</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../cicdgen/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../cobigen/1.0/index.html">Cobigen</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../cobigen/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../dashboard/1.0/index.html">Dashboard</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../dashboard/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../devon4j/1.0/index.html">Devon4j</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../devon4j/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../devon4net/1.0/index.html">Devon4net</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../devon4net/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../devon4ng/1.0/index.html">Devon4ng</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../devon4ng/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../devon4node/1.0/index.html">Devon4node</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../devon4node/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../devon4quarkus/1.0/index.html">Devon4quarkus</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../devon4quarkus/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../devon4ts/1.0/index.html">Devon4ts</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../devon4ts/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../devonfw.github.io/1.0/index.html">devonfw.github.io</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../devonfw.github.io/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../getting-started/1.0/index.html">Getting-started</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../getting-started/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../github/1.0/index.html">Github</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../github/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../hangar/1.0/index.html">Hangar</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../hangar/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../ide/1.0/index.html">IDE</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../ide/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../jump-the-queue/1.0/index.html">Jump-the-queue</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../jump-the-queue/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../mrchecker/1.0/index.html">Mrchecker</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../mrchecker/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../my-thai-star/1.0/index.html">My-thai-star</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../my-thai-star/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../production-line/1.0/index.html">Production-line</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../production-line/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="index.html">Shop-floor</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../solicitor/1.0/index.html">Solicitor</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../solicitor/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../sonar-devon4j-plugin/1.0/index.html">Sonar-devon4j-plugin</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../sonar-devon4j-plugin/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../devonfw.github.io/1.0/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
</nav>
  <div class="edit-this-page"><a href="https://github.com/MarvDan/shop-floor/edit/develop/modules/ROOT/pages/dsf-deployment-dsf4openshift-automatic-configuration.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<div class="sect1">
<h2 id="_openshift_deployment_environment_automatic_configuration"><a class="anchor" href="#_openshift_deployment_environment_automatic_configuration"></a>OpenShift deployment environment automatic configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this section you will see how you can create a new environment instance in your OpenShift cluster to deploy devonfw projects using docker images.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_prerequisites"><a class="anchor" href="#_prerequisites"></a>Prerequisites</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_add_openshift_client_to_jenkins"><a class="anchor" href="#_add_openshift_client_to_jenkins"></a>Add OpenShift Client to Jenkins</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To integrate it, you need to have installed the plugin OpenShift Client. To install it go to Manage Jenkins clicking on left menu and enter in <strong><em>Manage Plugins</em></strong>. Go to Available tab and search it using the filter textbox in the top right corner and install it.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration_openshift_client_in_jenkins"><a class="anchor" href="#_configuration_openshift_client_in_jenkins"></a>Configuration OpenShift Client in Jenkins</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Second, you need to configure the OC Client. Go to Manage Jenkins clicking on left menu and enter in <strong><em>Global Tool Configuration</em></strong>.</p>
</div>
<div class="paragraph">
<p>Go to OpenShift Client Tools section and add a new one like this.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/images/configuration/openshift-jenkins-plugin.png" alt="openshift jenkins plugin">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_devonfw_project"><a class="anchor" href="#_devonfw_project"></a>devonfw project</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You need to have a devonfw project in a git repository or a docker image uploaded to a docker registry.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comunication_between_components"><a class="anchor" href="#_comunication_between_components"></a>Comunication between components</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Jenkins must have access to git, docker registry and OpenShift.</p>
</div>
<div class="paragraph">
<p>Openshift must have access to docker registry.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_jenkinsfiles_to_configure_openshift"><a class="anchor" href="#_jenkinsfiles_to_configure_openshift"></a>Jenkinsfiles to Configure OpenShift</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can find one Jenkinsfile per devonfw technology in <a href="https://github.com/devonfw/devonfw-shop-floor/tree/develop/dsf4openshift/configure-environments">devonfw shop floor</a> repository to configure automatically your OpenShift cluster.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_use_it"><a class="anchor" href="#_how_to_use_it"></a>How to use it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To use it you need to follow the next steps</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_create_a_new_pipeline"><a class="anchor" href="#_create_a_new_pipeline"></a>Create a new pipeline</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You need to create a new pipeline in your repository and point it to Jenkinsfile in devonfw shop floor repository.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/images/configuration/openshift-jenkins-configure-environments-repo.jpg" alt="openshift jenkins configure environments repo">
</div>
</div>
<div class="paragraph">
<p>Note: In the script path section you should use the Jenkinsfile of the technology that you need.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_build_with_parameters"><a class="anchor" href="#_build_with_parameters"></a>Build with parameters</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The first time that you execute the pipeline is going to fail because Jenkins does not know that this pipeline needs parameters to execute. The better that you can do is stop it manually when <em>Declarative: Checkout SCM</em> is over.</p>
</div>
<div class="paragraph">
<p>Then you could see a button to Build with Parameters, click on it and fill the next form, these are the parameters:</p>
</div>
<div class="paragraph">
<p><strong>Docker registry credentials for OpenShift</strong></p>
</div>
<div class="paragraph">
<p><code>CREATE_SECRET</code>: This option allows you to add the credentials of your docker registry in your OpenShift and stored it as a secret called docker-registry + registry_secret_name_suffix value.</p>
</div>
<div class="paragraph">
<p>Remember that you only need one secret to connect with your registry per namespace, if you are going to add more than one application in the same namespace that use the same registry, use the same name suffix and please do not create more than one secret in the same namespace. The namespace is the OpenShift project when you are going to deploy your application.</p>
</div>
<div class="paragraph">
<p>You can see your secrets stored in OpenShift going to OpenShift and click on the left menu:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/images/configuration/openshift-secrets-menu.jpg" alt="openshift secrets menu">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If the secret exists, you should uncheck the checkbox and fill the name suffix to use it.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>REGISTRY_SECRET_NAME_SUFFIX</code>: This is the suffix of the name for your docker registry credentials stored in OpenShift as a secret. The name is going to be docker-registry + this suffix, if you use more than one docker-registry in the same namespace you need to add a suffix. For example you could add the name of your project, then to have the name as docker-registry-myprojectname you should use -myprojectname value.</p>
</div>
<div class="paragraph">
<p><strong>Build your docker image using OpenShift and store it in your docker registry</strong></p>
</div>
<div class="paragraph">
<p><code>CREATE_DOCKER_BUILDER</code>: This option allows you to create a build configuration in your OpenShift to create the docker images of your project and store them in your docker registry. If you are going to create the builder, your application is needed, you need to specify where is your git repository and which is the branch and credentials to use it.</p>
</div>
<div class="paragraph">
<p>The following parameters of this section are only necessary if a builder is to be created.</p>
</div>
<div class="paragraph">
<p><code>GIT_REPOSITORY</code>: This is the url of your git repository.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you are using production line, remember to use the internal rout of your repository, to use it you must change the base url of your production line for the internal route <code><a href="http://gitlab-core:80/gitlab" class="bare">http://gitlab-core:80/gitlab</a></code>. For example, if your production line repository is for example <code><a href="https://shared-services.pl.s2-eu.capgemini.com/gitlab/boat/boat-frontend.git" class="bare">https://shared-services.pl.s2-eu.capgemini.com/gitlab/boat/boat-frontend.git</a></code> use <code><a href="http://gitlab-core:80/gitlab/boat/boat-frontend.git" class="bare">http://gitlab-core:80/gitlab/boat/boat-frontend.git</a></code>)
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>GIT_BRANCH</code>: This is the branch that we are going to use for creating the first docker image. The next time that you are going to use the builder you could use another branches.</p>
</div>
<div class="paragraph">
<p><code>GIT_CREDENTIALS</code>: This is the credentials id stored in your jenkins to download the code from your git repository.</p>
</div>
<div class="paragraph">
<p><code>BUILD_SCRIPT</code>: In case of use devon4ng or devon4node you could specify which is the build script used to build and create the first docker image with this builder.</p>
</div>
<div class="paragraph">
<p><code>JAVA_VERSION</code> In case of use devon4j this is the java version used for your docker image.</p>
</div>
<div class="paragraph">
<p><strong>Docker registry information</strong></p>
</div>
<div class="paragraph">
<p><code>DOCKER_REGISTRY</code>: This is the url of your docker registry.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you are using production line, the url of your registry is docker-registry- + your production line url. For example, if your production line is <code>shared-services.pl.s2-eu.capgemini.com</code> your docker registry is <code>docker-registry-shared-services.pl.s2-eu.capgemini.com</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you cannot access to your docker registry, please open an incident in i4u.</p>
</div>
<div class="paragraph">
<p><code>DOCKER_REGISTRY_CREDENTIALS</code>: This is the credentials id stored in your jenkins to download or upload docker images in your docker registry.</p>
</div>
<div class="paragraph">
<p><code>DOCKER_TAG</code>: This is the tag that is going to be used for the builder to push the docker image and for the deployment config to pull and deploy it.</p>
</div>
<div class="paragraph">
<p><strong>OpenShift cluster information</strong></p>
</div>
<div class="paragraph">
<p><code>OPENSHIFT_URL</code>: This is the url of your OpenShift cluster.</p>
</div>
<div class="paragraph">
<p><code>OPENSHIFT_CREDENTIALS</code>: This is the credentials id stored in your jenkins to use OpenShift.</p>
</div>
<div class="paragraph">
<p><code>OPENSHIFT_NAMESPACE</code>: This is the name of the project in your OpenShift where you are going to use. The name of the project in OpenShift is called namespace.</p>
</div>
<div class="paragraph">
<p>Take care because although you see at the top of your OpenShift interface the name of the project that you are using, this name is the display-name and not the value that you need. To obtain the correct value you must check your OpenShift url like you see in the next image:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/images/configuration/openshift-namespace-name.jpg" alt="openshift namespace name">
</div>
</div>
<div class="paragraph">
<p><code>APP_NAME_SUFFIX</code>: The name of all things created in your OpenShift project are going to be called as the configuration of your application says. Normaly, our projects use a suffix that depends on the environment. You can see the values in the next list:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For develop branch we use <code>-dev</code></p>
</li>
<li>
<p>For release branch we use <code>-uat</code></p>
</li>
<li>
<p>For master branch we use <code>-prod</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>HOSTNAME</code>: If you do not specify nothing, OpenShift is going to autogenerate a valid url for your application. You could modify the value by default but be sure that you configure everything to server your application in the route that you specify.</p>
</div>
<div class="paragraph">
<p><code>SECURED_PROTOCOL</code>: If true, the protocol for the route will be https otherwise will be http.</p>
</div>
<div class="paragraph">
<p><strong>Jenkins tools</strong></p>
</div>
<div class="paragraph">
<p>All those parameters are the name of the tools in your Jenkinsfile.</p>
</div>
<div class="paragraph">
<p>To obtain it you need enter in your Jenkins and go to Manage Jenkins clicking on left menu and enter in <strong><em>Global Tool Configuration</em></strong> or in <strong><em>Managed files</em></strong>.</p>
</div>
<div class="paragraph">
<p><code>OPENSHIFT_TOOL</code>: Is located in Global tool configuration.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/images/configuration/openshift-jenkins-plugin-name.jpg" alt="openshift jenkins plugin name">
</div>
</div>
<div class="paragraph">
<p><code>NODEJS_TOOL</code>: Is located in Global tool configuration.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/images/configuration/jenkins-openshift-tool.jpg" alt="jenkins openshift tool">
</div>
</div>
<div class="paragraph">
<p><code>YARN_TOOL</code>: Is located in Global tool configuration, inside the custom tools.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/images/configuration/jenkins-yarn-tool-name.jpg" alt="jenkins yarn tool name">
</div>
</div>
<div class="paragraph">
<p><code>GLOBAL_SETTINGS_ID</code> Is located in Managed files. You need to click on edit button and take the id.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/images/configuration/jenkins-config-file-management.jpg" alt="jenkins config file management">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/images/configuration/jenkins-edit-configuration-file.jpg" alt="jenkins edit configuration file">
</div>
</div>
<div class="paragraph">
<p><code>MAVEN_INSTALLATION</code> Is located in Global tool configuration.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/images/configuration/jenkins-mave-tool-name.jpg" alt="jenkins mave tool name">
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
