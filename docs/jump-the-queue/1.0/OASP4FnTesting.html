<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: Devonfw.github.io Docs</title>
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../_/css/site.css">
    <script>var uiRootPath = '../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../..">Devonfw.github.io Docs</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="jump-the-queue" data-version="1.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-explore is-active" data-panel="explore">
  <div class="context">
    <span class="title">Jump-the-queue</span>
    <span class="version">1.0</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../../architecture-guidelines/1.0/index.html">Architecture-guidelines</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../architecture-guidelines/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../cicdgen/1.0/index.html">Cicdgen</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../cicdgen/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../cobigen/1.0/index.html">Cobigen</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../cobigen/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../dashboard/1.0/index.html">Dashboard</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../dashboard/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../devon4j/1.0/index.html">Devon4j</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../devon4j/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../devon4net/1.0/index.html">Devon4net</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../devon4net/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../devon4ng/1.0/index.html">Devon4ng</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../devon4ng/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../devon4node/1.0/index.html">Devon4node</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../devon4node/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../devon4quarkus/1.0/index.html">Devon4quarkus</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../devon4quarkus/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../devon4ts/1.0/index.html">Devon4ts</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../devon4ts/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../devonfw.github.io/1.0/index.html">devonfw.github.io</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../devonfw.github.io/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../getting-started/1.0/index.html">Getting-started</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../getting-started/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../github/1.0/index.html">Github</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../github/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../hangar/1.0/index.html">Hangar</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../hangar/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../ide/1.0/index.html">IDE</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../ide/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="index.html">Jump-the-queue</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../mrchecker/1.0/index.html">Mrchecker</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../mrchecker/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../my-thai-star/1.0/index.html">My-thai-star</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../my-thai-star/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../production-line/1.0/index.html">Production-line</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../production-line/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../shop-floor/1.0/index.html">Shop-floor</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../shop-floor/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../solicitor/1.0/index.html">Solicitor</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../solicitor/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../sonar-devon4j-plugin/1.0/index.html">Sonar-devon4j-plugin</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../sonar-devon4j-plugin/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../devonfw.github.io/1.0/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
</nav>
  <div class="edit-this-page"><a href="https://github.com/MarvDan/jump-the-queue/edit/master/modules/ROOT/pages/OASP4FnTesting.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<div id="toc" class="toc">
<div id="toctitle" class="title">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#testing-of-oasp4fn-applications">Testing of OASP4Fn Applications</a></li>
<li><a href="#install-global-dependencies">Install Global Dependencies</a></li>
<li><a href="#writing-the-tests">Writing the Tests</a></li>
<li><a href="#setting-up-file">Setting up File</a></li>
<li><a href="#add-tests-of-the-handlers">Add Tests of the Handlers</a></li>
<li><a href="#">==</a></li>
<li><a href="#add-an-after-hook">Add an after Hook</a></li>
<li><a href="#final-result">Final Result</a></li>
</ul>
</div>
<div class="sect1">
<h2 id="testing-of-oasp4fn-applications"><a class="anchor" href="#testing-of-oasp4fn-applications"></a>Testing of OASP4Fn Applications</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this chapter we are going to learn how to tests applications in OASP4Fn using the <a href="http://mochajs.org/">mocha</a> framework and the <a href="http://chaijs.com/">chai</a> assertion library.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="install-global-dependencies"><a class="anchor" href="#install-global-dependencies"></a>Install Global Dependencies</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As the title says in this section we&#8217;re going to specify the global dependencies that we need to run our tests, that only are the test framework and the typescript interpreter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>yarn global add mocha
yarn global add ts-node</code></pre>
</div>
</div>
<div class="paragraph">
<p>No more dependencies are needed, because we start our project with the oasp4fn application template and the local part of the test dependencies are specified as dev-dependencies at the package.json.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="writing-the-tests"><a class="anchor" href="#writing-the-tests"></a>Writing the Tests</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Once we have all the dependencies installed, it&#8217;s time to put hands on the tests.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="setting-up-file"><a class="anchor" href="#setting-up-file"></a>Setting up File</h2>
<div class="sectionbody">
<div class="paragraph">
<p>First of all we are going to import all the handlers which we are going to test in our file/s (in our case only in test/Http/Post.ts), our typing and the every time useful <em>Lodash</em> package, so the head of our test file will look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { HttpEvent, Context, Code } from '../../handlers/types';
import { register } from '../../handlers/Http/POST/register-handler';
import { search } from '../../handlers/Http/POST/search-handler';
import { expect } from 'chai';
import * as _ from 'lodash';</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next we are going to define our tests to the <em>register</em> handler, that specify the behavior of our handler, like isn&#8217;t really complex, we are going to specify that should return an object with, and we will have something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { HttpEvent, Context, Code } from '../../handlers/types';
import { register } from '../../handlers/Http/POST/register-handler';
import { search } from '../../handlers/Http/POST/search-handler';
import { expect } from 'chai';
import * as _ from 'lodash';

describe('register', function () {
    it('The register should return an object, with the code and dateAndTime properties');
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we execute this test with <code>yarn test</code> we should see that we only have one test and is in a pending state:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/images/oasp4fn/3.BuildYourOwn/yarn_test1.PNG" alt="Yarn Test">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="add-tests-of-the-handlers"><a class="anchor" href="#add-tests-of-the-handlers"></a>Add Tests of the Handlers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now is time to call the function and check his behavior, first of all execute <code>yarn test:auto</code> to watch for changes and execute the tests automatically, next write your test:</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id=""><a class="anchor" href="#"></a>==</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Keep in mind that if you don&#8217;t have the instance of the database running, as is specified in <a href="BuildOASP4FnApplication#local-database-set-up">this section</a>, the tests won&#8217;t pass.
== ==</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { HttpEvent, Context, Code } from '../../handlers/types';
import { register } from '../../handlers/Http/POST/register-handler';
import { search } from '../../handlers/Http/POST/search-handler';
import { expect } from 'chai';
import * as _ from 'lodash';

const EVENT = {
    method: 'POST',
    path: {},
    body: {},
    query: {},
    headers: {}
}

let context: Context;

describe('register', function () {
    this.timeout(6000);
    it('The register should return an object, with the code and dateAndTime properties', (done: Function) =&gt; {
        let event =  &lt;HttpEvent&gt;_.assign({ body: { "name": "David", "email": "somenthing@something.com", "phone": "658974145"}}, EVENT);
        register(event, context, (err: Error, res: Code) =&gt; {
            try {
                expect(err).to.be.null;
                expect(res).to.be.an('object').that.contains.all.keys('code', 'dateAndTime');
                done();
            }
            catch(error){
                done(error);
            }
        })
    });
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that we declare and instantiate a <code>HttpEvent</code> and only declare the Context, that&#8217;s why we don&#8217;t use the context variable inside our handlers but our event variable yes.</p>
</div>
<div class="paragraph">
<p>Also, realize that we have modified the mocha default timeout (that is 2000ms) to 6000ms, and we change it to match the default AWS lambda timeout. Be careful here, and look that the function passed to the <em>describe</em> is not an arrow function, that&#8217;s because the scope of an arrow function is bounded when it&#8217;s created not when it&#8217;s called, so if that function would been an arrow function we couldn&#8217;t have access to the mocha methods and properties.</p>
</div>
<div class="paragraph">
<p>Once we have tested the <em>register</em> handler, we have to add tests for the <em>search</em> handler, so you have to repeat the last process until you have something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">describe('search', function () {
    this.timeout(6000);
    it('The search should return an array with the items of the table Queue', (done: Function) =&gt; {
        search(EVENT, context, (err: Error, res: object[]) =&gt; {
            try {
                expect(err).to.be.null;
                expect(res).to.be.an('Array');
                res.forEach(obj =&gt; {
                    expect(obj).to.be.an('object');
                    expect(obj).to.contain.all.keys(
                        ['name', 'email', 'phone', 'code', 'dateAndTime']
                    );
                })
                done();
            }
            catch(error){
                done(error);
            }
        })
    });
});</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="add-an-after-hook"><a class="anchor" href="#add-an-after-hook"></a>Add an after Hook</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Finally, it&#8217;s worth to point that we are inserting test data into our database, so we should erase them if it&#8217;s necessary after executing the test, for do this, we are going to add a hook that will execute at the end of our tests, and will erase a visitor if we had inserted any, using OASP4Fn, so for that we are going to import OASP4Fn in our file, store the code of the inserted visitor and delete it if it had been inserted successfully, so our hook will look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">after(async () =&gt; {
    if(code)
        await oasp4fn.delete('Queue', code).promise();
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>Keep in mind that the variable <em>code</em> is the property code located in the returned object of the handler <em>register</em> that you should store, when his callback return it.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="final-result"><a class="anchor" href="#final-result"></a>Final Result</h2>
<div class="sectionbody">
<div class="paragraph">
<p>So, at the end of the road we have this test file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { HttpEvent, Context, Code } from '../../handlers/types';
import { register } from '../../handlers/Http/POST/register-handler';
import { search } from '../../handlers/Http/POST/search-handler';
import { expect } from 'chai';
import * as _ from 'lodash';
import oasp4fn from '@oasp/oasp4fn';

const EVENT = {
    method: 'POST',
    path: {},
    body: {},
    query: {},
    headers: {}
}

let context: Context;

let code: string;

describe('register', () =&gt; {
    it('The register should return an object, with the code and dateAndTime properties', (done: Function) =&gt; {
        let event =  &lt;HttpEvent&gt;_.assign({}, EVENT, { body: { "name": "David", "email": "somenthing@something.com", "phone": "658974145"}});
        register(event, context, (err: Error, res: Code) =&gt; {
            try {
                expect(err).to.be.null;
                expect(res).to.be.an('object').that.contains.all.keys('code', 'dateAndTime');
                code = res.code;
                done();
            }
            catch(error){
                done(error);
            }
        })
    });
});

describe('search', () =&gt; {
    it('The search should return an array with the items of the table Queue', (done: Function) =&gt; {
        search(EVENT, context, (err: Error, res: object[]) =&gt; {
            try {
                expect(err).to.be.null;
                expect(res).to.be.an('Array');
                res.forEach(obj =&gt; {
                    expect(obj).to.be.an('object');
                    expect(obj).to.contain.all.keys(
                        ['name', 'email', 'phone', 'code', 'dateAndTime']
                    );
                })
                done();
            }
            catch(error){
                done(error);
            }
        })
    });
});

after(async () =&gt; {
    if(code)
        await oasp4fn.delete('Queue', code).promise();
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>And the output console look like this:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/images/oasp4fn/3.BuildYourOwn/yarn_test2.png" alt="Yarn Test">
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>Next Chapter</strong>: <a href="OASP4FnDeployment">Deploy your OASP4Fn App</a></p>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
