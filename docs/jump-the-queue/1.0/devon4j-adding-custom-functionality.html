<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: Devonfw.github.io Docs</title>
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../_/css/site.css">
    <script>var uiRootPath = '../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../..">Devonfw.github.io Docs</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="jump-the-queue" data-version="1.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-explore is-active" data-panel="explore">
  <div class="context">
    <span class="title">Jump-the-queue</span>
    <span class="version">1.0</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../../architecture-guidelines/1.0/index.html">Architecture-guidelines</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../architecture-guidelines/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../cicdgen/1.0/index.html">Cicdgen</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../cicdgen/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../cobigen/1.0/index.html">Cobigen</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../cobigen/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../dashboard/1.0/index.html">Dashboard</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../dashboard/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../devon4j/1.0/index.html">Devon4j</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../devon4j/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../devon4net/1.0/index.html">Devon4net</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../devon4net/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../devon4ng/1.0/index.html">Devon4ng</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../devon4ng/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../devon4node/1.0/index.html">Devon4node</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../devon4node/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../devon4quarkus/1.0/index.html">Devon4quarkus</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../devon4quarkus/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../devon4ts/1.0/index.html">Devon4ts</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../devon4ts/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../devonfw.github.io/1.0/index.html">devonfw.github.io</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../devonfw.github.io/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../getting-started/1.0/index.html">Getting-started</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../getting-started/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../github/1.0/index.html">Github</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../github/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../hangar/1.0/index.html">Hangar</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../hangar/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../ide/1.0/index.html">IDE</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../ide/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="index.html">Jump-the-queue</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../mrchecker/1.0/index.html">Mrchecker</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../mrchecker/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../my-thai-star/1.0/index.html">My-thai-star</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../my-thai-star/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../production-line/1.0/index.html">Production-line</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../production-line/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../shop-floor/1.0/index.html">Shop-floor</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../shop-floor/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../solicitor/1.0/index.html">Solicitor</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../solicitor/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../sonar-devon4j-plugin/1.0/index.html">Sonar-devon4j-plugin</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../sonar-devon4j-plugin/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../devonfw.github.io/1.0/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
</nav>
  <div class="edit-this-page"><a href="https://github.com/MarvDan/jump-the-queue/edit/master/modules/ROOT/pages/devon4j-adding-custom-functionality.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<div id="toc" class="toc">
<div id="toctitle" class="title">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#devon4j-adding-custom-functionality">devon4j adding Custom Functionality</a></li>
<li><a href="#return-the-access-code">Return the Access Code</a></li>
<li><a href="#adding-methods-to-the-queue-component">Adding Methods to the <em>Queue</em> Component</a></li>
<li><a href="#1-modifying-ucmanagequeue">==  1. Modifying <code><em>UcManageQueue</em></code></a></li>
<li><a href="#2-implementing-the-methods-in-ucmanagequeueimpl">==  2. Implementing the Methods in <em>UcManageQueueImpl</em></a></li>
<li><a href="#3-modify-the-management-implementation-queuemanagementimpl">==  3. Modify the Management Implementation <code><em>QueuemanagementImpl</em></code></a></li>
<li><a href="#creating-the-usecasemanage-for-the-access-code">Creating the <code>usecasemanage</code> for the Access Code</a></li>
<li><a href="#adding-method-to-the-access-code-usecasefind">==  Adding method to the Access Code <code>usecasefind</code></a></li>
<li><a href="#creating-the-usecasemanage">==  Creating the <code>usecasemanage</code></a></li>
<li><a href="#adding-to-the-logic">Adding to the Logic</a></li>
<li><a href="#adding-to-the-service">Adding to the Service</a></li>
<li><a href="#testing-the-changes">Testing the Changes</a></li>
</ul>
</div>
<div class="sect1">
<h2 id="devon4j-adding-custom-functionality"><a class="anchor" href="#devon4j-adding-custom-functionality"></a>devon4j adding Custom Functionality</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the <a href="#devon4j-layers">previous chapter</a> we have seen that, using <em>CobiGen</em>, we can generate all the structure and functionality of a <em>devon4j</em> component in a few clicks.</p>
</div>
<div class="paragraph">
<p>In this chapter we are going to show how to add custom functionalities to our projects, that are out of the scope of code, that <em>CobiGen</em> is able to generate.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="return-the-access-code"><a class="anchor" href="#return-the-access-code"></a>Return the Access Code</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <em>JumpTheQueue</em> design defines a <a href="jump-the-queue-design.html#user-story-register" class="page">User Story</a> in which a visitor can register into an event and obtain an access code to avoid a queue.</p>
</div>
<div class="paragraph">
<p>In our <em>standard</em> implementation of the <em>JumpTheQueue</em> app we have used <em>CobiGen</em> to generate the components, so we have a default implementation of the services. Since the <code>AccessCode</code> component is more complex and requires the use of <em>CTOs</em>, we need to create our own <code>usecasemanage</code> and the methods <code>save</code> and <code>delete</code>.</p>
</div>
<div class="paragraph">
<p>We also have to add some methods to the <em>Queue</em> component, since when saving/deleting an <code>AccessCode</code>, the amount of customers in the <code>Queue</code> needs to increase/decrease.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="adding-methods-to-the-queue-component"><a class="anchor" href="#adding-methods-to-the-queue-component"></a>Adding Methods to the <em>Queue</em> Component</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In our case, two new methods are going to be needed; <code>decreaseQueueCustomer</code> and <code>increaseQueueCustomer</code>. In order to add those methods to the <code>queuemanagement</code>, we need to follow these three steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Modify the corresponding <code>usecase</code> interface, adding the methods.</p>
</li>
<li>
<p>Implement the methods in the <code>usecaseimpl</code>.</p>
</li>
<li>
<p>Modify the management implementation <code>managementimpl</code>.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="1-modifying-ucmanagequeue"><a class="anchor" href="#1-modifying-ucmanagequeue"></a>==  1. Modifying <code><em>UcManageQueue</em></code></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Inside <code>jtqj-api/queuemanagement/logic/api/usecase/UcManageQueue</code> the declarations of the two methods are going to be added:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>...

public interface UcManageQueue {

	...

	/**
	 * Decrease number of customers of the queue and update the queue.
	 *
	 * @param queueId id of the queue to decrease customer.
	 */
	void decreaseQueueCustomer(long queueId);

	/**
	 * Increase number of customers of the queue and update the queue.
	 *
	 * @param queueId id of the queue to increase customer.
	 */
	void increaseQueueCustomer(long queueId);

}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="2-implementing-the-methods-in-ucmanagequeueimpl"><a class="anchor" href="#2-implementing-the-methods-in-ucmanagequeueimpl"></a>==  2. Implementing the Methods in <em>UcManageQueueImpl</em></h2>
<div class="sectionbody">
<div class="paragraph">
<p>In <code>jtqj-core/src/main/java/queuemanagement/logic/impl/usecase/UcManageQueueImpl</code> the implementation of the methods, that were just added in the interface, are going to be added:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>...

public class UcManageQueueImpl extends AbstractQueueUc implements UcManageQueue {

  ...

  @Override
  public void decreaseQueueCustomer(long queueId) {

    // the queue is found by using the repository find method and queueId parameter
    QueueEntity queueEntity = getQueueRepository().find(queueId);

    // the customers gets reduced by one
    queueEntity.setCustomers(queueEntity.getCustomers() - 1);

    // Based on Hibernate, the command save(Entity) is not strictly required, but it improves readability.
    // the queueEntity gets saved
    getQueueRepository().save(queueEntity);
  }

  @Override
  public void increaseQueueCustomer(long queueId) {

    // the queue is found by using the repository find method and queueId paremeter
    QueueEntity queueEntity = getQueueRepository().find(queueId);

    // the customers gets increased by one
    queueEntity.setCustomers(queueEntity.getCustomers() + 1);

    // Based on Hibernate, the command save(Entity) is not strictly required, but it improves readability.
    // the queueEntity gets saved
    getQueueRepository().save(queueEntity);
  }

}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="3-modify-the-management-implementation-queuemanagementimpl"><a class="anchor" href="#3-modify-the-management-implementation-queuemanagementimpl"></a>==  3. Modify the Management Implementation <code><em>QueuemanagementImpl</em></code></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Since the <code>Queuemanagement</code> extends the usecase <code>UcManageQueue</code> the methods from the previous step need to be added in the <code>QueuemanagementImpl</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>...

public class QueuemanagementImpl extends AbstractComponentFacade implements Queuemanagement {

  ...

  @Override
  public void decreaseQueueCustomer(long queueId) {

    this.ucManageQueue.decreaseQueueCustomer(queueId);
  }

  @Override
  public void increaseQueueCustomer(long queueId) {

    this.ucManageQueue.increaseQueueCustomer(queueId);
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>These methods are simply going to call the <code>ucManageQueue</code> methods that were just added.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creating-the-usecasemanage-for-the-access-code"><a class="anchor" href="#creating-the-usecasemanage-for-the-access-code"></a>Creating the <code>usecasemanage</code> for the Access Code</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="adding-method-to-the-access-code-usecasefind"><a class="anchor" href="#adding-method-to-the-access-code-usecasefind"></a>==  Adding method to the Access Code <code>usecasefind</code></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Before creating the <code>usecasemanage</code>, a method needs to be added to the <code>usecasefind</code>, that will recover our <code>AccessCodeEto</code>. In <code>jtqj-api</code>, inside the package <code>accesscodemanagement/logic/api/usecase/</code>, the file <code>UcFindAccessCode</code> is going to be modified, adding the new method to the interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>...

import com.devonfw.application.jtqj.accesscodemanagement.logic.api.to.AccessCodeEto;

...

public interface UcFindAccessCode {

  ...

  /**
   * Returns a paginated list of AccessCodeEto matching the search criteria.
   *
   * @param criteria the {@link AccessCodeSearchCriteriaTo}.
   * @return the {@link List} of matching {@link AccessCodeEto}s.
   */
  Page&lt;AccessCodeEto&gt; findAccessCodeEtos(AccessCodeSearchCriteriaTo criteria);

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once that is finished, we will see that an error is going to appear in <code>UcFindAccessCodeImpl</code> and <code>AccesscodemanagementImpl</code>. The second error will be solved in later steps. To solve the first error, in <code>jtqj-core</code> the <code>accesscodemanagement/logic/impl/usecase/UcFindAccessCodeImpl</code> class needs to implement another method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>...

public class UcFindAccessCodeImpl extends AbstractAccessCodeUc implements UcFindAccessCode {

  ...

  @Override
  public Page&lt;AccessCodeEto&gt; findAccessCodeEtos(AccessCodeSearchCriteriaTo criteria) {

    Page&lt;AccessCodeEntity&gt; accessCodes = getAccessCodeRepository().findByCriteria(criteria);

    return mapPaginatedEntityList(accessCodes, AccessCodeEto.class);
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This method uses a <code>AcessCodeSearchCriteriaTo</code> to find a page of entities&#8201;&#8212;&#8201;<code>AccessCodeEntity</code>&#8201;&#8212;&#8201;using the repository. After that, it changes the mapping of the list from <code>AccessCodeEntity</code> to <code>AccessCodeEto</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creating-the-usecasemanage"><a class="anchor" href="#creating-the-usecasemanage"></a>==  Creating the <code>usecasemanage</code></h2>
<div class="sectionbody">
<div class="paragraph">
<p>In <code>jtqj-api</code>, inside the package <code>accesscodemanagement/logic/api/usecase/</code>, we are going to create a new interface called <code>UcManageAccessCode</code>, where we will define the save and delete methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>...

import com.devonfw.application.jtqj.accesscodemanagement.logic.api.to.AccessCodeEto;

public interface UcManageAccessCode {

  /**
   * Deletes an accessCode from the database by its ID 'accessCodeId'. Decreases the count of customers of the queue
   * assigned to the access code by one.
   *
   * @param queueId Id of the queue to delete
   */
  void deleteAccessCode(long accessCodeId);

  /**
   * Saves a queue and stores it in the database. Increases the count of customers of the queue assigned to the access
   * code by one.
   *
   * @param queue the {@link AccessCodeEto} to create.
   * @return the new {@link AccessCodeEto} that has been saved with ID and version.
   */
  AccessCodeEto saveAccessCode(AccessCodeEto accessCodeEto);

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then <code>jtqj-core</code>, inside the package <code>accesscodemanagement/logic/impl/usecase</code>, we are going to create a class called <code>UcManageAccessCodeImpl</code>, implementing the definition we just made and extending <code>AbstractAccessCodeUc</code>. This will allow us to have access to the repository.</p>
</div>
<div class="paragraph">
<p>Also, here is the part where we will use the methods that we created in the <code>Queue</code> component:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>...

import java.sql.Timestamp;
import java.time.Instant;
import java.util.List;
import java.util.Objects;

import javax.inject.Inject;
import javax.inject.Named;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.data.domain.PageRequest;
import org.springframework.data.domain.Pageable;
import org.springframework.transaction.annotation.Transactional;
import org.springframework.validation.annotation.Validated;

import com.devonfw.application.jtqj.accesscodemanagement.dataaccess.api.AccessCodeEntity;
import com.devonfw.application.jtqj.accesscodemanagement.logic.api.to.AccessCodeCto;
import com.devonfw.application.jtqj.accesscodemanagement.logic.api.to.AccessCodeEto;
import com.devonfw.application.jtqj.accesscodemanagement.logic.api.to.AccessCodeSearchCriteriaTo;
import com.devonfw.application.jtqj.accesscodemanagement.logic.api.usecase.UcFindAccessCode;
import com.devonfw.application.jtqj.accesscodemanagement.logic.api.usecase.UcManageAccessCode;
import com.devonfw.application.jtqj.accesscodemanagement.logic.base.usecase.AbstractAccessCodeUc;
import com.devonfw.application.jtqj.queuemanagement.dataaccess.api.QueueEntity;
import com.devonfw.application.jtqj.queuemanagement.logic.api.Queuemanagement;
import com.devonfw.application.jtqj.queuemanagement.logic.api.to.QueueEto;
import com.devonfw.application.jtqj.queuemanagement.logic.impl.usecase.UcManageQueueImpl;

@Named
@Validated
@Transactional
public class UcManageAccessCodeImpl extends AbstractAccessCodeUc implements UcManageAccessCode {

  @Inject
  private Queuemanagement queuemanagement;

  @Inject
  private Accesscodemanagement accesscodemanagement;

  /** Logger instance. */
  private static final Logger LOG = LoggerFactory.getLogger(UcManageQueueImpl.class);

  @Override
  public void deleteAccessCode(long accessCodeId) {

    // we get the queueId using the AccessCodeRepository
    long queueId = getAccessCodeRepository().find(accessCodeId).getQueueId();

    /**
     * Using the method getQueuemanagement() gives access to the methods that were created earlier in the usecasemanage
     * (inside the queue component). This is done so each component takes care of its own modifications.
     */
    this.queuemanagement.decreaseQueueCustomer(queueId);

    LOG.debug("The queue with id '{}' has decreased its customers.", queueId);

    // then we delete the accesscode
    getAccessCodeRepository().deleteById(accessCodeId);
    LOG.debug("The accesscode with id '{}' has been deleted.", accessCodeId);

  }

  @Override
  public AccessCodeEto saveAccessCode(AccessCodeEto accessCodeEto) {

    // make sure the object is not null
    Objects.requireNonNull(accessCodeEto, "UcManageAccessImpl accessCode null");

    AccessCodeEntity accessCodeEntity = getBeanMapper().map(accessCodeEto, AccessCodeEntity.class);

    long queueEntityId = accessCodeEntity.getQueueId();

    AccessCodeSearchCriteriaTo accessCodeSearchCriteriaTo = new AccessCodeSearchCriteriaTo();
    accessCodeSearchCriteriaTo.setQueueId(queueEntityId);
    Pageable pageable = PageRequest.of(0, 1000);
    accessCodeSearchCriteriaTo.setPageable(pageable);

    /**
     * Calling the parent with the method getAccesscodemanagement() we use the method findAccessCodeEtos() that will
     * call the implementation of the method inside (UcFindAccessCodeImpl) through the interface. This allows us to use
     * the {@link UcFindAccessCodeImpl}.
     */
    List&lt;AccessCodeEto&gt; accessCodeEtosInQueue = getAccesscodemanagement().findAccessCodeEtos(accessCodeSearchCriteriaTo)
        .getContent();

    // if there are no ETOs, we set the ticket to the first code
    // else we get the digit of the last ticket in the list and generate a new code for the ticket
    if (accessCodeEtosInQueue.isEmpty()) {
      accessCodeEntity.setTicketNumber("Q000");
    } else {
      AccessCodeEto lastAccessCode = accessCodeEtosInQueue.get(accessCodeEtosInQueue.size() - 1);
      int lastTicketDigit = Integer.parseInt(lastAccessCode.getTicketNumber().substring(1));
      accessCodeEntity.setTicketNumber(generateTicketCode(lastTicketDigit));
    }

    // set the creation time, startTime and endTime
    accessCodeEntity.setCreationTime(Timestamp.from(Instant.now()));
    accessCodeEntity.setStartTime(null);
    accessCodeEntity.setEndTime(null);

    // save the AccessCode
    AccessCodeEntity accessCodeEntitySaved = getAccessCodeRepository().save(accessCodeEntity);
    LOG.debug("The accesscode with id '{}' has been saved.", accessCodeEntitySaved.getId());

    /**
     * Using the method getQueuemanagement() gives access to the methods that were created earlier in the usecasemanage
     * (inside the queue component). This is done so each component takes care of its own modifications.
     */
    getQueuemanagement().increaseQueueCustomer(accessCodeEntitySaved.getQueueId());

    LOG.debug("The queue with id '{}' has increased its customers.", accessCodeEntitySaved.getQueueId());

    return getBeanMapper().map(accessCodeEntitySaved, AccessCodeEto.class);
  }

  /**
   * Generates a new ticked code using the ticket digit of the last codeaccess created.
   *
   * @param lastTicketDigit the int of the last codeaccess created.
   * @return the String with the new ticket code (example: 'Q005').
   */
  public String generateTicketCode(int lastTicketDigit) {

    int newTicketDigit = lastTicketDigit + 1;
    String newTicketCode = "";
    if (newTicketDigit ==  1000) {
      newTicketCode = "Q000";
    } else {
      StringBuilder stringBuilder = new StringBuilder();
      stringBuilder.append(newTicketDigit);
      while (stringBuilder.length() &lt; 3) {
        stringBuilder.insert(0, "0");
      }
      stringBuilder.insert(0, "Q");
      newTicketCode = stringBuilder.toString();
    }
    return newTicketCode;
  }

  public Queuemanagement getQueuemanagement() {

    return this.queuemanagement;
  }

  public Accesscodemanagement getAccesscodemanagement() {

    return this.accesscodemanagement;
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Taking a closer look at the code, we can see that, in order to use the methods from the <code>UcFindAccessCodeImpl</code>, we need to use the parent (<code>Accesscodemanagement</code>) instead of the class directly. Also, following the <code>devon4j</code> structure, each component needs to take care of its own. In this case, by using the method <code>getQueuemanagement()</code>, we get access to the <code>Queuemanagement</code> injection that will allow the use of the methods we created earlier in the use cases in the queue component.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="adding-to-the-logic"><a class="anchor" href="#adding-to-the-logic"></a>Adding to the Logic</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Inside <code>jtqj-api</code>, in the class <code>accesscodemanagement/logic/api/Accesscodemanagement</code> we are going to extend the <code>UcManageAccessCode</code> that we just defined:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>...

import com.devonfw.application.jtqj.accesscodemanagement.logic.api.usecase.UcFindAccessCode;
import com.devonfw.application.jtqj.accesscodemanagement.logic.api.usecase.UcManageAccessCode;

/**
 * Interface for Accesscodemanagement component.
 */
public interface Accesscodemanagement extends UcFindAccessCode, UcManageAccessCode {

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>After that, in <code>jtqj-core</code>, in the class <code>accesscodemanagement/logic/impl/AccesscodemanagementImpl</code>, we will see that an error has appeared because the methods
from the extended interfaces are missing. We add the unimplemented methods and inject the <code>usecasemanage</code> solving the error:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>...

import javax.inject.Inject;
import javax.inject.Named;

import org.springframework.data.domain.Page;

import com.devonfw.application.jtqj.accesscodemanagement.logic.api.Accesscodemanagement;
import com.devonfw.application.jtqj.accesscodemanagement.logic.api.to.AccessCodeCto;
import com.devonfw.application.jtqj.accesscodemanagement.logic.api.to.AccessCodeEto;
import com.devonfw.application.jtqj.accesscodemanagement.logic.api.to.AccessCodeSearchCriteriaTo;
import com.devonfw.application.jtqj.accesscodemanagement.logic.api.usecase.UcFindAccessCode;
import com.devonfw.application.jtqj.accesscodemanagement.logic.api.usecase.UcManageAccessCode;
import com.devonfw.application.jtqj.general.logic.base.AbstractComponentFacade;

/**
 * Implementation of component interface of Accesscodemanagement.
 */
@Named
public class AccesscodemanagementImpl extends AbstractComponentFacade implements Accesscodemanagement {

  @Inject
  private UcFindAccessCode ucFindAccessCode;

  @Inject
  private UcManageAccessCode ucManageAccessCode;

  @Override
  public AccessCodeCto findAccessCodeCto(long id) {

    return this.ucFindAccessCode.findAccessCodeCto(id);
  }

  @Override
  public Page&lt;AccessCodeCto&gt; findAccessCodeCtos(AccessCodeSearchCriteriaTo criteria) {

    return this.ucFindAccessCode.findAccessCodeCtos(criteria);
  }

  @Override
  public void deleteAccessCode(long accessCodeId) {

    this.ucManageAccessCode.deleteAccessCode(accessCodeId);
  }

  @Override
  public AccessCodeEto saveAccessCode(AccessCodeEto accessCodeEto) {

    return this.ucManageAccessCode.saveAccessCode(accessCodeEto);
  }

  @Override
  public Page&lt;AccessCodeEto&gt; findAccessCodeEtos(AccessCodeSearchCriteriaTo criteria) {

    return this.ucFindAccessCode.findAccessCodeEtos(criteria);
  }

}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="adding-to-the-service"><a class="anchor" href="#adding-to-the-service"></a>Adding to the Service</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To add the new service, we need to add its definition to the <code>jtqj-api</code> in <code>accesscodemanagement/service/api/rest/AccesscodemanagementRestService.java</code>. We are going to create a new <code>/accessCode</code> REST resource bound to three methods, one called <code>findAccessCodeEtos</code>, another one called <code>saveAccessCode</code> and yet another one called <code>deleteAccessCode</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>...

public interface AccesscodemanagementRestService {

  ...

  /**
   * Delegates to {@link Accesscodemanagement#findAccessCodeEtos}.
   *
   * @param searchCriteriaTo the pagination and search criteria to be used for finding accesscodes.
   * @return the {@link Page list} of matching {@link AccessCodeEto}s.
   */
  @POST
  @Path("/accesscode/search")
  public Page&lt;AccessCodeEto&gt; findAccessCodeEtos(AccessCodeSearchCriteriaTo searchCriteriaTo);

  /**
   * Delegates to {@link Accesscodemanagement#saveAccessCode}.
   *
   * @param accessCodeEto queue the {@link AccessCodeEto} to be saved.
   * @return the recently created {@link AccessCodeEto}.
   */
  @POST
  @Path("/accesscode/")
  public AccessCodeEto saveAccessCode(AccessCodeEto accessCodeEto);

  /**
   * Delegates to {@link Accesscodemanagement#deleteAccessCode}.
   *
   * @param id of the {@link AccessCodeEto} to be deleted.
   */
  @DELETE
  @Path("/accesscode/{id}/")
  public void deleteAccessCode(@PathParam("id") long id);

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then we need to implement the new methods in the <code>accesscodemanagement/service/impl/rest/AccesscodemanagementRestServiceImpl.java</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>...

public class AccesscodemanagementRestServiceImpl implements AccesscodemanagementRestService {

  ...

  @Override
  public AccessCodeEto saveAccessCode(AccessCodeEto accessCodeEto) {

    return this.accesscodemanagement.saveAccessCode(accessCodeEto);
  }

  @Override
  public void deleteAccessCode(long id) {

    this.accesscodemanagement.deleteAccessCode(id);
  }

  @Override
  public Page&lt;AccessCodeEto&gt; findAccessCodeEtos(AccessCodeSearchCriteriaTo searchCriteriaTo) {

    return this.accesscodemanagement.findAccessCodeEtos(searchCriteriaTo);
  }

}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="testing-the-changes"><a class="anchor" href="#testing-the-changes"></a>Testing the Changes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now run the app again via Eclipse and use Postman to call the new save service via <strong>POST</strong>:<br>
<code><a href="http://localhost:8081/jumpthequeue/services/rest/accesscodemanagement/v1/accesscode/" class="bare">http://localhost:8081/jumpthequeue/services/rest/accesscodemanagement/v1/accesscode/</a></code></p>
</div>
<div class="paragraph">
<p>In the body, provide an <code>AccessCode</code> object with the following required parameters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>{
  "queueId" : "1",
  "visitorId" : "1000000"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The result should be something similar to this:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/images/devon4j/6.Customizations/jumpthequeue_accesscode.png" alt="JumpTheQueue `AccessCode`">
</div>
</div>
<div class="paragraph">
<p>In order to know, if the new <code>codeaccess</code> has been successfully created, we can search all the CTOs, like we did in the previous steps. The new <code>accesscode</code> should be on the bottom:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/images/devon4j/6.Customizations/jumpthequeue_listwithcode.png" alt="JumpTheQueue List with Code">
</div>
</div>
<div class="paragraph">
<p>To test the delete, you can send a <strong>DELETE</strong> to this URL:
<code><a href="http://localhost:8081/jumpthequeue/services/rest/accesscodemanagement/v1/accesscode/{id}" class="bare">http://localhost:8081/jumpthequeue/services/rest/accesscodemanagement/v1/accesscode/{id}</a></code>
Pass the <code>AccessCode</code> ID of the new entry, which can be found in the returned result of the save or the search operation.</p>
</div>
<div class="paragraph">
<p>In this chapter we learned, how easy it is to extend a <em>devon4j</em> application. With only a few steps you can add new services to your back-end, to fit the functional requirements of your project, or edit services to adapt the default implementation to your needs.</p>
</div>
<div class="paragraph">
<p>In the next chapter we will show how to add validations for the data, that we receive from the client.</p>
</div>
<hr>
<div class="paragraph">
<p><strong>Next Chapter</strong>: <a href="devon4j-validations">Validations in devon4j</a></p>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
