<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: Devonfw.github.io Docs</title>
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../_/css/site.css">
    <script>var uiRootPath = '../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../..">Devonfw.github.io Docs</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="devon4ng" data-version="1.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-explore is-active" data-panel="explore">
  <div class="context">
    <span class="title">Devon4ng</span>
    <span class="version">1.0</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../../architecture-guidelines/1.0/index.html">Architecture-guidelines</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../architecture-guidelines/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../cicdgen/1.0/index.html">Cicdgen</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../cicdgen/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../cobigen/1.0/index.html">Cobigen</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../cobigen/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../dashboard/1.0/index.html">Dashboard</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../dashboard/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../devon4j/1.0/index.html">Devon4j</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../devon4j/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../devon4net/1.0/index.html">Devon4net</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../devon4net/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="index.html">Devon4ng</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../devon4node/1.0/index.html">Devon4node</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../devon4node/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../devon4quarkus/1.0/index.html">Devon4quarkus</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../devon4quarkus/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../devon4ts/1.0/index.html">Devon4ts</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../devon4ts/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../devonfw.github.io/1.0/index.html">devonfw.github.io</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../devonfw.github.io/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../getting-started/1.0/index.html">Getting-started</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../getting-started/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../github/1.0/index.html">Github</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../github/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../hangar/1.0/index.html">Hangar</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../hangar/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../ide/1.0/index.html">IDE</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../ide/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../jump-the-queue/1.0/index.html">Jump-the-queue</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../jump-the-queue/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../mrchecker/1.0/index.html">Mrchecker</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../mrchecker/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../my-thai-star/1.0/index.html">My-thai-star</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../my-thai-star/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../production-line/1.0/index.html">Production-line</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../production-line/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../shop-floor/1.0/index.html">Shop-floor</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../shop-floor/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../solicitor/1.0/index.html">Solicitor</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../solicitor/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../sonar-devon4j-plugin/1.0/index.html">Sonar-devon4j-plugin</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../sonar-devon4j-plugin/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../devonfw.github.io/1.0/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
</nav>
  <div class="edit-this-page"><a href="https://github.com/MarvDan/devon4ng/edit/develop/modules/ROOT/pages/services-layer.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<div id="toc" class="toc">
<div id="toctitle" class="title">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#services-layer">Services Layer</a></li>
<li><a href="#boundaries">Boundaries</a></li>
<li><a href="#store">Store</a></li>
<li><a href="#use-case-service">Use Case Service</a></li>
<li><a href="#adapter">Adapter</a></li>
<li><a href="#interaction-of-smart-components-through-the-services-layer">Interaction of Smart Components through the services layer</a></li>
<li><a href="#pattern">Pattern</a></li>
<li><a href="#example">Example</a></li>
</ul>
</div>
<div class="sect1">
<h2 id="services-layer"><a class="anchor" href="#services-layer"></a>Services Layer</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The services layer is more or less what we call 'business logic layer' on the server side.
It is the layer where the business logic is placed.
The main challenges are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Define application state and an API for the components layer to use it</p>
</li>
<li>
<p>Handle application state transitions</p>
</li>
<li>
<p>Perform back-end interaction (XHR, WebSocket, etc.)</p>
</li>
<li>
<p>Handle business logic in a maintainable way</p>
</li>
<li>
<p>Configuration management</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All parts of the services layer are described in this chapter.
An example which puts the concepts together can be found at the end <a href="#interaction-of-smart-components-through-the-services-layer">Interaction of Smart Components through the services layer</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="boundaries"><a class="anchor" href="#boundaries"></a>Boundaries</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are two APIs for the components layer to interact with the services layer:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A store can be subscribed to for receiving state updates over time</p>
</li>
<li>
<p>A use case service can be called to trigger an action</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To illustrate the fact the following figure shows an abstract overview.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/components-layer-service-layer-boundaries.svg"><img src="_images/images/components-layer-service-layer-boundaries.svg" alt="Smart and Dumb Components Interaction" width="450"></a>
</div>
<div class="title">Figure 1. Boundaries to components layer</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="store"><a class="anchor" href="#store"></a>Store</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A store is a class which defines and handles application state with its transitions over time.
Interaction with a store is always synchronous.
A basic implementation using RxJS can look like this.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
A more profound implementation taken from a real-life project can be found here (<a href="cookbook-abstract-class-store">Abstract Class Store</a>).
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Listing 1. Store defined using RxJS</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">@Injectable()
export class ProductSearchStore {

  private stateSource = new BehaviorSubject&lt;ProductSearchState&gt;(defaultProductSearchState);
  state$ = this.stateSource.asObservable();

  setLoading(isLoading: boolean) {
    const currentState = this.stateSource.getValue();
    this.stateSource.next({
      isLoading: isLoading,
      products: currentState.products,
      searchCriteria: currentState.searchCriteria
    });
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example <code>ProductSearchStore</code> handles state of type <code>ProductSearchState</code>.
The public API is the property <code>state$</code> which is an observable of type <code>ProductSearchState</code>.
The state can be changed with method calls.
So every desired change to the state needs to be modeled with an method.
In reactive terminology this would be an <em>Action</em>.
The store does not use any services.
Subscribing to the <code>state$</code> observable leads to the subscribers receiving every new state.</p>
</div>
<div class="paragraph">
<p>This is basically the <em>Observer Pattern</em>:<br>
The store consumer registers itself to the observable via <code>state$.subscribe()</code> method call.
The first parameter of <code>subscribe()</code> is a callback function to be called when the subject changes.
This way the consumer - the observer - is registered.
When next() is called with a new state inside the store, all callback functions are called with the new value.
So every observer is notified of the state change.
This equals the <em>Observer Pattern</em> push type.</p>
</div>
<div class="paragraph">
<p>A store is the API for <em>Smart Components</em> to receive state from the service layer.
State transitions are handled automatically with <em>Smart Components</em> registering to the <code>state$</code> observable.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="use-case-service"><a class="anchor" href="#use-case-service"></a>Use Case Service</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A use case service is a service which has methods to perform asynchronous state transitions.
In reactive terminology this would be an <em>Action of Actions</em> - a thunk (<code>redux</code>) or an effect (<code>@ngrx</code>).</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/use-case-service.svg"><img src="_images/images/use-case-service.svg" alt="Use Case Service" width="450"></a>
</div>
<div class="title">Figure 2. Use case services are the main API to trigger state transitions</div>
</div>
<div class="paragraph">
<p>A use case services method - an action - interacts with adapters, business services and stores.
So use case services orchestrate whole use cases.
For an example see <code><a href="#usecaseservice-example">use case service example</a></code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="adapter"><a class="anchor" href="#adapter"></a>Adapter</h2>
<div class="sectionbody">
<div class="paragraph">
<p>An adapter is used to communicate with the back-end.
This could be a simple XHR request, a WebSocket connection, etc.
An adapter is simple in the way that it does not add anything other than the pure network call.
So there is no caching or logging performed here.
The following listing shows an example.</p>
</div>
<div class="paragraph">
<p>For further information on back-end interaction see <a href="guide-consuming-rest-services">Consuming REST Services</a></p>
</div>
<div class="listingblock">
<div class="title">Listing 2. Calling the back-end via an adapter</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">@Injectable()
export class ProducsAdapter {

  private baseUrl = environment.baseUrl;

  constructor(private http: HttpClient) { }

  getAll(): Observable&lt;Product[]&gt; {
    return this.http.get&lt;Product[]&gt;(this.baseUrl + '/products');
  }

}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="interaction-of-smart-components-through-the-services-layer"><a class="anchor" href="#interaction-of-smart-components-through-the-services-layer"></a>Interaction of Smart Components through the services layer</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The interaction of smart components is a classic problem which has to be solved in every UI technology.
It is basically how one dialog tells the other something has changed.</p>
</div>
<div class="paragraph">
<p>An example is <em>adding an item to the shopping basket</em>.
With this action there need to be multiple state updates.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The small logo showing how many items are currently inside the basket needs to be updated from 0 to 1</p>
</li>
<li>
<p>The price needs to be recalculated</p>
</li>
<li>
<p>Shipping costs need to be checked</p>
</li>
<li>
<p>Discounts need to be updated</p>
</li>
<li>
<p>Ads need to be updated with related products</p>
</li>
<li>
<p>etc.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="pattern"><a class="anchor" href="#pattern"></a>Pattern</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To handle this interaction in a scalable way we apply the following pattern.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/smart-component-interaction-via-services-layer.svg"><img src="_images/images/smart-component-interaction-via-services-layer.svg" alt="Interaction of Smart Components via services layer" width="450"></a>
</div>
<div class="title">Figure 3. Smart Component interaction</div>
</div>
<div class="paragraph">
<p>The state of interest is encapsulated inside a store. All <em>Smart Components</em> interested in the state have to subscribe to the store&#8217;s API served by the public observable. Thus, with every update to the store the subscribed components receive the new value. The components basically react to state changes. Altering a store can be done directly if the desired change is synchronous. Most actions are of asynchronous nature so the <code>UseCaseService</code> comes into play. Its actions are <code>void</code> methods, which implement a use case, i.e., adding a new item to the basket. It calls asynchronous actions and can perform multiple store updates over time.</p>
</div>
<div class="paragraph">
<p>To put this pattern into perspective the <code>UseCaseService</code> is a programmatic alternative to <code>redux-thunk</code> or <code>@ngrx/effects</code>. The main motivation here is to use the full power of TypeScript <code>--strictNullChecks</code> and to let the learning curve not to become as steep as it would be when learning a new state management framework. This way actions are just <code>void</code> method calls.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="example"><a class="anchor" href="#example"></a>Example</h2>
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<a class="image" href="images/smart-smart-components-example.svg"><img src="_images/images/smart-smart-components-example.svg" alt="Smart component interaction example" width="450"></a>
</div>
<div class="title">Figure 4. Smart Components interaction example</div>
</div>
<div class="paragraph">
<p>The example shows two <em>Smart Components</em> sharing the <code>FlightSearchState</code> by using the <code>FlightSearchStore</code>.
The use case shown is started by an event in the <em>Smart Component</em> <code>FlightSearchComponent</code>. The action <code>loadFlight()</code> is called. This could be submitting a search form.
The <code>UseCaseService</code> is <code>FlightSearchService</code>, which handles the use case <em>Load Flights</em>.</p>
</div>
<div class="paragraph">
<div class="title"><code>UseCaseService</code> example</div>
<p><code><a id="usecaseservice-example"></a></code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">export class FlightSearchService {

  constructor(
    private flightSearchAdapter: FlightSearchAdapter,
    private store: FlightSearchStore
  ) { }

  loadFlights(criteria: FlightSearchCriteria): void {
    this.store.setLoadingFlights(true);
    this.store.clearFlights();

    this.flightSearchAdapter.getFlights(criteria.departureDate,
        {
          from: criteria.departureAirport,
          to: criteria.destinationAirport
        })
      .finally(() =&gt; this.store.setLoadingFlights(false))
      .subscribe((result: FlightTo[]) =&gt; this.store.setFlights(result, criteria));
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>First the loading flag is set to <code>true</code> and the current flights are cleared. This leads the <em>Smart Component</em> showing a spinner indicating the loading action. Then the asynchronous XHR is triggered by calling the adapter. After completion the loading flag is set to <code>false</code> causing the loading indication no longer to be shown. If the XHR was successful, the data would be put into the store. If the XHR was not successful, this would be the place to handle a custom error. All general network issues should be handled in a dedicated class, i.e., an interceptor. So for example the basic handling of 404 errors is not done here.</p>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
