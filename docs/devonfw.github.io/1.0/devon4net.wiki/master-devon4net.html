<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: Devonfw.github.io Docs</title>
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../..">Devonfw.github.io Docs</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="devonfw.github.io" data-version="1.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-explore is-active" data-panel="explore">
  <div class="context">
    <span class="title">devonfw.github.io</span>
    <span class="version">1.0</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../../../architecture-guidelines/1.0/index.html">Architecture-guidelines</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../architecture-guidelines/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../cicdgen/1.0/index.html">Cicdgen</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../cicdgen/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../cobigen/1.0/index.html">Cobigen</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../cobigen/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../dashboard/1.0/index.html">Dashboard</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../dashboard/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../devon4j/1.0/index.html">Devon4j</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../devon4j/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../devon4net/1.0/index.html">Devon4net</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../devon4net/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../devon4ng/1.0/index.html">Devon4ng</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../devon4ng/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../devon4node/1.0/index.html">Devon4node</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../devon4node/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../devon4quarkus/1.0/index.html">Devon4quarkus</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../devon4quarkus/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../devon4ts/1.0/index.html">Devon4ts</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../devon4ts/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="../index.html">devonfw.github.io</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../getting-started/1.0/index.html">Getting-started</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../getting-started/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../github/1.0/index.html">Github</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../github/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../hangar/1.0/index.html">Hangar</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../hangar/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../ide/1.0/index.html">IDE</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../ide/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../jump-the-queue/1.0/index.html">Jump-the-queue</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../jump-the-queue/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../mrchecker/1.0/index.html">Mrchecker</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../mrchecker/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../my-thai-star/1.0/index.html">My-thai-star</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../my-thai-star/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../production-line/1.0/index.html">Production-line</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../production-line/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../shop-floor/1.0/index.html">Shop-floor</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../shop-floor/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../solicitor/1.0/index.html">Solicitor</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../solicitor/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../sonar-devon4j-plugin/1.0/index.html">Sonar-devon4j-plugin</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../sonar-devon4j-plugin/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
</nav>
  <div class="edit-this-page"><a href="https://github.com/marvdan/devonfw.github.io/edit/developAntoraGhPage/docs/modules/ROOT/pages/devon4net.wiki/master-devon4net.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<div class="paragraph">
<p>==.net</p>
</div>
<div class="sect1">
<h2 id="_architecture_basics"><a class="anchor" href="#_architecture_basics"></a>Architecture basics</h2>
<div class="sectionbody">
<!-- toc disabled -->
<div class="sect3">
<h4 id="_introduction"><a class="anchor" href="#_introduction"></a>Introduction</h4>
<div class="paragraph">
<p>The <a href="https://devonfw.com"><em>devonfw platform</em></a> provides a solution to building applications which combine best-in-class frameworks and libraries as well as industry proven practices and code conventions.
It massively speeds up development, reduces risks and helps you to deliver better results.</p>
</div>
</div>
<div class="sect3">
<h4 id="_overview_onion_design"><a class="anchor" href="#_overview_onion_design"></a>Overview Onion Design</h4>
<div class="paragraph">
<p>This guide shows the overall proposed architecture in terms of separated layers making use the Onion architecture pattern. Each layers represents a logical group of components and functionality. In this guide you will learn the basics of the proposed architecture based in layers in order to develop software making use of the best practices.</p>
</div>
</div>
<div class="sect3">
<h4 id="_layer_specification"><a class="anchor" href="#_layer_specification"></a>Layer specification</h4>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>It is important to understand the distinction between layers and tiers. <em>Layers</em> describe the logical groupings of the functionality and components in an application; whereas <em>tiers</em> describe the physical distribution of the functionality and components on separate servers, computers, networks, or remote locations. Although both layers and tiers use the same set of names (presentation, business, services, and data), remember that only tiers imply a physical separation. It is quite common to locate more than one layer on the same physical machine (the same tier). You can think of the term tier as referring to physical distribution patterns such as two-tier, three-tier, and <em>n</em>-tier.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; Layered Application Guidelines<br>
<cite>MSDN Microsoft</cite>
</div>
</div>
<div class="paragraph">
<p>The proposed architecture makes use of cooperating components called layers. To develop specific functionality each layer contains a set of components which is capable to develop such functionalities.</p>
</div>
<div class="paragraph">
<p>The next figure represents the different layers:</p>
</div>
<div id="img-t-architecture" class="imageblock">
<div class="content">
<a class="image" href="images/onion_architecture.png"><img src="../_images/images/onion_architecture.png" alt="technical architecture" width="450"></a>
</div>
<div class="title">Figure 1. High level architecture representation</div>
</div>
<div class="paragraph">
<p>The layers are separated in physical tiers making use of interfaces. This pattern makes possible to be flexible in different kind of projects maximizing performance and deployment strategies (synchronous/asynchronous access, security, component deployment in different environments, microservices&#8230;&#8203;). Another important point is to provide automated unit testing or test-driven development (TDD) facilities.</p>
</div>
</div>
<div class="sect3">
<h4 id="_application_layer"><a class="anchor" href="#_application_layer"></a>==  Application layer</h4>
<div class="paragraph">
<p>The <em>Application Layer</em> encapsulates the different .Net projects and its resource dependencies and manages the user interaction depending on the project&#8217;s nature.</p>
</div>
<div id="img-t-architecture" class="imageblock">
<div class="content">
<a class="image" href="images/project_nature.png"><img src="../_images/images/project_nature.png" alt="technical architecture" width="850"></a>
</div>
<div class="title">Figure 2. Net application stack</div>
</div>
<div class="paragraph">
<p>The provided application template implements an dotnet API application. Also integrates by default the Swagger client. This provides the possibility to share the contract with external applications (angular, mobile apps, external services&#8230;&#8203;).</p>
</div>
</div>
<div class="sect3">
<h4 id="_business_layer"><a class="anchor" href="#_business_layer"></a>==  Business layer</h4>
<div class="paragraph">
<p>The business layer implements the core functionality of the application and encapsulates the component&#8217;s logic.
This layer provides the interface between the data transformation and the application exposition. This allow the data to be optimized and ready for different data consumers.</p>
</div>
<div class="paragraph">
<p>This layer may implement for each main entity the API controller, the entity related service and other classes to support the application logic.</p>
</div>
<div class="paragraph">
<p>In order to implement the service logic, the services class must follow the next specification:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c# hljs" data-lang="c#">    public class Service&lt;TContext&gt; : IService where TContext: DbContext</code></pre>
</div>
</div>
<div class="paragraph">
<p>PE: devon4Net API template shows how to implement the TODOs service as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c# hljs" data-lang="c#">    public class TodoService: Service&lt;TodoContext&gt;, ITodoService</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where <em>Service</em> is the base service class to be inherited and have full access for the <em>Unit of work</em>, <code><em>TodoContext</em></code> is the TODOs database context and <em>ITodoService</em> is the interface of the service, which exposes the public extended methods to be implemented.</p>
</div>
</div>
<div class="sect3">
<h4 id="_data_layer"><a class="anchor" href="#_data_layer"></a>==  Data layer</h4>
<div class="paragraph">
<p>The data layer orchestrates the data obtained between the <em>Domain Layer</em> and the <em>Business Layer</em>. Also transforms the data to be used more efficiently between layers.</p>
</div>
<div class="paragraph">
<p>So, if a service needs the help of another service or repository, the implemented Dependency Injection is the solution to accomplish the task.</p>
</div>
<div class="paragraph">
<p>The main aim of this layer is to implement the repository for each entity. The repository&#8217;s interface is defined in the Domain layer.</p>
</div>
<div class="paragraph">
<p>In order to implement the repository logic, the repository class must follow the next specification:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c# hljs" data-lang="c#">    Repository&lt;T&gt; : IRepository&lt;T&gt; where T : class</code></pre>
</div>
</div>
<div class="paragraph">
<p>PE: devon4Net API template shows how to implement the TODOs repository as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c# hljs" data-lang="c#">    public class TodoRepository : Repository&lt;Todos&gt;, ITodoRepository</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where <em>Repository</em> is the the base repository class to be inherited and have full access for the basic CRUD operations, <em>Todos</em> is the entity defined in the database context. <em>ITodoRepository</em> is the interface of the repository, which exposes the public extended methods to be implemented.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Please remember that &lt;T&gt; is the mapped class which reference the entity from the database context. This abstraction allows to write services implementation with different database contexts
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_domain_layer"><a class="anchor" href="#_domain_layer"></a>==  Domain layer</h4>
<div class="paragraph">
<p>The domain layer provides access to data directly exposed from other systems. The main source is used to be a data base system. The provided template makes use of <em>Entity Framework</em> solution from Microsoft in order to achieve this functionality.</p>
</div>
<div class="paragraph">
<p>To make a good use of this technology, <em>Repository Pattern</em> has been implemented with the help of <em>Unit Of Work</em> pattern. Also, the use of generic types are makes this solution to be the most flexible.</p>
</div>
<div class="paragraph">
<p>Regarding to data base source, each entity is mapped as a class. Repository pattern allows to use this mapped classes to access the data base via Entity framework:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#"> public class UnitOfWork&lt;TContext&gt; : IUnitOfWork&lt;TContext&gt; where TContext : DbContext</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Where &lt;T&gt; is the mapped class which reference the entity from the database.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The repository and unit of work patterns are create an abstraction layer between the data access layer and the business logic layer of an application.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Domain Layer has no dependencies with other layers. It contains the Entities, datasources and the Repository Interfaces.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_devon4net_architecture_layer_implementation"><a class="anchor" href="#_devon4net_architecture_layer_implementation"></a>devon4Net architecture layer implementation</h4>
<div class="paragraph">
<p>The next picture shows how the devon4Net API template implements the architecture described in previous points:</p>
</div>
<div id="img-t-architecture" class="imageblock">
<div class="content">
<a class="image" href="images/onion_architecture_solution.png"><img src="../_images/images/onion_architecture_solution.png" alt="devon4Net api template architecture implementation" width="400"></a>
</div>
<div class="title">Figure 3. devon4Net architecture implementations</div>
</div>
</div>
<div class="sect3">
<h4 id="_cross_cutting_concerns"><a class="anchor" href="#_cross_cutting_concerns"></a>==  Cross-Cutting concerns</h4>
<div class="paragraph">
<p>Cross-cutting provides the implementation functionality that spans layers. Each functionality is implemented through components able to work stand alone. This approach provides better reusability and maintainability.</p>
</div>
<div class="paragraph">
<p>A common component set of cross cutting components include different types of functionality regarding to authentication, authorization, security, caching, configuration, logging, and communication.</p>
</div>
</div>
<div class="sect3">
<h4 id="_communication_between_layers_interfaces"><a class="anchor" href="#_communication_between_layers_interfaces"></a>Communication between Layers: Interfaces</h4>
<div class="paragraph">
<p>The main target of the use of interfaces is to loose coupling between layers and minimize dependencies.</p>
</div>
<div class="paragraph">
<p>Public interfaces allow to hide implementation details of the components within the layers making use of dependency inversion.</p>
</div>
<div class="paragraph">
<p>In order to make this possible, we make use of <em>Dependency Injection Pattern</em> (implementation of dependency inversion) given by default in <em>.Net Core</em>.</p>
</div>
<div class="paragraph">
<p>The provided <em>Data Layer</em> contains the abstract classes to inherit from. All new repository and service classes must inherit from them, also the must implement their own interfaces.</p>
</div>
<div id="img-t-architecture" class="imageblock">
<div class="content">
<a class="image" href="images/layer_arch_detail.png"><img src="../_images/images/layer_arch_detail.png" alt="technical architecture" width="750"></a>
</div>
<div class="title">Figure 4. Architecture representation in deep</div>
</div>
</div>
<div class="sect3">
<h4 id="_templates"><a class="anchor" href="#_templates"></a>Templates</h4>

</div>
<div class="sect3">
<h4 id="_state_of_the_art"><a class="anchor" href="#_state_of_the_art"></a>State of the art</h4>
<div class="paragraph">
<p>The provided bundle contains the devon4Net API template based on .net core. The template allows to create a microservice solution with minimal configuration.</p>
</div>
<div class="paragraph">
<p>Also, the devon4Net framework can be added to third party templates such as the Amazon API template to use lambdas in serverless environments.</p>
</div>
<div class="paragraph">
<p>Included features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Logging:</p>
</li>
<li>
<p>Text File</p>
</li>
<li>
<p>Sqlite database support</p>
</li>
<li>
<p>Serilog Seq Server support</p>
</li>
<li>
<p>Graylog integration ready through TCP/UDP/HTTP protocols</p>
</li>
<li>
<p>API Call params interception (simple and compose objects)</p>
</li>
<li>
<p>API error exception management</p>
</li>
<li>
<p>Swagger:</p>
</li>
<li>
<p>Swagger autogenerating client from comments and annotations on controller classes</p>
</li>
<li>
<p>Full swagger client customization (Version, Title, Description, Terms, License, Json end point definition)</p>
</li>
<li>
<p>Easy configuration with just one configuration node in your settings file</p>
</li>
<li>
<p>JWT:</p>
</li>
<li>
<p>Issuer, audience, token expiration customization by external file configuration</p>
</li>
<li>
<p>Token generation via certificate</p>
</li>
<li>
<p>MVC inherited classes to access JWT user properties</p>
</li>
<li>
<p>API method security access based on JWT Claims</p>
</li>
<li>
<p>CORS:</p>
</li>
<li>
<p>Simple CORS definition ready</p>
</li>
<li>
<p>Multiple CORS domain origin definition with specific headers and verbs</p>
</li>
<li>
<p>Headers:</p>
</li>
<li>
<p>Automatic header injection with middleware.</p>
</li>
<li>
<p>Supported header definitions: <code>AccessControlExposeHeader, StrictTransportSecurityHeader, XFrameOptionsHeader, XssProtectionHeader, XContentTypeOptionsHeader, ContentSecurityPolicyHeader, PermittedCrossDomainPoliciesHeader, ReferrerPolicyHeader</code></p>
</li>
<li>
<p>Reporting server:</p>
</li>
<li>
<p>Partial implementation of reporting server based on <code>My-FyiReporting</code> (now runs on linux container)</p>
</li>
<li>
<p>Testing:</p>
</li>
<li>
<p>Integration test template with sqlite support</p>
</li>
<li>
<p>Unit test template</p>
</li>
<li>
<p>Moq, xunit frameworks integrated</p>
</li>
<li>
<p>Circuit breaker:</p>
</li>
<li>
<p>Integrated with HttpClient factory</p>
</li>
<li>
<p>Client Certificate customization</p>
</li>
<li>
<p>Number of retries customizables</p>
</li>
<li>
<p>LiteDB:</p>
</li>
<li>
<p>Support for LiteDB</p>
</li>
<li>
<p>Provided basic repository for CRUD operations</p>
</li>
<li>
<p><code>RabbitMq</code>:</p>
</li>
<li>
<p>Use of EasyQNet library to perform CQRS main functions between different microservices</p>
</li>
<li>
<p>Send commands / Subscribe queues with one C# sentence</p>
</li>
<li>
<p>Events management: Handled received commands to subscribed messages</p>
</li>
<li>
<p>Automatic messaging backup when sent and handled (Internal database via LiteDB and database backup via Entity Framework)</p>
</li>
<li>
<p><code>MediatR</code>:</p>
</li>
<li>
<p>Use of <code>MediatR</code> library to perform CQRS main functions in memory</p>
</li>
<li>
<p>Send commands / Subscribe queues with one C# sentence</p>
</li>
<li>
<p>Events management: Handled received commands to subscribed messages</p>
</li>
<li>
<p>Automatic messaging backup when sent and handled (Internal database via LiteDB and database backup via Entity Framework)</p>
</li>
<li>
<p><code>SmaxHcm</code>:</p>
</li>
<li>
<p>Component to manage Microfocus <code>SMAX</code> for cloud infrastructure services management</p>
</li>
<li>
<p>CyberArk:</p>
</li>
<li>
<p>Manage safe credentials with CyberArk</p>
</li>
<li>
<p><code>AnsibleTower</code>:</p>
</li>
<li>
<p>Ansible automates the cloud infrastructure. devon4net integrates with Ansible Tower via API consumption endpoints</p>
</li>
<li>
<p>gRPC+Protobuf:</p>
</li>
<li>
<p>Added Client + Server basic templates sample gRPC with Google&#8217;s Protobuf protocol using devon4net</p>
</li>
<li>
<p>Kafka:</p>
</li>
<li>
<p>Added Apache Kafka support for deliver/consume messages and create/delete topics as well</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_software_stack"><a class="anchor" href="#_software_stack"></a>Software stack</h4>
<div class="paragraph">
<div class="title">Technology Stack of devon4Net</div>
<p>|== == == == == == == == == == == =
|<strong>Topic</strong>|<strong>Detail</strong>|<strong>Implementation</strong>
|runtime|language &amp; VM|.Net Core Version 3.0
|<a href="guide-dataaccess-layer">persistence</a>|OR-mapper| <a href="https://msdn.microsoft.com/en-us/data/ee712907.aspx">Entity Framework Core</a>
|<a href="guide-service-layer">service</a>|<a href="guide-service-layer#rest">REST services</a>|https://www.asp.net/web-api[Web API]
|<a href="guide-service-layer">service - integration to external systems - optional</a>|<a href="guide-service-layer#soap">SOAP services</a>|https://msdn.microsoft.com/en-us/library/dd456779(v=vs.110).aspx[WCF]
|<a href="guide-logging">logging</a>|framework|https://github.com/serilog/serilog-extensions-logging[Serilog]
|<a href="guide-validation">validation</a>|framework| <a href="https://www.newtonsoft.com/jsonschema/help/html/GenerateWithDataAnnotations.htm"><code>NewtonSoft</code> Json</a>, <a href="http://www.asp.net/mvc/overview/older-versions-1/models-data/validation-with-the-data-annotation-validators-cs"><code>DataAnnotations</code></a>
|component management|<a href="guide-dependency-injection">dependency injection</a>| <a href="https://unity.codeplex.com">Unity</a>
|<a href="guide-security">security</a>|Authentication &amp; Authorization| <a href="https://jwt.io">JWT</a> <a href="https://msdn.microsoft.com/en-us/library/fkytk30f(v=vs.110).aspx">.Net Security - Token based, local Authentication Provider</a>
|unit tests|framework|https://github.com/xunit/xunit[xUnit]
|Circuit breaker|framework, allows retry pattern on http calls|https://github.com/App-vNext/Polly[Polly]
|CQRS|Memory events and queue events| <a href="https://github.com/jbogard/MediatR"><code>MediatR</code></a> - <a href="https://github.com/EasyNetQ/EasyNetQ">EasyNetQ</a> - <a href="https://github.com/confluentinc/confluent-kafka-dotnet">Kafka</a>
|Kafka| Kafka support for enterprise applications| <a href="https://github.com/confluentinc/confluent-kafka-dotnet">Confluent.Kafka</a>
|Fluent Validation| Fluent validation for class instances|https://fluentvalidation.net/[Fluent validation]
|== == == == == == == == == == == =</p>
</div>
</div>
<div class="sect3">
<h4 id="_target_platforms"><a class="anchor" href="#_target_platforms"></a>Target platforms</h4>
<div class="paragraph">
<p>Thanks to the new .Net Core platform from Microsoft, the developed software can be published Windows, Linux, OS, X and Android platforms.</p>
</div>
</div>
<div class="sect3">
<h4 id="_external_links"><a class="anchor" href="#_external_links"></a>External links</h4>
<div class="paragraph">
<p><a href="https://docs.microsoft.com/en-us/dotnet/standard/frameworks">.Net Frameworks</a></p>
</div>
<div class="paragraph">
<p><a href="https://docs.microsoft.com/en-us/ef/">Entity Framework documentation from Microsoft</a></p>
</div>
<div class="paragraph">
<p><a href="https://swagger.io/">Swagger API tooling</a></p>
</div>
<div class="paragraph">
<p><a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/dependency-injection">Dependency Injection in .NET Core</a></p>
</div>
<div class="paragraph">
<p><a href="https://jwt.io">Json Web Token</a></p>
</div>
<div class="paragraph">
<p><a href="https://github.com/xunit/xunit">Unit Testing (xUnit)</a></p>
</div>
<div class="paragraph">
<p><a href="https://docs.microsoft.com/en-us/dotnet/core/rid-catalog">Runtime IDentifier for publishing</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_user_guide"><a class="anchor" href="#_user_guide"></a>User guide</h2>
<div class="sectionbody">
<!-- toc disabled -->
<div id="img-t-architecture" class="imageblock">
<div class="content">
<a class="image" href="images/devon.png"><img src="../_images/images/devon.png" alt="technical architecture" width="450"></a>
</div>
</div>
<div class="sect3">
<h4 id="_devon4net_guide"><a class="anchor" href="#_devon4net_guide"></a>devon4net Guide</h4>

</div>
<div class="sect3">
<h4 id="_introduction_2"><a class="anchor" href="#_introduction_2"></a>Introduction</h4>
<div class="paragraph">
<p>Welcome to devon4net framework user guide. In this document you will find the information regarding how to start and deploy your project using the guidelines proposed in our solution.</p>
</div>
<div class="paragraph">
<p>All the  guidelines shown and used in this document are a set of rules and conventions proposed and supported by Microsoft and the industry.</p>
</div>
</div>
<div class="sect3">
<h4 id="_the_package"><a class="anchor" href="#_the_package"></a>The package</h4>
<div class="paragraph">
<p><code>Devon4Net</code> package solution contains:</p>
</div>
<div class="paragraph">
<p>|== == == == == == == == == == == =
|<strong>File / Folder</strong>|<strong>Content</strong>
|Documentation| User documentation in HTML format
|Modules| Contains the source code of the different devon4net modules
|Samples| Different samples implemented in .NET and .NET Core. Also includes My Thai Star Devon flagship restaurant application
|Templates| Main .net Core template to start developing from scratch
|License| License agreement
|README.md| Github main page
|TERMS_OF_USE.adoc| The devon4net terms of use
|LICENSE| The devon license
|Other files| Such the code of conduct and contributing guide
|== == == == == == == == == == == =</p>
</div>
</div>
<div class="sect3">
<h4 id="_application_templates"><a class="anchor" href="#_application_templates"></a>Application templates</h4>
<div class="paragraph">
<p>The application templates given in the bundle are ready to use.</p>
</div>
<div class="paragraph">
<p>At the moment .net Core template is supported. The template is ready to be used as a simple console Kestrel application or being deployed in a web server like IIS.</p>
</div>
</div>
<div class="sect3">
<h4 id="_samples"><a class="anchor" href="#_samples"></a>Samples</h4>

</div>
<div class="sect3">
<h4 id="_my_thai_star"><a class="anchor" href="#_my_thai_star"></a>==  My Thai Star</h4>
<div class="paragraph">
<p>You can find My Thai Star .NET port application at <a href="https://github.com/devonfw/my-thai-star/tree/develop/net">Github</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
As devon4net has been migrated to the latest version of .net core, the template is not finished yet.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_cookbook"><a class="anchor" href="#_cookbook"></a>Cookbook</h4>

</div>
<div class="sect3">
<h4 id="_data_management"><a class="anchor" href="#_data_management"></a>Data management</h4>
<div class="paragraph">
<p>To use Entity Framework Core, install the package for the database provider(s) you want to target. This walk-through uses SQL Server.</p>
</div>
<div class="paragraph">
<p>For a list of available providers see <a href="https://docs.microsoft.com/en-us/ef/core/providers/index">Database Providers</a></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Go to <strong>Tools &gt; NuGet Package Manager &gt; Package Manager Console</strong></p>
</li>
<li>
<p>Run <strong>Install-Package Microsoft.EntityFrameworkCore.SqlServer</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We will be using some Entity Framework Tools to create a model from the database. So we will install the tools package as well:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Run <strong>Install-Package Microsoft.EntityFrameworkCore.Tools</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We will be using some ASP.NET Core Scaffolding tools to create controllers and views later on. So we will install this design package as well:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Run <strong>Install-Package Microsoft.VisualStudio.Web.CodeGeneration.Design</strong></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_entity_framework_code_first"><a class="anchor" href="#_entity_framework_code_first"></a>==  Entity Framework Code first</h4>
<div class="paragraph">
<p>In order to design your database model from scratch, we encourage to follow the Microsoft guidelines described  <a href="https://docs.microsoft.com/en-us/aspnet/core/data/ef-mvc/complex-data-model">here</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_entity_framework_database_first"><a class="anchor" href="#_entity_framework_database_first"></a>==  Entity Framework Database first</h4>
<div class="ulist">
<ul>
<li>
<p>Go to <strong>Tools &gt; NuGet Package Manager &gt; Package Manager Console</strong></p>
</li>
<li>
<p>Run the following command to create a model from the existing database:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>Scaffold-DbContext "Your connection string to existing database" Microsoft.EntityFrameworkCore.SqlServer -OutputDir Models</code></pre>
</div>
</div>
<div class="paragraph">
<p>The command will create the database context and the mapped entities as well inside of Models folder.</p>
</div>
</div>
<div class="sect3">
<h4 id="_register_your_context_with_dependency_injection"><a class="anchor" href="#_register_your_context_with_dependency_injection"></a>==  Register your context with dependency injection</h4>
<div class="paragraph">
<p>Services are registered with dependency injection during application startup.</p>
</div>
<div class="paragraph">
<p>In order to register your database context (or multiple database context as well) you can add the following line at ConfigureDbService method at startup.cs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>       private void SetupDatabase(IServiceCollection services)
        {
            services.SetupDatabase&lt;TodoContext&gt;(Configuration, "Default", WebAPI.Configuration.Enums.DatabaseType.InMemory);
        }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where:</p>
</div>
<div class="paragraph">
<p>|== == == == == == == == == == == =
|<strong>Param</strong>|<strong>Description</strong>
|<code>TodoContext</code>| Is the database context definition
|Default| Is the connection string defined at <code><em>ConnectionString</em></code> node at the appsettings configuration file
|<code>WebAPI.Configuration.Enums.DatabaseType.InMemory</code>| Is the database driver selection. In this case <code>InMemory</code> data base is chosen
|== == == == == == == == == == == =</p>
</div>
<div class="paragraph">
<p>The supported databases are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>SqlServer</p>
</li>
<li>
<p>Sqlite</p>
</li>
<li>
<p>InMemory</p>
</li>
<li>
<p>Cosmos</p>
</li>
<li>
<p>PostgreSQL</p>
</li>
<li>
<p>MySql</p>
</li>
<li>
<p>MariaDb</p>
</li>
<li>
<p>FireBird</p>
</li>
<li>
<p>Oracle</p>
</li>
<li>
<p>MSAccess</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_repositories_and_services"><a class="anchor" href="#_repositories_and_services"></a>Repositories and Services</h4>
<div class="paragraph">
<p><em>Services</em> and <em>Repositories</em> are an important part of devon4net proposal. To make them work properly, first of all must be declared and injected at Startup.cs at <em>DI</em> Region.</p>
</div>
<div class="paragraph">
<p><em>Services</em> are declared in devon4net.Business.Common and injected in Controller classes when needed. Use services to build your application logic.</p>
</div>
<div id="img-t-architecture" class="imageblock">
<div class="content">
<a class="image" href="images/business_ide_ext.png"><img src="../_images/images/business_ide_ext.png" alt="technical architecture" width="450"></a>
</div>
<div class="title">Figure 5. Screenshot of devon4net.Business.Common project in depth</div>
</div>
<div class="paragraph">
<p>For example, My Thai Star Booking controller constructor looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>        public BookingController(IBookingService bookingService, IMapper mapper)
        {
            BookingService = bookingService;
            Mapper = mapper;

        }</pre>
</div>
</div>
<div class="paragraph">
<p>Currently devon4net has a <em>Unit of Work</em> class in order to perform CRUD operations to database making use of your designed model context.</p>
</div>
<div class="paragraph">
<p><em>Repositories</em> are declared at <code><em>devon4net.Domain.UnitOfWork</em></code> project and make use of <em>Unit of Work</em> class.</p>
</div>
<div class="paragraph">
<p>The common methods to perform CRUD operations (where &lt;T&gt; is an entity from your model) are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Sync methods:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>IList&lt;T&gt; GetAll(Expression&lt;Func&lt;T, bool&gt;&gt; predicate = null);
T Get(Expression&lt;Func&lt;T, bool&gt;&gt; predicate = null);
IList&lt;T&gt; GetAllInclude(IList&lt;string&gt; include, Expression&lt;Func&lt;T, bool&gt;&gt; predicate = null);
T Create(T entity);
void Delete(T entity);
void DeleteById(object id);
void Delete(Expression&lt;Func&lt;T, bool&gt;&gt; where);
void Edit(T entity);</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Async methods:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>Task&lt;IList&lt;T&gt;&gt; GetAllAsync(Expression&lt;Func&lt;T, bool&gt;&gt; predicate = null);
Task&lt;T&gt; GetAsync(Expression&lt;Func&lt;T, bool&gt;&gt; predicate = null);
Task&lt;IList&lt;T&gt;&gt; GetAllIncludeAsync(IList&lt;string&gt; include, Expression&lt;Func&lt;T, bool&gt;&gt; predicate = null);</pre>
</div>
</div>
<div class="paragraph">
<p>If you perform a Commit operation and an error happens, changes will be rolled back.</p>
</div>
</div>
<div class="sect3">
<h4 id="_swagger_integration"><a class="anchor" href="#_swagger_integration"></a>Swagger integration</h4>
<div class="paragraph">
<p>The given templates allow you to specify the API contract through Swagger integration and the controller classes are the responsible of exposing methods making use of comments in the source code.</p>
</div>
<div class="paragraph">
<p>The next example shows how to comment the method with summaries in order to define the contract. Add (Triple Slash) XML Documentation To Swagger:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>/// &lt;summary&gt;
/// Method to get reservations
/// &lt;/summary&gt;
/// &lt;response code="201"&gt;Ok.&lt;/response&gt;
/// &lt;response code="400"&gt;Bad request. Parser data error.&lt;/response&gt;
/// &lt;response code="401"&gt;Unauthorized. Authentication fail.&lt;/response&gt;
/// &lt;response code="403"&gt;Forbidden. Authorization error.&lt;/response&gt;
/// &lt;response code="500"&gt;Internal Server Error. The search process ended with error.&lt;/response&gt;
[HttpPost]
[Route("/mythaistar/services/rest/bookingmanagement/v1/booking/search")]
//[Authorize(Policy = "MTSWaiterPolicy")]
[AllowAnonymous]
[EnableCors("CorsPolicy")]
public async Task&lt;IActionResult&gt; BookingSearch([FromBody]BookingSearchDto bookingSearchDto)
{</pre>
</div>
</div>
<div class="paragraph">
<p>In order to be effective and make use of the comments to build the API contract, the project which contains the controller classes must generate the XML document file. To achieve this, the XML documentation file must be checked in project settings tab:</p>
</div>
<div id="img-t-architecture" class="imageblock">
<div class="content">
<a class="image" href="images/project_doc.png"><img src="../_images/images/project_doc.png" alt="technical architecture" width="450"></a>
</div>
<div class="title">Figure 6. Project settings tab</div>
</div>
<div class="paragraph">
<p>We propose to generate the file under the <code>XmlDocumentation</code> folder. For example in devon4net.Domain.Entities project in My Thai Star .NET implementation the output folder is:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>`XmlDocumentation\devon4net.Business.Common.xml`</pre>
</div>
</div>
<div class="paragraph">
<p>The file <em>devon4net.Business.Common.xml</em> won&#8217;t appear until you build the project. Once the file is generated, please modify its properties as a resource and set it to be <em>Copy always</em> .</p>
</div>
<div id="img-t-architecture" class="imageblock">
<div class="content">
<a class="image" href="images/doc_copy_always.png"><img src="../_images/images/doc_copy_always.png" alt="technical architecture" width="450"></a>
</div>
<div class="title">Figure 7. Swagger XML document file properties</div>
</div>
<div class="paragraph">
<p>Once you have this, the swagger user interface will show the method properties defined in your controller comments.</p>
</div>
<div class="paragraph">
<p>Making use of this technique controller are not encapsulated to the application project. Also, you can develop your controller classes in different projects obtain code reusability.</p>
</div>
<div class="paragraph">
<p>Swagger comment:</p>
</div>
<div class="paragraph">
<p>|== == == == == == == == == == == =
|<strong>Comment</strong>|<strong>Functionality</strong>
|&lt;summary&gt;| Will map to the operation&#8217;s summary
|&lt;remarks&gt;| Will map to the operation&#8217;s description (shown as "Implementation Notes" in the UI)
|&lt;response code="###"&gt;| Specifies the different response of the target method
|&lt;param&gt;| Will define the parameter(s) of the target method
|
|== == == == == == == == == == == =</p>
</div>
<div class="paragraph">
<p>Please check <a href="https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/xmldoc/recommended-tags-for-documentation-comments">Microsoft&#8217;s site</a> regarding to summary notations.</p>
</div>
</div>
<div class="sect3">
<h4 id="_logging_module"><a class="anchor" href="#_logging_module"></a>Logging module</h4>
<div class="paragraph">
<p>An important part of life software is the need of using log and traces. devon4net has a log module pre-configured to achieve this important point.</p>
</div>
<div class="paragraph">
<p>By default Microsoft provides a logging module on .NET Core applications. This module is open and can it can be extended. devon4net uses the <a href="https://serilog.net/">Serilog</a> implementation. This implementation provides a huge quantity information about events and traces.</p>
</div>
</div>
<div class="sect3">
<h4 id="_log_file"><a class="anchor" href="#_log_file"></a>==  Log file</h4>
<div class="paragraph">
<p>devon4net can write the log information to a simple text file. You can configure the file name and folder at appsettings.json file (<code>LogFile</code> attribute) at devon4net.Application.WebApi project.</p>
</div>
</div>
<div class="sect3">
<h4 id="_database_log"><a class="anchor" href="#_database_log"></a>==  Database log</h4>
<div class="paragraph">
<p>devon4net can write the log information to a SQLite database. You can configure the file name and folder at appsettings.json file (<code>LogDatabase</code> attribute) at devon4net.Application.WebApi project.</p>
</div>
<div class="paragraph">
<p>With this method you can launch queries in order to search the information you are looking for.</p>
</div>
</div>
<div class="sect3">
<h4 id="_seq_log"><a class="anchor" href="#_seq_log"></a>==  Seq log</h4>
<div class="paragraph">
<p>devon4net can write the log information to a Serilog server. You can configure the Serilog URL at appsettings.json file <code>(SeqLogServerUrl attribute)</code> at devon4net.Application.WebApi project.</p>
</div>
<div class="paragraph">
<p>With this method you can make queries via HTTP.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/serilog_seq.png"><img src="../_images/images/serilog_seq.png" alt="serilog seq"></a>
</div>
</div>
<div class="paragraph">
<p>By default you can find the log information at <em>Logs</em> folder.</p>
</div>
</div>
<div class="sect3">
<h4 id="_jwt_module"><a class="anchor" href="#_jwt_module"></a>JWT module</h4>
<div class="paragraph">
<p>JSON Web Tokens are an open, industry standard RFC 7519 method for representing claims securely between two parties allowing you to decode, verify and generate JWT.</p>
</div>
<div class="paragraph">
<p>You should use JWT for:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Authentication : allowing the user to access routes, services, and resources that are permitted with that token.</p>
</li>
<li>
<p>Information Exchange: JSON Web Tokens are a good way of securely transmitting information between parties.  Additionally, as the signature is calculated using the header and the payload, you can also verify that the content.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The JWT module is configured at Startup.cs inside devon4net.Application.WebApi project from .NET Core template. In this class you can configure the different authentication policy and JWT properties.</p>
</div>
<div class="paragraph">
<p>Once the user has been authenticated, the client perform the call to the backend with the attribute <em>Bearer</em> plus the token generated at server side.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/jwt.png"><img src="../_images/images/jwt.png" alt="jwt"></a>
</div>
</div>
<div class="paragraph">
<p>On My Thai Star sample there are two predefined users: user0 and Waiter. Once they log in the application, the client (Angular/Xamarin) will manage the server call with the json web token. With this method we can manage the server authentication and authorization.</p>
</div>
<div class="paragraph">
<p>You can find more information about JWT at  <a href="https://jwt.io">jwt.io</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_aop_module"><a class="anchor" href="#_aop_module"></a>AOP module</h4>
<div class="paragraph">
<p>AOP (Aspect Oriented Programming) tracks all information when a method is call.<code>AOP</code> also tracks the input and output data when a method is call.</p>
</div>
<div class="paragraph">
<p>By default devon4net has <code>AOP</code> module pre-configured and activated for controllers at Startup.cs file at devon4net.Application.WebApi:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>options.Filters.Add(new Infrastructure.AOP.AopControllerAttribute(Log.Logger));

options.Filters.Add(new Infrastructure.AOP.AopExceptionFilter(Log.Logger));</pre>
</div>
</div>
<div class="paragraph">
<p>This configuration allows all Controller classes to be tracked. If you don&#8217;t need to track the info comment the lines written before.</p>
</div>
</div>
<div class="sect3">
<h4 id="_docker_support"><a class="anchor" href="#_docker_support"></a>Docker support</h4>
<div class="paragraph">
<p>devon4net Core projects are ready to be integrated with docker.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/devonfw/my-thai-star/tree/develop/net">My Thai Star application</a> sample is ready to be use with linux docker containers. The Readme file explains how to launch and setup the sample application.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>angular</strong> : Angular client to support backend. Just binaries.</p>
</li>
<li>
<p><strong>database</strong> : Database scripts and .bak file</p>
</li>
<li>
<p><strong>mailservice</strong>: Microservice implementation to send notifications.</p>
</li>
<li>
<p><strong>netcore</strong>: Server side using .net core 2.0.x.</p>
</li>
<li>
<p><strong>xamarin</strong>: Xamarin client based on Excalibur framework from The Netherlands using XForms.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Docker configuration and docker-compose files are provided.</p>
</div>
</div>
<div class="sect3">
<h4 id="_testing_with_xunit"><a class="anchor" href="#_testing_with_xunit"></a>Testing with XUnit</h4>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>xUnit.net is a free, open source, community-focused unit testing tool for the .NET Framework. Written by the original inventor of NUnit v2, xUnit.net is the latest technology for unit testing C#, F#, VB.NET and other .NET languages. xUnit.net works with <code>ReSharper</code>, <code>CodeRush</code>, <code>TestDriven.NET</code> and Xamarin. It is part of the .NET Foundation, and operates under their code of conduct. It is licensed under Apache 2 (an OSI approved license).</p>
</div>
</blockquote>
<div class="attribution">
&#8212; About xUnit.net<br>
<cite>https://xunit.github.io/#documentation</cite>
</div>
</div>
<div class="paragraph">
<p><em>Facts</em> are tests which are always true. They test invariant conditions.</p>
</div>
<div class="paragraph">
<p><em>Theories</em> are tests which are only true for a particular set of data.</p>
</div>
</div>
<div class="sect3">
<h4 id="_the_first_test"><a class="anchor" href="#_the_first_test"></a>The first test</h4>
<div class="listingblock">
<div class="content">
<pre>using Xunit;

namespace MyFirstUnitTests
{
    public class Class1
    {
        [Fact]
        public void PassingTest()
        {
            Assert.Equal(4, Add(2, 2));
        }

        [Fact]
        public void FailingTest()
        {
            Assert.Equal(5, Add(2, 2));
        }

        int Add(int x, int y)
        {
            return x + y;
        }
    }
}</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_the_first_test_with_theory"><a class="anchor" href="#_the_first_test_with_theory"></a>The first test with theory</h4>
<div class="paragraph">
<p><em>Theory</em> attribute is used to create tests with input params:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[Theory]
[InlineData(3)]
[InlineData(5)]
[InlineData(6)]
public void MyFirstTheory(int value)
{
    Assert.True(IsOdd(value));
}

bool IsOdd(int value)
{
    return value % 2 ==  1;
}</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_cheat_sheet"><a class="anchor" href="#_cheat_sheet"></a>Cheat Sheet</h4>
<div class="paragraph">
<p>|== == == == == == == == == == == =
|Operation| Example
|Test|</p>
</div>
<div class="listingblock">
<div class="content">
<pre>public void Test()
{
}
|Setup|public class TestFixture {
public TestFixture()
{

...

    }

}
|Teardown|public class TestFixture : IDisposable

{

public void Dispose() {

 ...
 }

}</pre>
</div>
</div>
<div class="paragraph">
<p>|== == == == == == == == == == == =</p>
</div>
</div>
<div class="sect3">
<h4 id="_console_runner_return_codes"><a class="anchor" href="#_console_runner_return_codes"></a>Console runner return codes</h4>
<div class="paragraph">
<p>|== == == == == == == == == == == =
|Code| Meaning
|0|The tests ran successfully.
|1|One or more of the tests failed.
|2|The help page was shown, either because it was requested, or because the user did not provide any command line arguments.
|3|	There was a problem with one of the command line options passed to the runner.
|4|There was a problem loading one or more of the test assemblies (for example, if a 64-bit only assembly is run with the 32-bit test runner).
|== == == == == == == == == == == =</p>
</div>
</div>
<div class="sect3">
<h4 id="_publishing"><a class="anchor" href="#_publishing"></a>Publishing</h4>

</div>
<div class="sect3">
<h4 id="_nginx"><a class="anchor" href="#_nginx"></a>==  Nginx</h4>
<div class="paragraph">
<p>In order to deploy your application to a Nginx server on Linux platform you can follow the instructions from <em>Microsoft</em> <a href="./offline/nginx.html">here</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_iis"><a class="anchor" href="#_iis"></a>==  IIS</h4>
<div class="paragraph">
<p>In this point is shown the configuration options that must implement the .Net Core application.</p>
</div>
<div class="paragraph">
<p>Supported operating systems:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Windows 7 and newer</p>
</li>
<li>
<p>Windows Server 2008 R2 and newer*</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>WebListener</code> server will not work in a reverse-proxy configuration with IIS. You must use the <a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/servers/kestrel?tabs=aspnetcore2x">Kestrel server</a>.</p>
</div>
<div class="paragraph">
<p><span class="underline">IIS configuration</span></p>
</div>
<div class="paragraph">
<p>Enable the Web Server (IIS) role and establish role services.</p>
</div>
<div class="paragraph">
<p><strong>Windows desktop operating systems</strong></p>
</div>
<div class="paragraph">
<p>Navigate to Control Panel &gt; Programs &gt; Programs and Features &gt; Turn Windows features on or off (left side of the screen). Open the group for Internet Information Services and Web Management Tools. Check the box for IIS Management Console. Check the box for World Wide Web Services. Accept the default features for World Wide Web Services or customize the IIS features to suit your needs.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/iis_1.png"><img src="../_images/images/iis_1.png" alt="iis 1"></a>
</div>
</div>
<div class="paragraph">
<p>*Conceptually, the IIS configuration described in this document also applies to hosting ASP.NET Core applications on Nano Server IIS, but refer to ASP.NET Core with IIS on Nano Server for specific instructions.</p>
</div>
<div class="paragraph">
<p><strong>Windows Server operating systems</strong>
For server operating systems, use the Add Roles and Features wizard via the Manage menu or the link in Server Manager. On the Server Roles step, check the box for Web Server (IIS).</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/iis_2.png"><img src="../_images/images/iis_2.png" alt="iis 2"></a>
</div>
</div>
<div class="paragraph">
<p>On the Role services step, select the IIS role services you desire or accept the default role services provided.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/iis_3.png"><img src="../_images/images/iis_3.png" alt="iis 3"></a>
</div>
</div>
<div class="paragraph">
<p>Proceed through the Confirmation step to install the web server role and services. A server/IIS restart is not required after installing the Web Server (IIS) role.</p>
</div>
<div class="paragraph">
<p><span class="underline">Install the .NET Core Windows Server Hosting bundle</span></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Install the .NET Core Windows Server Hosting bundle on the hosting system. The bundle will install the .NET Core Runtime, .NET Core Library, and the ASP.NET Core Module. The module creates the reverse-proxy between IIS and the Kestrel server. Note: If the system doesn&#8217;t have an Internet connection, obtain and install the Microsoft Visual C++ 2015 Re-distributable before installing the .NET Core Windows Server Hosting bundle.</p>
</li>
<li>
<p>Restart the system or execute net stop was /y followed by net start w3svc from a command prompt to pick up a change to the system <code>PATH</code>.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you use an IIS Shared Configuration, see ASP.NET Core Module with IIS Shared Configuration.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To configure IISIntegration service options, include a service configuration for IISOptions in <code>ConfigureServices</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c# hljs" data-lang="c#">services.Configure&lt;IISOptions&gt;(options =&gt;
{
    ...
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>|== == == == == == == == == == == =
|Option|Default|Setting
|<code>AutomaticAuthentication</code>| true |If true, the authentication middleware sets the <code>HttpContext.User</code> and responds to generic challenges. If false, the authentication middleware only provides an identity (<code>HttpContext.User</code>) and responds to challenges when explicitly requested by the Authentication Scheme. Windows Authentication must be enabled in IIS for <code>AutomaticAuthentication</code> to function.
|<code>AuthenticationDisplayName</code> | null| 	Sets the display name shown to users on login pages.
|<code>ForwardClientCertificate</code> |true|If true and the <code>MS-ASPNETCORE-CLIENTCERT</code> request header is present, the <code>HttpContext.Connection.ClientCertificate</code> is populated.
|== == == == == == == == == == == =</p>
</div>
<div class="paragraph">
<p><span class="underline">web.config</span></p>
</div>
<div class="paragraph">
<p>The web.config file configures the ASP.NET Core Module and provides other IIS configuration. Creating, transforming, and publishing web.config is handled by Microsoft.NET.Sdk.Web, which is included when you set your project&#8217;s SDK at the top of your .csproj file, &lt;Project Sdk="Microsoft.NET.Sdk.Web"&gt;. To prevent the <code>MSBuild</code> target from transforming your web.config file, add the <code>&lt;IsTransformWebConfigDisabled&gt;</code> property to your project file with a setting of true:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;PropertyGroup&gt;
  &lt;IsTransformWebConfigDisabled&gt;true&lt;/IsTransformWebConfigDisabled&gt;
&lt;/PropertyGroup&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_azure"><a class="anchor" href="#_azure"></a>==  Azure</h4>
<div class="paragraph">
<p>In order to deploy your application to Azure platform you can follow the instructions from <em>Microsoft</em>:</p>
</div>
<div class="paragraph">
<p><strong>Set up the development environment</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Install the latest&nbsp;<a href="https://www.visualstudio.com/vs/azure-tools/">Azure SDK for Visual Studio</a>. The SDK installs Visual Studio if you don&#8217;t already have it.</p>
</li>
<li>
<p>Verify your&nbsp;<a href="https://portal.azure.com/">Azure account</a>. You can&nbsp;<a href="https://azure.microsoft.com/pricing/free-trial/">open a free Azure account</a>&nbsp;or&nbsp;<a href="https://azure.microsoft.com/pricing/member-offers/msdn-benefits-details/">Activate Visual Studio subscriber benefits</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Create a web app</strong></p>
</div>
<div class="paragraph">
<p>In the Visual Studio Start Page, select&nbsp;<strong>File &gt; New &gt; Project&#8230;&#8203;</strong></p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/offline/azure_files/file_new_project.png" alt="File menu">
</div>
</div>
<div class="paragraph">
<p>Complete the&nbsp;<strong>New Project</strong>&nbsp;dialog:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In the left pane, select&nbsp;<strong>.NET Core</strong>.</p>
</li>
<li>
<p>In the center pane, select&nbsp;<strong>ASP.NET Core Web Application</strong>.</p>
</li>
<li>
<p>Select&nbsp;<strong>OK</strong>.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/offline/azure_files/new_prj.png" alt="New Project dialog">
</div>
</div>
<div class="paragraph">
<p>In the&nbsp;<strong>New ASP.NET Core Web Application</strong>&nbsp;dialog:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Select&nbsp;<strong>Web Application</strong>.</p>
</li>
<li>
<p>Select&nbsp;<strong>Change Authentication</strong>.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/offline/azure_files/new_prj_2.png" alt="New Project dialog">
</div>
</div>
<div class="paragraph">
<p>The&nbsp;<strong>Change Authentication</strong>&nbsp;dialog appears.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Select&nbsp;<strong>Individual User Accounts</strong>.</p>
</li>
<li>
<p>Select&nbsp;<strong>OK</strong>&nbsp;to return to the&nbsp;<strong>New ASP.NET Core Web Application</strong>, then select&nbsp;<strong>OK</strong>&nbsp;again.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/offline/azure_files/new_prj_auth.png" alt="New ASP.NET Core Web authentication dialog">
</div>
</div>
<div class="paragraph">
<p>Visual Studio creates the solution.</p>
</div>
<div class="paragraph">
<p><strong>Run the app locally</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Choose&nbsp;<strong>Debug</strong>&nbsp;then&nbsp;<strong>Start Without Debugging</strong>&nbsp;to run the app locally.</p>
</li>
<li>
<p>Click the&nbsp;<strong>About</strong>&nbsp;and&nbsp;<strong>Contact</strong>&nbsp;links to verify the web application works.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/offline/azure_files/show.png" alt="Web application open in Microsoft Edge on localhost">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Select&nbsp;<strong>Register</strong>&nbsp;and register a new user. You can use a fictitious email address. When you submit, the page displays the following error:</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>"Internal Server Error: A database operation failed while processing the request. SQL exception: Cannot open the database. Applying existing migrations for Application DB context may resolve this issue."</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Select&nbsp;<strong>Apply Migrations</strong>&nbsp;and, once the page updates, refresh the page.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../offline/azure_files/mig.png" alt="Internal Server Error: A database operation failed while processing the request. SQL exception: Cannot open the database. Applying existing migrations for Application DB context may resolve this issue.">
</div>
</div>
<div class="paragraph">
<p>The app displays the email used to register the new user and a&nbsp;<strong>Log out</strong>&nbsp;link.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/offline/azure_files/hello.png" alt="Web application open in Microsoft Edge. The Register link is replaced by the text Hello email@domain.com!">
</div>
</div>
<div class="paragraph">
<p><strong>Deploy the app to Azure</strong></p>
</div>
<div class="paragraph">
<p>Close the web page, return to Visual Studio, and select&nbsp;<strong>Stop Debugging</strong>&nbsp;from the&nbsp;<strong>Debug</strong>&nbsp;menu.</p>
</div>
<div class="paragraph">
<p>Right-click on the project in Solution Explorer and select&nbsp;<strong>Publish&#8230;&#8203;</strong>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/offline/azure_files/pub.png" alt="Contextual menu open with Publish link highlighted">
</div>
</div>
<div class="paragraph">
<p>In the&nbsp;<strong>Publish</strong>&nbsp;dialog, select&nbsp;<strong>Microsoft Azure App Service</strong>&nbsp;and click&nbsp;<strong>Publish</strong>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/offline/azure_files/maas1.png" alt="Publish dialog">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Name the app a unique name.</p>
</li>
<li>
<p>Select a subscription.</p>
</li>
<li>
<p>Select&nbsp;<strong>New&#8230;&#8203;</strong>&nbsp;for the resource group and enter a name for the new resource group.</p>
</li>
<li>
<p>Select&nbsp;<strong>New&#8230;&#8203;</strong>&nbsp;for the app service plan and select a location near you. You can keep the name that is generated by default.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/offline/azure_files/newrg1.png" alt="App Service dialog">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Select the&nbsp;<strong>Services</strong>&nbsp;tab to create a new database.</p>
</li>
<li>
<p>Select the green&nbsp;<strong>+</strong>&nbsp;icon to create a new SQL Database</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/offline/azure_files/sql.png" alt="New SQL Database">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Select&nbsp;<strong>New&#8230;&#8203;</strong>&nbsp;on the&nbsp;<strong>Configure SQL Database</strong>&nbsp;dialog to create a new database.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/offline/azure_files/conf.png" alt="New SQL Database and server">
</div>
</div>
<div class="paragraph">
<p>The&nbsp;<strong>Configure SQL Server</strong>&nbsp;dialog appears.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Enter an administrator user name and password, and then select&nbsp;<strong>OK</strong>. Don&#8217;t forget the user name and password you create in this step. You can keep the default&nbsp;<strong>Server Name</strong>.</p>
</li>
<li>
<p>Enter names for the database and connection string.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_note"><a class="anchor" href="#_note"></a>== Note</h4>
<div class="paragraph">
<p>"admin" is not allowed as the administrator user name.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/offline/azure_files/conf_servername.png" alt="Configure SQL Server dialog">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Select&nbsp;<strong>OK</strong>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Visual Studio returns to the&nbsp;<strong>Create App Service</strong>&nbsp;dialog.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Select&nbsp;<strong>Create</strong>&nbsp;on the&nbsp;<strong>Create App Service</strong>&nbsp;dialog.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/azure_files/conf_final.png" alt="Configure SQL Database dialog">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Click the&nbsp;<strong>Settings</strong>&nbsp;link in the&nbsp;<strong>Publish</strong>&nbsp;dialog.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/offline/azure_files/pubc.png" alt="Publish dialog: Connection panel">
</div>
</div>
<div class="paragraph">
<p>On the&nbsp;<strong>Settings</strong>&nbsp;page of the&nbsp;<strong>Publish</strong>&nbsp;dialog:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Expand&nbsp;<strong>Databases</strong>&nbsp;and check&nbsp;<strong>Use this connection string at runtime</strong>.</p>
</li>
<li>
<p>Expand&nbsp;<strong>Entity Framework Migrations</strong>&nbsp;and check&nbsp;<strong>Apply this migration on publish</strong>.</p>
</li>
<li>
<p>Select&nbsp;<strong>Save</strong>. Visual Studio returns to the&nbsp;<strong>Publish</strong>&nbsp;dialog.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/offline/azure_files/pubs.png" alt="Publish dialog: Settings panel">
</div>
</div>
<div class="paragraph">
<p>Click&nbsp;<strong>Publish</strong>. Visual Studio will publish your app to Azure and launch the cloud app in your browser.</p>
</div>
<div class="paragraph">
<p><strong>Test your app in Azure</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Test the&nbsp;<strong>About</strong>&nbsp;and&nbsp;<strong>Contact</strong>&nbsp;links</p>
</li>
<li>
<p>Register a new user</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/offline/azure_files/register.png" alt="Web application opened in Microsoft Edge on Azure App Service">
</div>
</div>
<div class="paragraph">
<p><strong>Update the app</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Edit <code>the&nbsp;<em>Pages/About.cshtml</em>&nbsp;Razor</code> page and change its contents. For example, you can modify the paragraph to say "Hello ASP.NET Core!":</p>
<div class="literalblock">
<div class="content">
<pre>html&lt;button class="action copy" data-bi-name="copy"&gt;Copy&lt;/button&gt;</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c# hljs" data-lang="c#">@page
@model AboutModel
@{
    ViewData["Title"] = "About";
}
&lt;h2&gt;@ViewData["Title"]&lt;/h2&gt;
&lt;h3&gt;@Model.Message&lt;/h3&gt;

    &lt;p&gt;Hello ASP.NET Core!&lt;/p&gt;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Right-click on the project and select&nbsp;<strong>Publish&#8230;&#8203;</strong>&nbsp;again.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/offline/azure_files/pub.png" alt="Contextual menu open with Publish link highlighted">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>After the app is published, verify the changes you made are available on Azure.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/offline/azure_files/final.png" alt="Verify task is complete">
</div>
</div>
<div class="paragraph">
<p><strong>Clean up</strong></p>
</div>
<div class="paragraph">
<p>When you have finished testing the app, go to the&nbsp;<a href="https://portal.azure.com/">Azure portal</a>&nbsp;and delete the app.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Select&nbsp;<strong>Resource groups</strong>, then select the resource group you created.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/offline/azure_files/portalrg.png" alt="Azure Portal: Resource Groups in sidebar menu">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>In the&nbsp;<strong>Resource groups</strong>&nbsp;page, select&nbsp;<strong>Delete</strong>.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/offline/azure_files/rgd.png" alt="Azure Portal: Resource Groups page">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Enter the name of the resource group and select&nbsp;<strong>Delete</strong>. Your app and all other resources created in this tutorial are now deleted from Azure.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_external_links_2"><a class="anchor" href="#_external_links_2"></a>External links</h4>
<div class="paragraph">
<p><a href="https://docs.microsoft.com/en-us/aspnet/core/publishing/iis?tabs=aspnetcore2x">Publishing .Net Core on IIS</a></p>
</div>
<div class="paragraph">
<p><a href="https://docs.microsoft.com/en-us/aspnet/core/hosting/aspnet-core-module#aspnet-core-module-with-an-iis-shared-configuration">IIS Shared configuration</a></p>
</div>
<div class="paragraph">
<p><a href="https://docs.microsoft.com/en-us/aspnet/core/publishing/linuxproduction?tabs=aspnetcore2x">Publishing to Nginx</a></p>
</div>
<div class="paragraph">
<p><a href="https://docs.microsoft.com/en-us/aspnet/core/publishing/docker">Publishing to Docker</a></p>
</div>
<div class="paragraph">
<p><a href="https://docs.microsoft.com/en-us/ef/core/miscellaneous/connection-strings">Connection strings</a></p>
</div>
<div class="paragraph">
<p><a href="https://docs.microsoft.com/en-us/ef/core/get-started/aspnetcore/new-db#create-the-model">Entity Framework basics</a></p>
</div>
<div class="paragraph">
<p><a href="https://docs.microsoft.com/en-us/aspnet/core/data/ef-mvc/complex-data-model">Entity framework advanced design</a></p>
</div>
<div class="paragraph">
<p><a href="https://github.com/domaindrivendev/Swashbuckle.AspNetCore#include-descriptions-from-xml-comments">Swagger annotations</a></p>
</div>
<div class="paragraph">
<p><a href="https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/xmldoc/recommended-tags-for-documentation-comments">Summary notation</a></p>
</div>
<div class="paragraph">
<p><a href="https://jwt.io/">JWT Official Site</a></p>
</div>
<div class="paragraph">
<p><a href="https://serilog.net/">Serilog</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_section"><a class="anchor" href="#_how_to_section"></a>How To section</h2>
<div class="sectionbody">
<!-- toc disabled -->
<div class="sect3">
<h4 id="_introduction_3"><a class="anchor" href="#_introduction_3"></a>Introduction</h4>
<div class="paragraph">
<p>The aim of this document is to show  how to get devon4net things done in a easy way.</p>
</div>
</div>
<div class="sect3">
<h4 id="_how_to"><a class="anchor" href="#_how_to"></a>How to</h4>

</div>
<div class="sect3">
<h4 id="_start_a_new_devonfw_project"><a class="anchor" href="#_start_a_new_devonfw_project"></a>Start a new devonfw project</h4>
<div class="paragraph">
<p>The <em>.Net Core 3.1</em> template allows you to start developing an n-layer server application to provide the latest features. The template can be used in Visual Studio Code and Visual Studio 2019.</p>
</div>
<div class="paragraph">
<p>The application result can be deployed as a console application, microservice or web page.</p>
</div>
<div class="paragraph">
<p>To start developing with devon4Net template, please follow this instructions:</p>
</div>
</div>
<div class="sect3">
<h4 id="_using_devon4net_template"><a class="anchor" href="#_using_devon4net_template"></a>==  Using devon4Net template</h4>

</div>
<div class="sect3">
<h4 id="_option_1"><a class="anchor" href="#_option_1"></a>==  Option 1</h4>
<div class="listingblock">
<div class="content">
<pre>Open your favourite terminal (Win/Linux/iOS)
Go to future project's path
Type dotnet new --install Devon4Net.WebAPI.Template
Type dotnet new Devon4NetAPI
Go to project's path
You are ready to start developing with devon4Net</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_option_2"><a class="anchor" href="#_option_2"></a>==  Option 2</h4>
<div class="listingblock">
<div class="content">
<pre>Create a new dotnet` API` project from scratch
Add the NuGet package reference to your project:
Install-Package Devon4Net.Application.WebAPI.Configuration</pre>
</div>
</div>
<div class="paragraph">
<p>Set up your project as follows in program.cs file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c# hljs" data-lang="c#">        public static void Main(string[] args)
        {
            // Please use
            // Devonfw.Configure&lt;Startup&gt;(args);
            // Or :

            WebHost.CreateDefaultBuilder(args)
                .UseStartup&lt;Startup&gt;()
                .InitializeDevonFw()
                .Build()
                .Run();
        }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Set up your project as follows in startup.cs file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>    private IConfiguration Configuration { get; }


   public Startup(IConfiguration configuration)
    {
        Configuration = configuration;
    }

    public void ConfigureServices(IServiceCollection services)
    {

        services.ConfigureDevonFw(Configuration);
        SetupDatabase(services);

        ...
    }


    private void SetupDatabase(IServiceCollection services)
    {
        // Default is the database connection name in appsettings.json file
        services.SetupDatabase&lt;TodoContext&gt;(Configuration, "Default", DatabaseType.InMemory);
    }

    public void Configure(IApplicationBuilder app, IWebHostEnvironment env)
    {
        app.ConfigureDevonFw();
        ...
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Add the devonfw configuration options in your appsettings.json file</p>
</div>
</div>
<div class="sect3">
<h4 id="_devon4net_configuration_files"><a class="anchor" href="#_devon4net_configuration_files"></a>devon4net configuration files</h4>
<div class="paragraph">
<p>To start using devon4net in your .net core application add this configuration in your appsettings.json file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json"> "devonfw": {
    "UseDetailedErrorsKey": true,
    "UseIIS": false,
    "UseSwagger": true,
    "Environment": "Development",
    "KillSwitch": {
      "killSwitchSettingsFile": "killswitch.appsettings.json"
    },
    "Kestrel": {
      "UseHttps": true,
      "HttpProtocol": "Http2", //Http1, Http2, Http1AndHttp2, none
      "ApplicationPort": 8082,
      "KeepAliveTimeout": 120, //in seconds
      "MaxConcurrentConnections": 100,
      "MaxConcurrentUpgradedConnections": 100,
      "MaxRequestBodySize": 28.6, //In MB. The default maximum request body size is 30,000,000 bytes, which is approximately 28.6 MB
      "Http2MaxStreamsPerConnection": 100,
      "Http2InitialConnectionWindowSize": 131072, // From 65,535 and less than 2^31 (2,147,483,648)
      "Http2InitialStreamWindowSize": 98304, // From 65,535 and less than 2^31 (2,147,483,648)
      "AllowSynchronousIO": true,
      "SslProtocol": "Tls12", //Tls, Tls11,Tls12, Tls13, Ssl2, Ssl3, none. For Https2 Tls12 is needed
      "ServerCertificate": {
        "Certificate": "localhost.pfx",
        "CertificatePassword": "localhost"
      },
      "ClientCertificate": {
        "DisableClientCertificateCheck": true,
        "RequireClientCertificate": false,
        "CheckCertificateRevocation": true,
        "ClientCertificates": {
          "Whitelist": [
            "3A87A49460E8FE0E2A198E63D408DC58435BC501"
          ],
          "DisableClientCertificateCheck": false
        }
      }
    },
    "IIS": {
      "ForwardClientCertificate": true,
      "AutomaticAuthentication": true,
      "AuthenticationDisplayName" : ""
    }
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Also, for start using the devon4net components, you should add the next json options in your appsettings.json or appsettings.Development.json file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>{
  "ExtraSettingsFiles": [
    "Put a directory path (relative/absolute/linux-like) like /run/secrets/global where there are many settings/secret files to load",
    "Put a specific file name (with/without path) like /app-configs/app/extra-settings.json"
  ],
  "ConnectionStrings": {
    "Default": "Todos",
    "Employee": "Employee",
    "RabbitMqBackup": "Add your database connection string here for messaging backup",
    "MediatRBackup": "Add your database connection string here for messaging backup"
  },
  "Logging": {
    "LogLevel": {
      "Default": "Debug",
      "System": "Information",
      "Microsoft": "Information"
    }
  },
  "Swagger": {
    "Version": "v1",
    "Title": "devon4net API",
    "Description": "devon4net API Contract",
    "Terms": "https://www.devonfw.com/terms-of-use/",
    "Contact": {
      "Name": "devonfw",
      "Email": "sample@mail.com",
      "Url": "https://www.devonfw.com"
    },
    "License": {
      "Name": "devonfw - Terms of Use",
      "Url": "https://www.devonfw.com/terms-of-use/"
    },
    "Endpoint": {
      "Name": "V1 Docs",
      "Url": "/swagger/v1/swagger.json",
      "UrlUi": "swagger",
      "RouteTemplate": "swagger/v1/{documentName}/swagger.json"
    }
  },
  "JWT": {
    "Audience": "devon4Net",
    "Issuer": "devon4Net",
    "TokenExpirationTime": 60,
    "ValidateIssuerSigningKey": true,
    "ValidateLifetime": true,
    "ClockSkew": 5,
    "Security": {
      "SecretKeyLengthAlgorithm": "",
      "SecretKeyEncryptionAlgorithm": "",
      "SecretKey": "",
      "Certificate": "",
      "CertificatePassword": "",
      "CertificateEncryptionAlgorithm": ""
    }
  },
  "Cors": []
  //[
  //  {
  //    "CorsPolicy": "CorsPolicy1",
  //    "Origins": "http://example.com,http://www.contoso.com",
  //    "Headers": "accept,content-type,origin,x-custom-header",
  //    "Methods": "GET,POST,HEAD",
  //    "AllowCredentials": true
  //  },
  //  {
  //    "CorsPolicy": "CorsPolicy2",
  //    "Origins": "http://example.com,http://www.contoso.com",
  //    "Headers": "accept,content-type,origin,x-custom-header",
  //    "Methods": "GET,POST,HEAD",
  //    "AllowCredentials": true
  //  }
  //]
  ,
  "CircuitBreaker": {
    "CheckCertificate": false,
    "Endpoints": [
      {
        "Name": "AnsibleTower",
        "BaseAddress": "PUT THE IP ADDRESS HERE",
        "Headers": {
        },
        "WaitAndRetrySeconds": [
          0.0001,
          0.0005,
          0.001
        ],
        "DurationOfBreak": 0.0005,
        "UseCertificate": false,
        "Certificate": "localhost.pfx",
        "CertificatePassword": "localhost",
        "SslProtocol": "3072" //TLS12
      },
      {
        "Name": "CyberArk",
        "BaseAddress": "PUT THE IP ADDRESS HERE",
        "Headers": {
        },
        "WaitAndRetrySeconds": [
          0.0001,
          0.0005,
          0.001
        ],
        "DurationOfBreak": 0.0005,
        "UseCertificate": false,
        "Certificate": "localhost.pfx",
        "CertificatePassword": "localhost",
        "SslProtocol": "3072" //TLS12
      },
      {
        "Name": "SmaxHcm",
        "BaseAddress": "PUT THE IP ADDRESS HERE",
        "Headers": {
        },
        "WaitAndRetrySeconds": [
          0.0001,
          0.0005,
          0.001
        ],
        "DurationOfBreak": 0.0005,
        "UseCertificate": false,
        "Certificate": "localhost.pfx",
        "CertificatePassword": "localhost",
        "SslProtocol": "3072" //TLS12
      }
    ]
  },
  "Headers": {
    "AccessControlExposeHeader": "Authorization",
    "StrictTransportSecurityHeader": "",
    "XFrameOptionsHeader": "DENY",
    "XssProtectionHeader": "1;mode=block",
    "XContentTypeOptionsHeader": "nosniff",
    "ContentSecurityPolicyHeader": "",
    "PermittedCrossDomainPoliciesHeader": "",
    "ReferrerPolicyHeader": ""
  },
  "Log": {
    "UseAOPTrace": false,
    "LogLevel": "Debug",
    "SqliteDatabase": "logs/log.db",
    "LogFile": "logs/{0}_devonfw.log",
    "SeqLogServerHost": "http://127.0.0.1:5341",
    "GrayLog": {
      "GrayLogHost": "127.0.0.1",
      "GrayLogPort": "12201",
      "GrayLogProtocol": "UDP",
      "UseSecureConnection": true,
      "UseAsyncLogging": true,
      "RetryCount": 5,
      "RetryIntervalMs": 15,
      "MaxUdpMessageSize": 8192
    }
  },
  "RabbitMq": {
    "EnableRabbitMq": false,
    "Hosts": [
      {
        "Host": "127.0.0.1",
        "Port": 5672,
        "Ssl": false,
        "SslServerName": "localhost",
        "SslCertPath": "localhost.pfx",
        "SslCertPassPhrase": "localhost",
        "SslPolicyErrors": "RemoteCertificateNotAvailable" //None, RemoteCertificateNotAvailable, RemoteCertificateNameMismatch, RemoteCertificateChainErrors
      }
    ],

    "VirtualHost": "/",
    "UserName": "admin",
    "Password": "password",
    "Product": "devon4net",
    "RequestedHeartbeat": 10, //Set to zero for no heartbeat
    "PrefetchCount": 50,
    "PublisherConfirms": false,
    "PersistentMessages": true,
    "Platform": "localhost",
    "Timeout": 10,
    "Backup": {
      "UseLocalBackup": false,
      "DatabaseName": "devon4netMessageBackup.db"
    }
  },
  "MediatR": {
    "EnableMediatR": false,
    "Backup": {
      "UseLocalBackup": false,
      "DatabaseName": "devon4netMessageBackup.db"
    }
  },
  "LiteDb": {
    "DatabaseLocation": "devon4net.db"
  },
  "AnsibleTower": {
    "EnableAnsible": false,
    "Name": "AnsibleTower",
    "CircuitBreakerName": "AnsibleTower",
    "ApiUrlBase": "/api/v2/?format=json",
    "Version": "1.0.5.29",
    "Username": "",
    "Password": ""
  },
  "CyberArk": {
    "EnableCyberArk": false,
    "Username": "",
    "Password": "",
    "CircuitBreakerName": "CyberArk"
  },
  "SmaxHcm": {
    "EnableSmax": false,
    "Username": "",
    "Password": "",
    "TenantId": "",
    "CircuitBreakerName": "SmaxHcm",
    "ProviderId": ""
  },
  "Kafka": {
    "EnableKafka": true,
    "Administration": [
      {
        "AdminId": "Admin1",
        "Servers": "127.0.0.1:9092"
      }
    ],
    "Producers": [
      {
        "ProducerId": "Producer1", // devon identifier
        "Servers": "127.0.0.1:9092", // Initial list of brokers as a CSV list of broker host or host:port. The application may also use `rd_kafka_brokers_add()` to add brokers during runtime
        "ClientId": "client1", //Client identifier
        "Topic": "devonfw", // topics to deliver the message
        "MessageMaxBytes": 1000000, //Maximum Kafka protocol request message size. Due to differing framing overhead between protocol versions the producer is unable to reliably enforce a strict max message limit at produce time and may exceed the maximum size by one message in protocol ProduceRequests, the broker will enforce the the topic's `max.message.bytes` limit (see Apache Kafka documentation)
        "CompressionLevel": -1, // [0-9] for gzip; [0-12] for lz4; only 0 for snappy; -1 = codec-dependent default compression level
        "CompressionType": "None", // None, Gzip, Snappy, Lz4, Zstd
        "ReceiveMessageMaxBytes": 100000000,
        "EnableSslCertificateVerification": false,
        "CancellationDelayMaxMs": 100, // The maximum length of time (in milliseconds) before a cancellation request is acted on. Low values may result in measurably higher CPU usage
        "Ack": "None", //Zero=Broker does not send any response/ack to client, One=The leader will write the record to its local log but will respond without awaiting full acknowledgement from all followers. All=Broker will block until message is committed by all in sync replicas (ISRs). If there are less than min.insync.replicas (broker configuration) in the ISR set the produce request will fail
        "Debug": "", //A comma-separated list of debug contexts to enable. Detailed Producer debugging: broker,topic,msg. Consumer: consumer,cgrp,topic,fetch
        "BrokerAddressTtl": 1000, //How long to cache the broker address resolving results (milliseconds)
        "BatchNumMessages": 1000000, // Maximum size (in bytes) of all messages batched in one MessageSet, including protocol framing overhead. This limit is applied after the first message has been added to the batch, regardless of the first message's size, this is to ensure that messages that exceed batch.size are produced. The total MessageSet size is also limited by batch.num.messages and message.max.bytes
        "EnableIdempotence": false, //When set to `true`, the producer will ensure that messages are successfully produced exactly once and in the original produce order. The following configuration properties are adjusted automatically (if not modified by the user) when idempotence is enabled: `max.in.flight.requests.per.connection=5` (must be less than or equal to 5), `retries=INT32_MAX` (must be greater than 0), `acks=all`, `queuing.strategy=fifo`. Producer instantation will fail if user-supplied configuration is incompatible
        "MaxInFlight": 5,
        "MessageSendMaxRetries": 5,
        "BatchSize": 100000000 // Maximum size (in bytes) of all messages batched in one MessageSet, including protocol framing overhead. This limit is applied after the first message has been added to the batch, regardless of the first message's size, this is to ensure that messages that exceed batch.size are produced. The total MessageSet size is also limited by batch.num.messages and message.max.bytes
      }
    ],
    "Consumers": [
      {
        "ConsumerId": "Consumer1", // devon identifier
        "Servers": "127.0.0.1:9092",
        "GroupId": "group1",
        "Topics": "devonfw", // Comma separated topics to subscribe
        "AutoCommit": true, //Automatically and periodically commit offsets in the background. Note: setting this to false does not prevent the consumer from fetching previously committed start offsets. To circumvent this behaviour set specific start offsets per partition in the call to assign()
        "StatisticsIntervalMs": 0, //librdkafka statistics emit interval. The application also needs to register a stats callback using `rd_kafka_conf_set_stats_cb()`. The granularity is 1000ms. A value of 0 disables statistics
        "SessionTimeoutMs": 10000, //Client group session and failure detection timeout. The consumer sends periodic heartbeats (heartbeat.interval.ms) to indicate its liveness to the broker. If no hearts are received by the broker for a group member within the session timeout, the broker will remove the consumer from the group and trigger a rebalance. The allowed range is configured with the **broker** configuration properties `group.min.session.timeout.ms` and `group.max.session.timeout.ms`. Also see `max.poll.interval.ms`
        "AutoOffsetReset": "Largest", //Action to take when there is no initial offset in offset store or the desired offset is out of range: 'smallest','earliest' - automatically reset the offset to the smallest offset, 'largest','latest' - automatically reset the offset to the largest offset, 'error' - trigger an error which is retrieved by consuming messages and checking 'message-&amp;gt;err'
        "EnablePartitionEof": true, //Verify CRC32 of consumed messages, ensuring no on-the-wire or on-disk corruption to the messages occurred. This check comes at slightly increased CPU usage
        "IsolationLevel": "ReadCommitted", //Controls how to read messages written transactionally: `ReadCommitted` - only return transactional messages which have been committed. `ReadUncommitted` - return all messages, even transactional messages which have been aborted.
        "EnableSslCertificateVerification": false,
        "Debug": "" //A comma-separated list of debug contexts to enable. Detailed Producer debugging: broker,topic,msg. Consumer: consumer,cgrp,topic,fetch
      }
    ]
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_devon4net_cobigen_guide"><a class="anchor" href="#_devon4net_cobigen_guide"></a>devon4net Cobigen Guide</h4>

</div>
<div class="sect3">
<h4 id="_overview"><a class="anchor" href="#_overview"></a>Overview</h4>
<div class="paragraph">
<p>In this guide we will explain how to generate a new WebApi project from an OpenAPI 3.0.0 specification. This  means that we are going to use a “contract first” strategy. This is going to be possible due to these type of files that contain all the information about entities, operations, etc…</p>
</div>
<div class="paragraph">
<p>In order to make it work we are using <a href="https://github.com/devonfw/cobigen">CobiGen</a>, a powerful tool for generating source code. CobiGen allows users to generate all the structure and code of the components, helping to save a lot of time otherwise wasted on repetitive tasks.</p>
</div>
</div>
<div class="sect3">
<h4 id="_getting_things_ready"><a class="anchor" href="#_getting_things_ready"></a>Getting things ready</h4>

</div>
<div class="sect3">
<h4 id="_devonfw_distribution"><a class="anchor" href="#_devonfw_distribution"></a>==  devonfw Distribution</h4>
<div class="paragraph">
<p>The devonfw distributions can be obtained from <a href="https://repository.sonatype.org/service/local/artifact/maven/redirect?r=central-proxy&amp;g=com.devonfw.tools.ide&amp;a=devonfw-ide-scripts&amp;v=LATEST&amp;p=tar.gz">here</a>. You can find all releases in <a href="https://repo.maven.apache.org/maven2/com/devonfw/tools/ide/devonfw-ide-scripts/">maven central</a>.</p>
</div>
<div class="paragraph">
<p>It is not necessary to install nor configure anything. Just extracting the zip content is enough to have a fully functional devonfw. The only thing you have to do is run <strong>create-or-update-workspace.bat</strong> and then <strong>update-all-workspaces.bat</strong> to set up all the needed tools.</p>
</div>
</div>
<div class="sect3">
<h4 id="_devon4net_templates"><a class="anchor" href="#_devon4net_templates"></a>==  devon4net Templates</h4>
<div class="paragraph">
<p>We are going to use the template of devon4net as a base to generate all the code, so what we have to do now is to download said template using the following steps.</p>
</div>
<div class="paragraph">
<p>First of all you have to set up all the environment for .NET, you can do this using <a href="https://devon4net.github.io/environment.html">the following tutorial</a>. Next we are going to create a new folder where we want to have the WebAPI project, lastly we are going to open the terminal there.</p>
</div>
<div class="paragraph">
<p>Type the following:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>dotnet new -i Devon4Net.WebAPI.Template</pre>
</div>
</div>
<div class="paragraph">
<p>and then:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>dotnet new Devon4NetAPI</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_openapi_file"><a class="anchor" href="#_openapi_file"></a>==  OpenAPI File</h4>
<div class="paragraph">
<p>In order to let CobiGen generate all the files, we first have to make some modifications to our OpenAPI file.</p>
</div>
<div class="paragraph">
<p>It is obligatory to put the <em>“x-rootpackage”</em> tag to indicate where CobiGen will place the generated files as well as the <em>"x-component"</em> tags for each component, keep in mind that due to CobiGen&#8217;s limitations each component <strong><em>must</em></strong> have its own entity.</p>
</div>
<div class="paragraph">
<p>You can read more information about how to configure your OpenAPI file and a working example <a href="https://github.com/devonfw/cobigen/wiki/cobigen-openapipluginfull-example">here</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_generating_files"><a class="anchor" href="#_generating_files"></a>Generating files</h4>
<div class="paragraph">
<p>Cobigen allow us to generate the files in two different ways. One of them is using Eclipse which it can be done by using the its graphical interface. The other way to generate the code is using the Cobigen` CLI` tool.</p>
</div>
</div>
<div class="sect3">
<h4 id="_generating_files_through_eclipse"><a class="anchor" href="#_generating_files_through_eclipse"></a>==  Generating files through Eclipse</h4>
<div class="paragraph">
<p>In order to generate the files using Eclipse we need to follow some simple steps.</p>
</div>
<div class="paragraph">
<p>First we are going to import our basic devon4net WebAPI Project into Eclipse. to do so open Eclipse with the “eclipse-main.bat” file that can be found in the devon distribution root folder. Once we are inside of Eclipse we go to <strong>File &gt; Open projects from file system&#8230;&#8203;</strong> and, under "Directory", search for your project.</p>
</div>
<div id="img-cobigen" class="imageblock">
<div class="content">
<a class="image" href="= "images/Project_selection.png""><img src="../_images/images/Project_selection.png" alt="cobigen" width="= "600""></a>
</div>
</div>
<div class="paragraph">
<p>Next we copy our OpenAPI file into the root folder of the project.</p>
</div>
<div id="img-cobigen" class="imageblock">
<div class="content">
<a class="image" href="= "images/OpenAPI_file_root_folder.png""><img src="../_images/images/OpenAPI_file_root_folder.png" alt="cobigen" width="= "300""></a>
</div>
</div>
<div class="paragraph">
<p>And then we right click on OpenAPI file and then select <strong>CobiGen &gt; Generate&#8230;&#8203;</strong> It will display a window like this:</p>
</div>
<div id="img-cobigen" class="imageblock">
<div class="content">
<a class="image" href="= "images/cobigen_generate0.png""><img src="../_images/images/cobigen_generate0.png" alt="cobigen" width="= "800""></a>
</div>
</div>
<div class="paragraph">
<p>To select all .NET features choose <strong>CRUD devon4net Server</strong> otherwise you can select only those that interest you.</p>
</div>
<div id="img-cobigen" class="imageblock">
<div class="content">
<a class="image" href="= "images/cobigen_generate1.png"><img src="../_images/images/cobigen_generate1.png" alt="cobigen" width="= "800""></a>
</div>
</div>
<div class="paragraph">
<p>Ones you select all the files that you want to generate, click on the <em>“Finish”</em> button to generate all the source code.</p>
</div>
</div>
<div class="sect3">
<h4 id="_generating_files_through_cobigen_cli"><a class="anchor" href="#_generating_files_through_cobigen_cli"></a>==  Generating files through Cobigen` CLI`</h4>
<div class="paragraph">
<p>In order to generate the files using the Cobigen` CLI` it is needed to do the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Go to devonfw distribution folder</p>
</li>
<li>
<p>Run <strong>console.bat</strong>, this will open a console.</p>
</li>
<li>
<p>Go to the folder you downloaded the <strong>devon4net template</strong> and your <strong>yml</strong> file.</p>
</li>
<li>
<p>Run the command:</p>
<div class="literalblock">
<div class="content">
<pre>cobigen generate {yourOpenAPIFile}.yml</pre>
</div>
</div>
</li>
<li>
<p>A list of increments will be printed so that you can start the generation. It has to be selected <strong>CRUD devon4net Server</strong> increment.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_configuration"><a class="anchor" href="#_configuration"></a>Configuration</h4>

</div>
<div class="sect3">
<h4 id="_dependency_injection_configuration"><a class="anchor" href="#_dependency_injection_configuration"></a>==  Dependency Injection configuration</h4>
<div class="paragraph">
<p>At this point it is needed to make some modifications in the code in order to configure correctly the server. To do so it is needed to locate the services and the repositories files that were created in <strong>Devon4Net.WebAPI.Implementation</strong></p>
</div>
<div class="paragraph">
<p>Services location:</p>
</div>
<div id="img-cobigen" class="imageblock">
<div class="content">
<a class="image" href="= "images/Services.png"><img src="../_images/images/Services.png" alt="cobigen" width="= "300""></a>
</div>
</div>
<div class="paragraph">
<p>Repositories location:</p>
</div>
<div id="img-cobigen" class="imageblock">
<div class="content">
<a class="image" href="= "images/Repositories.png"><img src="../_images/images/Repositories.png" alt="cobigen" width="= "300""></a>
</div>
</div>
<div class="paragraph">
<p>Now, we are going to open the following file <strong>Devon4Net.WebAPI.Implementation\Configure\DevonConfiguration.cs</strong>.
In there we have to add the Dependency Injection for the services and the repositories that Cobigen has generated. The following image is an example of what is needed to add.</p>
</div>
<div id="img-cobigen" class="imageblock">
<div class="content">
<a class="image" href="= "images/BussinessConfiguration.png"><img src="../_images/images/BussinessConfiguration.png" alt="cobigen" width="= "800""></a>
</div>
</div>
<div class="paragraph">
<p>Moreover it is needed to remove the last line in order to be able to run the application:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>`throw new NotImplementedException(...);`</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_configure_data_base"><a class="anchor" href="#_configure_data_base"></a>==  Configure data base</h4>
<div class="paragraph">
<p>Cobigen is generating an empty context that has to be filled with manually in order to be able to work with the database. The context can be found in <strong>[Project_Name]/Devon4Net.WebAPI.Implementation/Domain/Database/CobigenContext.cs</strong>.</p>
</div>
<div id="img-cobigen" class="imageblock">
<div class="content">
<a class="image" href="= "images/CobigenContextLocation.png"><img src="../_images/images/CobigenContextLocation.png" alt="cobigen" width="= "350""></a>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_configure_services"><a class="anchor" href="#_configure_services"></a>==  Configure services</h4>
<div class="paragraph">
<p>In order to finish the configuration of the services it is needed to go to each service file of the managements generated.</p>
</div>
<div class="paragraph">
<p>In there we will see some <code>"NotImplementedExceptions"</code>, so it is needed to read carefully each comment inside of each exception in order to be able to use the service. It can be shown an example of the service with its <code>NotImplementedExceptions</code> comments:</p>
</div>
<div id="img-cobigen" class="imageblock">
<div class="content">
<a class="image" href="= "images/ServiceExample.png"><img src="../_images/images/ServiceExample.png" alt="cobigen" width="= "800""></a>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_run_the_application"><a class="anchor" href="#_run_the_application"></a>==  Run the application</h4>
<div class="paragraph">
<p>After doing all the steps defined above, open a terminal in path: <strong>[Project_Name]/Devon4Net.Application.WebAPI</strong> and then type:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>dotnet run</pre>
</div>
</div>
<div class="paragraph">
<p>This will deploy our application in our localhost with the port 8081, so when you click <a href="https://localhost:8082/swagger/index.html">here</a> (<a href="https://localhost:8082/swagger" class="bare">https://localhost:8082/swagger</a>) you can see, in swagger, all the services and the data model.</p>
</div>
</div>
<div class="sect3">
<h4 id="_use_http2_protocol"><a class="anchor" href="#_use_http2_protocol"></a>Use HTTP2 protocol</h4>
<div class="paragraph">
<p>You can specify the` HTTP` protocol to be used on your devon4net application modifying some node values at <em>devonfw</em> node in your appsettings configuration file.</p>
</div>
</div>
<div class="sect3">
<h4 id="_httpprotocol"><a class="anchor" href="#_httpprotocol"></a>HttpProtocol</h4>
<div class="paragraph">
<p>The supported protocols are:</p>
</div>
<div class="paragraph">
<p>|== == == == == == == == == == == =
|<strong>Protocol</strong>|<strong>Description</strong>
|Http1| Http1 protocol
|Http2| Http2 Protocol
|Http1AndHttp2| Both supported
|== == == == == == == == == == == =</p>
</div>
</div>
<div class="sect3">
<h4 id="_ssl"><a class="anchor" href="#_ssl"></a>=` SSL`</h4>
<div class="paragraph">
<p>To activate the HTTP2, the <em>SslProtocol</em> node must be set to <em>Tls12</em> value.</p>
</div>
<div class="paragraph">
<p>The` SSL` protocol supported version values are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Tls</p>
</li>
<li>
<p>Tls11</p>
</li>
<li>
<p>Tls12</p>
</li>
<li>
<p>Tls13</p>
</li>
<li>
<p>Ssl2</p>
</li>
<li>
<p>Ssl3</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_create_a_certificate_for_development_purposes"><a class="anchor" href="#_create_a_certificate_for_development_purposes"></a>Create a certificate for development purposes</h4>
<div class="paragraph">
<p>In order to create a valid certificate for development purposes the Open` SSL` tools are needed.</p>
</div>
</div>
<div class="sect3">
<h4 id="_certificate_authority_ca"><a class="anchor" href="#_certificate_authority_ca"></a>Certificate authority (CA)</h4>
<div class="paragraph">
<p>Run the next commands in a shell:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-numbered hljs" data-lang="numbered">1. openssl req -x509 -nodes -new -sha256 -days 1024 -newkey rsa:2048 -keyout RootCA.key -out RootCA.pem -subj "/C=ES/ST=Valencia/L=Valencia/O=Certificates/CN=localhost.local"

2. openssl x509 -outform pem -in RootCA.pem -out RootCA.crt</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to convert your certificate run the command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-numbered hljs" data-lang="numbered">openssl pkcs12 -export -out localhost.pfx -inkey RootCA.key -in RootCA.crt</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_domain_name_certificate"><a class="anchor" href="#_domain_name_certificate"></a>Domain name certificate</h4>
<div class="paragraph">
<p>Run the next commands in a shell:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-numbered hljs" data-lang="numbered">1. openssl req -new -nodes -newkey rsa:2048 -keyout localhost.key -out localhost.csr -subj "/C=ES/ST=Valencia/L=Valencia/O=Certificates/CN=localhost.local"

2. openssl x509 -req -sha256 -days 1024 -in localhost.csr -CA RootCA.pem -CAkey RootCA.key -CAcreateserial -extfile domains.ext -out localhost.crt</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where the <em>domains.ext</em> file should contain:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-numbered hljs" data-lang="numbered">authorityKeyIdentifier=keyid,issuer
basicConstraints=CA:FALSE
keyUsage = digitalSignature, nonRepudiation, keyEncipherment, dataEncipherment
subjectAltName = @alt_names
[alt_names]
DNS.1 = localhost
DNS.2 = localhost.local
DNS.3 = 127.0.0.1
DNS.4 = fake1.local
DNS.5 = fake2.local</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to convert your certificate run the command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-numbered hljs" data-lang="numbered">openssl pkcs12 -export -out localhost.pfx -inkey localhost.key -in localhost.crt</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_setup_the_database_driver"><a class="anchor" href="#_setup_the_database_driver"></a>Setup the database driver</h4>
<div class="paragraph">
<p>Add the database connection on the <code>SetupDatabase</code> method at Startup.cs</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>       private void SetupDatabase(IServiceCollection services)
        {
            services.SetupDatabase&lt;TodoContext&gt;(Configuration, "Default", WebAPI.Configuration.Enums.DatabaseType.InMemory);
        }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where:</p>
</div>
<div class="paragraph">
<p>|== == == == == == == == == == == =
|<strong>Param</strong>|<strong>Description</strong>
|<code>TodoContext</code>| Is the database context definition
|Default| Is the connection string defined at <code><em>ConnectionString</em></code> node at the appsettings configuration file
|<code>WebAPI.Configuration.Enums.DatabaseType.InMemory</code>| Is the database driver selection. In this case InMemory data base is chosen
|== == == == == == == == == == == =</p>
</div>
<div class="paragraph">
<p>The supported databases are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>SqlServer</p>
</li>
<li>
<p>Sqlite</p>
</li>
<li>
<p>InMemory</p>
</li>
<li>
<p>Cosmos</p>
</li>
<li>
<p>PostgreSQL</p>
</li>
<li>
<p>MySql</p>
</li>
<li>
<p>MariaDb</p>
</li>
<li>
<p>FireBird</p>
</li>
<li>
<p>Oracle</p>
</li>
<li>
<p>MSAccess</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_change_the_jwt_encryption_algorithm"><a class="anchor" href="#_change_the_jwt_encryption_algorithm"></a>Change the JWT encryption algorithm</h4>
<div class="paragraph">
<p>In the appsettings.json configuration file, you can use the next values on the <code><em>SecretKeyLengthAlgorithm</em></code> and <code><em>SecretKeyEncryptionAlgorithm</em></code> nodes at JWT configuration:</p>
</div>
<div class="paragraph">
<p>|== == == == == == == == == == == =
|<strong>Algorithm</strong>|<strong>Description</strong>
|<code>Aes128Encryption</code>|"http://www.w3.org/2001/04/xmlenc#aes128-cbc"
|<code>Aes192Encryption</code>|"http://www.w3.org/2001/04/xmlenc#aes192-cbc"
|<code>Aes256Encryption</code>|"http://www.w3.org/2001/04/xmlenc#aes256-cbc"
|<code>DesEncryption</code>|"http://www.w3.org/2001/04/xmlenc#des-cbc"
|<code>Aes128KeyWrap</code>|"http://www.w3.org/2001/04/xmlenc#kw-aes128"
|<code>Aes192KeyWrap</code>|"http://www.w3.org/2001/04/xmlenc#kw-aes192"
|<code>Aes256KeyWrap</code>|"http://www.w3.org/2001/04/xmlenc#kw-aes256"
|<code>RsaV15KeyWrap</code>|"http://www.w3.org/2001/04/xmlenc#rsa-1_5"
|<code>Ripemd160Digest</code>|"http://www.w3.org/2001/04/xmlenc#ripemd160"
|<code>RsaOaepKeyWrap</code>|"http://www.w3.org/2001/04/xmlenc#rsa-oaep"
|<code>Aes128KW</code>|"A128KW"
|<code>Aes256KW</code>|"A256KW"
|<code>RsaPKCS1</code>|<code>"RSA1_5"</code>
|<code>RsaOAEP</code>|<code>"RSA-OAEP"</code>
|<code>ExclusiveC14n</code>|"http://www.w3.org/2001/10/xml-exc-c14n#"
|<code>ExclusiveC14nWithComments</code>|"http://www.w3.org/2001/10/xml-exc-c14n#WithComments"
|<code>EnvelopedSignature</code>|"http://www.w3.org/2000/09/xmldsig#enveloped-signature"
|<code>Sha256Digest</code>|"http://www.w3.org/2001/04/xmlenc#sha256"
|<code>Sha384Digest</code>|"http://www.w3.org/2001/04/xmldsig-more#sha384"
|<code>Sha512Digest</code>|"http://www.w3.org/2001/04/xmlenc#sha512"
|<code>Sha256</code>|"SHA256"
|<code>Sha384</code>|"SHA384"
|<code>Sha512</code>|"SHA512"
|<code>EcdsaSha256Signature</code>|"http://www.w3.org/2001/04/xmldsig-more#ecdsa-sha256"
|<code>EcdsaSha384Signature</code>|"http://www.w3.org/2001/04/xmldsig-more#ecdsa-sha384"
|<code>EcdsaSha512Signature</code>|"http://www.w3.org/2001/04/xmldsig-more#ecdsa-sha512"
|<code>HmacSha256Signature</code>|"http://www.w3.org/2001/04/xmldsig-more#hmac-sha256"
|<code>HmacSha384Signature</code>|"http://www.w3.org/2001/04/xmldsig-more#hmac-sha384"
|<code>HmacSha512Signature</code>|"http://www.w3.org/2001/04/xmldsig-more#hmac-sha512"
|<code>RsaSha256Signature</code>|"http://www.w3.org/2001/04/xmldsig-more#rsa-sha256"
|<code>RsaSha384Signature</code>|"http://www.w3.org/2001/04/xmldsig-more#rsa-sha384"
|<code>RsaSha512Signature</code>|"http://www.w3.org/2001/04/xmldsig-more#rsa-sha512"
|<code>RsaSsaPssSha256Signature</code>|"http://www.w3.org/2007/05/xmldsig-more#sha256-rsa-MGF1"
|<code>RsaSsaPssSha384Signature</code>|"http://www.w3.org/2007/05/xmldsig-more#sha384-rsa-MGF1"
|<code>RsaSsaPssSha512Signature</code>|"http://www.w3.org/2007/05/xmldsig-more#sha512-rsa-MGF1"
|<code>EcdsaSha256</code>|"ES256"
|<code>EcdsaSha384</code>|"ES384"
|<code>EcdsaSha512</code>|"ES512"
|<code>HmacSha256</code>|"HS256"
|<code>HmacSha384</code>|"HS384"
|<code>HmacSha512</code>|"HS512"
|None|"none"
|<code>RsaSha256</code>|"RS256"
|<code>RsaSha384</code>|"RS384"
|<code>RsaSha512</code>|"RS512"
|<code>RsaSsaPssSha256</code>|"PS256"
|<code>RsaSsaPssSha384</code>|"PS384"
|<code>RsaSsaPssSha512</code>|"PS512"
|<code>Aes128CbcHmacSha256</code>|"A128CBC-HS256"
|<code>Aes192CbcHmacSha384</code>|"A192CBC-HS384"
|<code>Aes256CbcHmacSha512</code>|"A256CBC-HS512"
|== == == == == == == == == == == =</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_cobigen_guide"><a class="anchor" href="#_cobigen_guide"></a>Cobigen guide</h2>
<div class="sectionbody">
<!-- toc disabled -->
<div class="sect3">
<h4 id="_devon4net_cobigen_guide_2"><a class="anchor" href="#_devon4net_cobigen_guide_2"></a>devon4net Cobigen Guide</h4>

</div>
<div class="sect3">
<h4 id="_overview_2"><a class="anchor" href="#_overview_2"></a>Overview</h4>
<div class="paragraph">
<p>In this guide we will explain how to generate a new <code>WebApi</code> project from an OpenAPI 3.0.0 specification. This  means that we are going to use a “contract first” strategy. This is going to be possible due to these type of files that contain all the information about entities, operations, etc…</p>
</div>
<div class="paragraph">
<p>In order to make it work we are using <a href="https://github.com/devonfw/cobigen"><code>CobiGen</code></a>, a powerful tool for generating source code. <code>CobiGen</code> allows users to generate all the structure and code of the components, helping to save a lot of time otherwise wasted on repetitive tasks.</p>
</div>
</div>
<div class="sect3">
<h4 id="_getting_things_ready_2"><a class="anchor" href="#_getting_things_ready_2"></a>Getting things ready</h4>

</div>
<div class="sect3">
<h4 id="_devonfw_distribution_2"><a class="anchor" href="#_devonfw_distribution_2"></a>devonfw Distribution</h4>
<div class="paragraph">
<p>The devonfw distributions can be obtained from the <a href="https://coconet.capgemini.com/sf/frs/do/listReleases/projects.apps2_devon/frs.devon_distribution"><code>TeamForge</code> releases library</a> and are packaged in zips files that include all the needed tools, software and configurations.</p>
</div>
<div class="paragraph">
<p>It is not necessary to install nor configure anything. Just extracting the zip content is enough to have a fully functional devonfw. The only thing you have to do is run <strong>create-or-update-workspace.bat</strong> and then <strong>update-all-workspaces.bat</strong> to set up all the needed tools.</p>
</div>
</div>
<div class="sect3">
<h4 id="_devon4net_templates_2"><a class="anchor" href="#_devon4net_templates_2"></a>devon4net Templates</h4>
<div class="paragraph">
<p>We are going to use the template of devon4net as a base to generate all the code, so what we have to do now is to download said template using the following steps.</p>
</div>
<div class="paragraph">
<p>First of all you have to set up all the environment for .NET, you can do this using <a href="https://devon4net.github.io/environment.html">the following tutorial</a>. Next we are going to create a new folder where we want to have the WebAPI project, lastly we are going to open the terminal there.</p>
</div>
<div class="paragraph">
<p>Type the following:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>dotnet new -i `Devon4Net`.WebAPI.Template</pre>
</div>
</div>
<div class="paragraph">
<p>and then:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>dotnet new Devon4NetAPI</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_openapi_file_2"><a class="anchor" href="#_openapi_file_2"></a>OpenAPI File</h4>
<div class="paragraph">
<p>In order to let <code>CobiGen</code> generate all the files, we first have to make some modifications to our OpenAPI file.</p>
</div>
<div class="paragraph">
<p>It is obligatory to put the <em>“x-rootpackage”</em> tag to indicate where <code>CobiGen</code> will place the generated files as well as the <em>"x-component"</em> tags for each component, keep in mind that due to `CobiGen&#8217;s limitations each component <strong><em>must</em></strong> have its own entity.</p>
</div>
<div class="paragraph">
<p>You can read more information about how to configure your OpenAPI file and a working example <a href="https://github.com/devonfw/cobigen/wiki/cobigen-openapiplugin#full-example">here</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_generating_files_2"><a class="anchor" href="#_generating_files_2"></a>Generating files</h4>
<div class="paragraph">
<p>Cobigen allow us to generate the files in two different ways. One of them is using Eclipse which it can be done by using the its graphical interface. The other way to generate the code is using the Cobigen CLI tool.</p>
</div>
</div>
<div class="sect3">
<h4 id="_generating_files_through_eclipse_2"><a class="anchor" href="#_generating_files_through_eclipse_2"></a>Generating files through Eclipse</h4>
<div class="paragraph">
<p>In order to generate the files using Eclipse we need to follow some simple steps.</p>
</div>
<div class="paragraph">
<p>First we are going to import our basic devon4net WebAPI Project into Eclipse. to do so open Eclipse with the “eclipse-main.bat” file that can be found in the devon distribution root folder. Once we are inside of Eclipse we go to <strong>File &gt; Open projects from file system&#8230;&#8203;</strong> and, under "Directory", search for your project.</p>
</div>
<div id="img-cobigen" class="imageblock">
<div class="content">
<a class="image" href="= "images/Project_selection.png""><img src="../_images/images/Project_selection.png" alt="cobigen" width="= "600""></a>
</div>
</div>
<div class="paragraph">
<p>Next we copy our OpenAPI file into the root folder of the project.</p>
</div>
<div id="img-cobigen" class="imageblock">
<div class="content">
<a class="image" href="= "images/OpenAPI_file_root_folder.png""><img src="../_images/images/OpenAPI_file_root_folder.png" alt="cobigen" width="= "300""></a>
</div>
</div>
<div class="paragraph">
<p>And then we right click on OpenAPI file and then select <strong>CobiGen &gt; Generate&#8230;&#8203;</strong> It will display a window like this:</p>
</div>
<div id="img-cobigen" class="imageblock">
<div class="content">
<a class="image" href="= "images/cobigen_generate0.png""><img src="../_images/images/cobigen_generate0.png" alt="cobigen" width="= "800""></a>
</div>
</div>
<div class="paragraph">
<p>To select all .NET features choose <strong>CRUD devon4net Server</strong> otherwise you can select only those that interest you.</p>
</div>
<div id="img-cobigen" class="imageblock">
<div class="content">
<a class="image" href="= "images/cobigen_generate1.png"><img src="../_images/images/cobigen_generate1.png" alt="cobigen" width="= "800""></a>
</div>
</div>
<div class="paragraph">
<p>Ones you select all the files that you want to generate, click on the <em>“Finish”</em> button to generate all the source code.</p>
</div>
</div>
<div class="sect3">
<h4 id="_generating_files_through_cobigen_cli_2"><a class="anchor" href="#_generating_files_through_cobigen_cli_2"></a>Generating files through Cobigen CLI</h4>
<div class="paragraph">
<p>In order to generate the files using the Cobigen CLI it is needed to do the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Go to devonfw distribution folder</p>
</li>
<li>
<p>Run <strong>console.bat</strong>, this will open a console.</p>
</li>
<li>
<p>Go to the folder you downloaded the <strong>devon4net template</strong> and your <strong>yml</strong> file.</p>
</li>
<li>
<p>Run the command:</p>
<div class="literalblock">
<div class="content">
<pre>cobigen generate {yourOpenAPIFile}.yml</pre>
</div>
</div>
</li>
<li>
<p>A list of increments will be printed so that you can start the generation. It has to be selected <strong>CRUD devon4net Server</strong> increment.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_configuration_2"><a class="anchor" href="#_configuration_2"></a>Configuration</h4>

</div>
<div class="sect3">
<h4 id="_dependency_injection_configuration_2"><a class="anchor" href="#_dependency_injection_configuration_2"></a>Dependency Injection configuration</h4>
<div class="paragraph">
<p>At this point it is needed to make some modifications in the code in order to configure correctly the server. To do so it is needed to locate the services and the repositories files that were created in <strong>Devon4Net.WebAPI.Implementation</strong></p>
</div>
<div class="paragraph">
<p>Services location:</p>
</div>
<div id="img-cobigen" class="imageblock">
<div class="content">
<a class="image" href="= "images/Services.png"><img src="../_images/images/Services.png" alt="cobigen" width="= "300""></a>
</div>
</div>
<div class="paragraph">
<p>Repositories location:</p>
</div>
<div id="img-cobigen" class="imageblock">
<div class="content">
<a class="image" href="= "images/Repositories.png"><img src="../_images/images/Repositories.png" alt="cobigen" width="= "300""></a>
</div>
</div>
<div class="paragraph">
<p>Now, we are going to open the following file <code><strong>Devon4Net.WebAPI.Implementation\Configure\DevonConfiguration.cs</strong></code>.
In there we have to add the Dependency Injection for the services and the repositories that Cobigen has generated. The following image is an example of what is needed to add.</p>
</div>
<div id="img-cobigen" class="imageblock">
<div class="content">
<a class="image" href="= "images/BussinessConfiguration.png"><img src="../_images/images/BussinessConfiguration.png" alt="cobigen" width="= "800""></a>
</div>
</div>
<div class="paragraph">
<p>Moreover it is needed to remove the last line in order to be able to run the application:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>`throw new NotImplementedException(...);`</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_configure_data_base_2"><a class="anchor" href="#_configure_data_base_2"></a>Configure data base</h4>
<div class="paragraph">
<p>Cobigen is generating an empty context that has to be filled with manually in order to be able to work with the database. The context can be found in <code><strong>[Project_Name]/Devon4Net.WebAPI.Implementation/Domain/Database/CobigenContext.cs</strong></code>.</p>
</div>
<div id="img-cobigen" class="imageblock">
<div class="content">
<a class="image" href="= "images/CobigenContextLocation.png"><img src="../_images/images/CobigenContextLocation.png" alt="cobigen" width="= "350""></a>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_configure_services_2"><a class="anchor" href="#_configure_services_2"></a>Configure services</h4>
<div class="paragraph">
<p>In order to finish the configuration of the services it is needed to go to each service file of the managements generated.</p>
</div>
<div class="paragraph">
<p>In there we will see some <code>"NotImplementedExceptions"</code>, so it is needed to read carefully each comment inside of each exception in order to be able to use the service. It can be shown an example of the service with its <code>NotImplementedExceptions</code> comments:</p>
</div>
<div id="img-cobigen" class="imageblock">
<div class="content">
<a class="image" href="= "images/ServiceExample.png"><img src="../_images/images/ServiceExample.png" alt="cobigen" width="= "800""></a>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_run_the_application_2"><a class="anchor" href="#_run_the_application_2"></a>Run the application</h4>
<div class="paragraph">
<p>After doing all the steps defined above, open a terminal in path: <strong>[Project_Name]/Devon4Net.Application.WebAPI</strong> and then type:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>dotnet run</pre>
</div>
</div>
<div class="paragraph">
<p>This will deploy our application in our localhost with the port 8081, so when you click <a href="https://localhost:8082/swagger/index.html">here</a> (<a href="https://localhost:8082/swagger" class="bare">https://localhost:8082/swagger</a>) you can see, in swagger, all the services and the data model.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_coding_conventions"><a class="anchor" href="#_coding_conventions"></a>Coding conventions</h2>
<div class="sectionbody">
<!-- toc disabled -->
<div class="paragraph">
<p>==Code conventions</p>
</div>
<div class="sect3">
<h4 id="_introduction_4"><a class="anchor" href="#_introduction_4"></a><span class="navy">Introduction</span></h4>
<div class="paragraph">
<p>This document covers .NET Coding Standards and is recommended to be read by team <code>leaders/sw</code> architects and developing teams operating in the Microsoft .NET environment.</p>
</div>
<div class="paragraph">
<p>“All the code in the system looks as if it was written by a single – very competent – individual” (K. Beck)</p>
</div>
</div>
<div class="sect3">
<h4 id="_capitalization_conventions"><a class="anchor" href="#_capitalization_conventions"></a><span class="navy">Capitalization Conventions</span></h4>
<div class="sect4">
<h5 id="_terminology"><a class="anchor" href="#_terminology"></a><span class="navy">Terminology</span></h5>
<div class="sect5">
<h6 id="_camel_case_camelcase"><a class="anchor" href="#_camel_case_camelcase"></a>Camel Case (camelCase)</h6>
<div class="paragraph">
<p>Each word or abbreviation in the middle of the phrase begins with a capital letter, with no intervening spaces or punctuation.</p>
</div>
<div class="paragraph">
<p>The camel case convention, used only for parameter names, capitalizes the first character of each word except the first word, as shown in the following examples. As the example also shows, two-letter acronyms that begin a camel-cased identifier are both lowercase.</p>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-= fa-thumbs-o-up"></i></span> use <code>camelCasing</code> for parameter names.</p>
</div>
</div>
<div class="sect5">
<h6 id="_pascal_case_pascalcase"><a class="anchor" href="#_pascal_case_pascalcase"></a>Pascal Case (<code>PascalCase</code>)</h6>
<div class="paragraph">
<p>The first letter of each concatenated word is capitalized. No other characters are used to separate the words, like hyphens or underscores.</p>
</div>
<div class="paragraph">
<p>The <code>PascalCasing</code> convention, used for all identifiers except parameter names, capitalizes the first character of each word (including acronyms over two letters in length).</p>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-= fa-thumbs-o-up"></i></span> use <code>PascalCasing</code> for all public member, type, and namespace names consisting of multiple words.</p>
</div>
</div>
<div class="sect5">
<h6 id="_underscore_prefix_underscore"><a class="anchor" href="#_underscore_prefix_underscore"></a>Underscore Prefix (_underScore)</h6>
<div class="paragraph">
<p>For underscore ( _ ), the word after _ use camelCase terminology.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_general_naming_conventions"><a class="anchor" href="#_general_naming_conventions"></a><span class="navy">General Naming Conventions</span></h4>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-= fa-thumbs-o-up"></i></span> choose easily readable identifier names.</p>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-= fa-thumbs-o-up"></i></span> favor readability over brevity.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>◦ e.g.: `GetLength` is a better name than GetInt.
◦ Aim for the “ubiquitous language” (E. Evans): A language distilled from the domain language, which helps the team clarifying domain concepts and communicating with domain experts.</pre>
</div>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-= fa-thumbs-o-up"></i></span> prefer adding a suffix rather than a prefix to indicate a new version of an existing <code>API</code>.</p>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-= fa-thumbs-o-up"></i></span> use a numeric suffix to indicate a new version of an existing <code>API</code>, particularly if the existing name of the <code>API</code> is the only name that makes sense (i.e., if it is an industry standard) and if adding any meaningful suffix (or changing the name) is not an appropriate option.</p>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-= fa-thumbs-o-down"></i></span> do not use underscores, hyphens, or any other non-alphanumeric characters.</p>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-= fa-thumbs-o-down"></i></span> do not use Hungarian notation.</p>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-= fa-thumbs-o-down"></i></span> avoid using identifiers that conflict with keywords of widely used programming languages.</p>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-= fa-thumbs-o-down"></i></span> do not use abbreviations or contractions as part of identifier names.</p>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-= fa-thumbs-o-down"></i></span> do not use any acronyms that are not widely accepted, and even if they are, only when necessary.</p>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-= fa-thumbs-o-down"></i></span> do not use the "Ex" (or a similar) suffix for an identifier to distinguish it from an earlier version of the same <code>API</code>.</p>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-= fa-thumbs-o-down"></i></span> do not use C# reserved words as names.</p>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-= fa-thumbs-o-down"></i></span> do not use Hungarian notation. Hungarian notation is the practice of including a prefix in identifiers to encode some metadata about the parameter, such as the data type of the identifier.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>◦ `e.g.: iNumberOfClients, sClientName`</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_names_of_assemblies_and_dlls"><a class="anchor" href="#_names_of_assemblies_and_dlls"></a><span class="navy">Names of Assemblies and DLLs</span></h4>
<div class="paragraph">
<p>An assembly is the unit of deployment and identity for managed code programs. Although assemblies can span one or more files, typically an assembly maps one-to-one with a` DLL`. Therefore, this section describes only` DLL` naming conventions, which then can be mapped to assembly naming conventions.</p>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-= fa-thumbs-o-up"></i></span> choose names for your assembly DLLs that suggest large chunks of functionality, such as System.Data.</p>
</div>
<div class="paragraph">
<p>Assembly and <code>DLL</code> names don’t have to correspond to namespace names, but it is reasonable to follow the namespace name when naming assemblies. A good rule of thumb is to name the <code>DLL</code> based on the common prefix of the assemblies contained in the assembly. For example, an assembly with two namespaces, <code>MyCompany.MyTechnology.FirstFeature</code> and <code>MyCompany.MyTechnology.SecondFeature</code>, could be called <code>MyCompany.MyTechnology.dll</code>.</p>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-= fa-thumbs-o-up"></i></span> consider naming DLLs according to the following pattern:<br>
&lt;Company&gt;.&lt;Component&gt;.dll
where &lt;Component&gt; contains one or more dot-separated clauses.</p>
</div>
<div class="paragraph">
<p>For example:
Litware.Controls.dll.</p>
</div>
</div>
<div class="sect3">
<h4 id="_general_coding_style"><a class="anchor" href="#_general_coding_style"></a><span class="navy">General coding style</span></h4>
<div class="ulist">
<ul>
<li>
<p>Source files: One Namespace per file and one class per file.</p>
</li>
<li>
<p>Braces: On new line. Always use braces when optional.</p>
</li>
<li>
<p>Indention: Use tabs with size of 4.</p>
</li>
<li>
<p>Comments: Use // for simple comment or /// for summaries. Do not /* … */ and do not flower box.</p>
</li>
<li>
<p>Use Use built-in C# native data types vs .NET <code>CTS</code> types (string instead of String)</p>
</li>
<li>
<p>Avoid changing default type in Enums.</p>
</li>
<li>
<p>Use <em>base</em> or <em>this</em> only in constructors or within an override.</p>
</li>
<li>
<p>Always check for null before invoking events.</p>
</li>
<li>
<p>Avoid using <em>Finalize</em>. Use C# Destructors and do not create Finalize() method.</p>
</li>
<li>
<p>Suggestion: Use blank lines, to make it much more readable by dividing it into small, easy-to-digest sections:</p>
<div class="literalblock">
<div class="content">
<pre>◦ Use a single blank line to separate logical groups of code, such as control structures.
◦ Use two blank lines to separate method definitions</pre>
</div>
</div>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Case</strong></th>
<th class="tableblock halign-left valign-top"><strong>Convention</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Source File</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pascal case. Match class name and file name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Namespace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pascal case</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pascal case</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interface</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pascal case</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generics</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Single capital letter (T or <code>K</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Methods</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pascal case (use a Verb or Verb+Object)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Public field</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pascal case</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Private field</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Camel case with underscore (_) prefix</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Static field</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pascal case</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Property</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pascal case. Try to use get and and set convention {get;set;}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Constant</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pascal case</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enum</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pascal case</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Variable (inline)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Camel case</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Param</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Camel case</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_use_of_region_guideline"><a class="anchor" href="#_use_of_region_guideline"></a><span class="navy">Use of Region guideline</span></h4>
<div class="paragraph">
<p>Regions can be used to collapse code inside Visual Studio .NET. Regions are ideal candidates to hide boiler plate style code that adds little value to the reader on your code. Regions can then be expanded to provide progressive disclosure of the underlying details of the class or method.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Do Not regionalise entire type definitions that are of an important nature. Types such as enums (which tend to be fairly static in their nature) can be regionalised – their permissible values show up in Intellisense anyway.</p>
</li>
<li>
<p>Do Not regionalise an entire file. When another developer opens the file, all they will see is a single line in the code editor pane.</p>
</li>
<li>
<p>Do regionalise boiler plate type code.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_use_of_comment_guideline"><a class="anchor" href="#_use_of_comment_guideline"></a><span class="navy">Use of Comment guideline</span></h4>
<div class="paragraph">
<p>Code is the only completely reliable documentation: write “good code” first!</p>
</div>
<div class="sect4">
<h5 id="_avoid_unnecessary_comments"><a class="anchor" href="#_avoid_unnecessary_comments"></a><span class="navy">Avoid Unnecessary comments</span></h5>
<div class="ulist">
<ul>
<li>
<p>Choosing good names for fields, methods, parameters, etc. “let the code speak” (K. Beck) by itself reducing the need for comments and documentation</p>
</li>
<li>
<p>Avoid “repeating the code” and commenting the obvious</p>
</li>
<li>
<p>Avoid commenting “tricky code”: rewrite it! If there’s no time at present to refactor a tricky section, mark it with a <code>TODO</code> and schedule time to take care of it as soon as possible.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_effective_comments"><a class="anchor" href="#_effective_comments"></a><span class="navy">Effective comments</span></h5>
<div class="ulist">
<ul>
<li>
<p>Use comments to summarize a section of code</p>
</li>
<li>
<p>Use comments to clarify sensitive pieces of code</p>
</li>
<li>
<p>Use comments to clarify the intent of the code</p>
</li>
<li>
<p>Bad written or out-of-date comments are more damaging than helpful:</p>
</li>
<li>
<p>Write clear and effective comments</p>
</li>
<li>
<p>Pay attention to pre-existing comments when modifying code or copying&amp;pasting code</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_external_links_3"><a class="anchor" href="#_external_links_3"></a><span class="navy">External links</span></h4>
<div class="paragraph">
<p><a href="https://docs.microsoft.com/en-us/dotnet/standard/design-guidelines/naming-guidelines">Naming guidelines</a></p>
</div>
<div class="paragraph">
<p><a href="https://docs.microsoft.com/en-us/dotnet/standard/design-guidelines/general-naming-conventions">General naming conventions</a></p>
</div>
<div class="paragraph">
<p><a href="https://docs.microsoft.com/en-us/dotnet/standard/design-guidelines/capitalization-conventions">Capitalization conventions</a></p>
</div>
<div class="paragraph">
<p><a href="https://docs.microsoft.com/en-us/dotnet/standard/design-guidelines/names-of-assemblies-and-dlls">Assembly and Name Spaces conventions</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_environment"><a class="anchor" href="#_environment"></a>Environment</h2>
<div class="sectionbody">
<!-- toc disabled -->
<div class="sect3">
<h4 id="_environment_2"><a class="anchor" href="#_environment_2"></a>Environment</h4>

</div>
<div class="sect3">
<h4 id="_overview_3"><a class="anchor" href="#_overview_3"></a><span class="navy">Overview</span></h4>

</div>
<div class="sect3">
<h4 id="_required_software"><a class="anchor" href="#_required_software"></a><span class="navy">Required software</span></h4>
<div class="paragraph">
<p><a href="https://code.visualstudio.com/">Visual Studio Code</a></p>
</div>
<div class="paragraph">
<p><a href="https://marketplace.visualstudio.com/items?itemName=ms-vscode.csharp">C# Extension for VS Code</a></p>
</div>
<div class="paragraph">
<p><a href="https://www.microsoft.com/net/core">.Net Core SDK</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_setting_up_the_environment"><a class="anchor" href="#_setting_up_the_environment"></a><span class="navy">Setting up the environment</span></h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Download and install <a href="https://code.visualstudio.com/">Visual Studio Code</a></p>
</li>
<li>
<p>Download and install <a href="https://www.microsoft.com/net/core">.Net Core SDK</a></p>
</li>
<li>
<p><a href="https://code.visualstudio.com/docs/editor/extension-gallery">Intall the extension</a> <a href="https://marketplace.visualstudio.com/items?itemName=ms-vscode.csharp">Omnisharp</a> in Visual Studio Code</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_hello_world"><a class="anchor" href="#_hello_world"></a>==  <span class="navy">Hello world</span></h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open a project:</p>
<div class="ulist">
<ul>
<li>
<p>Open Visual Studio Code.</p>
</li>
<li>
<p>Click on the Explorer icon on the left menu and then click <strong>Open Folder</strong>.</p>
</li>
<li>
<p>Select the folder you want your C# project to be in and click <strong>Select Folder</strong>. For our example, we&#8217;ll create a folder for our project named <code>'HelloWorld'</code>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Initialize a C# project:</p>
<div class="ulist">
<ul>
<li>
<p>Open the Integrated Terminal from Visual Studio Code by typing <code>CTRL+(backtick)</code>. Alternatively, you can select <strong>View</strong> &gt; <strong>Integrated Terminal</strong> from the main menu.</p>
</li>
<li>
<p>In the terminal window, type <code>dotnet new console</code>.</p>
</li>
<li>
<p>This creates a <code>Program.cs</code> file in your folder with a simple "Hello World" program already written, along with a C# project file named <code>HelloWorld.csproj</code>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Resolve the build assets:</p>
<div class="ulist">
<ul>
<li>
<p>For <strong>.NET Core 2.0</strong>, this step is optional. The <code>dotnet restore</code> command executes automatically when a new project is created.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Run the "Hello World" program:</p>
<div class="ulist">
<ul>
<li>
<p>Type <code>dotnet run</code>.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_debug"><a class="anchor" href="#_debug"></a><span class="navy">Debug</span></h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open Program.cs by clicking on it. The first time you open a C# file in Visual Studio Code, OmniSharp will load in the editor.</p>
</li>
<li>
<p>Visual Studio Code will prompt you to add the missing assets to build and debug your app. Select Yes.</p>
</li>
<li>
<p>To open the Debug view, click on the Debugging icon on the left side menu.</p>
</li>
<li>
<p>Locate the green arrow at the top of the pane. Make sure the drop-down next to it has <code>.NET Core Launch (console)</code> selected.</p>
</li>
<li>
<p>Add a breakpoint to your project by clicking on the <strong>editor margin</strong> (the space on the left of the line numbers in the editor).</p>
</li>
<li>
<p>Select F5 or the green arrow to start debugging. The debugger stops execution of your program when it reaches the breakpoint you set in the previous step.</p>
<div class="ulist">
<ul>
<li>
<p>While debugging you can view your local variables in the top left pane or use the debug console.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Select the green arrow at the top to continue debugging, or select the red square at the top to stop.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id=""><a class="anchor" href="#"></a>==</h4>
<div class="paragraph">
<p>For more information and troubleshooting tips on .NET Core debugging with OmniSharp in Visual Studio Code, see <a href="https://github.com/OmniSharp/omnisharp-vscode/blob/master/debugger.md">Instructions for setting up the .NET Core debugger</a>.
== ==</p>
</div>
</div>
<div class="sect3">
<h4 id="_external_links_4"><a class="anchor" href="#_external_links_4"></a><span class="navy">External links</span></h4>
<div class="paragraph">
<p><a href="https://www.microsoft.com/net/core">.Net Core</a></p>
</div>
<div class="paragraph">
<p><a href="https://code.visualstudio.com/docs/other/dotnet">Using .NET Core in Visual Studio Code</a></p>
</div>
<div class="paragraph">
<p><a href="https://docs.microsoft.com/dotnet/core/tutorials/with-visual-studio-code">.Net Core in Visual Studio Code tutorial</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_packages"><a class="anchor" href="#_packages"></a>Packages</h2>
<div class="sectionbody">
<!-- toc disabled -->
<div class="sect3">
<h4 id="_packages_2"><a class="anchor" href="#_packages_2"></a>Packages</h4>

</div>
<div class="sect3">
<h4 id="_packages_overview"><a class="anchor" href="#_packages_overview"></a>Packages overview</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<em>devon4Net</em> is composed by a number of packages that increases the functionality and boosts time development. Each package has it&#8217;s own configuration to make them work properly. In <em>appsettings.json</em> set up your environment. On <em>appsettings.{environment}.json</em> you can configure each component.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_the_packages"><a class="anchor" href="#_the_packages"></a>The packages</h4>
<div class="paragraph">
<p>You can get the devon4Net packages on <a href="https://www.nuget.org/packages?q=devonfw">nuget.org</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_devon4net_application_webapi_configuration"><a class="anchor" href="#_devon4net_application_webapi_configuration"></a><code>Devon4Net</code>.Application.WebAPI.Configuration</h4>

</div>
<div class="sect3">
<h4 id="_description"><a class="anchor" href="#_description"></a>==  Description</h4>
<div class="paragraph">
<p>The devon4Net web API configuration core.</p>
</div>
</div>
<div class="sect3">
<h4 id="_configuration_3"><a class="anchor" href="#_configuration_3"></a>==  Configuration</h4>
<div class="ulist">
<ul>
<li>
<p>Install package on your solution:</p>
<div class="literalblock">
<div class="content">
<pre>PM&gt; Install-Package Devon4Net.Application.WebAPI.Configuration</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_default_configuration_values"><a class="anchor" href="#_default_configuration_values"></a>==  Default configuration values</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>  "devonfw": {
    "UseDetailedErrorsKey": true,
    "UseIIS": false,
    "UseSwagger": true,
    "Environment": "Development",
    "KillSwitch": {
      "killSwitchSettingsFile": "killswitch.appsettings.json"
    },
    "Kestrel": {
      "UseHttps": true,
      "HttpProtocol": "Http2", //Http1, Http2, Http1AndHttp2, none
      "ApplicationPort": 8082,
      "KeepAliveTimeout": 120, //in seconds
      "MaxConcurrentConnections": 100,
      "MaxConcurrentUpgradedConnections": 100,
      "MaxRequestBodySize": 28.6, //In MB. The default maximum request body size is 30,000,000 bytes, which is approximately 28.6 MB
      "Http2MaxStreamsPerConnection": 100,
      "Http2InitialConnectionWindowSize": 131072, // From 65,535 and less than 2^31 (2,147,483,648)
      "Http2InitialStreamWindowSize": 98304, // From 65,535 and less than 2^31 (2,147,483,648)
      "AllowSynchronousIO": true,
      "SslProtocol": "Tls12", //Tls, Tls11,Tls12, Tls13, Ssl2, Ssl3, none. For Https2 Tls12 is needed
      "ServerCertificate": {
        "Certificate": "localhost.pfx",
        "CertificatePassword": "localhost"
      },
      "ClientCertificate": {
        "DisableClientCertificateCheck": true,
        "RequireClientCertificate": false,
        "CheckCertificateRevocation": true,
        "ClientCertificates": {
          "Whitelist": [
            "3A87A49460E8FE0E2A198E63D408DC58435BC501"
          ],
          "DisableClientCertificateCheck": false
        }
      }
    },
    "IIS": {
      "ForwardClientCertificate": true,
      "AutomaticAuthentication": true,
      "AuthenticationDisplayName" : ""
    }
  }</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_devon4net_infrastructure_circuitbreaker"><a class="anchor" href="#_devon4net_infrastructure_circuitbreaker"></a>Devon4Net.Infrastructure.CircuitBreaker</h4>

</div>
<div class="sect3">
<h4 id="_description_2"><a class="anchor" href="#_description_2"></a>==  Description</h4>
<div class="paragraph">
<p>The Devon4Net.Infrastructure.CircuitBreaker component implements the retry pattern for HTTP/HTTPS calls.</p>
</div>
</div>
<div class="sect3">
<h4 id="_configuration_4"><a class="anchor" href="#_configuration_4"></a>==  Configuration</h4>
<div class="ulist">
<ul>
<li>
<p>Install package on your solution:</p>
<div class="literalblock">
<div class="content">
<pre>PM&gt; Install-Package Devon4Net.Infrastructure.CircuitBreaker</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_default_configuration_values_2"><a class="anchor" href="#_default_configuration_values_2"></a>==  Default configuration values</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>  "CircuitBreaker": {
    "CheckCertificate": true,
    "Endpoints": [
      {
        "Name": "SampleService",
        "BaseAddress": "https://localhost:5001/",
        "Headers": {
        },
        "WaitAndRetrySeconds": [
          0.0001,
          0.0005,
          0.001
        ],
        "DurationOfBreak": 0.0005,
        "UseCertificate": true,
        "Certificate": "localhost.pfx",
        "CertificatePassword": "localhost",
        "SslProtocol": "3072" //TLS12
      }
    ]
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>|== == == == == == == == == == == =
|<strong>Property</strong>|<strong>Description</strong>
|<code>CheckCertificate</code>| True if HTTPS is required. This is useful when developing an API Gateway needs a secured HTTP, disabling this on development we can use communications with a valid server certificate
|Endpoints| Array with predefined sites to connect with
|Name| The name key to identify the destination URL
|Headers| Not ready yet
|WaitAndRetrySeconds| Array which determines the number of retries and the lapse period between each retry. The value is in milliseconds.
|Certificate| Ceritificate client to use to perform the HTTP call
|<code>SslProtocol</code>| The secure protocol to use on the call
|== == == == == == == == == == == =</p>
</div>
</div>
<div class="sect3">
<h4 id="_protocols"><a class="anchor" href="#_protocols"></a>==  Protocols</h4>
<div class="paragraph">
<p>|== == == == == == == == == == == =
|<strong>Protocol</strong>|<strong>Key</strong>|<strong>Description</strong>
|SSl3|48| Specifies the Secure Socket Layer (SSL) 3.0 security protocol. SSL 3.0 has been superseded by the Transport Layer Security (TLS) protocol and is provided for backward compatibility only.
|TLS|192|Specifies the Transport Layer Security (TLS) 1.0 security protocol. The TLS 1.0 protocol is defined in IETF RFC 2246.
|TLS11|768| Specifies the Transport Layer Security (TLS) 1.1 security protocol. The TLS 1.1 protocol is defined in IETF RFC 4346. On Windows systems, this value is supported starting with Windows 7.
|TLS12|3072| Specifies the Transport Layer Security (TLS) 1.2 security protocol. The TLS 1.2 protocol is defined in IETF RFC 5246. On Windows systems, this value is supported starting with Windows 7.
|TLS13|12288| Specifies the TLS 1.3 security protocol. The TLS protocol is defined in IETF RFC 8446.</p>
</div>
<div class="paragraph">
<p>|== == == == == == == == == == == =</p>
</div>
</div>
<div class="sect3">
<h4 id="_usage"><a class="anchor" href="#_usage"></a>==  Usage</h4>
<div class="paragraph">
<p>Add via Dependency Injection the circuit breaker instance. PE:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#">    public class FooService : Service&lt;TodosContext&gt;, ILoginService
    {
 public FooService(IUnitOfWork&lt;AUTContext&gt; uoW,  ICircuitBreakerHttpClient circuitBreakerClient,
            ILogger&lt;LoginService&gt; logger) : base(uoW)
        {
        ...
        }
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>At this point you can use the circuit breaker functionality in your code.</p>
</div>
<div class="paragraph">
<p>To perform a POST call you should use your circuit breaker instance as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#">await circuitBreakerClient.PostAsync&lt;YourOutputClass&gt;(NameOftheService, EndPoint, InputData, MediaType.ApplicationJson).ConfigureAwait(false);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where:</p>
</div>
<div class="paragraph">
<p>|== == == == == == == == == == == =
|<strong>Property</strong>|<strong>Description</strong>
|YourOutputClass| The type of the class that you are expecting to retrieve from the POST call
|NameOftheService| The key name of the endpoint provided in the appsettings.json file at Endpoints[] node
|<code>EndPoint</code>|Part of the url to use with the base address. PE: <em>/validate</em>
|<code>InputData</code>| Your instance of the class with values that you want to use in the POST call
|<code>MediaType.ApplicationJson</code>| The media type flag for the POST call
|== == == == == == == == == == == =</p>
</div>
</div>
<div class="sect3">
<h4 id="_devon4net_domain_unitofwork"><a class="anchor" href="#_devon4net_domain_unitofwork"></a>devon4Net.Domain.UnitOfWork</h4>

</div>
<div class="sect3">
<h4 id="_description_3"><a class="anchor" href="#_description_3"></a>==  Description</h4>
<div class="paragraph">
<p>Unit of work implementation for devon4net solution. This unit of work provides the different methods to access the data layer with an atomic context. Sync and Async repository operations are provided. Customized Eager Loading method also provided for custom entity properties.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This component will move on next releases to Infrastructure instead of being part of Domain components
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_configuration_5"><a class="anchor" href="#_configuration_5"></a>==  Configuration</h4>
<div class="ulist">
<ul>
<li>
<p>Install package on your solution:</p>
<div class="literalblock">
<div class="content">
<pre>PM&gt; Install-Package devon4Net.Domain.UnitOfWork</pre>
</div>
</div>
</li>
<li>
<p>Adding the database connection information:</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Add the database connection on the <code>SetupDatabase</code> method at Startup.cs</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#">       private void SetupDatabase(IServiceCollection services)
        {
            services.SetupDatabase&lt;TodoContext&gt;(Configuration, "Default", WebAPI.Configuration.Enums.DatabaseType.InMemory);
        }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where:</p>
</div>
<div class="paragraph">
<p>|== == == == == == == == == == == =
|<strong>Param</strong>|<strong>Description</strong>
|<code>TodoContext</code>| Is the database context definition
|Default| Is the connection string defined at <em>ConnectionString</em> node at the appsettings configuration file
|WebAPI.Configuration.Enums.DatabaseType.InMemory| Is the database driver selection. In this case <code>InMemory</code> data base is chosen
|== == == == == == == == == == == =</p>
</div>
<div class="paragraph">
<p>The supported databases are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>SqlServer</code></p>
</li>
<li>
<p>Sqlite</p>
</li>
<li>
<p><code>InMemory</code></p>
</li>
<li>
<p>Cosmos</p>
</li>
<li>
<p>PostgreSQL</p>
</li>
<li>
<p><code>MySql</code></p>
</li>
<li>
<p><code>MariaDb</code></p>
</li>
<li>
<p><code>FireBird</code></p>
</li>
<li>
<p>Oracle</p>
</li>
<li>
<p>MSAccess</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_notes"><a class="anchor" href="#_notes"></a>==  Notes</h4>
<div class="paragraph">
<p>Now you can use the unit of work via dependency injection on your classes:</p>
</div>
<div id="img-t-architecture" class="imageblock">
<div class="content">
<a class="image" href="images/uow_sample.png"><img src="../_images/images/uow_sample.png" alt="UOW `DI` Sample" width="*"></a>
</div>
<div class="title">Figure 8. Use of Unit of work via dependency injection</div>
</div>
<div class="paragraph">
<p>As you can see in the image, you can use Unit Of Work class with your defined <code>ModelContext</code> classes.</p>
</div>
<div class="paragraph">
<p><em>Predicate expression builder</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use this expression builder to generate lambda expressions dynamically.</p>
<div class="literalblock">
<div class="content">
<pre>var predicate =  PredicateBuilder.True&lt;T&gt;();</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Where <code>T</code> is a class. At this moment, you can build your expression and apply it to obtain your results in a efficient way and not retrieving data each time you apply an expression.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Example from My Thai Star .Net Core implementation:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#">public async Task&lt;PaginationResult&lt;Dish&gt;&gt; GetpagedDishListFromFilter(int currentpage, int pageSize, bool isFav, decimal maxPrice, int minLikes, string searchBy, IList&lt;long&gt; categoryIdList, long userId)
{
    var includeList = new List&lt;string&gt;{"DishCategory","DishCategory.IdCategoryNavigation", "DishIngredient","DishIngredient.IdIngredientNavigation","IdImageNavigation"};

    //Here we create our predicate builder
    var dishPredicate = PredicateBuilder.True&lt;Dish&gt;();


    //Now we start applying the different criteria:
    if (!string.IsNullOrEmpty(searchBy))
    {
        var criteria = searchBy.ToLower();
        dishPredicate = dishPredicate.And(d =&gt; d.Name.ToLower().Contains(criteria) || d.Description.ToLower().Contains(criteria));
    }

    if (maxPrice &gt; 0) dishPredicate = dishPredicate.And(d=&gt;d.Price&lt;=maxPrice);

    if (categoryIdList.Any())
    {
        dishPredicate = dishPredicate.And(r =&gt; r.DishCategory.Any(a =&gt; categoryIdList.Contains(a.IdCategory)));
    }

    if (isFav &amp;&amp; userId &gt;= 0)
    {
        var favourites = await UoW.Repository&lt;UserFavourite&gt;().GetAllAsync(w=&gt;w.IdUser ==  userId);
        var dishes = favourites.Select(s =&gt; s.IdDish);
        dishPredicate = dishPredicate.And(r=&gt; dishes.Contains(r.Id));
    }

    // Now we can use the predicate to retrieve data from database with just one call
    return await UoW.Repository&lt;Dish&gt;().GetAllIncludePagedAsync(currentpage, pageSize, includeList, dishPredicate);

}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_devon4net_infrastructure_extensions"><a class="anchor" href="#_devon4net_infrastructure_extensions"></a>devon4Net.Infrastructure.Extensions</h4>

</div>
<div class="sect3">
<h4 id="_description_4"><a class="anchor" href="#_description_4"></a>==  Description</h4>
<div class="paragraph">
<p>Miscellaneous extension library which contains :
- Predicate expression builder
- <code>DateTime</code> formatter
- <code>HttpClient</code>
- <code>HttpContext</code> (Middleware support)</p>
</div>
</div>
<div class="sect3">
<h4 id="_configuration_6"><a class="anchor" href="#_configuration_6"></a>==  Configuration</h4>
<div class="ulist">
<ul>
<li>
<p>Install package on your solution:</p>
<div class="literalblock">
<div class="content">
<pre>PM&gt; Install-Package devon4Net.Infrastructure.Extensions</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>HttpContext</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p>TryAddHeader method is used on <em>devon4Net.Infrastructure.Middleware</em> component to add automatically response header options such authorization.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_devon4net_infrastructure_jwt"><a class="anchor" href="#_devon4net_infrastructure_jwt"></a>devon4Net.Infrastructure.JWT</h4>

</div>
<div class="sect3">
<h4 id="_description_5"><a class="anchor" href="#_description_5"></a>==  Description</h4>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>JSON Web Token (JWT) is an open standard (RFC 7519) that defines a compact and self-contained way for securely transmitting information between parties as a JSON object. This information can be verified and trusted because it is digitally signed. JWTs can be signed using a secret (with the` HMAC` algorithm) or a public/private key pair using <code>RSA</code> or <code>ECDSA</code>.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; What is JSON Web Token?<br>
<cite>https://jwt.io/introduction/</cite>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>devon4Net component to manage  JWT standard to provide security to .Net API applications.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_configuration_7"><a class="anchor" href="#_configuration_7"></a>==  Configuration</h4>
<div class="ulist">
<ul>
<li>
<p>Install package on your solution:</p>
<div class="literalblock">
<div class="content">
<pre>PM&gt; devon4Net.Infrastructure.JWT</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_default_configuration_values_3"><a class="anchor" href="#_default_configuration_values_3"></a>==  Default configuration values</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>"JWT": {
    "Audience": "devon4Net",
    "Issuer": "devon4Net",
    "TokenExpirationTime": 60,
    "ValidateIssuerSigningKey": true,
    "ValidateLifetime": true,
    "ClockSkew": 5,
    "Security": {
      "SecretKeyLengthAlgorithm": "",
      "SecretKeyEncryptionAlgorithm": "",
      "SecretKey": "",
      "Certificate": "",
      "CertificatePassword": "",
      "CertificateEncryptionAlgorithm": ""
    }
  }</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code><em>ClockSkew</em></code> indicates the token expiration time in minutes</p>
</li>
<li>
<p><code><em>Certificate</em></code> you can specify the name of your certificate (if it is on the same path) or the full path of the certificate. If the certificate does not exists an exception will be raised.</p>
</li>
<li>
<p><code><em>SecretKeyLengthAlgorithm</em></code>, <code><em>SecretKeyEncryptionAlgorithm</em></code> and <code><em>CertificateEncryptionAlgorithm</em></code> supported algorithms are:</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>|== == == == == == == == == == == =
|<strong>Algorithm</strong>|<strong>Description</strong>
|<code>Aes128Encryption</code>|"http://www.w3.org/2001/04/xmlenc#aes128-cbc"
|<code>Aes192Encryption</code>|"http://www.w3.org/2001/04/xmlenc#aes192-cbc"
|<code>Aes256Encryption</code>|"http://www.w3.org/2001/04/xmlenc#aes256-cbc"
|<code>DesEncryption</code>|"http://www.w3.org/2001/04/xmlenc#des-cbc"
|Aes128KeyWrap|"http://www.w3.org/2001/04/xmlenc#kw-aes128"
|Aes192KeyWrap|"http://www.w3.org/2001/04/xmlenc#kw-aes192"
|Aes256KeyWrap|"http://www.w3.org/2001/04/xmlenc#kw-aes256"
|RsaV15KeyWrap|"http://www.w3.org/2001/04/xmlenc#rsa-1_5"
|<code>Ripemd160Digest</code>|"http://www.w3.org/2001/04/xmlenc#ripemd160"
|RsaOaepKeyWrap|"http://www.w3.org/2001/04/xmlenc#rsa-oaep"
|Aes128KW|"A128KW"
|Aes256KW|"A256KW"
|RsaPKCS1|"RSA1_5"
|RsaOAEP|"RSA-OAEP"
|<code>ExclusiveC14n</code>|"http://www.w3.org/2001/10/xml-exc-c14n#"
|ExclusiveC14nWithComments|"http://www.w3.org/2001/10/xml-exc-c14n#WithComments"
|<code>EnvelopedSignature</code>|"http://www.w3.org/2000/09/xmldsig#enveloped-signature"
|<code>Sha256Digest</code>|"http://www.w3.org/2001/04/xmlenc#sha256"
|<code>Sha384Digest</code>|"http://www.w3.org/2001/04/xmldsig-more#sha384"
|<code>Sha512Digest</code>|"http://www.w3.org/2001/04/xmlenc#sha512"
|Sha256|"SHA256"
|Sha384|"SHA384"
|Sha512|"SHA512"
|EcdsaSha256Signature|"http://www.w3.org/2001/04/xmldsig-more#ecdsa-sha256"
|EcdsaSha384Signature|"http://www.w3.org/2001/04/xmldsig-more#ecdsa-sha384"
|EcdsaSha512Signature|"http://www.w3.org/2001/04/xmldsig-more#ecdsa-sha512"
|HmacSha256Signature|"http://www.w3.org/2001/04/xmldsig-more#hmac-sha256"
|HmacSha384Signature|"http://www.w3.org/2001/04/xmldsig-more#hmac-sha384"
|HmacSha512Signature|"http://www.w3.org/2001/04/xmldsig-more#hmac-sha512"
|RsaSha256Signature|"http://www.w3.org/2001/04/xmldsig-more#rsa-sha256"
|RsaSha384Signature|"http://www.w3.org/2001/04/xmldsig-more#rsa-sha384"
|RsaSha512Signature|"http://www.w3.org/2001/04/xmldsig-more#rsa-sha512"
|RsaSsaPssSha256Signature|"http://www.w3.org/2007/05/xmldsig-more#sha256-rsa-MGF1"
|RsaSsaPssSha384Signature|"http://www.w3.org/2007/05/xmldsig-more#sha384-rsa-MGF1"
|RsaSsaPssSha512Signature|"http://www.w3.org/2007/05/xmldsig-more#sha512-rsa-MGF1"
|<code>EcdsaSha256</code>|"ES256"
|<code>EcdsaSha384</code>|"ES384"
|<code>EcdsaSha512</code>|"ES512"
|<code>HmacSha256</code>|"HS256"
|<code>HmacSha384</code>|"HS384"
|<code>HmacSha512</code>|"HS512"
|None|"none"
|<code>RsaSha256</code>|"RS256"
|<code>RsaSha384</code>|"RS384"
|<code>RsaSha512</code>|"RS512"
|RsaSsaPssSha256|"PS256"
|RsaSsaPssSha384|"PS384"
|RsaSsaPssSha512|"PS512"
|Aes128CbcHmacSha256|"A128CBC-HS256"
|Aes192CbcHmacSha384|"A192CBC-HS384"
|Aes256CbcHmacSha512|"A256CBC-HS512"
|== == == == == == == == == == == =</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Please check <a href="https://github.com/AzureAD/azure-activedirectory-identitymodel-extensions-for-dotnet/wiki/Supported-Algorithms">Microsoft documentation</a> to get the lastest updates on supported encryption algorithms
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Add this line of code  (only if you use this component stand alone):</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>services.AddBusinessCommonJwtPolicy();</code></pre>
</div>
</div>
<div class="paragraph">
<p>On</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Startup.cs</pre>
</div>
</div>
<div class="paragraph">
<p>or on:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>devon4Net.Application.Configuration.Startup/JwtApplicationConfiguration/ConfigureJwtPolicy method.</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Inside the <code><em>AddBusinessCommonJwtPolicy</em></code> method you can add your  JWT Policy like in My Thai Star application sample:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#"> services.ConfigureJwtAddPolicy("MTSWaiterPolicy", "role", "waiter");</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_notes_2"><a class="anchor" href="#_notes_2"></a>==  Notes</h4>
<div class="ulist">
<ul>
<li>
<p>The certificate will be used to generate the key to encrypt the json web token.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_devon4net_infrastructure_middleware"><a class="anchor" href="#_devon4net_infrastructure_middleware"></a>devon4Net.Infrastructure.Middleware</h4>

</div>
<div class="sect3">
<h4 id="_description_6"><a class="anchor" href="#_description_6"></a>==  Description</h4>
<div class="ulist">
<ul>
<li>
<p>devon4Net support for middleware classes.</p>
</li>
<li>
<p>In ASP.NET Core, middleware classes can handle an HTTP request or response. Middleware can either:</p>
<div class="ulist">
<ul>
<li>
<p>Handle an incoming HTTP request by generating an HTTP response.</p>
</li>
<li>
<p>Process an incoming HTTP request, modify it, and pass it on to another piece of middleware.</p>
</li>
<li>
<p>Process an outgoing HTTP response, modify it, and pass it on to either another piece of middleware, or the ASP.NET Core web server.</p>
</li>
</ul>
</div>
</li>
<li>
<p>devon4Net supports the following automatic response headers:</p>
<div class="ulist">
<ul>
<li>
<p><code>AccessControlExposeHeader</code></p>
</li>
<li>
<p><code>StrictTransportSecurityHeader</code></p>
</li>
<li>
<p><code>XFrameOptionsHeader</code></p>
</li>
<li>
<p><code>XssProtectionHeader</code></p>
</li>
<li>
<p><code>XContentTypeOptionsHeader</code></p>
</li>
<li>
<p><code>ContentSecurityPolicyHeader</code></p>
</li>
<li>
<p><code>PermittedCrossDomainPoliciesHeader</code></p>
</li>
<li>
<p><code>ReferrerPolicyHeader:toc: macro</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_configuration_8"><a class="anchor" href="#_configuration_8"></a>==  Configuration</h4>
<div class="ulist">
<ul>
<li>
<p>Install package on your solution:</p>
<div class="literalblock">
<div class="content">
<pre>PM&gt; Install-Package devon4Net.Infrastructure.Middleware</pre>
</div>
</div>
</li>
<li>
<p>You can configure your Middleware configuration on <em>appsettings.{environment}.json</em>:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>"Middleware": {
    "Headers": {
      "AccessControlExposeHeader": "Authorization",
      "StrictTransportSecurityHeader": "",
      "XFrameOptionsHeader": "DENY",
      "XssProtectionHeader": "1;mode=block",
      "XContentTypeOptionsHeader": "nosniff",
      "ContentSecurityPolicyHeader": "",
      "PermittedCrossDomainPoliciesHeader": "",
      "ReferrerPolicyHeader": ""
    }
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>On the above sample, the server application will add to response header the <code>AccessControlExposeHeader</code>, XFrameOptionsHeader, XssProtectionHeader and XContentTypeOptionsHeader headers.</p>
</li>
<li>
<p>If the header response type does not have a value, it will not be added to the response headers.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_devon4net_infrastructure_swagger"><a class="anchor" href="#_devon4net_infrastructure_swagger"></a>devon4Net.Infrastructure.Swagger</h4>

</div>
<div class="sect3">
<h4 id="_description_7"><a class="anchor" href="#_description_7"></a>==  Description</h4>
<div class="ulist">
<ul>
<li>
<p>devon4net Swagger abstraction to provide full externalized easy configuration.</p>
</li>
<li>
<p>Swagger offers the easiest to use tools to take full advantage of all the capabilities of the OpenAPI Specification (OAS).</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_configuration_9"><a class="anchor" href="#_configuration_9"></a>==  Configuration</h4>
<div class="ulist">
<ul>
<li>
<p>Install package on your solution:</p>
<div class="literalblock">
<div class="content">
<pre>PM&gt; devon4Net.Infrastructure.Swagger</pre>
</div>
</div>
</li>
<li>
<p>You can configure your Swagger configuration on <em>appsettings.{environment}.json</em>:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>"Swagger": {
    "Version": "v1",
    "Title": "devon4net API",
    "Description": "devon4net API Contract",
    "Terms": "https://www.devonfw.com/terms-of-use/",
    "Contact": {
      "Name": "devonfw",
      "Email": "sample@mail.com",
      "Url": "https://www.devonfw.com"
    },
    "License": {
      "Name": "devonfw - Terms of Use",
      "Url": "https://www.devonfw.com/terms-of-use/"
    },
    "Endpoint": {
      "Name": "V1 Docs",
      "Url": "/swagger/v1/swagger.json",
      "UrlUi": "swagger",
      "RouteTemplate": "swagger/v1/{documentName}/swagger.json"
    }
  }</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Add this line of code (only if you use this component stand alone):</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#">services.ConfigureSwaggerService();</code></pre>
</div>
</div>
<div class="paragraph">
<p>On</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Startup.cs</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Also add this line of code  (only if you use this component stand alone):</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#">app.ConfigureSwaggerApplication();</code></pre>
</div>
</div>
<div class="paragraph">
<p>On</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Startup.cs/Configure(IApplicationBuilder app, IHostingEnvironment env)</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Ensure your API actions and non-route parameters are decorated with explicit "Http" and "From" bindings.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_notes_3"><a class="anchor" href="#_notes_3"></a>==  Notes</h4>
<div class="ulist">
<ul>
<li>
<p>To access to swagger UI launch your API project and type in your html browser the url <em><a href="http://localhost:yourPort/swagger" class="bare">http://localhost:yourPort/swagger</a></em>.</p>
</li>
<li>
<p>In order to generate the documentation annotate your actions with summary, remarks and response tags:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>/// &lt;summary&gt;
/// Method to make a reservation with potential guests. The method returns the reservation token with the format: {(CB_|GB_)}{now.Year}{now.Month:00}{now.Day:00}{_}{MD5({Host/Guest-email}{now.Year}{now.Month:00}{now.Day:00}{now.Hour:00}{now.Minute:00}{now.Second:00})}
/// &lt;/summary&gt;
/// &lt;param name="bookingDto"&gt;&lt;/param&gt;
/// &lt;response code="201"&gt;Ok.&lt;/response&gt;
/// &lt;response code="400"&gt;Bad request. Parser data error.&lt;/response&gt;
/// &lt;response code="401"&gt;Unauthorized. Authentication fail.&lt;/response&gt;
/// &lt;response code="403"&gt;Forbidden. Authorization error.&lt;/response&gt;
/// &lt;response code="500"&gt;Internal Server Error. The search process ended with error.&lt;/response&gt;
[HttpPost]
[HttpOptions]
[Route("/mythaistar/services/rest/bookingmanagement/v1/booking")]
[AllowAnonymous]
[EnableCors("CorsPolicy")]
public async Task&lt;IActionResult&gt; Booking([FromBody]BookingDto bookingDto)
{
    try
    {

    ...</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Ensure that your project has the <em>generateXMLdocumentationfile</em> check active on build menu:</p>
</li>
</ul>
</div>
<div id="img-t-architecture" class="imageblock">
<div class="content">
<a class="image" href="images/swaggerDocXMLCheck.png"><img src="../_images/images/swaggerDocXMLCheck.png" alt="Generate documentation XML check" width="*"></a>
</div>
<div class="title">Figure 9. Swagger documentation</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Ensure that your XML files has the attribute copy always to true:</p>
</li>
</ul>
</div>
<div id="img-t-architecture" class="imageblock">
<div class="content">
<a class="image" href="images/swaggerDoc.png"><img src="../_images/images/swaggerDoc.png" alt="Generate documentation XML check" width="*"></a>
</div>
<div class="title">Figure 10. Swagger documentation</div>
</div>
</div>
<div class="sect3">
<h4 id="_devon4net_infrastructure_test"><a class="anchor" href="#_devon4net_infrastructure_test"></a>devon4Net.Infrastructure.Test</h4>

</div>
<div class="sect3">
<h4 id="_description_8"><a class="anchor" href="#_description_8"></a>==  Description</h4>
<div class="paragraph">
<p>devon4Net Base classes to create unit tests and integration tests with Moq and <code>xUnit</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_configuration_10"><a class="anchor" href="#_configuration_10"></a>==  Configuration</h4>
<div class="ulist">
<ul>
<li>
<p>Load the template:
&gt; dotnet new -i devon4Net.Test.Template
&gt; dotnet new devon4NetTest</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_notes_4"><a class="anchor" href="#_notes_4"></a>==  Notes</h4>
<div class="ulist">
<ul>
<li>
<p>At this point you can find this classes:</p>
<div class="ulist">
<ul>
<li>
<p>BaseManagementTest</p>
</li>
<li>
<p>DatabaseManagementTest&lt;T&gt; (Where <code>T</code> is a <em>devon4NetBaseContext</em> class)</p>
</li>
</ul>
</div>
</li>
<li>
<p>For unit testing, inherit a class from <em>BaseManagementTest</em>.</p>
</li>
<li>
<p>For integration tests, inherit a class from <em>DatabaseManagementTest</em>.</p>
</li>
<li>
<p>The recommended databases in integration test are <em>in memory database</em> or <em>SQlite database</em>.</p>
</li>
<li>
<p>Please check <em>My thai Star</em> test project.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_deperecated_packages"><a class="anchor" href="#_deperecated_packages"></a>Deperecated packages</h4>

</div>
<div class="sect3">
<h4 id="_devon4net_domain_context"><a class="anchor" href="#_devon4net_domain_context"></a>devon4Net.Domain.Context</h4>

</div>
<div class="sect3">
<h4 id="_description_9"><a class="anchor" href="#_description_9"></a>==  Description</h4>
<div class="paragraph">
<p>devon4Net.Domain.Context contains the extended class devon4NetBaseContext in order to make easier the process of having a model context configured against different database engines. This configuration allows an easier testing configuration against local and in memory databases.</p>
</div>
</div>
<div class="sect3">
<h4 id="_configuration_11"><a class="anchor" href="#_configuration_11"></a>==  Configuration</h4>
<div class="ulist">
<ul>
<li>
<p>Install package on your solution:</p>
<div class="literalblock">
<div class="content">
<pre>PM&gt; Install-Package devon4Net.Domain.Context</pre>
</div>
</div>
</li>
<li>
<p>Add to <em>appsettings.{environment}.json</em> file your database connections:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>"ConnectionStrings":
{
"DefaultConnection":
"Server=localhost;Database=MyThaiStar;User Id=sa;Password=sa;MultipleActiveResultSets=True;",

"AuthConnection":
"Server=(localdb)\\mssqllocaldb;Database=aspnet-DualAuthCore-5E206A0B-D4DA-4E71-92D3-87FD6B120C5E;Trusted_Connection=True;MultipleActiveResultSets=true",

"SqliteConnection": "Data Source=c:\\tmp\\membership.db;"
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>On Startup.cs :</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#">void ConfigureServices(IServiceCollection services)</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Add your database connections defined on previous point:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#">services.ConfigureDataBase(
new Dictionary&lt;string, string&gt; {
{ConfigurationConst.DefaultConnection, Configuration.GetConnectionString(ConfigurationConst.DefaultConnection) }});</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>On devon4Net.Application.Configuration.Startup/DataBaseConfiguration/ConfigureDataBase configure your connections.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_devon4net_infrastructure_applicationuser"><a class="anchor" href="#_devon4net_infrastructure_applicationuser"></a>devon4Net.Infrastructure.ApplicationUser</h4>

</div>
<div class="sect3">
<h4 id="_description_10"><a class="anchor" href="#_description_10"></a>==  Description</h4>
<div class="paragraph">
<p>devon4Net Application user classes to implement basic Microsoft&#8217;s basic authentication in order to be used on authentication methodologies such Jason Web Token (JWT).</p>
</div>
</div>
<div class="sect3">
<h4 id="_configuration_12"><a class="anchor" href="#_configuration_12"></a>==  Configuration</h4>
<div class="ulist">
<ul>
<li>
<p>Install package on your solution:</p>
<div class="literalblock">
<div class="content">
<pre>PM&gt; devon4Net.Infrastructure.ApplicationUser</pre>
</div>
</div>
</li>
<li>
<p>Add the database connection string for user management on <em>appsettings.{environment}.json</em>:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>"ConnectionStrings":
{
"AuthConnection":
"Server=(localdb)\\mssqllocaldb;Database=aspnet-DualAuthCore-5E206A0B-D4DA-4E71-92D3-87FD6B120C5E;Trusted_Connection=True;MultipleActiveResultSets=true"
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Add the following line of code</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>services.AddApplicationUserDependencyInjection();</code></pre>
</div>
</div>
<div class="paragraph">
<p>On</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Startup.cs/ConfigureServices(IServiceCollection services)</pre>
</div>
</div>
<div class="paragraph">
<p>or on:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>devon4Net.Application.Configuration.Startup/DependencyInjectionConfiguration/ConfigureDependencyInjectionService method.</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Add the data seeder on Configure method on start.cs class:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#">public void Configure(IApplicationBuilder app, IHostingEnvironment env, DataSeeder seeder)
{
    ...

    app.UseAuthentication();
    seeder.SeedAsync().Wait();

    ...
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_notes_5"><a class="anchor" href="#_notes_5"></a>==  Notes</h4>
<div class="ulist">
<ul>
<li>
<p>You can use the following methods to set up the database configuration:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>public static void AddApplicationUserDbContextInMemoryService(this IServiceCollection services)

public static void AddApplicationUserDbContextSQliteService(this IServiceCollection services, string connectionString)

public static void AddApplicationUserDbContextSQlServerService(this IServiceCollection services, string connectionString)</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The method <code><em>AddApplicationUserDbContextInMemoryService</em></code> uses the <em>AuthContext</em> connection string name to set up the database.</p>
</li>
<li>
<p>This component is used with the components <em>devon4Net.Infrastructure.JWT</em> and <em>devon4Net.Infrastructure.JWT.MVC</em>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_devon4net_infrastructure_communication"><a class="anchor" href="#_devon4net_infrastructure_communication"></a>devon4Net.Infrastructure.Communication</h4>

</div>
<div class="sect3">
<h4 id="_description_11"><a class="anchor" href="#_description_11"></a>==  Description</h4>
<div class="paragraph">
<p>Basic client classes to  invoke` GET`/POST methods asynchronously. This component has the minimal classes to send basic data. For more complex operations please use <em>ASP4Net.Infrastructure.Extensions</em>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_configuration_13"><a class="anchor" href="#_configuration_13"></a>==  Configuration</h4>
<div class="ulist">
<ul>
<li>
<p>Install package on your solution:</p>
<div class="literalblock">
<div class="content">
<pre>PM&gt; devon4Net.Infrastructure.Communication</pre>
</div>
</div>
</li>
<li>
<p>Create an instance of <em>RestManagementService</em> class.</p>
</li>
<li>
<p>Use next methods to use GET/POST basic options:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>public Task&lt;string&gt; CallGetMethod(string url);
public Task&lt;Stream&gt; CallGetMethodAsStream(string url);
public Task&lt;string&gt; CallPostMethod&lt;T&gt;(string url, T dataToSend);
public Task&lt;string&gt; CallPutMethod&lt;T&gt;(string url, T dataToSend);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_notes_6"><a class="anchor" href="#_notes_6"></a>==  Notes</h4>
<div class="ulist">
<ul>
<li>
<p>Example:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#">private async Task RestManagementServiceSample(EmailDto dataToSend)
{
    var url = Configuration["EmailServiceUrl"];
    var restManagementService = new RestManagementService();
    await restManagementService.CallPostMethod(url, dataToSend);
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_devon4net_infrastructure_jwt_mvc"><a class="anchor" href="#_devon4net_infrastructure_jwt_mvc"></a>devon4Net.Infrastructure.JWT.MVC</h4>

</div>
<div class="sect3">
<h4 id="_description_12"><a class="anchor" href="#_description_12"></a>==  Description</h4>
<div class="ulist">
<ul>
<li>
<p>devon4Net Extended controller to interact with  JWT features</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_configuration_14"><a class="anchor" href="#_configuration_14"></a>==  Configuration</h4>
<div class="ulist">
<ul>
<li>
<p>Extend your _ Microsoft.AspNetCore.Mvc.Controller_ class with <em>devon4NetJWTController</em> class:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#">public class LoginController : devon4NetJWTController
{
    private readonly ILoginService _loginService;

    public LoginController(ILoginService loginService,  SignInManager&lt;ApplicationUser&gt;  signInManager, UserManager&lt;ApplicationUser&gt; userManager, ILogger&lt;LoginController&gt; logger, IMapper mapper) : base(logger,mapper)
    {
        _loginService = loginService;
    }

    ....</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_notes_7"><a class="anchor" href="#_notes_7"></a>==  Notes</h4>
<div class="ulist">
<ul>
<li>
<p>In order to generate a  JWT, you should implement the  JWT generation on user login. For example, in My Thai Star is created as follows:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>public async Task&lt;IActionResult&gt; Login([FromBody]LoginDto loginDto)
{
    try
    {
        if (loginDto ==  null) return Ok();
        var logged = await _loginService.LoginAsync(loginDto.UserName, loginDto.Password);

        if (logged)
        {
            var user = await _loginService.GetUserByUserNameAsync(loginDto.UserName);

            var encodedJwt = new JwtClientToken().CreateClientToken(_loginService.GetUserClaimsAsync(user));

            Response.Headers.Add("Access-Control-Expose-Headers", "Authorization");

            Response.Headers.Add("Authorization", $"{JwtBearerDefaults.AuthenticationScheme} {encodedJwt}");

            return Ok(encodedJwt);
        }
        else
        {
            Response.Headers.Clear();
            return StatusCode((int)HttpStatusCode.Unauthorized, "Login Error");
        }

    }
    catch (Exception ex)
    {
        return StatusCode((int)HttpStatusCode.InternalServerError, $"{ex.Message} : {ex.InnerException}");
    }
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>In My Thai Star the  JWT will contain the user information such id, roles&#8230;&#8203;</p>
</li>
<li>
<p>Once you extend your controller with <em>devon4NetJWTController</em> you will have available these methods to simplify user management:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#">    public interface Idevon4NetJWTController
    {
        // Gets the current user
        JwtSecurityToken GetCurrentUser();

        // Gets an specific assigned claim of current user
        Claim GetUserClaim(string claimName, JwtSecurityToken jwtUser = null);

        // Gets all the assigned claims of current user
        IEnumerable&lt;Claim&gt; GetUserClaims(JwtSecurityToken jwtUser = null);
    }</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_devon4net_infrastructure_mvc"><a class="anchor" href="#_devon4net_infrastructure_mvc"></a>devon4Net.Infrastructure.MVC</h4>

</div>
<div class="sect3">
<h4 id="_description_13"><a class="anchor" href="#_description_13"></a>==  Description</h4>
<div class="paragraph">
<p>Common classes to extend controller functionality on API. Also provides support for paged results in devon4Net applications and automapper injected class.</p>
</div>
</div>
<div class="sect3">
<h4 id="_configuration_15"><a class="anchor" href="#_configuration_15"></a>==  Configuration</h4>
<div class="ulist">
<ul>
<li>
<p>Install package on your solution:</p>
<div class="literalblock">
<div class="content">
<pre>PM&gt; devon4Net.Infrastructure.MVC</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_notes_8"><a class="anchor" href="#_notes_8"></a>==  Notes</h4>
<div class="ulist">
<ul>
<li>
<p>The generic class <em>ResultObjectDto&lt;T&gt;</em> provides a typed result object with pagination.</p>
</li>
<li>
<p>The extended class provides the following methods:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#">        ResultObjectDto&lt;T&gt; GenerateResultDto&lt;T&gt;(int? page, int? size, int? total);
        ResultObjectDto&lt;T&gt; GenerateResultDto&lt;T&gt;(List&lt;T&gt; result, int? page = null, int? size = null);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><em>GenerateResultDto</em> provides typed <em>ResultObjectDto</em> object or a list of typed <em>ResultObjectDto</em> object. The aim of this methods is to provide a clean management for result objects and not repeating code through the different controller classes.</p>
</li>
<li>
<p>The following sample from <em>My Thai Star</em> shows how to use it:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#">public async Task&lt;IActionResult&gt; Search([FromBody] FilterDtoSearchObject filterDto)
{
    if (filterDto ==  null) filterDto = new FilterDtoSearchObject();

    try
    {
        var dishList = await _dishService.GetDishListFromFilter(false, filterDto.GetMaxPrice(), filterDto.GetMinLikes(), filterDto.GetSearchBy(),filterDto.GetCategories(), -1);


        return new OkObjectResult(GenerateResultDto(dishList).ToJson());
    }
    catch (Exception ex)
    {
        return StatusCode((int)HttpStatusCode.InternalServerError, $"{ex.Message} : {ex.InnerException}");
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_devon4net_infrastructure_aop"><a class="anchor" href="#_devon4net_infrastructure_aop"></a>devon4Net.Infrastructure.AOP</h4>

</div>
<div class="sect3">
<h4 id="_description_14"><a class="anchor" href="#_description_14"></a>==  Description</h4>
<div class="paragraph">
<p>Simple AOP Exception handler for .Net Controller classes integrated with Serilog.</p>
</div>
</div>
<div class="sect3">
<h4 id="_configuration_16"><a class="anchor" href="#_configuration_16"></a>==  Configuration</h4>
<div class="ulist">
<ul>
<li>
<p>Install package on your solution:</p>
<div class="literalblock">
<div class="content">
<pre>PM&gt; Install-Package devon4Net.Domain.AOP</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Add this line of code on <code>ConfigureServices</code> method on Startup.cs</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>services.AddAopAttributeService();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_notes_9"><a class="anchor" href="#_notes_9"></a>==  Notes</h4>
<div class="paragraph">
<p>Now automatically your exposed API methods exposed on controller classes will be tracked on the methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>OnActionExecuting</p>
</li>
<li>
<p>OnActionExecuted</p>
</li>
<li>
<p>OnResultExecuting</p>
</li>
<li>
<p>OnResultExecuted</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If an exception occurs, a message will be displayed on log with the stack trace.</p>
</div>
</div>
<div class="sect3">
<h4 id="_devon4net_infrastructure_cors"><a class="anchor" href="#_devon4net_infrastructure_cors"></a>devon4Net.Infrastructure.Cors</h4>

</div>
<div class="sect3">
<h4 id="_description_15"><a class="anchor" href="#_description_15"></a>==  Description</h4>
<div class="paragraph">
<p>Enables CORS configuration for devon4Net application. Multiple domains can be configured from configuration. Mandatory to web clients (p.e. Angular) to prevent making AJAX requests to another domain.</p>
</div>
<div class="paragraph">
<p>Cross-Origin Resource Sharing (CORS) is a mechanism that uses additional HTTP headers to tell a browser to let a web application running at one origin (domain) have permission to access selected resources from a server at a different origin. A web application makes a cross-origin HTTP request when it requests a resource that has a different origin (domain, protocol, and port) than its own origin.</p>
</div>
<div class="paragraph">
<p>Please refer to <a href="https://docs.microsoft.com/en-us/aspnet/core/security/cors?view=aspnetcore-2.1">this link</a> to get more information about CORS and .Net core.</p>
</div>
</div>
<div class="sect3">
<h4 id="_configuration_17"><a class="anchor" href="#_configuration_17"></a>==  Configuration</h4>
<div class="ulist">
<ul>
<li>
<p>Install package on your solution:</p>
<div class="literalblock">
<div class="content">
<pre>PM&gt; devon4Net.Infrastructure.Cors</pre>
</div>
</div>
</li>
<li>
<p>You can configure your Cors configuration on <em>appsettings.{environment}.json</em>:</p>
<div class="literalblock">
<div class="content">
<pre>`CorsPolicy`: indicates the name of the policy. You can use this name to add security headers on your API exposed methods.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Origins: The allowed domains</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Headers: The allowed headers such accept,content-type,origin,x-custom-header</pre>
</div>
</div>
</li>
<li>
<p>If you specify the cors configuration as empty array, a default cors-policy will be used with all origins enabled:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">  "Cors": []</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>On the other hand, you can specify different Cors policies in your solution as follows:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>"Cors": []
[
  {
    "CorsPolicy": "CorsPolicy1",
    "Origins": "http:example.com,http:www.contoso.com",
    "Headers": "accept,content-type,origin,x-custom-header",
    "Methods": "GET,POST,HEAD",
    "AllowCredentials": true
  },
  {
    "CorsPolicy": "CorsPolicy2",
    "Origins": "http:example.com,http:www.contoso.com",
    "Headers": "accept,content-type,origin,x-custom-header",
    "Methods": "GET,POST,HEAD",
    "AllowCredentials": true
  }
]</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_notes_10"><a class="anchor" href="#_notes_10"></a>==  Notes</h4>
<div class="ulist">
<ul>
<li>
<p>To use CORS in your API methods, use the next notation:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>[EnableCors("YourCorsPolicy")]
public IActionResult Index() {
    return View();
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>if you want to disable the CORS check use the following annotation:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#">[DisableCors]
public IActionResult Index() {
    return View();
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_required_software_2"><a class="anchor" href="#_required_software_2"></a>Required software</h4>
<div class="paragraph">
<p><a href="https://code.visualstudio.com/">Visual Studio Code</a></p>
</div>
<div class="paragraph">
<p><a href="https://marketplace.visualstudio.com/items?itemName=ms-vscode.csharp">C# Extension for VS Code</a></p>
</div>
<div class="paragraph">
<p><a href="https://www.microsoft.com/net/core">.Net Core SDK</a></p>
</div>
<div class="paragraph">
<p><a href="https://docs.microsoft.com/en-us/aspnet/core/security/cors?view=aspnetcore-2.1">CORS in .Net Core</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_templates_2"><a class="anchor" href="#_templates_2"></a>Templates</h2>
<div class="sectionbody">
<!-- toc disabled -->
<div class="paragraph">
<p>==Templates</p>
</div>
<div class="sect3">
<h4 id="_overview_4"><a class="anchor" href="#_overview_4"></a>Overview</h4>
<div class="paragraph">
<p>The .Net Core and .Net Framework given templates allows to start coding an application with the following functionality ready to use:</p>
</div>
<div class="paragraph">
<p>Please refer to <a href="userguide.html">User guide</a> in order to start developing.</p>
</div>
</div>
<div class="sect3">
<h4 id="_net_core_3_0"><a class="anchor" href="#_net_core_3_0"></a>Net Core 3.0</h4>
<div class="paragraph">
<p>The <em>.Net Core 3.0</em> template allows you to start developing an n-layer server application to provide the latest features. The template can be used in Visual Studio Code and Visual Studio 2019.</p>
</div>
<div class="paragraph">
<p>The application result can be deployed as a console application, microservice or web page.</p>
</div>
<div class="paragraph">
<p>To start developing with devon4Net template, please follow this instructions:</p>
</div>
<div class="sect5">
<h6 id="_using_devon4net_template_2"><a class="anchor" href="#_using_devon4net_template_2"></a>Using devon4Net template</h6>

</div>
<div class="sect5">
<h6 id="_option_1_2"><a class="anchor" href="#_option_1_2"></a>Option 1</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open your favourite terminal (Win/Linux/iOS)</p>
</li>
<li>
<p>Go to future project&#8217;s path</p>
</li>
<li>
<p>Type <em>dotnet new --install Devon4Net.WebAPI.Template</em></p>
</li>
<li>
<p>Type <em>dotnet new Devon4NetAPI</em></p>
</li>
<li>
<p>Go to project&#8217;s path</p>
</li>
<li>
<p>You are ready to start developing with <em>devon4Net</em></p>
</li>
</ol>
</div>
</div>
<div class="sect5">
<h6 id="_option_2_2"><a class="anchor" href="#_option_2_2"></a>Option 2</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a new dotnet API project from scratch</p>
</li>
<li>
<p>Add the NuGet package reference to your project</p>
</li>
<li>
<p>Type <em>dotnet new --install Devon4Net.WebAPI.Template</em></p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_net_core_2_1_x"><a class="anchor" href="#_net_core_2_1_x"></a>Net Core 2.1.x</h4>
<div class="paragraph">
<p>The <em>.Net Core 2.1.x</em> template allows you to start developing an n-layer server application to provide the latest features. The template can be used in Visual Studio Code and Visual Studio 2017.</p>
</div>
<div class="paragraph">
<p>The application result can be deployed as a console application, microservice or web page.</p>
</div>
<div class="paragraph">
<p>To start developing with devon4Net template, please follow this instructions:</p>
</div>
<div class="sect5">
<h6 id="_using_devon4net_template_3"><a class="anchor" href="#_using_devon4net_template_3"></a>Using devon4Net template</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open your favourite terminal (Win/Linux/iOS)</p>
</li>
<li>
<p>Go to future project&#8217;s path</p>
</li>
<li>
<p>Type <em>dotnet new --install Devon4Net.WebAPI.Template::1.0.8</em></p>
</li>
<li>
<p>Type <em>dotnet new Devon4NetAPI</em></p>
</li>
<li>
<p>Go to project&#8217;s path</p>
</li>
<li>
<p>You are ready to start developing with <em>devon4Net</em></p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For the latest updates on references packages, please get the sources from <a href="https://github.com/devonfw/devon4net">Github</a>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_links"><a class="anchor" href="#_links"></a>Links</h4>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-= fa-floppy-o"></i></span>  <a href="https://github.com/devonfw/devon4net/tree/develop/source/Templates">.Net templates</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_samples_2"><a class="anchor" href="#_samples_2"></a>Samples</h2>
<div class="sectionbody">
<!-- toc disabled -->
<div class="sect3">
<h4 id="_samples_3"><a class="anchor" href="#_samples_3"></a>Samples</h4>

</div>
<div class="sect3">
<h4 id="_my_thai_star_restaurant"><a class="anchor" href="#_my_thai_star_restaurant"></a>My Thai Star Restaurant</h4>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-= fa-floppy-o"></i></span>  <a href="resources/samples/mts/MyThaiStar.zip">My Thai Star (.Net Core Server + Angular client)</a></p>
</div>
<div class="videoblock">
<div class="content">
<video src="../_images/videos/mts_startup.mp4#t=0" width="640" autoplay controls>
Your browser does not support the video tag.
</video>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_angular_requirements"><a class="anchor" href="#_angular_requirements"></a>Angular requirements</h4>
<div class="ulist">
<ul>
<li>
<p><a href="https://nodejs.org/es/download/">Node</a></p>
</li>
<li>
<p><a href="https://cli.angular.io/">Angular CLI</a></p>
</li>
<li>
<p><a href="https://yarnpkg.com/lang/en/docs/install/">Yarn</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_angular_client"><a class="anchor" href="#_angular_client"></a>Angular client</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Install Node.js LTS version</p>
</li>
<li>
<p>Install Angular CLI from command line:</p>
<div class="ulist">
<ul>
<li>
<p>npm install -g @angular/cli</p>
</li>
</ul>
</div>
</li>
<li>
<p>Install Yarn</p>
</li>
<li>
<p>Go to Angular client from command line</p>
</li>
<li>
<p>Execute : <em>yarn install</em></p>
</li>
<li>
<p>Launch the app from command line: <em>ng serve</em> and check <em><a href="http://localhost:4200" class="bare">http://localhost:4200</a></em></p>
</li>
<li>
<p>You are ready</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_net_core_server"><a class="anchor" href="#_net_core_server"></a>.Net Core server</h4>

</div>
<div class="sect3">
<h4 id="_basic_architecture_details"><a class="anchor" href="#_basic_architecture_details"></a>==  Basic architecture details</h4>
<div class="paragraph">
<p>Following the devonfw conventions the .Net Core 2.0 My Thai Star backend is going to be developed dividing the application in <em>Components</em> and using a n-layer architecture.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/project_modules.png"><img src="../_images/images/project_modules.png" alt="project modules"></a>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_components"><a class="anchor" href="#_components"></a>==  Components</h4>
<div class="paragraph">
<p>The application is going to be divided in different components to encapsulate the different domains of the application functionalities.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/mtsn_components.png"><img src="../_images/images/mtsn_components.png" alt="mtsn components"></a>
</div>
</div>
<div class="paragraph">
<p>As <em>main components</em> we will find:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>_BookingService</code>: Manages the bookings part of the application. With this component the users (anonymous/logged in) can create new bookings or cancel an existing booking. The users with waiter role can see all scheduled bookings.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>-<code><em>OrderService</em></code>: This component handles the process to order dishes (related to bookings). A user (as a host or as a guest) can create orders (that contain dishes) or cancel an existing one. The users with waiter role can see all ordered orders.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code><em>DishService</em></code>: This component groups the logic related to the menu (dishes) view. Its main feature is to provide the client with the data of the available dishes but also can be used by other components (Ordermanagement) as a data provider in some processes.</p>
</li>
<li>
<p><code><em>UserService</em></code>: Takes care of the User Profile management, allowing to create and update the data profiles.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As <em>common components</em> (that don&#8217;t exactly represent an application&#8217;s area but provide functionalities that can be used by the <em>main components</em>):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Mailservice</em>: with this service we will provide the functionality for sending email notifications. This is a shared service between different app components such as <em>bookingmanagement</em> or <em>ordercomponent</em>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Other components:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Security (will manage the access to the <em>private</em> part of the application using a <a href="https://jwt.io/">jwt</a> implementation).</p>
</li>
<li>
<p>Twitter integration: planned as a <em>Microservice</em> will provide the twitter integration needed for some specific functionalities of the application.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_layers"><a class="anchor" href="#_layers"></a>Layers</h4>

</div>
<div class="sect3">
<h4 id="_introduction_5"><a class="anchor" href="#_introduction_5"></a>==  Introduction</h4>
<div class="paragraph">
<p>The .Net Core backend for My Thai Star application is going to be based on:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>devon4NET</strong> as the .Net Core framework</p>
</li>
<li>
<p><strong>VSCode</strong> as the Development environment</p>
</li>
<li>
<p><strong>TOBAGO</strong> as code generation tool</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_application_layer_2"><a class="anchor" href="#_application_layer_2"></a>==  Application layer</h4>
<div class="paragraph">
<p>This layer will expose the REST api to exchange information with the client applications.</p>
</div>
<div class="paragraph">
<p>The application will expose the services on port 8081 and it can be launched as a self host console application (microservice approach) and as a Web Api application hosted on IIS/IIS Express.</p>
</div>
</div>
<div class="sect3">
<h4 id="_business_layer_2"><a class="anchor" href="#_business_layer_2"></a>==  Business layer</h4>
<div class="paragraph">
<p>This layer will define the controllers which will be used on the application layer to expose the different services. Also, will define the swagger contract making use of summary comments and framework attributes.</p>
</div>
<div class="paragraph">
<p>This layer also includes the object response classes in order to interact with external clients.</p>
</div>
</div>
<div class="sect3">
<h4 id="_service_layer"><a class="anchor" href="#_service_layer"></a>==  Service layer</h4>
<div class="paragraph">
<p>The layer in charge of hosting the business logic of the application. Also orchestrates the object conversion between object response and entity objects defined in <em>Data layer</em>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_data_layer_2"><a class="anchor" href="#_data_layer_2"></a>==  Data layer</h4>
<div class="paragraph">
<p>The layer to communicate with the data base.</p>
</div>
<div class="paragraph">
<p>Data layer makes use of <em>Entity Framework</em>.
The Database context is defined on <code><em>DataAccessLayer</em></code> assembly (<code>ModelContext</code>).</p>
</div>
<div class="paragraph">
<p>This layer makes use of the <em>Repository pattern</em> and <em>Unit of work</em> in order to encapsulate the complexity. Making use of this combined patterns we ensure an organized and easy work model.</p>
</div>
<div class="paragraph">
<p>As in the previous layers, the <em>data access</em> layer will have both <em>interface</em> and <em>implementation</em> tiers. However, in this case, the implementation will be slightly different due to the use of <em>generics</em>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_cross_cutting_concerns_2"><a class="anchor" href="#_cross_cutting_concerns_2"></a>==  Cross-Cutting concerns</h4>
<div class="paragraph">
<p>the layer to make use of transversal components such JWT and mailing.</p>
</div>
</div>
<div class="sect3">
<h4 id="_jwt_basics"><a class="anchor" href="#_jwt_basics"></a>Jwt basics</h4>
<div class="ulist">
<ul>
<li>
<p>A user will provide a username / password combination to our auth server.</p>
</li>
<li>
<p>The auth server will try to identify the user and, if the credentials match, will issue a token.</p>
</li>
<li>
<p>The user will send the token as the <em>Authorization</em> header to access resources on server protected by  JWT Authentication.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/jwt_schema.png"><img src="../_images/images/jwt_schema.png" alt="jwt schema"></a>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_jwt_implementation_details"><a class="anchor" href="#_jwt_implementation_details"></a>Jwt implementation details</h4>
<div class="paragraph">
<p>The <em>Json Web Token</em> pattern will be implemented based on the <a href="https://blogs.msdn.microsoft.com/webdev/2017/04/06/jwt-validation-and-authorization-in-asp-net-core/"><em>jwt on .net core</em></a> framework that is provided by default in the <em>devon4Net</em> projects.</p>
</div>
</div>
<div class="sect3">
<h4 id="_authentication"><a class="anchor" href="#_authentication"></a>Authentication</h4>
<div class="paragraph">
<p>Based on <em>Microsoft</em> approach, we will implement a class to define the security <em>entry point</em> and filters. Also, as <em>My Thai Star</em> is a mainly <em>public</em> application, we will define here the resources that won&#8217;t be secured.</p>
</div>
<div class="paragraph">
<p>On devon4Net.Infrastructure.JWT assembly is defined a subset of <em>Microsoft&#8217;s authorization schema</em> Database. It is started up the first time the application launches.</p>
</div>
<div class="paragraph">
<p>You can read more about _Authorization on:</p>
</div>
<div class="paragraph">
<p><a href="https://docs.microsoft.com/en-us/aspnet/core/security/authorization/">Authorization in ASP.NET Core</a></p>
</div>
<div class="paragraph">
<p><a href="https://docs.microsoft.com/en-us/aspnet/core/security/authorization/claims">Claim based authorization</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_dependency_injection"><a class="anchor" href="#_dependency_injection"></a>Dependency injection</h4>
<div class="paragraph">
<p>As it is explained in the <a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/dependency-injection">Microsoft documentation</a> we are going to implement the <em>dependency injection</em> pattern basing our solution on <em>.Net Core</em>.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/dependency_injection.png"><img src="../_images/images/dependency_injection.png" alt="dependency injection"></a>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Separation of API and implementation: Inside each layer we will separate the elements in different tiers: <em>interface</em> and <em>implementation</em>. The <em>interface</em> tier will store the <em>interface</em> with the methods definition and inside the <em>implementation</em> we will store the class that implements the <em>interface</em>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_layer_communication_method"><a class="anchor" href="#_layer_communication_method"></a>Layer communication method</h4>
<div class="paragraph">
<p>The connection between layers, to access to the functionalities of each one, will be solved using the <em>dependency injection</em>.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/layer_impl.png"><img src="../_images/images/layer_impl.png" alt="layer impl"></a>
</div>
</div>
<div class="paragraph">
<p><strong>Connection <code>BookingService</code> - Logic</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c# hljs" data-lang="c#"> public class BookingService : EntityService&lt;Booking&gt;, IBookingService
    {
        private readonly IBookingRepository _bookingRepository;
        private readonly IRepository&lt;Order&gt; _orderRepository;
        private readonly IRepository&lt;InvitedGuest&gt; _invitedGuestRepository;
        private readonly IOrderLineRepository _orderLineRepository;
        private readonly IUnitOfWork _unitOfWork;

        public BookingService(IUnitOfWork unitOfWork,
            IBookingRepository repository,
            IRepository&lt;Order&gt; orderRepository,
            IRepository&lt;InvitedGuest&gt; invitedGuestRepository,
            IOrderLineRepository orderLineRepository) : base(unitOfWork, repository)
        {
            _unitOfWork = unitOfWork;
            _bookingRepository = repository;
            _orderRepository = orderRepository;
            _invitedGuestRepository = invitedGuestRepository;
            _orderLineRepository = orderLineRepository;
        }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To give service to the defined <em>User Stories</em> we will need to implement the following services:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>provide all available dishes.</p>
</li>
<li>
<p>save a booking.</p>
</li>
<li>
<p>save an order.</p>
</li>
<li>
<p>provide a list of bookings (only for waiters) and allow filtering.</p>
</li>
<li>
<p>provide a list of orders (only for waiters) and allow filtering.</p>
</li>
<li>
<p>login service (see the <em>Security</em> section).</p>
</li>
<li>
<p>provide the <em>current user</em> data (see the <em>Security</em> section)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Following the [naming conventions] proposed for <em>devon4Net</em> applications we will define the following <em>end points</em> for the listed services.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>(POST) <code>/mythaistar/services/rest/dishmanagement/v1/dish/search</code>.</p>
</li>
<li>
<p>(POST) <code>/mythaistar/services/rest/bookingmanagement/v1/booking</code>.</p>
</li>
<li>
<p>(POST) <code>/mythaistar/services/rest/ordermanagement/v1/order</code>.</p>
</li>
<li>
<p>(POST) <code>/mythaistar/services/rest/bookingmanagement/v1/booking/search</code>.</p>
</li>
<li>
<p>(POST) <code>/mythaistar/services/rest/ordermanagement/v1/order/search</code>.</p>
</li>
<li>
<p>(POST) <code>/mythaistar/services/rest/ordermanagement/v1/order/filter</code> (to filter with fields that does not belong to the Order entity).</p>
</li>
<li>
<p>(POST) <code>/mythaistar/login</code>.</p>
</li>
<li>
<p>(GET) <code>/mythaistar/services/rest/security/v1/currentuser/</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can find all the details for the services implementation in the <a href="https://github.com/devonfw/my-thai-star/blob/develop/swagger/mythaistar.yaml">Swagger definition</a> included in the My Thai Star project on Github.</p>
</div>
</div>
<div class="sect3">
<h4 id="_api_exposed"><a class="anchor" href="#_api_exposed"></a>Api Exposed</h4>
<div class="paragraph">
<p>The <em>devon4Net.Business.Controller</em> assembly in the <em>business</em> layer of a <em>component</em> will store the definition of the service by a  <em>interface</em>. In this definition of the service we will set-up the <em>endpoints</em> of the service, the type of data expected and returned, the <em>HTTP</em> method for each endpoint of the service and other configurations if needed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c# hljs" data-lang="c#">        /// &lt;summary&gt;
        /// Method to make a reservation with potential guests. The method returns the reservation token with the format: {(CB_|GB_)}{now.Year}{now.Month:00}{now.Day:00}{_}{MD5({Host/Guest-email}{now.Year}{now.Month:00}{now.Day:00}{now.Hour:00}{now.Minute:00}{now.Second:00})}
        /// &lt;/summary&gt;

        /// &lt;param name="bookingView"&gt;&lt;/param&gt;
        /// &lt;response code="201"&gt;Ok.&lt;/response&gt;
        /// &lt;response code="400"&gt;Bad request. Parser data error.&lt;/response&gt;
        /// &lt;response code="401"&gt;Unauthorized. Authentication fail.&lt;/response&gt;
        /// &lt;response code="403"&gt;Forbidden. Authorization error.&lt;/response&gt;
        /// &lt;response code="500"&gt;Internal Server Error. The search process ended with error.&lt;/response&gt;
        [HttpPost]
        [HttpOptions]
        [Route("/mythaistar/services/rest/bookingmanagement/v1/booking")]
        [AllowAnonymous]
        [EnableCors("CorsPolicy")]
        public IActionResult BookingBooking([FromBody]BookingView bookingView)
        {
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using the summary annotations and attributes will tell to swagger the contract via the XML doc generated on compiling time. This doc will be stored in <code><em>XmlDocumentation</em></code> folder.</p>
</div>
<div class="paragraph">
<p>The Api methods will be exposed on the application layer.</p>
</div>
</div>
<div class="sect3">
<h4 id="_google_mail_api_consumer"><a class="anchor" href="#_google_mail_api_consumer"></a>Google Mail API Consumer</h4>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-= fa-floppy-o"></i></span>  <a href="resources/samples/components/GMailAPIConsumer.zip">Google Mail API Consumer</a></p>
</div>
<div class="paragraph">
<p>|== == == == == == == == == == == =
|Application| <code>MyThaiStarEmailService.exe</code>
|Config file| <code>MyThaiStarEmailService.exe.Config</code>
|Default port|8080
|== == == == == == == == == == == =</p>
</div>
</div>
<div class="sect3">
<h4 id="_overview_5"><a class="anchor" href="#_overview_5"></a>Overview</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Execute <code>MyThaiStarEmailService.exe</code>.</p>
</li>
<li>
<p>The first time google will ask you for credentials
(just one time) in your default browser:</p>
<div class="ulist">
<ul>
<li>
<p>Account: <a href="mailto:mythaistarrestaurant@gmail.com">mythaistarrestaurant@gmail.com</a></p>
</li>
<li>
<p>Password: mythaistarrestaurant2501</p>
</li>
</ul>
</div>
</li>
<li>
<p>Visit the url: <a href="http://localhost:8080/swagger" class="bare">http://localhost:8080/swagger</a></p>
</li>
<li>
<p>Your server is ready!</p>
</li>
</ol>
</div>
<div id="img-t-architecture" class="imageblock">
<div class="content">
<a class="image" href="images/email_swagger.png"><img src="../_images/images/email_swagger.png" alt="GMail Service" width="820"></a>
</div>
<div class="title">Figure 11. GMail Server Swagger contract page</div>
</div>
</div>
<div class="sect3">
<h4 id="_json_example"><a class="anchor" href="#_json_example"></a>JSON Example</h4>
<div class="paragraph">
<p>This is the JSON example to test with swagger client. Please read the swagger documentation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
   "EmailFrom":"mythaistarrestaurant@gmail.com",
   "EmailAndTokenTo":{
      "MD5Token1":" Email_Here!@gmail.com",
      "MD5Token2":" Email_Here!@gmail.com"
   },
   "EmailType":0,
   "DetailMenu":[
      "Thai Spicy Basil Fried Rice x2",
      "Thai green chicken curry x2"
   ],
   "BookingDate":"2017-05-31T12:53:39.7864723+02:00",
   "Assistants":2,
   "BookingToken":"MD5Booking",
   "Price":20.0,
   "ButtonActionList":{
      "http://accept.url":"Accept",
      "http://cancel.url":"Cancel"
   },
   "Host":{
      " Email_Here!@gmail.com":"José Manuel"
   }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_configure_the_service_port"><a class="anchor" href="#_configure_the_service_port"></a>Configure the service port</h4>
<div class="paragraph">
<p>If you want to change the default port, please edit the config file and
change the next entry in <code>appSettings</code> node:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;appSettings&gt;
   &lt;add key="LocalListenPort" value="8080" /&gt;
&lt;/appSettings&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_external_links_5"><a class="anchor" href="#_external_links_5"></a>==  External links</h4>
<div class="paragraph">
<p><a href="https://console.developers.google.com/flows/enableapi?apiid=gmail">Google API Account Configuration</a></p>
</div>
<div class="paragraph">
<p><a href="https://developers.google.com/gmail/api/auth/scopes">About Scopes</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_downloads"><a class="anchor" href="#_downloads"></a>Downloads</h4>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-= fa-floppy-o"></i></span>  <a href="https://github.com/devonfw/my-thai-star/tree/develop/net">My Thai Star (.Net Core Server + Angular client)</a></p>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
