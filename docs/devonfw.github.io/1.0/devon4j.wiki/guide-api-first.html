<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: Devonfw.github.io Docs</title>
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../..">Devonfw.github.io Docs</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="devonfw.github.io" data-version="1.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-explore is-active" data-panel="explore">
  <div class="context">
    <span class="title">devonfw.github.io</span>
    <span class="version">1.0</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../../../architecture-guidelines/1.0/index.html">Architecture-guidelines</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../architecture-guidelines/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../cicdgen/1.0/index.html">Cicdgen</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../cicdgen/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../cobigen/1.0/index.html">Cobigen</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../cobigen/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../dashboard/1.0/index.html">Dashboard</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../dashboard/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../devon4j/1.0/index.html">Devon4j</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../devon4j/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../devon4net/1.0/index.html">Devon4net</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../devon4net/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../devon4ng/1.0/index.html">Devon4ng</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../devon4ng/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../devon4node/1.0/index.html">Devon4node</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../devon4node/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../devon4quarkus/1.0/index.html">Devon4quarkus</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../devon4quarkus/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../devon4ts/1.0/index.html">Devon4ts</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../devon4ts/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="../index.html">devonfw.github.io</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../getting-started/1.0/index.html">Getting-started</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../getting-started/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../github/1.0/index.html">Github</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../github/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../hangar/1.0/index.html">Hangar</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../hangar/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../ide/1.0/index.html">IDE</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../ide/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../jump-the-queue/1.0/index.html">Jump-the-queue</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../jump-the-queue/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../mrchecker/1.0/index.html">Mrchecker</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../mrchecker/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../my-thai-star/1.0/index.html">My-thai-star</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../my-thai-star/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../production-line/1.0/index.html">Production-line</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../production-line/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../shop-floor/1.0/index.html">Shop-floor</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../shop-floor/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../solicitor/1.0/index.html">Solicitor</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../solicitor/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../sonar-devon4j-plugin/1.0/index.html">Sonar-devon4j-plugin</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../sonar-devon4j-plugin/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
</nav>
  <div class="edit-this-page"><a href="https://github.com/marvdan/devonfw.github.io/edit/developAntoraGhPage/docs/modules/ROOT/pages/devon4j.wiki/guide-api-first.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<div id="toc" class="toc">
<div id="toctitle" class="title">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_api_first_strategy">API first strategy</a></li>
<li><a href="#_api_first_provider">API first provider</a>
<ul class="sectlevel2">
<li><a href="#_openapi_generator_maven_plugin">OpenAPI Generator maven plugin</a></li>
<li><a href="#_generate_once_vs_generate_always">Generate once vs generate always</a></li>
<li><a href="#_implement_the_generated_interfaces">Implement the generated interfaces</a></li>
<li><a href="#_serving_api_docs_swagger_ui">Serving API docs / Swagger-UI</a></li>
<li><a href="#_advanced_topics">Advanced topics</a></li>
</ul>
</li>
</ul>
</div>
<div class="paragraph">
<p>==API first development guide</p>
</div>
<div class="paragraph">
<p>Cloud native promotes the use of microservices, which are loosely coupled and self-contained. These services communicate with each other using a well-defined interface or API, and no consumer needs to be aware of any implementation details of the provider. There could even be multiple providers of the same API, or we can decide to swap existing implementation for a new one, without disrupting our clients - all because we adhere to a well defined API.
This guide focuses on HTTP interfaces following RESTful design principles.</p>
</div>
<div class="sect1">
<h2 id="_api_first_strategy"><a class="anchor" href="#_api_first_strategy"></a>API first strategy</h2>
<div class="sectionbody">
<div class="paragraph">
<p>API first strategy treats APIs as first class citizens in the delivery model.
The APIs are modeled/designed first (usually as <a href="guide-openapi">OpenAPI specification</a>), often in a collaborative process between providers and consumers, and only once the APIs are defined do we start with development of the provider service.
This requires a bit more time upfront, but also provides opportunity to think about the behaviour of the system before it gets implemented. Several other advatages of this approach:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>provider and client implementation can run in parallel - we have the contract, client does not need to wait for provider to finish implementation</p>
</li>
<li>
<p>support for automation and great ecosystem - we can easily generate stubs and clients for most languages/frameworks, generate documentation and API catalogues using one of the many opensource and commercial tools</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_api_first_provider"><a class="anchor" href="#_api_first_provider"></a>API first provider</h2>
<div class="sectionbody">
<div class="paragraph">
<p>After careful planning, we defined our future API. Now we would like to implement a provider of this API.
We could manually create all the <a href="guide-rest#jax-rs">JAX-RS</a> endpoints based on the schema and then test whether the actually provided interface conforms with the API schema. However, it is an error prone and laborious process, especially if the API gets big.
Luckily, we can use great open source tooling to generate JAX-RS interfaces that conform to 100% with the schema, and then we simply implement them.</p>
</div>
<div class="paragraph">
<p>There are many open source tools, that allow code generation from OpenAPI schema files, for example <a href="https://openapi-generator.tech/">OpenAPI Generator</a> or <a href="https://github.com/swagger-api/swagger-codegen">Swagger codegen</a>. Both are based on Java and even provide maven plugins to integrate them in our build.</p>
</div>
<div class="sect2">
<h3 id="_openapi_generator_maven_plugin"><a class="anchor" href="#_openapi_generator_maven_plugin"></a>OpenAPI Generator maven plugin</h3>
<div class="paragraph">
<p>If we already have our backend maven project, using the maven plugin will be easiest for us. Lets define a new maven profile and add the OpenAPI generator plugin:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;profile&gt;
  &lt;id&gt;apigen&lt;/id&gt;
  &lt;activation&gt;&lt;activeByDefault&gt;true&lt;/activeByDefault&gt;&lt;/activation&gt;
  &lt;build&gt;
    &lt;plugins&gt;
      &lt;plugin&gt;
        &lt;groupId&gt;org.openapitools&lt;/groupId&gt;
        &lt;artifactId&gt;openapi-generator-maven-plugin&lt;/artifactId&gt;
        &lt;version&gt;5.1.0&lt;/version&gt;
        &lt;executions&gt;
          &lt;execution&gt;
            &lt;goals&gt;
              &lt;goal&gt;generate&lt;/goal&gt;
            &lt;/goals&gt;
            &lt;configuration&gt;
              &lt;!-- input spec can be a url, or a local file --&gt;
              &lt;inputSpec&gt;https://raw.githubusercontent.com/OAI/OpenAPI-Specification/main/examples/v3.0/petstore.yaml&lt;/inputSpec&gt;
              &lt;!-- &lt;inputSpec&gt;${project.basedir}/src/main/resources/api.yaml&lt;/inputSpec&gt; --&gt;
              &lt;generatorName&gt;jaxrs-spec&lt;/generatorName&gt;
              &lt;apiPackage&gt;com.petclinic.api&lt;/apiPackage&gt;
              &lt;modelPackage&gt;com.petclinic.api.model&lt;/modelPackage&gt;
              &lt;!-- &lt;library&gt;quarkus&lt;/library&gt; --&gt;
              &lt;configOptions&gt;
                &lt;sourceFolder&gt;src/gen/java/main&lt;/sourceFolder&gt;
                &lt;useSwaggerAnnotations&gt;false&lt;/useSwaggerAnnotations&gt;
                &lt;useTags&gt;true&lt;/useTags&gt;
                &lt;interfaceOnly&gt;true&lt;/interfaceOnly&gt;
                &lt;generatePom&gt;false&lt;/generatePom&gt;
              &lt;/configOptions&gt;
            &lt;/configuration&gt;
          &lt;/execution&gt;
        &lt;/executions&gt;
      &lt;/plugin&gt;
    &lt;/plugins&gt;
  &lt;/build&gt;
&lt;/profile&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>OpenAPI generator project includes support for many languages and frameworks - in our case we picked <code>jaxrs-spec</code> server generator.
Many of the generator templates have further sub-generators, for example for your specific framework. We could, for example use <code>quarkus</code> sub-generator to bootstrap a full working Quarkus maven project, but in our case, we want to have more control over the process, therefore we opt for standard <code>jaxrs</code> template and pass some additional configuration:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>apiPackage</code> = generated package name for our endpoint interfaces</p>
</li>
<li>
<p><code>modelPackage</code> = generated package name for our API models (DTOs)</p>
</li>
<li>
<p><code>sourceFolder</code> = where do we want to output the generated files, relative to the <code>output</code> folder - if we regenerate the files with every build, then it is recommended to put them in <code>${project.build.directory}/generated-sources/openapi</code> (default, can be changed via <code>output</code> plugin attribute). Final location of our generated Java files will then be <code>${project.build.directory}/generated-sources/openapi/src/gen/java/main</code></p>
</li>
<li>
<p><code>useTags</code> = group the generated endpoints by schema <code>tag</code> attribute</p>
</li>
<li>
<p><code>interfaceOnly</code> = we want to implement the endpoint logic ourselves, so we only want JAX-RS interfaces</p>
</li>
<li>
<p><code>generatePom</code> = we are generating the files into existing project, so we dont want to generate additional maven pom</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Let&#8217;s run the plugin now using <code>mvn clean compile</code>. If everything went well, we end up with something like this:</p>
</div>
<div id="img-generated-sources" class="imageblock text-center">
<div class="content">
<a class="image" href="https://devonfw.com/website/pages/docs/images/apifirst-generated-sources.png"><img src="../_images/images/apifirst-generated-sources.png" alt="Generated sources by OpenAPI generator"></a>
</div>
<div class="title">Figure 1. Generated sources by OpenAPI generator</div>
</div>
<div class="paragraph">
<p>Depending on the configuration of your code generator, you might need to add some additional dependencies to your <code>pom.xml</code>, for example for bean validation or Jackson annotations.</p>
</div>
<div class="paragraph">
<p>The OpenAPI generator has many more configuration options that are outside the scope of this guide. You can find full documentation of the codegen plugin in the <a href="https://github.com/OpenAPITools/openapi-generator/tree/master/modules/openapi-generator-maven-plugin">projects GitHub repository</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_generate_once_vs_generate_always"><a class="anchor" href="#_generate_once_vs_generate_always"></a>Generate once vs generate always</h3>
<div class="paragraph">
<p>Depending on our needs, we may either want to generate the interfaces and models once and afterwards copy them to our project as general source code files, or treat them as immutable generated assets, that we generate anew with every build.
Both scenarios have their pros and cons, and you&#8217;ll need to find out what best suits your project. In the example above, we use a profile with <code>activeByDefault=true</code>, which will cause the generator to run with every build. The generated files will be included as sources in our project, so we can import them in any other java class without issues.</p>
</div>
<div class="paragraph">
<p>In case you only want to generate your API resources once and version them afterwards in SCM, simply run the generator, outputting to some temporary location, then, copy them to <code>src/main/java</code> and you are done. Be careful if you manually modify the generated files afterwards and you want to re-generate them after an API schema update, you will lose any manual changes.</p>
</div>
</div>
<div class="sect2">
<h3 id="_implement_the_generated_interfaces"><a class="anchor" href="#_implement_the_generated_interfaces"></a>Implement the generated interfaces</h3>
<div class="paragraph">
<p>To implement the generated interfaces, we simply create an impl class - rest controller bean - that implements the interface from our <code>gen</code> package:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.acme.rest.controller;

import java.util.List;

import com.petclinic.api.PetsApi;
import com.petclinic.api.model.Pet;

public class PetClinicController implements PetsApi {

    @Override
    public void createPets() {
        // TODO Auto-generated method stub

    }

    @Override
    public List&lt;Pet&gt; listPets(Integer limit) {
        // TODO Auto-generated method stub
        return null;
    }

    @Override
    public Pet showPetById(String petId) {
        // TODO Auto-generated method stub
        return null;
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And now we can invoke our API endpoint as usual: <code><a href="http://localhost:8080/pets" class="bare">http://localhost:8080/pets</a></code> - because <code>/pets</code> is the <code>@Path</code> annotation value in the generated <code>PetsApi</code> interface.</p>
</div>
</div>
<div class="sect2">
<h3 id="_serving_api_docs_swagger_ui"><a class="anchor" href="#_serving_api_docs_swagger_ui"></a>Serving API docs / Swagger-UI</h3>
<div class="paragraph">
<p>A common requirement is that our backend API provider should also provide an endpoint with the schema or a Swagger-UI application with that schema.
In our example, we decided to generate the JAX-RS interface without Swagger/OpenAPI annotations, therefore the schema can not be re-constructed 1:1 from our code (missing method documentation, error handling, etc.).</p>
</div>
<div class="paragraph">
<p>When having a Quarkus application and using the <a href="guide-openapi#smallrye-openapi">Smallrye OpenAPI extension</a>, we can tell Quarkus to serve a static version of the API as our openapi schema (the same file we used to generate the interfaces and models) and to disable the auto-generating of the schema. Follow the <a href="https://quarkus.io/guides/openapi-swaggerui#openapi">Quarkus OpenAPI documentation</a> for more info.</p>
</div>
</div>
<div class="sect2">
<h3 id="_advanced_topics"><a class="anchor" href="#_advanced_topics"></a>Advanced topics</h3>
<div class="paragraph">
<p>In some cases, we may have specific requirements or API extensions that are not supported by the existing generators. OpenAPI generator project allows us to define <a href="https://github.com/OpenAPITools/openapi-generator/tree/master/modules/openapi-generator-maven-plugin#custom-generator">custom genererator</a>, or to extend the existing <a href="https://openapi-generator.tech/docs/templating">generator templates</a>. We can also selectively generate subset of the models or API endpoints, generate test code and much more.</p>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
