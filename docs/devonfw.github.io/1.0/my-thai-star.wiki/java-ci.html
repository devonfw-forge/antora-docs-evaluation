<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: Devonfw.github.io Docs</title>
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../..">Devonfw.github.io Docs</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="devonfw.github.io" data-version="1.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-explore is-active" data-panel="explore">
  <div class="context">
    <span class="title">devonfw.github.io</span>
    <span class="version">1.0</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../../../architecture-guidelines/1.0/index.html">Architecture-guidelines</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../architecture-guidelines/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../cicdgen/1.0/index.html">Cicdgen</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../cicdgen/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../cobigen/1.0/index.html">Cobigen</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../cobigen/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../dashboard/1.0/index.html">Dashboard</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../dashboard/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../devon4j/1.0/index.html">Devon4j</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../devon4j/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../devon4net/1.0/index.html">Devon4net</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../devon4net/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../devon4ng/1.0/index.html">Devon4ng</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../devon4ng/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../devon4node/1.0/index.html">Devon4node</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../devon4node/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../devon4quarkus/1.0/index.html">Devon4quarkus</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../devon4quarkus/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../devon4ts/1.0/index.html">Devon4ts</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../devon4ts/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="../index.html">devonfw.github.io</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../getting-started/1.0/index.html">Getting-started</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../getting-started/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../github/1.0/index.html">Github</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../github/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../hangar/1.0/index.html">Hangar</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../hangar/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../ide/1.0/index.html">IDE</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../ide/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../jump-the-queue/1.0/index.html">Jump-the-queue</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../jump-the-queue/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../mrchecker/1.0/index.html">Mrchecker</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../mrchecker/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../my-thai-star/1.0/index.html">My-thai-star</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../my-thai-star/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../production-line/1.0/index.html">Production-line</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../production-line/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../shop-floor/1.0/index.html">Shop-floor</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../shop-floor/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../solicitor/1.0/index.html">Solicitor</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../solicitor/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../sonar-devon4j-plugin/1.0/index.html">Sonar-devon4j-plugin</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../sonar-devon4j-plugin/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
</nav>
  <div class="edit-this-page"><a href="https://github.com/marvdan/devonfw.github.io/edit/developAntoraGhPage/docs/modules/ROOT/pages/my-thai-star.wiki/java-ci.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<div id="toc" class="toc">
<div id="toctitle" class="title">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_java_ci">Java CI</a></li>
<li><a href="#_pipeline">Pipeline</a></li>
<li><a href="#_adjustments">Adjustments</a></li>
<li><a href="#_pipeline_environment">Pipeline Environment</a></li>
<li><a href="#_description">==  Description</a></li>
<li><a href="#_distribution_management">Distribution management</a></li>
</ul>
</div>
<div class="sect1">
<h2 id="_java_ci"><a class="anchor" href="#_java_ci"></a>Java CI</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Java server-side of My Thai Star is an <strong>devon4j</strong>-based application. As long as <strong>Maven</strong> and a <strong>Java 8</strong> are going to be needed, the Pipeline should have those tools available as well.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_pipeline"><a class="anchor" href="#_pipeline"></a>Pipeline</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This Pipeline is called <strong>MyThaiStar_SERVER_BUILD</strong>, and it is located exactly in the same PL instance&#8217;s folder than <code><strong>MyThaiStar_FRONTEND_BUILD</strong></code>. Let&#8217;s see how the Pipeline&#8217;s flow behaves.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="java_pipeline_flow.PNG"><img src="../_images/images/ci/java/java_pipeline_flow.PNG" alt="java pipeline flow"></a>
</div>
</div>
<div class="paragraph">
<p>Check those Pipeline stages with more detail:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Declarative: Checkout SCM</strong></p>
<div class="paragraph">
<p>Gets the code from <a href="https://github.com/devonfw/my-thai-star" class="bare">https://github.com/devonfw/my-thai-star</a> . This step is not defined directly in our pipeline, but as it is loaded from the repository this step should always be done at the beginning.</p>
</div>
</li>
<li>
<p><strong>Declarative: Tool Install</strong></p>
<div class="paragraph">
<p>The My Thai Star application works with JDK11. In this step, if JDK11 is not installed, we install it and then put the JDK folder into PATH.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">tools {
  jdk 'OpenJDK11'
}</code></pre>
</div>
</div>
</li>
<li>
<p><strong>Loading Custom Tools</strong></p>
<div class="paragraph">
<p>In this step we load the tools that can not be loaded in the previous step. As My Thai Star is delivered as docker container, in this step we load docker as custom tool.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">tool dockerTool</code></pre>
</div>
</div>
</li>
<li>
<p><strong>Install dependencies</strong></p>
<div class="paragraph">
<p>This step will download all project dependencies.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">mvn clean install -Dmaven.test.skip=true</code></pre>
</div>
</div>
</li>
<li>
<p><strong>Unit Tests</strong></p>
<div class="paragraph">
<p>This step will execute the project unit test with maven.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">mvn clean test</code></pre>
</div>
</div>
</li>
<li>
<p><strong>Dependency Checker</strong></p>
<div class="paragraph">
<p>Execute the OWASP Dependency Checker in order to validate the project dependencies. It will generate a report that can be used in SonarQube</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">dependencyCheck additionalArguments: '--project "MTSJ" --scan java/mtsj --format XML', odcInstallation: 'dependency-check'
dependencyCheckPublisher pattern: ''</code></pre>
</div>
</div>
</li>
<li>
<p><strong>SonarQube analysis</strong></p>
<div class="paragraph">
<p>The code is evaluated using the integrated PL instance&#8217;s SonarQube. Also, it will wait for the quality gate status. If the status is failing, the pipeline execution will be stopped.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">withSonarQubeEnv(sonarEnv) {
    sh "mvn sonar:sonar"
}

def qg = waitForQualityGate()
if (qg.status != 'OK') {
    error "Pipeline aborted due to quality gate failure: ${qg.status}"
}</code></pre>
</div>
</div>
</li>
<li>
<p><strong>Deliver application into Nexus</strong></p>
<div class="paragraph">
<p>Store all artifacts into nexus.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">mvn deploy -Dmaven.test.skip=true</code></pre>
</div>
</div>
</li>
<li>
<p><strong>Create the Docker image</strong></p>
<div class="paragraph">
<p>Create the docker image and then publish the image into a docker registry.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_adjustments"><a class="anchor" href="#_adjustments"></a>Adjustments</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_pipeline_environment"><a class="anchor" href="#_pipeline_environment"></a>Pipeline Environment</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In order to easily reuse the pipeline in other java projects, all variables have been defined in the block environment. All variables have the default values that Production Line uses, so if you&#8217;re going to work in production line you won&#8217;t have to change anything. Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">environment {
    // Directory with java project
    javaDir = 'java/mtsj'

    // SonarQube
    // Name of the SonarQube environment
    sonarEnv = "SonarQube"

    // Nexus 3
    // Maven global settings configuration ID
    `globalSettingsId = 'MavenSettings'`
    // Maven tool id
    `mavenInstallation = 'Maven3'`

    // Docker
    dockerRegistryCredentials = 'nexus-api'
    dockerRegistryProtocol = 'https://\'
    dockerTool = 'docker-global
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_description"><a class="anchor" href="#_description"></a>==  Description</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><strong>java Dir</strong>: Relative route to java application. In My Thai Star this is the <code>java/mtsj</code> folder. The actual directory (.) is also allowed.</p>
<div class="imageblock">
<div class="content">
<a class="image" href="java_directory.png"><img src="../_images/images/ci/java/java_directory.png" alt="java directory"></a>
</div>
</div>
</li>
<li>
<p><strong>sonar Env</strong>: Name of the SonarQube environment. SonarQube is the default value for PL.</p>
</li>
<li>
<p><strong>global Settings Id</strong>: The id of the global settings file. <code>MavenSettings</code> is the default value for PL.</p>
<div class="imageblock">
<div class="content">
<a class="image" href="nexus3_global_config.PNG"><img src="../_images/images/ci/angular/nexus3_global_config.png" alt="nexus3 global config"></a>
</div>
</div>
</li>
<li>
<p><strong>maven Installation</strong>: The name of the maven tool. Maven3 is the default value for PL.</p>
<div class="imageblock">
<div class="content">
<a class="image" href="maven_tool.PNG"><img src="../_images/images/ci/angular/maven_tool.png" alt="maven tool"></a>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_distribution_management"><a class="anchor" href="#_distribution_management"></a>Distribution management</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The only <em>extra</em> thing that needs to be added to the Java server-side is some information that determines where the artifact of the project is going to be stored in <strong>Nexus</strong>. This is going to be a section in the main <code>pom.xml</code> file called <code>&lt;distributionManagement&gt;</code>. This section will point to the PL instance&#8217;s Nexus. Let&#8217;s have a look at it. It&#8217;s already configured with the PL default values.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;distributionManagement&gt;
    &lt;repository&gt;
      &lt;id&gt;pl-nexus&lt;/id&gt;
      &lt;name&gt;PL Releases&lt;/name&gt;
      &lt;url&gt;http://nexus3-core:8081/nexus/content/repositories/maven-releases/&lt;/url&gt;
    &lt;/repository&gt;
    &lt;snapshotRepository&gt;
      &lt;id&gt;pl-nexus&lt;/id&gt;
      &lt;name&gt;PL Snapshots&lt;/name&gt;
      &lt;url&gt;http://nexus3-core:8081/nexus3/repository/maven-snapshots&lt;/url&gt;
    &lt;/snapshotRepository&gt;
&lt;/distributionManagement&gt;</code></pre>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
