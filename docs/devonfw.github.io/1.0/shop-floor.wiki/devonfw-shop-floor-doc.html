<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: Devonfw.github.io Docs</title>
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../..">Devonfw.github.io Docs</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="devonfw.github.io" data-version="1.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-explore is-active" data-panel="explore">
  <div class="context">
    <span class="title">devonfw.github.io</span>
    <span class="version">1.0</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../../../architecture-guidelines/1.0/index.html">Architecture-guidelines</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../architecture-guidelines/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../cicdgen/1.0/index.html">Cicdgen</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../cicdgen/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../cobigen/1.0/index.html">Cobigen</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../cobigen/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../dashboard/1.0/index.html">Dashboard</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../dashboard/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../devon4j/1.0/index.html">Devon4j</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../devon4j/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../devon4net/1.0/index.html">Devon4net</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../devon4net/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../devon4ng/1.0/index.html">Devon4ng</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../devon4ng/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../devon4node/1.0/index.html">Devon4node</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../devon4node/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../devon4quarkus/1.0/index.html">Devon4quarkus</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../devon4quarkus/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../devon4ts/1.0/index.html">Devon4ts</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../devon4ts/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="../index.html">devonfw.github.io</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../getting-started/1.0/index.html">Getting-started</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../getting-started/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../github/1.0/index.html">Github</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../github/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../hangar/1.0/index.html">Hangar</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../hangar/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../ide/1.0/index.html">IDE</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../ide/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../jump-the-queue/1.0/index.html">Jump-the-queue</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../jump-the-queue/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../mrchecker/1.0/index.html">Mrchecker</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../mrchecker/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../my-thai-star/1.0/index.html">My-thai-star</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../my-thai-star/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../production-line/1.0/index.html">Production-line</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../production-line/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../shop-floor/1.0/index.html">Shop-floor</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../shop-floor/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../solicitor/1.0/index.html">Solicitor</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../solicitor/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../sonar-devon4j-plugin/1.0/index.html">Sonar-devon4j-plugin</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../sonar-devon4j-plugin/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
</nav>
  <div class="edit-this-page"><a href="https://github.com/marvdan/devonfw.github.io/edit/developAntoraGhPage/docs/modules/ROOT/pages/shop-floor.wiki/devonfw-shop-floor-doc.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<div class="sect1">
<h2 id="_devonfw_shop_floor_project_version"><a class="anchor" href="#_devonfw_shop_floor_project_version"></a>devonfw shop floor ${project.version}</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The devonfw community
${project.version}, ${buildtime}: Subtitle {doctitle}
:description: comprehensive documentation for the devonfw shop floor.
:sectnums:
:toc:
:toc-title: Table of Contents
:toclevels: 3
:imagesdir: ./
:footnote: test footnote
:productname: test productname</p>
</div>
<!-- toc disabled -->
</div>
</div>
<div class="sect1">
<h2 id="_what_is_devonfw_shop_floor"><a class="anchor" href="#_what_is_devonfw_shop_floor"></a>What is devonfw shop floor?</h2>
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="../_images/images/devonfw-shop-floor.jpg" alt="devonfw shop floor">
</div>
</div>
<div class="paragraph">
<p>devonfw shop floor is a platform to industrialize continuous delivery and continuous integration processes.</p>
</div>
<div class="paragraph">
<p>devonfw shop floor is a set of documentation, tools and methodologies used to configure the provisioning, development and uat environments used in your projects. devonfw shop floor allows the administrators of those environments to apply CI/CD operations and enables automated application deployment.</p>
</div>
<div class="paragraph">
<p>devonfw shop floor is mainly oriented to configure the provisioning environment provided by Production Line and deploy applications on an OpenShift cluster. In the cases where Production Line or OpenShift cluster are not available, there will be alternatives to achieve similar goals.</p>
</div>
<div class="paragraph">
<p>The <strong>devonfw shop floor 4 OpenShift</strong> is a solution based on the experience of priming devonfw for OpenShift by RedHat.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/dsf4openshift/primed.jpg" alt="primed">
</div>
</div>
<div class="paragraph">
<p><a href="dsf-how-to-use.adoc">Let&#8217;s start</a>.</p>
</div>
<div class="sect2">
<h3 id="_how_to_use_it"><a class="anchor" href="#_how_to_use_it"></a>How to use it</h3>
<div class="paragraph">
<p>This is the documentation about shop floor and its different tools. Here you are going to learn how to create new projects, so that they can include continuous integration and continuous delivery processes, and be deployed automatically in different environments.</p>
</div>
</div>
<div class="sect2">
<h3 id="_prerequisites_provisioning_environment"><a class="anchor" href="#_prerequisites_provisioning_environment"></a>Prerequisites - Provisioning environment</h3>
<div class="paragraph">
<p>To start working you need to have some services running in your provisioning environment, such as Jenkins (automation server), GitLab (git repository), SonarQube (program analysis), Nexus (software repository) or similar.</p>
</div>
<div class="paragraph">
<p>To host those services we recommend to have a Production Line instance but you can use other platforms. Here is the list for the different options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="dsf-provisioning-production-line.adoc">Production Line</a>.</p>
</li>
<li>
<p><a href="dsf-provisioning-dsf4docker.adoc">dsf4docker</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_step_1_configuration_and_services_integration"><a class="anchor" href="#_step_1_configuration_and_services_integration"></a>Step 1 - Configuration and services integration</h3>
<div class="paragraph">
<p>The first step is configuring your services and integrate them with jenkins. Here you have an example about how to manually configure the next services:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="dsf-configure-nexus.adoc">Nexus</a>.</p>
</li>
<li>
<p><a href="dsf-configure-sonarqube.adoc">SonarQube</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_step_2_create_the_project"><a class="anchor" href="#_step_2_create_the_project"></a>Step 2 - Create the project</h3>

</div>
<div class="sect2">
<h3 id="_create_and_integrate_git_repository"><a class="anchor" href="#_create_and_integrate_git_repository"></a>Create and integrate git repository</h3>
<div class="paragraph">
<p>The second is create or git repository and integrate it with Jenkins.</p>
</div>
<div class="paragraph">
<p>Here you can find a manual guide about how it:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="dsf-configure-gitlab.adoc">GitLab</a> new project.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_start_new_devonfw_project"><a class="anchor" href="#_start_new_devonfw_project"></a>Start new devonfw project</h3>
<div class="paragraph">
<p>It is time to create your devonfw project:</p>
</div>
<div class="paragraph">
<p>You can find all that you need about how to create a <a href="dsf-create-new-devonfw-project.adoc">new devonfw project</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_cicd_configuration"><a class="anchor" href="#_cicd_configuration"></a>cicd configuration</h3>
<div class="paragraph">
<p>Now you need to add cicd files in your project.</p>
</div>
</div>
<div class="sect2">
<h3 id="_manual_configuration"><a class="anchor" href="#_manual_configuration"></a>==  Manual configuration</h3>

</div>
<div class="sect2">
<h3 id="_jenkinsfile"><a class="anchor" href="#_jenkinsfile"></a>== Jenkinsfile</h3>
<div class="paragraph">
<p>Here you can find all that you need to know to do your <a href="dsf-configure-jenkinsfile.adoc">Jenkinsfile</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_dockerfile"><a class="anchor" href="#_dockerfile"></a>==  Dockerfile</h3>
<div class="paragraph">
<p>Here you can find all that you need to know to do your <a href="dsf-configure-dockerfile.adoc">Dockerfile</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_automatic_configuration"><a class="anchor" href="#_automatic_configuration"></a>==  Automatic configuration</h3>

</div>
<div class="sect2">
<h3 id="_cicdgen"><a class="anchor" href="#_cicdgen"></a>== cicdgen</h3>
<div class="paragraph">
<p>If you are using production line for provisioning you could use cicdgen to configure automatically almost everything explained in the manual configuration. To do it see the <a href="https://github.com/devonfw/cicdgen/wiki">cicdgen</a> documentation.</p>
</div>
</div>
<div class="sect2">
<h3 id="_step_3_deployment"><a class="anchor" href="#_step_3_deployment"></a>Step 3 - Deployment</h3>
<div class="paragraph">
<p>The third is configure our deployment environment. Here is the list for the different options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="dsf-deployment-dsf4openshift.adoc">dsf4openshift</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_step_4_monitoring"><a class="anchor" href="#_step_4_monitoring"></a>Step 4 - Monitoring</h3>
<div class="paragraph">
<p>Here you can find information about tools for monitoring:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="dsf-configure-jenkins-build-monitor-view.adoc">build monitor view</a> for Jenkins. With this tool you will be able to see in real time what is the state of your Jenkins pipelines.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_provisioning_environments"><a class="anchor" href="#_provisioning_environments"></a>Provisioning environments</h2>
<div class="sectionbody">
<!-- toc disabled -->
<div class="sect3">
<h4 id="_production_line_provisioning_environment"><a class="anchor" href="#_production_line_provisioning_environment"></a>Production Line provisioning environment</h4>
<div class="paragraph">
<p><span class="image"><img src="../_images/images/dsf4pl/pl.png" alt="pl"></span></p>
</div>
<div class="paragraph">
<p>The Production Line Project is a set of server-side collaboration tools for Capgemini engagements. It has been developed for supporting project engagements with individual tools like issue tracking, continuous integration, continuous deployment, documentation, binary storage and much more!</p>
</div>
<div class="paragraph">
<p>For additional information use the <a href="https://km3.capgemini.com/community/1042857/home">official documentation</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_how_to_obtain_your_production_line"><a class="anchor" href="#_how_to_obtain_your_production_line"></a>How to obtain your Production Line</h4>
<div class="paragraph">
<p>You can order your Production Line environment instance following the <a href="https://km3.capgemini.com/book/1082360">official guide</a>. Remember that you need to order at least the next tools:
 * Jenkins
 * GitLab
 * SonarQube
 * Nexus</p>
</div>
<hr>
<div class="paragraph">
<p><a href="dsf-how-to-use#Step-1---Configuration-and-services-integration.adoc">Back</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_dsf4docker_provisioning_environment"><a class="anchor" href="#_dsf4docker_provisioning_environment"></a>dsf4docker provisioning environment</h4>
<div class="imageblock">
<div class="content">
<img src="../_images/images/dsf4docker/docker.png" alt="docker">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_architecture_overview"><a class="anchor" href="#_architecture_overview"></a>Architecture overview</h4>
<div class="paragraph">
<p><span class="image"><img src="../_images/images/dsf4docker/dsf-docker-arch.png" alt="dsf docker arch"></span></p>
</div>
</div>
<div class="sect3">
<h4 id="_prerequisite"><a class="anchor" href="#_prerequisite"></a>Prerequisite</h4>
<div class="paragraph">
<p>To use dsf4docker provisioning environment you need a remote server and you must clone or download devonfw shop floor.</p>
</div>
</div>
<div class="sect3">
<h4 id="_how_to_use_it_2"><a class="anchor" href="#_how_to_use_it_2"></a>How to use it</h4>
<div class="paragraph">
<p>Navigate to <code>./devonfw-shop-floor/dsf4docker/environment</code> and here you can find one scripts to install it, and another one to uninstall it.</p>
</div>
</div>
<div class="sect3">
<h4 id="_install_devonfw_shop_floor_4_docker"><a class="anchor" href="#_install_devonfw_shop_floor_4_docker"></a>Install devonfw shop floor 4 Docker</h4>
<div class="paragraph">
<p>There is an installation script to do so, so the complete installation should be completed by running it. Make sure this script has execution permissions in the Docker Host:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"> chmod +x dsf4docker-install.sh
 sudo ./dsf4docker-install.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>This script, besides the container "installation" itself, will also adapt the <code>docker-compose.yml</code> file to your host (using <code>sed</code> to replace the <strong>IP_ADDRESS</strong> word of the file for your real Docker Host&#8217;s IP address).</p>
</div>
</div>
<div class="sect3">
<h4 id="_uninstall_devonfw_shop_floor_4_docker"><a class="anchor" href="#_uninstall_devonfw_shop_floor_4_docker"></a>Uninstall devonfw shop floor 4 Docker</h4>
<div class="paragraph">
<p>As well as for the installation, if we want to remove everything concerning <strong>devonfw shop floor 4 Docker</strong> from our Docker Host, we&#8217;ll run this script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"> chmod +x dsf4docker-uninstall.sh
 sudo ./dsf4docker-uninstall.sh</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_troubleshooting"><a class="anchor" href="#_troubleshooting"></a>Troubleshooting</h4>
<div class="paragraph">
<p>When trying to execute the install or uninstall .sh there may be some problems related to the windows/linux format file, so if you see this error log while executing the script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./dsf4docker-install.sh: line 16: $'\r': command not found</pre>
</div>
</div>
<div class="paragraph">
<p>You need to do a file conversion with this command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>dos2unix dsf4docker-install.sh</pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre>dos2unix dsf4docker-uninstall.sh</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_a_little_history"><a class="anchor" href="#_a_little_history"></a>A little history</h4>
<div class="paragraph">
<p>The <strong>Docker</strong> part of the shop floor is created based on the experience of the environment setup of the project <strong>Mirabaud Advisory</strong>, and intended to be updated to latest versions. Mirabaud Advisory is a web service developed with devonfw (Java) that, alongside its own implementation, it needed an environment both for the team to follow CICD rules through their 1-week-long sprints and for the client (Mirabaud) to check the already done work.</p>
</div>
<div class="paragraph">
<p>There is a practical experience about the <a href="dsf-mirabaud-cicd-environment-setup.adoc">Mirabaud Case</a>.</p>
</div>
<hr>
<div class="paragraph">
<p><a href="dsf-how-to-use#Step-1---Configuration-and-services-integration.adoc">Back</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration_and_services_integration"><a class="anchor" href="#_configuration_and_services_integration"></a>Configuration and services integration</h2>
<div class="sectionbody">
<div class="sect3">
<h4 id="_nexus_configuration"><a class="anchor" href="#_nexus_configuration"></a>Nexus Configuration</h4>
<div class="paragraph">
<p>In this document you will see how you can configure Nexus repository and how to integrate it with jenkins.</p>
</div>
</div>
<div class="sect3">
<h4 id="_login_in_nexus"><a class="anchor" href="#_login_in_nexus"></a>Login in Nexus</h4>
<div class="paragraph">
<p>The first time you enter in Nexus you need to log in with the user 'admin' and the password that is inside the path: /volumes/nexus/nexus-data
Then you can change that password and create a new one.</p>
</div>
</div>
<div class="sect3">
<h4 id="_prerequisites"><a class="anchor" href="#_prerequisites"></a>Prerequisites</h4>

</div>
<div class="sect3">
<h4 id="_repositories"><a class="anchor" href="#_repositories"></a>Repositories</h4>
<div class="paragraph">
<p>You need to have one repository for snapshots, another for releases and another one for release-candidates. Normally you use maven2 (hosted) repositories and if you are going to use a docker registry, you need docker (hosted) too.</p>
</div>
<div class="paragraph">
<p>To create a repository in Nexus go to the administration clicking on the gear icon at top menu bar. Then on the left menu click on Repositories and press the <strong><em>Create repository</em></strong> button.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/configuration/nexus-create-repository.png" alt="nexus create repository">
</div>
</div>
<div class="paragraph">
<p>Now you must choose the type of the repository and configure it. This is an example for Snapshot:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/configuration/nexus-create-repository-form.png" alt="nexus create repository form">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_create_user_to_uploaddownload_content"><a class="anchor" href="#_create_user_to_uploaddownload_content"></a>Create user to upload/download content</h4>
<div class="paragraph">
<p>Once you have the repositories, you need a user to upload/download content. To do it go to the administration clicking on the gear icon at top menu bar. Then on the left menu click on Users and press the <strong><em>Create local</em></strong> user button.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/configuration/nexus-create-user.png" alt="nexus create user">
</div>
</div>
<div class="paragraph">
<p>Now you need to fill a form like this:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/configuration/nexus-create-user-form.png" alt="nexus create user form">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_jenkins_integration"><a class="anchor" href="#_jenkins_integration"></a>Jenkins integration</h4>
<div class="paragraph">
<p>To use Nexus in our pipelines you need to configure Jenkins.</p>
</div>
</div>
<div class="sect3">
<h4 id="_customize_jenkins"><a class="anchor" href="#_customize_jenkins"></a>Customize jenkins</h4>
<div class="paragraph">
<p>The first time you enter jenkins, you are asked fot the pluggins to be installed.
We select  <em>install suggested plugins</em> and later we can add the plugins that we need depending on the project necessities.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/configuration/plugins-jenkins.png" alt="plugins jenkins">
</div>
</div>
<div class="paragraph">
<p>Then we need to create our first admin user, we can do it like this:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/configuration/jenkins-first-admin-user.png" alt="jenkins first admin user">
</div>
</div>
<div class="paragraph">
<p>The next step is the jenkins URL:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/configuration/jenkins-url.png" alt="jenkins url">
</div>
</div>
<div class="paragraph">
<p>Your jenkins setup is ready!</p>
</div>
</div>
<div class="sect3">
<h4 id="_add_nexus_user_credentials"><a class="anchor" href="#_add_nexus_user_credentials"></a>Add nexus user credentials</h4>
<div class="paragraph">
<p>First of all you need to add the user created in the step before to Jenkins. To do it (on the left menu) click on Credentials, then on System. Now you could access to <strong><em>Global credentials (unrestricted)</em></strong>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/configuration/nexus-jenkins-credentials.png" alt="nexus jenkins credentials">
</div>
</div>
<div class="paragraph">
<p>Enter on it and you could see a button on the left to <strong><em>Add credentials</em></strong>. Click on it and fill a form like this:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/configuration/nexus-jenkins-credentials-form.png" alt="nexus jenkins credentials form">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_add_the_nexus_user_to_maven_global_settings"><a class="anchor" href="#_add_the_nexus_user_to_maven_global_settings"></a>Add the nexus user to maven global settings</h4>
<div class="paragraph">
<p>In order to do this, you will need the <strong>Config File Provider</strong> plugin so we need to download it.Go to Jenkins&#8594;Manage jenkins&#8594;Manage plugins and "<em>available</em>" tab and search for it:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/configuration/jenkins-config-fp.png" alt="jenkins config fp">
</div>
</div>
<div class="paragraph">
<p>Click on "Download now and install after restart".</p>
</div>
<div class="paragraph">
<p>Now you need to go to Manage Jenkins clicking on left menu and enter in <strong><em>Managed files</em></strong>.</p>
</div>
<div class="paragraph">
<p>Click on <strong>Add a new config/Global Maven settings.xml</strong>, change the id for a new one more readable:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/configuration/jenkins-maven-settings.png" alt="jenkins maven settings">
</div>
</div>
<div class="paragraph">
<p>Then click on <strong>"Submit"</strong></p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/configuration/jenkins-global-maven.png" alt="jenkins global maven">
</div>
</div>
<div class="paragraph">
<p>Edit the Global Maven settings.xml to add your nexus repositories credentials(the ones you created before) as you could see in the next image:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/configuration/nexus-jenkins-global-maven-form.png" alt="nexus jenkins global maven form">
</div>
</div>
<div class="paragraph">
<p>And you are done.</p>
</div>
</div>
<div class="sect3">
<h4 id="_sonarqube_configuration"><a class="anchor" href="#_sonarqube_configuration"></a>SonarQube Configuration</h4>
<div class="paragraph">
<p>To use SonarQube you need to use a <strong>token</strong> to connect, and to know the results of the analysis you need a <strong>webhook</strong>. Also, you need to install and configure SonarQube in Jenkins.</p>
</div>
</div>
<div class="sect3">
<h4 id="_generate_user_token"><a class="anchor" href="#_generate_user_token"></a>Generate user token</h4>
<div class="paragraph">
<p>To generate the user token, go to your account clicking in the left icon on the top menu bar.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you don&#8217;t have any account, you can use the admin/admin user/pass
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/configuration/sonarqube-administration.png" alt="sonarqube administration">
</div>
</div>
<div class="paragraph">
<p>Go to security tab and generate the token.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/configuration/sonarqube-token.png" alt="sonarqube token">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_webhook"><a class="anchor" href="#_webhook"></a>Webhook</h4>
<div class="paragraph">
<p>When you execute our SonarQube scanner in our pipeline job, you need to ask SonarQube if the quality gate has been passed. To do it you need to create a webhook.</p>
</div>
<div class="paragraph">
<p>Go to administration clicking the option on the top bar menu and select the tab for Configuration.</p>
</div>
<div class="paragraph">
<p>Then search in the left menu to go to webhook section and create your webhook.</p>
</div>
<div class="paragraph">
<p>An example for Production Line:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/configuration/sonarqube-webhook.png" alt="sonarqube webhook">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_jenkins_integration_2"><a class="anchor" href="#_jenkins_integration_2"></a>Jenkins integration</h4>
<div class="paragraph">
<p>To use SonarQube in our pipelines you need to configure Jenkins to integrate SonarQube.</p>
</div>
</div>
<div class="sect3">
<h4 id="_sonarqube_scanner"><a class="anchor" href="#_sonarqube_scanner"></a>SonarQube Scanner</h4>
<div class="paragraph">
<p>First, you need to configure the scanner. Go to Manage Jenkins clicking on left menu and enter in <strong><em>Global Tool Configuration</em></strong>.</p>
</div>
<div class="paragraph">
<p>Go to SonarQube Scanner section and add a new SonarQube scanner like this.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/configuration/sonarqube-jenkins-scanner.png" alt="sonarqube jenkins scanner">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_sonarqube_server"><a class="anchor" href="#_sonarqube_server"></a>SonarQube Server</h4>
<div class="paragraph">
<p>Now you need to configure where is our SonarQube server using the user token that you create before. Go to Manage Jenkins clicking on left menu and enter in <strong><em>Configure System</em></strong>.</p>
</div>
<div class="paragraph">
<p>For example, in Production Line the server is the next:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/configuration/sonarqube-jenkins-server.png" alt="sonarqube jenkins server">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Remember, the token was created at the beginning  of this SonarQube configuration.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_sonarqube_configuration_2"><a class="anchor" href="#_sonarqube_configuration_2"></a>SonarQube configuration</h4>
<div class="paragraph">
<p>Now is time to configure your sonar in order to measure the quality of your code. To do it, please follow the official documentation about our plugins and Quality Gates and Profiles <a href="https://github.com/devonfw/sonar-devon4j-plugin">here</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_how_to_ignore_files"><a class="anchor" href="#_how_to_ignore_files"></a>How to ignore files</h4>
<div class="paragraph">
<p>Usually the developers need to ignore some files from Sonar analysis. To do that, they must add the next line as a parameter of the sonar execution to their Jenkinsfile in the SonarQube code analysis step.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>-Dsonar.exclusions='**/*.spec.ts, **/*.model.ts, **/*mock.ts'</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_create_project"><a class="anchor" href="#_create_project"></a>Create project</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_create_and_integrate_git_repository_2"><a class="anchor" href="#_create_and_integrate_git_repository_2"></a>Create and integrate git repository</h2>
<div class="sectionbody">
<div class="paragraph">
<p>include::dsf-configure-gitlab.adoc[leveloffset=2].</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_start_new_devonfw_project_2"><a class="anchor" href="#_start_new_devonfw_project_2"></a>start new devonfw project</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is time to create your devonfw project:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>visit our <a href="https://github.com/devonfw/devonfw-tutorial-sources/wiki/build-devon4ng-application">devon4ng</a> guide.</p>
</li>
<li>
<p>visitr our <a href="https://github.com/devonfw/devonfw-tutorial-sources/wiki/build-devon4j-application">devon4j</a> guide.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_cicd_configuration_2"><a class="anchor" href="#_cicd_configuration_2"></a>cicd configuration</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_manual_configuration_2"><a class="anchor" href="#_manual_configuration_2"></a>==  Manual configuration</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_jenkinsfile_2"><a class="anchor" href="#_jenkinsfile_2"></a>== Jenkinsfile</h2>
<div class="sectionbody">
<div class="paragraph">
<p>include::dsf-configure-jenkins.adoc[leveloffset=2].</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_deployment"><a class="anchor" href="#_deployment"></a>Deployment</h2>
<div class="sectionbody">
<div class="paragraph">
<p>include::dsf-deployment-dsf4openshift.adoc[leveloffset=2].</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_annexes"><a class="anchor" href="#_annexes"></a>Annexes</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_custom_services"><a class="anchor" href="#_custom_services"></a>Custom Services</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_bitbucket"><a class="anchor" href="#_bitbucket"></a>==  BitBucket</h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>[Under construction]</em></p>
</div>
<hr>
<div class="paragraph">
<p>The purpose of the present document is to provide the basic steps carried out to setup a BitBucket server in OpenShift.</p>
</div>
<div class="sect4">
<h5 id="_introduction"><a class="anchor" href="#_introduction"></a>Introduction</h5>
<div class="paragraph">
<p>BitBucket is the Atlassian tool that extends the Git functionality, by adding integration with JIRA, Confluence, or Trello, as well as incorporates extra features for security or management of user accounts (See <a href="https://www.atlassian.com/software/bitbucket/features">BitBucket</a>).</p>
</div>
<div class="paragraph">
<p>BitBucket server is the Atlassian tool that runs the BitBucket services (See <a href="https://www.atlassian.com/software/bitbucket/server">BitBucket server</a>).</p>
</div>
<div class="paragraph">
<p>The followed approach has been not using command line, but OpenShift Web Console, by deploying the Docker image <strong>atlassian/bitbucket-server</strong> (available in <a href="https://hub.docker.com/r/atlassian/bitbucket-server/">Docker Hub</a>) in the existing project <strong>Deployment</strong>.</p>
</div>
<div class="paragraph">
<p>The procedure below exposed consists basically in three main steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Deploy the BitBucket server image (from OpenShift web console)</p>
</li>
<li>
<p>Add a route for the external traffic (from OpenShift web console)</p>
</li>
<li>
<p>Configure the BitBucket server (from BitBucket server web console)</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_prerequisites_2"><a class="anchor" href="#_prerequisites_2"></a>Prerequisites</h5>
<div class="ulist">
<ul>
<li>
<p>OpenShift up &amp; running</p>
</li>
<li>
<p>Atlassian account (with personal account key). Not required for OpenShift, but for the initial BitBucket server configuration.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_procedure"><a class="anchor" href="#_procedure"></a>Procedure</h5>

</div>
<div class="sect4">
<h5 id="_step_0_log_into_our_openshift_web_console"><a class="anchor" href="#_step_0_log_into_our_openshift_web_console"></a>Step 0: Log into our <a href="https://10.68.26.163:8443/console/logout">OpenShift Web console</a></h5>
<div class="imageblock">
<div class="content">
<img src="../_images/images/others/bitbucket/step0.png" alt="step0">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_step_1_get_into_development_project"><a class="anchor" href="#_step_1_get_into_development_project"></a>Step 1: Get into Development project</h5>
<div class="imageblock">
<div class="content">
<img src="../_images/images/others/bitbucket/step1.png" alt="]">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_step_2_1_deploy_a_new_image_to_the_project"><a class="anchor" href="#_step_2_1_deploy_a_new_image_to_the_project"></a>Step 2.1: Deploy a new image to the project</h5>
<div class="imageblock">
<div class="content">
<img src="../_images/images/others/bitbucket/step2.1.png" alt="step2.1">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_step_2_2_introduce_the_image_name_available_in_docker_hub_and_search"><a class="anchor" href="#_step_2_2_introduce_the_image_name_available_in_docker_hub_and_search"></a>Step 2.2: Introduce the image name (available in <a href="https://hub.docker.com/r/atlassian/bitbucket-server/">Docker Hub</a>) and search</h5>
<div class="paragraph">
<p>Image name: <strong>atlassian/bitbucket-server</strong></p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/others/bitbucket/step2.2.png" alt="step2.2">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_step_2_3_leave_by_the_moment_the_default_config_since_it_is_enough_for_the_basic_setup_press_create"><a class="anchor" href="#_step_2_3_leave_by_the_moment_the_default_config_since_it_is_enough_for_the_basic_setup_press_create"></a>Step 2.3: Leave by the moment the default config. since it is enough for the basic setup. Press Create</h5>
<div class="imageblock">
<div class="content">
<img src="../_images/images/others/bitbucket/step2.3.png" alt="step2.3">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_step_2_4_copy_the_oc_commands_in_case_it_is_required_to_work_via_command_line_and_go_to_overview"><a class="anchor" href="#_step_2_4_copy_the_oc_commands_in_case_it_is_required_to_work_via_command_line_and_go_to_overview"></a>Step 2.4: Copy the oc commands in case it is required to work via command line, and Go to overview</h5>
<div class="imageblock">
<div class="content">
<img src="../_images/images/others/bitbucket/step2.4.png" alt="step2.4">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_step_2_5_wait_until_openshift_deploys_and_starts_up_the_image_all_the_info_will_be_available"><a class="anchor" href="#_step_2_5_wait_until_openshift_deploys_and_starts_up_the_image_all_the_info_will_be_available"></a>Step 2.5: Wait until OpenShift deploys and starts up the image. All the info will be available.</h5>
<div class="paragraph">
<p>Please notice that there are no pre-configured routes, hence the application is not accessible from outside the cluster.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/others/bitbucket/step2.5.png" alt="step2.5">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_step_3_create_a_route_in_order_for_the_application_to_be_accessible_from_outside_the_cluster_external_traffic_press_create"><a class="anchor" href="#_step_3_create_a_route_in_order_for_the_application_to_be_accessible_from_outside_the_cluster_external_traffic_press_create"></a>Step 3: Create a route in order for the application to be accessible from outside the cluster (external traffic). Press Create</h5>
<div class="paragraph">
<p>Please notice that there are different fields that can be specified (hostname, port). If required, the value of those fields can be modified later.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/others/bitbucket/step3a.png" alt="step3a">
</div>
</div>
<div class="paragraph">
<p>Leave by the moment the default config. as it is enough for the basic setup.</p>
</div>
<div class="paragraph">
<p>The route for external traffic is now available.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/others/bitbucket/step3b.png" alt="step3b">
</div>
</div>
<hr>
<div class="paragraph">
<p>Now the BitBucker server container is up &amp; running in our cluster.</p>
</div>
<div class="paragraph">
<p>The below steps correspond to the basic configuration of our BitBucket server.</p>
</div>
<hr>
</div>
<div class="sect4">
<h5 id="_step_4_1_click_on_the_link_of_the_external_traffic_route_this_will_open_our_bitbucket_server_setup_wizard"><a class="anchor" href="#_step_4_1_click_on_the_link_of_the_external_traffic_route_this_will_open_our_bitbucket_server_setup_wizard"></a>Step 4.1: Click on the link of the external traffic route. This will open our BitBucket server setup wizard</h5>

</div>
<div class="sect4">
<h5 id="_step_4_2_leave_by_the_moment_the_internal_database_since_it_is_enough_for_the_basic_setup_and_it_can_be_modified_later_and_click_next"><a class="anchor" href="#_step_4_2_leave_by_the_moment_the_internal_database_since_it_is_enough_for_the_basic_setup_and_it_can_be_modified_later_and_click_next"></a>Step 4.2: Leave by the moment the Internal database since it is enough for the basic setup (and it can be modified later), and click Next</h5>
<div class="imageblock">
<div class="content">
<img src="../_images/images/others/bitbucket/step4.2.png" alt="step4.2">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_step_4_3_select_the_evaluation_license_and_click_i_have_an_account"><a class="anchor" href="#_step_4_3_select_the_evaluation_license_and_click_i_have_an_account"></a>Step 4.3: Select the evaluation license, and click I have an account</h5>
<div class="imageblock">
<div class="content">
<img src="../_images/images/others/bitbucket/step4.3.png" alt="step4.3">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_step_4_4_select_the_option_bitbucker_server"><a class="anchor" href="#_step_4_4_select_the_option_bitbucker_server"></a>Step 4.4: Select the option Bitbucker (Server)</h5>
<div class="imageblock">
<div class="content">
<img src="../_images/images/others/bitbucket/step4.4.png" alt="step4.4">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_step_4_5_introduce_your_organization_capgemini_and_click_generate_license"><a class="anchor" href="#_step_4_5_introduce_your_organization_capgemini_and_click_generate_license"></a>Step 4.5: Introduce your organization (Capgemini), and click Generate License</h5>

</div>
<div class="sect4">
<h5 id="_step_4_6_confirm_that_you_want_to_install_the_license_on_the_bitbucket_server"><a class="anchor" href="#_step_4_6_confirm_that_you_want_to_install_the_license_on_the_bitbucket_server"></a>Step 4.6: Confirm that you want to install the license on the BitBucket server</h5>
<div class="imageblock">
<div class="content">
<img src="../_images/images/others/bitbucket/step4.6.png" alt="step4.6">
</div>
</div>
<div class="paragraph">
<p>The license key will be automatically generated. Click <strong>Next</strong></p>
</div>
</div>
<div class="sect4">
<h5 id="_step_4_7_introduce_the_details_of_the_administration_account"><a class="anchor" href="#_step_4_7_introduce_the_details_of_the_administration_account"></a>Step 4.7: Introduce the details of the Administration account.</h5>
<div class="paragraph">
<p>Since our BitBucket server is not going to be integrated with JIRA, click on Go to Bitbucket. The integration with JIRA can be configured later.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/others/bitbucket/step4.7.png" alt="step4.7">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_step_4_8_log_in_with_the_admin_account_that_has_been_just_created"><a class="anchor" href="#_step_4_8_log_in_with_the_admin_account_that_has_been_just_created"></a>Step 4.8: Log in with the admin account that has been just created</h5>

</div>
<div class="sect4">
<h5 id="_done"><a class="anchor" href="#_done"></a>DONE !!</h5>
<div class="imageblock">
<div class="content">
<img src="../_images/images/others/bitbucket/done.png" alt="done">
</div>
</div>
<div class="paragraph">
<p><em>[Under construction]</em></p>
</div>
<hr>
<div class="paragraph">
<p>The purpose of the present document is to provide the basic steps carried out to improve the configuration of BitBucket server in OpenShift.</p>
</div>
<div class="paragraph">
<p>The improved configuration consists on:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Persistent Volume Claims</p>
</li>
<li>
<p>Health Checks <em>(pending to be completed)</em></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_persistent_volume_claims"><a class="anchor" href="#_persistent_volume_claims"></a>Persistent Volume Claims.</h5>
<div class="paragraph">
<p>Please notice that the BitBucket server container does not use persistent volume claims by default, which means that the data (e.g.: BitBucket server config.) will be lost from one deployment to another.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/others/bitbucket/xtraconfig/pvc0.png" alt="pvc0">
</div>
</div>
<div class="paragraph">
<p><strong>It is very important to create a persistent volume claim in order to prevent the mentioned loss of data.</strong></p>
</div>
</div>
<div class="sect4">
<h5 id="_step_1_add_storage"><a class="anchor" href="#_step_1_add_storage"></a>Step 1: Add storage</h5>
<div class="imageblock">
<div class="content">
<img src="../_images/images/others/bitbucket/xtraconfig/pvc1.png" alt="pvc1">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_step_2_select_the_appropriate_storage_or_create_it_from_scratch_if_necessary"><a class="anchor" href="#_step_2_select_the_appropriate_storage_or_create_it_from_scratch_if_necessary"></a>Step 2: Select the appropriate storage, or create it from scratch if necessary</h5>
<div class="imageblock">
<div class="content">
<img src="../_images/images/others/bitbucket/xtraconfig/pvc2.png" alt="pvc2">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_step_3_introduce_the_required_information"><a class="anchor" href="#_step_3_introduce_the_required_information"></a>Step 3: Introduce the required information</h5>
<div class="ulist">
<ul>
<li>
<p><strong>Path</strong> as it is specified in the <a href="https://hub.docker.com/r/atlassian/bitbucket-server/">BitBucket server Docker image</a> (/var/atlassian/application-data/bitbucket)</p>
</li>
<li>
<p><strong>Volume name</strong> with a unique name to clearly identify the volume</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/others/bitbucket/xtraconfig/pvc3.png" alt="pvc3">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_the_change_will_be_inmediately_applied"><a class="anchor" href="#_the_change_will_be_inmediately_applied"></a>The change will be inmediately applied</h5>
<div class="imageblock">
<div class="content">
<img src="../_images/images/others/bitbucket/xtraconfig/done.png" alt="done">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_mirabaud_cicd_environment_setup"><a class="anchor" href="#_mirabaud_cicd_environment_setup"></a>Mirabaud CICD Environment Setup</h4>
<div class="paragraph">
<p>Initial requirements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>OS</strong>: RHEL 6.5</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Remote setup in CI machine (located in the Netherlands)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>    - Jenkins
    - Nexus
    - GitLab
    - Mattermost
    - Atlassian Crucible
    - SonarQube</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_1_install_docker_and_docker_compose_in_rhel_6_5"><a class="anchor" href="#_1_install_docker_and_docker_compose_in_rhel_6_5"></a>1. Install Docker and Docker Compose in RHEL 6.5</h4>

</div>
<div class="sect3">
<h4 id="_docker"><a class="anchor" href="#_docker"></a>Docker</h4>
<div class="paragraph">
<p>Due to that OS version, the only way to have Docker running in the CI machine is by installing it from the <strong>EPEL</strong> repository (Extra Packages for Enterprise Linux).</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>Add EPEL</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>##rpm -iUvh http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Install <code>docker.io</code> from that repository</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>##yum -y install docker-io</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Start Docker daemon</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>##service docker start</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Check the installation</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>##docker -v
Docker version 1.7.1, build 786b29d/1.7.1</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_docker_compose"><a class="anchor" href="#_docker_compose"></a>Docker Compose</h4>
<div class="paragraph">
<p>Download and install it via <strong>curl</strong>. It will use <a href="https://github.com/docker/compose/releases?after=1.7.0-rc2">this site</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>##curl -L https://github.com/docker/compose/releases/download/1.5.0/docker-compose-`uname -s`-`uname -m` &gt; /usr/local/bin/docker-compose

##chmod +x /usr/local/bin/docker-compose</code></pre>
</div>
</div>
<div class="paragraph">
<p>Add it to your <code>sudo</code> path:</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>Find out where it is:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>##echo $PATH</pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Copy the <code>docker-compose</code> file from <code>/usr/local/bin/</code> to your <code>sudo</code> PATH.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>##docker-compose -v
docker-compose version 1.5.2, build 7240ff3</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_2_directories_structure"><a class="anchor" href="#_2_directories_structure"></a>2. Directories structure</h4>
<div class="paragraph">
<p>Several directories had been added to organize some files related to docker (like <code>docker-compose.yml</code>) and docker volumes for each service. Here&#8217;s how it looks:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">/home
    /[username]
        /jenkins
            /volumes
                /jenkins_home
        /sonarqube
            /volumes
                /conf
                /data
                /extensions
                /lib
                    /bundled-plugins
        /nexus
            /volumes
                /nexus-data
        /crucible
            /volumes
                /
        /gitlab
            docker-compose.yml
            /volumes
                /etc
                    /gitlab
                /var
                    /log
                    /opt
        /mattermost
            docker-compose.yml
            /volumes
                /db
                    /var
                        /lib
                            /postgresql
                                /data
                /app
                    /mattermost
                        /config
                        /data
                        /logs
                /web
                    /cert</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_3_cicd_services_with_docker"><a class="anchor" href="#_3_cicd_services_with_docker"></a>3. CICD Services with Docker</h4>
<div class="paragraph">
<p>Some naming conventions had been followed as naming containers as <code>mirabaud_[service]</code>.</p>
</div>
<div class="paragraph">
<p>Several folders have been created to store each service&#8217;s volumes, <code>docker-compose.yml</code>(s), extra configuration settings and so on:</p>
</div>
</div>
<div class="sect3">
<h4 id="_jenkins"><a class="anchor" href="#_jenkins"></a>Jenkins</h4>

</div>
<div class="sect3">
<h4 id="_command"><a class="anchor" href="#_command"></a>==  Command</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>##docker run -d -p 8080:8080 -p 50000:50000 --name=mirabaud_jenkins \
    -v /home/[username]/jenkins/volumes/jenkins_home:/var/jenkins_home \
    jenkins</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_generate_keystore"><a class="anchor" href="#_generate_keystore"></a>==  Generate keystore</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>keytool -importkeystore -srckeystore server.p12 -srcstoretype pkcs12 -srcalias 1 -destkeystore newserver.jks -deststoretype jks -destalias server</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_start_jekins_with_ssl_todo_make_a_docker_compose_yml_for_this"><a class="anchor" href="#_start_jekins_with_ssl_todo_make_a_docker_compose_yml_for_this"></a>==  Start jekins with SSL (TODO: make a docker-compose.yml for this):</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>sudo docker run -d --name mirabaud_jenkins -v /jenkins:/var/jenkins_home -p 8080:8443 jenkins --httpPort=-1 --httpsPort=8443 --httpsKeyStore=/var/jenkins_home/certs/keystore.jks --httpsKeyStorePassword=Mirabaud2017</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_volumes"><a class="anchor" href="#_volumes"></a>==  Volumes</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>volumes/jenkins_home:/var/jenkins_home</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_sonarqube"><a class="anchor" href="#_sonarqube"></a>SonarQube</h4>

</div>
<div class="sect3">
<h4 id="_command_2"><a class="anchor" href="#_command_2"></a>==  Command</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>##docker run -d -p 9000:9000 -p 9092:9092 --name=mirabaud_sonarqube \
    -v /home/[username]/sonarqube/volumes/conf:/opt/sonarqube/conf \
    -v /home/[username]/sonarqube/volumes/data:/opt/sonarqube/data \
    -v /home/[username]/sonarqube/volumes/extensions:/opt/sonarqube/extensions \
    -v /home/[username]/sonarqube/volumes/lib/bundled-plugins:/opt/sonarqube//lib/bundled-plugins \
    sonarqube</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_volumes_2"><a class="anchor" href="#_volumes_2"></a>==  Volumes</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>volumes/conf:/opt/sonarqube/conf
volumes/data:/opt/sonarqube/data
volumes/extensions:/opt/sonarqube/extensions
volumes/lib/bundled-plugins:/opt/sonarqube/lib/bundled-plugins</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_nexus"><a class="anchor" href="#_nexus"></a>Nexus</h4>

</div>
<div class="sect3">
<h4 id="_command_3"><a class="anchor" href="#_command_3"></a>==  Command</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>##docker run -d -p 8081:8081 --name=mirabaud_nexus\
    -v /home/[username]/nexus/nexus-data:/sonatype-work
    sonatype/nexus</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_volumes_3"><a class="anchor" href="#_volumes_3"></a>==  Volumes</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>volumes/nexus-data/:/sonatype-work</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_atlassian_crucible"><a class="anchor" href="#_atlassian_crucible"></a>Atlassian Crucible</h4>

</div>
<div class="sect3">
<h4 id="_command_4"><a class="anchor" href="#_command_4"></a>==  Command</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>##docker run -d -p 8084:8080 --name=mirabaud_crucible \
    -v /home/[username]/crucible/volumes/data:/atlassian/data/crucible
    mswinarski/atlassian-crucible:latest</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_volumes_4"><a class="anchor" href="#_volumes_4"></a>==  Volumes</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>volumes/data:/atlassian/data/crucible</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_4_cicd_services_with_docker_compose"><a class="anchor" href="#_4_cicd_services_with_docker_compose"></a>4. CICD Services with Docker Compose</h4>
<div class="paragraph">
<p>Both Services had been deploying by using the <code># docker-compose up -d</code> command from their root directories (<code>/gitlab</code> and <code>/mattermost</code>). The syntax of the two <code>docker-compose.yml</code> files is the one corresponding with the 1st version (due to the <code>docker-compose v1.5</code>).</p>
</div>
</div>
<div class="sect3">
<h4 id="_gitlab"><a class="anchor" href="#_gitlab"></a>GitLab</h4>

</div>
<div class="sect3">
<h4 id="_docker_compose_yml"><a class="anchor" href="#_docker_compose_yml"></a>==  <code>docker-compose.yml</code></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">mirabaud:
    image: 'gitlab/gitlab-ce:latest'
    restart: always
    ports:
            - '8888:80'
    volumes:
            - '/home/[username]/gitlab/volumes/etc/gilab:/etc/gitlab'
            - '/home/[username]/gitlab/volumes/var/log:/var/log/gitlab'
            - '/home/[username]/gitlab/volumes/var/opt:/var/opt/gitlab'</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_command_docker"><a class="anchor" href="#_command_docker"></a>==  Command (docker)</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>docker run -d -p 8888:80 --name=mirabaud_gitlab \
    -v /home/[username]/gitlab/volumes/etc/gitlab/:/etc/gitlab \
    -v /home/[username]/gitlab/volumes/var/log:/var/log/gitlab \
    -v /home/[username]/gitlab/volumes/var/opt:/var/opt/gitlab \
    gitlab/gitlab-ce</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_volumes_5"><a class="anchor" href="#_volumes_5"></a>==  Volumes</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>volumes/etc/gitlab:/etc/gitlab
volumes/var/opt:/var/log/gitlab
volumes/var/log:/var/log/gitlab</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_mattermost"><a class="anchor" href="#_mattermost"></a>Mattermost</h4>

</div>
<div class="sect3">
<h4 id="_docker_compose_yml_2"><a class="anchor" href="#_docker_compose_yml_2"></a>==  <code>docker-compose.yml</code>:</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">db:
  image: mattermost/mattermost-prod-db
  restart: unless-stopped
  volumes:
    - ./volumes/db/var/lib/postgresql/data:/var/lib/postgresql/data
    - /etc/localtime:/etc/localtime:ro
  environment:
    - POSTGRES_USER=mmuser
    - POSTGRES_PASSWORD=mmuser_password
    - POSTGRES_DB=mattermost

app:
  image: mattermost/mattermost-prod-app
  links:
    - db:db
  restart: unless-stopped
  volumes:
    - ./volumes/app/mattermost/config:/mattermost/config:rw
    - ./volumes/app/mattermost/data:/mattermost/data:rw
    - ./volumes/app/mattermost/logs:/mattermost/logs:rw
    - /etc/localtime:/etc/localtime:ro
  environment:
    - MM_USERNAME=mmuser
    - MM_PASSWORD=mmuser_password
    - MM_DBNAME=mattermost

web:
  image: mattermost/mattermost-prod-web
  ports:
    - "8088:80"
    - "8089:443"
  links:
    - app:app
  restart: unless-stopped
  volumes:
    - ./volumes/web/cert:/cert:ro
    - /etc/localtime:/etc/localtime:ro</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ssl_certificate"><a class="anchor" href="#_ssl_certificate"></a>==  SSL Certificate</h4>
<div class="paragraph">
<p>How to generate the certificates:</p>
</div>
<div class="paragraph">
<p>Get the <strong>crt</strong> and <strong>key</strong> from CA or <strong>generate a new one self-signed</strong>. Then:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>// 1. create the p12 keystore
##openssl pkcs12 -export -in cert.crt -inkey mycert.key -out certkeystore.p12

// 2. export the pem certificate with password
##openssl pkcs12 -in certkeystore.p12 -out cert.pem

// 3. export the pem certificate without password
##openssl rsa -in cert.pem -out key-no-password.pem</code></pre>
</div>
</div>
<div class="paragraph">
<p>SSL:</p>
</div>
<div class="paragraph">
<p>Copy the cert and the key without password at:</p>
</div>
<div class="paragraph">
<p><code>./volumes/web/cert/cert.pem</code></p>
</div>
<div class="paragraph">
<p>and</p>
</div>
<div class="paragraph">
<p><code>./volumes/web/cert/key-no-password.pem</code></p>
</div>
<div class="paragraph">
<p>Restart the server and the SSL should be enabled at port <strong>8089</strong> using <strong>HTTPS</strong>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_volumes_6"><a class="anchor" href="#_volumes_6"></a>==  Volumes</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>-- db --
volumes/db/var/lib/postgresql/data:/var/lib/postgresql/data
/etc/localtime:/etc/localtime:ro                                # absolute path

-- app --
volumes/app/mattermost/config:/mattermost/config:rw
volumes/app/mattermost/data:/mattermost/data:rw
volumes/app/mattermost/logs:/mattermost/logs:rw
/etc/localtime:/etc/localtime:ro                                # absolute path

-- web --
volumes/web/cert:/cert:ro
/etc/localtime:/etc/localtime:ro                                # absolute path</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_5_service_integration"><a class="anchor" href="#_5_service_integration"></a>5. Service Integration</h4>
<div class="paragraph">
<p>All integrations had been done following <strong>CICD Services Integration</strong> guides:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="dsf-mirabaud-jenkins-nexus-integration.adoc">Jenkins - Nexus integration</a></p>
</li>
<li>
<p><a href="dsf-mirabaud-jenkins-gitLab-integration.adoc">Jenkins - GitLab integration</a></p>
</li>
<li>
<p><a href="dsf-mirabaud-jenkins-sonarQube-integration.adoc">Jenkins - SonarQube integration</a></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
These guides may be obsolete. You can find here the <a href="dsf-how-to-use#Step-1---Configuration-and-service-integration.adoc">official configuration guides</a>,
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_jenkins_gitlab_integration"><a class="anchor" href="#_jenkins_gitlab_integration"></a>Jenkins - GitLab integration</h5>
<div class="paragraph">
<p>The first step to have a Continuous Integration system for your development is to make sure that all your changes to your team&#8217;s remote repository are evaluated by the time they are pushed. That usually implies the usage of so-called <em>webhooks</em>. You&#8217;ll find a fancy explanation about what Webhooks are in <a href="http://culttt.com/2014/01/22/webhooks/">here</a>.</p>
</div>
<div class="paragraph">
<p>To resume what we&#8217;re doing here, we are going to prepare our Jenkins and our GitLab so when a developer pushes some changes to the GitLab repository, a pipeline in Jenkins gets triggered. Just like that, in an automatic way.</p>
</div>
</div>
<div class="sect4">
<h5 id="_1_jenkins_gitlab_plugin"><a class="anchor" href="#_1_jenkins_gitlab_plugin"></a>1. Jenkins GitLab plugin</h5>
<div class="paragraph">
<p>As it usually happens, some Jenkins plug-in(s) must be installed. In this case, let&#8217;s install those related with GitLab:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/others/jenkins-gitlab/jenkins-gitlab-plugins.png" alt="jenkins gitlab plugins">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_2_gitlab_api_token"><a class="anchor" href="#_2_gitlab_api_token"></a>2. GitLab API Token</h5>
<div class="paragraph">
<p>To communicate with GitLab from Jenkins, we will need to create an authentication token from your GitLab user settings. A good practice for this would be to create it from a <em>machine user</em>. Something like (i.e.) <code>devonfw-ci/******</code>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/others/jenkins-gitlab/gitlab-access-token.png" alt="gitlab access token">
</div>
</div>
<div class="paragraph">
<p>Simply by adding a name to it and a date for it expire is enough:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/others/jenkins-gitlab/gitlab-access-token-generation.png" alt="gitlab access token generation">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/others/jenkins-gitlab/gitlab-access-token-generated.png" alt="gitlab access token generated">
</div>
</div>
<div class="paragraph">
<p>As GitLab said, you should make sure you don&#8217;t lose your token. Otherwise you would need to create a new one.</p>
</div>
<div class="paragraph">
<p>This will allow Jenkins to connect with right permissions to our GitLab server.</p>
</div>
</div>
<div class="sect4">
<h5 id="_3_create_gitlab_api_token_credentials"><a class="anchor" href="#_3_create_gitlab_api_token_credentials"></a>3. Create "GitLab API" Token credentials</h5>
<div class="paragraph">
<p>Those credentials will use that token already generated in GitLab to connect once we declare the GitLab server in the Global Jenkins configuration. Obviously, those credentials must be <strong>GitLab API token</strong>-like.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/others/jenkins-gitlab/jenkins-gitlab-api-token-credentials-kind.png" alt="jenkins gitlab api token credentials kind">
</div>
</div>
<div class="paragraph">
<p>Then, we add the generated token in the <code>API token</code> field:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/others/jenkins-gitlab/jenkins-gitlab-api-token-credentials-complete.png" alt="jenkins gitlab api token credentials complete">
</div>
</div>
<div class="paragraph">
<p>Look in your Global credentials if they had been correctly created:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/others/jenkins-gitlab/jenkins-gitlab-api-token-credentials.png" alt="jenkins gitlab api token credentials">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_4_create_gitlab_connection_in_jenkins"><a class="anchor" href="#_4_create_gitlab_connection_in_jenkins"></a>4. Create GitLab connection in Jenkins</h5>
<div class="paragraph">
<p>Specify a GitLab connection in your Jenkins&#8217;s <code>Manage Jenkins &gt; Configure System</code> configuration. This will tell Jenkins where is our GitLab server, a user to access it from and so on.</p>
</div>
<div class="paragraph">
<p>You&#8217;ll need to give it a name, for example, related with what this GitLab is dedicated for (specific clients, internal projects&#8230;&#8203;). Then, the <code>Gitlab host URL</code> is just where your GitLab server is. If you have it locally, that field should look similar to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Connection name: <code>my-local-gitlab</code></p>
</li>
<li>
<p>Gitlab host URL: <code>http://localhost:${PORT_NUMBER}</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Finally, we select our recently GitLab API token as credentials.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/others/jenkins-gitlab/jenkins-gitlab-connection.png" alt="jenkins gitlab connection">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_5_jenkins_pipeline_changes"><a class="anchor" href="#_5_jenkins_pipeline_changes"></a>5. Jenkins Pipeline changes</h5>

</div>
<div class="sect4">
<h5 id="_5_1_choose_gitlab_connection_in_pipelines_general_configuration"><a class="anchor" href="#_5_1_choose_gitlab_connection_in_pipelines_general_configuration"></a>5.1 Choose GitLab connection in Pipeline&#8217;s General configuration</h5>
<div class="paragraph">
<p>First, our pipeline should allow us to add a GitLab connection to connect to (the already created one).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/others/jenkins-gitlab/jenkins-pipeline-gitlab-connection.png" alt="jenkins pipeline gitlab connection">
</div>
</div>
<div class="paragraph">
<p>In the case of the local example, could be like this:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>GitLab connection: <code>my-local-gitlab</code></p>
</li>
<li>
<p>GitLab Repository Name: <code>myusername/webhook-test</code> (for example)</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_5_2_create_a_build_trigger"><a class="anchor" href="#_5_2_create_a_build_trigger"></a>5.2 Create a Build Trigger</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>You should already see your GitLab project&#8217;s URL (as you stated in the General settings of the Pipeline).</p>
</li>
<li>
<p>Write <code>.*build.*</code> in the comment for triggering a build</p>
</li>
<li>
<p>Specify or filter the branch of your repo you want use as target. That means, whenever a git action is done to that branch (for example, <code>master</code>), this Pipeline is going to be built.</p>
</li>
<li>
<p>Generate a Secret token (to be added in the yet-to-be-created GitLab webhook).</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/others/jenkins-gitlab/jenkins-pipeline-build-trigger.png" alt="jenkins pipeline build trigger">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_6_gitlab_webhook"><a class="anchor" href="#_6_gitlab_webhook"></a>6. GitLab Webhook</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Go to you GitLab project&#8217;s <code>Settings &gt; Integration</code> section.</p>
</li>
<li>
<p>Add the path to your Jenkins Pipeline. Make sure you add <strong>project</strong> instead of <strong>job</strong> in the path.</p>
</li>
<li>
<p>Paste the generated Secret token of your Jenkins pipeline</p>
</li>
<li>
<p>Select your git action that will trigger the build.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/others/jenkins-gitlab/gitlab-webhook.png" alt="gitlab webhook">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_7_results"><a class="anchor" href="#_7_results"></a>7. Results</h5>
<div class="paragraph">
<p>After all those steps you should have a result similar to this in your Pipeline:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/others/jenkins-gitlab/jenkins-pipeline-result.png" alt="jenkins pipeline result">
</div>
</div>
<div class="paragraph">
<p>Enjoy the Continuous Integration! :)</p>
</div>
</div>
<div class="sect4">
<h5 id="_jenkins_nexus_integration"><a class="anchor" href="#_jenkins_nexus_integration"></a>Jenkins - Nexus integration</h5>
<div class="paragraph">
<p>Nexus is used to both host dependencies for devonfw projects to download (common Maven ones, custom ones such as <code>ojdb</code> and even devonfw so-far-IP modules). Moreover, it will host our projects' build artifacts (<code>.jar</code>, <code>.war</code>, &#8230;&#8203;) and expose them for us to download, wget and so on. A team should have a bidirectional relation with its Nexus repository.</p>
</div>
</div>
<div class="sect4">
<h5 id="_1_jenkins_credentials_to_access_nexus"><a class="anchor" href="#_1_jenkins_credentials_to_access_nexus"></a>1. Jenkins credentials to access Nexus</h5>
<div class="paragraph">
<p>By default, when Nexus is installed, it contains 3 user credentials for different purposes. The admin ones look like this: <code>admin/admin123</code>. There are also other 2: <code>deployment/deployment123</code> and <code>TODO</code>.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>// ADD USER TABLE IMAGE FROM NEXUS</pre>
</div>
</div>
<div class="paragraph">
<p>In this case, let&#8217;s use the ones with the greater permissions: <code>admin/admin123</code>.</p>
</div>
<div class="paragraph">
<p>Go to <code>Credentials &gt; System</code> (left sidebar of Jenkins) then to <code>Global credentials (unrestricted)</code> on the page table and on the left sidebar again click on <code>Add Credentials</code>.</p>
</div>
<div class="paragraph">
<p>This should be shown in your Jenkins:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/others/jenkins-nexus/jenkins-new-nexus-credentials.png" alt="jenkins new nexus credentials">
</div>
</div>
<div class="paragraph">
<p>Fill the form like this:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/others/jenkins-nexus/jenkins-new-nexus-credentials-filled.png" alt="jenkins new nexus credentials filled">
</div>
</div>
<div class="paragraph">
<p>And click in OK to create them. Check if the whole thing went as expected:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/others/jenkins-nexus/jenkins-new-nexus-credentials-completed.png" alt="jenkins new nexus credentials completed">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_2_jenkins_maven_settings"><a class="anchor" href="#_2_jenkins_maven_settings"></a>2. Jenkins Maven Settings</h5>
<div class="paragraph">
<p>Those settings are also configured (or maybe not-yet-configured) in our <strong>devonfw distributions</strong> in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>/${devonfw-dist-path}
    /software
        /maven
            /conf
                settings.xml</code></pre>
</div>
</div>
<div class="paragraph">
<p>Go to <code>Manage Jenkins &gt; Managed files</code> and select <code>Add a new Config</code> in the left sidebar.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/others/jenkins-nexus/jenkins-new-maven-settings.png" alt="jenkins new maven settings">
</div>
</div>
<div class="paragraph">
<p>The ID field will get automatically filled with a unique value if you don&#8217;t set it up. No problems about that. Click on <code>Submit</code> and let&#8217;s create some Servers Credentials:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/others/jenkins-nexus/jenkins-new-maven-settings-servers.png" alt="jenkins new maven settings servers">
</div>
</div>
<div class="paragraph">
<p>Those <strong>Server Credentials</strong> will allow Jenkins to access to the different repositories/servers that are going to be declared afterwards.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s create 4 server credentials.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>my.nexus</code>: Will serve as general profile for <strong>Maven</strong>.</p>
</li>
<li>
<p><code>mynexus.releases</code>: When a <code>mvn deploy</code> process is executed, this will tell <strong>Maven</strong> where to push <strong>releases</strong> to.</p>
</li>
<li>
<p><code>mynexus.snapshots</code>: The same as before, but with <strong>snapshots</strong> instead.</p>
</li>
<li>
<p><code>mynexus.central</code>: Just in case we want to install an specific dependency that is not by default in the Maven Central repository (such as <code>ojdbc</code>), Maven will point to it instead.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/others/jenkins-nexus/jenkins-new-maven-settings-servers-credentials.png" alt="jenkins new maven settings servers credentials">
</div>
</div>
<div class="paragraph">
<p>A more or less complete Jenkins Maven settings would look look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;settings xmlns="http://maven.apache.org/SETTINGS/1.0.0"
          xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
          xsi:schemaLocation="http://maven.apache.org/SETTINGS/1.0.0 http://maven.apache.org/xsd/settings-1.0.0.xsd"&gt;

    &lt;mirrors&gt;
        &lt;mirror&gt;
            &lt;id&gt;mynexus.central&lt;/id&gt;
            &lt;mirrorOf&gt;central&lt;/mirrorOf&gt;
            &lt;name&gt;central&lt;/name&gt;
            &lt;url&gt;http://${URL-TO-YOUR-NEXUS-REPOS}/central&lt;/url&gt;
        &lt;/mirror&gt;
    &lt;/mirrors&gt;

    &lt;profiles&gt;
        &lt;profile&gt;
            &lt;id&gt;my.nexus&lt;/id&gt;
            &lt;!-- 3 REPOS ARE DECLARED --&gt;
            &lt;repositories&gt;
                &lt;repository&gt;
                    &lt;id&gt;mynexus.releases&lt;/id&gt;
                    &lt;name&gt;mynexus Releases&lt;/name&gt;
                    &lt;url&gt;http://${URL-TO-YOUR-NEXUS-REPOS}/releases&lt;/url&gt;
                    &lt;releases&gt;
                        &lt;enabled&gt;true&lt;/enabled&gt;
                        &lt;updatePolicy&gt;always&lt;/updatePolicy&gt;
                    &lt;/releases&gt;
                    &lt;snapshots&gt;
                        &lt;enabled&gt;false&lt;/enabled&gt;
                        &lt;updatePolicy&gt;always&lt;/updatePolicy&gt;
                    &lt;/snapshots&gt;
                &lt;/repository&gt;
                &lt;repository&gt;
                    &lt;id&gt;mynexus.snapshots&lt;/id&gt;
                    &lt;name&gt;mynexus Snapshots&lt;/name&gt;
                    &lt;url&gt;http://${URL-TO-YOUR-NEXUS-REPOS}/snapshots&lt;/url&gt;
                    &lt;releases&gt;
                        &lt;enabled&gt;false&lt;/enabled&gt;
                        &lt;updatePolicy&gt;always&lt;/updatePolicy&gt;
                    &lt;/releases&gt;
                    &lt;snapshots&gt;
                        &lt;enabled&gt;true&lt;/enabled&gt;
                        &lt;updatePolicy&gt;always&lt;/updatePolicy&gt;
                    &lt;/snapshots&gt;
                &lt;/repository&gt;
            &lt;/repositories&gt;
            &lt;pluginRepositories&gt;
                &lt;pluginRepository&gt;
                    &lt;id&gt;public&lt;/id&gt;
                    &lt;name&gt;Public Repositories&lt;/name&gt;
                    &lt;url&gt;http://${URL-TO-YOUR-NEXUS}/nexus/content/groups/public/&lt;/url&gt;
                    &lt;releases&gt;
                        &lt;enabled&gt;true&lt;/enabled&gt;
                        &lt;updatePolicy&gt;always&lt;/updatePolicy&gt;
                    &lt;/releases&gt;
                    &lt;snapshots&gt;
                        &lt;enabled&gt;true&lt;/enabled&gt;
                        &lt;updatePolicy&gt;always&lt;/updatePolicy&gt;
                    &lt;/snapshots&gt;
                &lt;/pluginRepository&gt;
            &lt;/pluginRepositories&gt;
        &lt;/profile&gt;
    &lt;/profiles&gt;
    &lt;!-- HERE IS WHERE WE TELL MAVEN TO CHOOSE THE my.nexus PROFILE --&gt;
    &lt;activeProfiles&gt;
        &lt;activeProfile&gt;my.nexus&lt;/activeProfile&gt;
    &lt;/activeProfiles&gt;
&lt;/settings&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_3_use_it_in_jenkins_pipelines"><a class="anchor" href="#_3_use_it_in_jenkins_pipelines"></a>3. Use it in Jenkins Pipelines</h5>

</div>
<div class="sect4">
<h5 id="_jenkins_sonarqube_integration"><a class="anchor" href="#_jenkins_sonarqube_integration"></a>Jenkins - SonarQube integration</h5>
<div class="paragraph">
<p>First thing is installing both tools by, for example, Docker or Docker Compose. Then, we have to think about how they should collaborate to create a more efficient Continuous Integration process.</p>
</div>
<div class="paragraph">
<p>Once our project&#8217;s pipeline is triggered (it could also be triggered in a fancy way, such as when a merge to the <code>develop</code> branch is done).</p>
</div>
</div>
<div class="sect4">
<h5 id="_1_jenkins_sonarqube_plugin"><a class="anchor" href="#_1_jenkins_sonarqube_plugin"></a>1. Jenkins SonarQube plugin</h5>
<div class="paragraph">
<p>Typically in those integration cases, Jenkins plug-in installations become a <strong>must</strong>. Let&#8217;s look for some available SonarQube plug-in(s) for Jenkins:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/others/jenkins-sonarqube/jenkins-sonarqube-plugin.png" alt="jenkins sonarqube plugin">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_2_sonarqube_token"><a class="anchor" href="#_2_sonarqube_token"></a>2. SonarQube token</h5>
<div class="paragraph">
<p>Once installed let&#8217;s create a <strong>token</strong> in SonarQube so that Jenkins can communicate with it to trigger their Jobs. Once we install SonarQube in our CI/CD machine (ideally a remote machine) let&#8217;s login with <code>admin/admin</code> credentials:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/others/jenkins-sonarqube/sonarqube-login.png" alt="sonarqube login">
</div>
</div>
<div class="paragraph">
<p>Afterwards, SonarQube itself asks you to create this token we talked about (the name is up to you):</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/others/jenkins-sonarqube/sonarqube-token-name.png" alt="sonarqube token name">
</div>
</div>
<div class="paragraph">
<p>Then a token is generated:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/others/jenkins-sonarqube/sonarqube-token-generation.png" alt="sonarqube token generation">
</div>
</div>
<div class="paragraph">
<p>You click in "continue" and the token&#8217;s generation is completed:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/others/jenkins-sonarqube/sonarqube-token-done.png" alt="sonarqube token done">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_3_jenkins_sonarqube_server_setup"><a class="anchor" href="#_3_jenkins_sonarqube_server_setup"></a>3. Jenkins SonarQube Server setup</h5>
<div class="paragraph">
<p>Now we need to tell Jenkins where is SonarQube and how to communicate with it. In <code>Manage Jenkins &gt; Configure Settings</code>. We add a name for the server (up to you), where it is located (URL), version and the Server authentication token created in point 2.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/others/jenkins-sonarqube/jenkins-sonarqube-server-setup.png" alt="jenkins sonarqube server setup">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_4_jenkins_sonarqube_scanner"><a class="anchor" href="#_4_jenkins_sonarqube_scanner"></a>4. Jenkins SonarQube Scanner</h5>
<div class="paragraph">
<p>Install a SonarQube Scanner as a Global tool in Jenkins to be used in the project&#8217;s pipeline.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/others/jenkins-sonarqube/jenkins-sonarqube-scanner.png" alt="jenkins sonarqube scanner">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_5_pipeline_code"><a class="anchor" href="#_5_pipeline_code"></a>5. Pipeline code</h5>
<div class="paragraph">
<p>Last step is to add the SonarQube process in our project&#8217;s Jenkins pipeline. The following code will trigger a SonarQube process that will evaluate our code&#8217;s quality looking for bugs, duplications, and so on.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">    stage 'SonarQube Analysis'
        def scannerHome = tool 'SonarQube scanner';
        sh "${scannerHome}/bin/sonar-scanner \
             -Dsonar.host.url=http://url-to-your-sq-server:9000/ \
             -Dsonar.login=[SONAR_USER] -Dsonar.password=[SONAR_PASS] \
             -Dsonar.projectKey=[PROJECT_KEY] \
             -Dsonar.projectName=[PROJECT_NAME] -Dsonar.projectVersion=[PROJECT_VERSION] \
             -Dsonar.sources=. -Dsonar.java.binaries=. \
             -Dsonar.java.source=1.8 -Dsonar.language=java"</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_6_results"><a class="anchor" href="#_6_results"></a>6. Results</h5>
<div class="paragraph">
<p>After all this, you should end up having something like this in Jenkins:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/others/jenkins-sonarqube/jenkins-sonarqube-feedback.png" alt="jenkins sonarqube feedback">
</div>
</div>
<div class="paragraph">
<p>And in SonarQube:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/others/jenkins-sonarqube/sonarqube-project-result.png" alt="sonarqube project result">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_7_changes_in_a_devonfw_project_to_execute_sonarqube_tests_with_coverage"><a class="anchor" href="#_7_changes_in_a_devonfw_project_to_execute_sonarqube_tests_with_coverage"></a>7. Changes in a devonfw project to execute SonarQube tests with Coverage</h5>
<div class="paragraph">
<p>The plugin used to have Coverage reports in the SonarQube for devonfw projects is <strong>Jacoco</strong>. There are some changes in the project&#8217;s parent <code>pom.xml</code> that are mandatory to use it.</p>
</div>
<div class="paragraph">
<p>Inside of the <code>&lt;properties&gt;</code> tag:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;properties&gt;

    (...)

    &lt;sonar.jacoco.version&gt;3.8&lt;/sonar.jacoco.version&gt;
    &lt;sonar.java.coveragePlugin&gt;jacoco&lt;/sonar.java.coveragePlugin&gt;
    &lt;sonar.core.codeCoveragePlugin&gt;jacoco&lt;/sonar.core.codeCoveragePlugin&gt;
    &lt;sonar.dynamicAnalysis&gt;reuseReports&lt;/sonar.dynamicAnalysis&gt;
    &lt;sonar.language&gt;java&lt;/sonar.language&gt;
    &lt;sonar.java.source&gt;1.7&lt;/sonar.java.source&gt;
    &lt;sonar.junit.reportPaths&gt;target/surefire-reports&lt;/sonar.junit.reportPaths&gt;
    &lt;sonar.jacoco.reportPaths&gt;target/jacoco.exec&lt;/sonar.jacoco.reportPaths&gt;
    &lt;sonar.sourceEncoding&gt;UTF-8&lt;/sonar.sourceEncoding&gt;
    &lt;sonar.exclusions&gt;
        **/generated-sources/**/*,
        **io/oasp/mirabaud/general/**/*,
        **/*Dao.java,
        **/*Entity.java,
        **/*Cto.java,
        **/*Eto.java,
        **/*SearchCriteriaTo.java,
        **/*management.java,
        **/*SpringBootApp.java,
        **/*SpringBootBatchApp.java,
        **/*.xml,
        **/*.jsp
    &lt;/sonar.exclusions&gt;
    &lt;sonar.coverage.exclusions&gt;
        **io/oasp/mirabaud/general/**/*,
        **/*Dao.java,
        **/*Entity.java,
        **/*Cto.java,
        **/*Eto.java,
        **/*SearchCriteriaTo.java,
        **/*management.java,
        **/*SpringBootApp.java,
        **/*SpringBootBatchApp.java,
        **/*.xml,
        **/*.jsp
    &lt;/sonar.coverage.exclusions&gt;
    &lt;sonar.host.url&gt;http://${YOUR_SONAR_SERVER_URL}/&lt;/sonar.host.url&gt;
    &lt;jacoco.version&gt;0.7.9&lt;/jacoco.version&gt;

    &lt;war.plugin.version&gt;3.2.0&lt;/war.plugin.version&gt;
    &lt;assembly.plugin.version&gt;3.1.0&lt;/assembly.plugin.version&gt;
&lt;/properties&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course, those <code>sonar</code> amd <code>sonar.coverage</code> can/must be changed to fit with other projects.</p>
</div>
<div class="paragraph">
<p>Now add the <strong>Jacoco Listener</strong> as a dependency:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependencies&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.sonarsource.java&lt;/groupId&gt;
        &lt;artifactId&gt;sonar-jacoco-listeners&lt;/artifactId&gt;
        &lt;scope&gt;test&lt;/scope&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Plugin Management declarations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;pluginManagement&gt;
    &lt;plugins&gt;
        &lt;plugin&gt;
            &lt;groupId&gt;org.sonarsource.scanner.maven&lt;/groupId&gt;
            &lt;artifactId&gt;sonar-maven-plugin&lt;/artifactId&gt;
            &lt;version&gt;3.2&lt;/version&gt;
        &lt;/plugin&gt;
        &lt;plugin&gt;
            &lt;groupId&gt;org.jacoco&lt;/groupId&gt;
            &lt;artifactId&gt;jacoco-maven-plugin&lt;/artifactId&gt;
            &lt;version&gt;${jacoco.version}&lt;/version&gt;
        &lt;/plugin&gt;
    &lt;/plugins&gt;
&lt;pluginManagement&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Plugins:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;plugins&gt;

    (...)

    &lt;plugin&gt;
        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
        &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt;
        &lt;version&gt;2.20.1&lt;/version&gt;
        &lt;configuration&gt;
            &lt;argLine&gt;-XX:-UseSplitVerifier -Xmx2048m ${surefireArgLine}&lt;/argLine&gt;
            &lt;testFailureIgnore&gt;false&lt;/testFailureIgnore&gt;
            &lt;useFile&gt;false&lt;/useFile&gt;
            &lt;reportsDirectory&gt;${project.basedir}/${sonar.junit.reportPaths}&lt;/reportsDirectory&gt;
            &lt;argLine&gt;${jacoco.agent.argLine}&lt;/argLine&gt;
            &lt;excludedGroups&gt;${oasp.test.excluded.groups}&lt;/excludedGroups&gt;
            &lt;alwaysGenerateSurefireReport&gt;true&lt;/alwaysGenerateSurefireReport&gt;
            &lt;aggregate&gt;true&lt;/aggregate&gt;
            &lt;properties&gt;
                &lt;property&gt;
                    &lt;name&gt;listener&lt;/name&gt;
                    &lt;value&gt;org.sonar.java.jacoco.JUnitListener&lt;/value&gt;
                &lt;/property&gt;
            &lt;/properties&gt;
        &lt;/configuration&gt;
    &lt;/plugin&gt;
    &lt;plugin&gt;
        &lt;groupId&gt;org.jacoco&lt;/groupId&gt;
        &lt;artifactId&gt;jacoco-maven-plugin&lt;/artifactId&gt;
        &lt;configuration&gt;
            &lt;argLine&gt;-Xmx128m&lt;/argLine&gt;
            &lt;append&gt;true&lt;/append&gt;
            &lt;propertyName&gt;jacoco.agent.argLine&lt;/propertyName&gt;
            &lt;destFile&gt;${sonar.jacoco.reportPath}&lt;/destFile&gt;
            &lt;excludes&gt;
                &lt;exclude&gt;**/generated-sources/**/*,&lt;/exclude&gt;
                &lt;exclude&gt;**io/oasp/${PROJECT_NAME}/general/**/*&lt;/exclude&gt;
                &lt;exclude&gt;**/*Dao.java&lt;/exclude&gt;
                &lt;exclude&gt;**/*Entity.java&lt;/exclude&gt;
                &lt;exclude&gt;**/*Cto.java&lt;/exclude&gt;
                &lt;exclude&gt;**/*Eto.java&lt;/exclude&gt;
                &lt;exclude&gt;**/*SearchCriteriaTo.java&lt;/exclude&gt;
                &lt;exclude&gt;**/*management.java&lt;/exclude&gt;
                &lt;exclude&gt;**/*SpringBootApp.java&lt;/exclude&gt;
                &lt;exclude&gt;**/*SpringBootBatchApp.java&lt;/exclude&gt;
                &lt;exclude&gt;**/*.class&lt;/exclude&gt;
            &lt;/excludes&gt;
        &lt;/configuration&gt;
        &lt;executions&gt;
            &lt;execution&gt;
                &lt;id&gt;prepare-agent&lt;/id&gt;
                &lt;phase&gt;initialize&lt;/phase&gt;
                &lt;goals&gt;
                    &lt;goal&gt;prepare-agent&lt;/goal&gt;
                &lt;/goals&gt;
                &lt;configuration&gt;
                    &lt;destFile&gt;${sonar.jacoco.reportPath}&lt;/destFile&gt;
                    &lt;append&gt;true&lt;/append&gt;
                &lt;/configuration&gt;
            &lt;/execution&gt;
            &lt;execution&gt;
                &lt;id&gt;report-aggregate&lt;/id&gt;
                &lt;phase&gt;verify&lt;/phase&gt;
                &lt;goals&gt;
                    &lt;goal&gt;report-aggregate&lt;/goal&gt;
                &lt;/goals&gt;
            &lt;/execution&gt;
            &lt;execution&gt;
                &lt;id&gt;jacoco-site&lt;/id&gt;
                &lt;phase&gt;verify&lt;/phase&gt;
                &lt;goals&gt;
                    &lt;goal&gt;report&lt;/goal&gt;
                &lt;/goals&gt;
            &lt;/execution&gt;
        &lt;/executions&gt;
    &lt;/plugin&gt;
&lt;/plugins&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_jenkins_sonarqube_execution"><a class="anchor" href="#_jenkins_sonarqube_execution"></a>Jenkins SonarQube execution</h5>
<div class="paragraph">
<p>If the previous configuration is already setup, once Jenkins execute the sonar maven plugin, it will automatically execute coverage as well.</p>
</div>
<div class="paragraph">
<p>This is an example of a block of code from a devonfw project&#8217;s <code>Jenkinsfile</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">    withMaven(globalMavenSettingsConfig: 'YOUR_GLOBAL_MAVEN_SETTINGS', jdk: 'OpenJDK 1.8', maven: 'Maven_3.3.9') {
        sh "mvn sonar:sonar -Dsonar.login=[USERNAME] -Dsonar.password=[PASSWORD]"
    }</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_okd_openshift_origin"><a class="anchor" href="#_okd_openshift_origin"></a>OKD <em>(OpenShift Origin)</em></h4>

</div>
<div class="sect3">
<h4 id="_what_is_okd"><a class="anchor" href="#_what_is_okd"></a>What is OKD</h4>
<div class="paragraph">
<p>OKD is a distribution of Kubernetes optimized for continuous application development and multi-tenant deployment. OKD is the upstream Kubernetes distribution embedded in Red Hat OpenShift.</p>
</div>
<div class="paragraph">
<p>OKD embeds Kubernetes and extends it with security and other integrated concepts. OKD is also referred to as Origin in github and in the documentation.</p>
</div>
<div class="paragraph">
<p>OKD provides a complete open source container application platform. If you are looking for enterprise-level support, or information on partner certification, Red Hat also offers <a href="https://www.openshift.com/">Red Hat OpenShift Container Platform</a>.</p>
</div>
<hr>
<h4 id="_continue_reading" class="discrete">Continue reading&#8230;&#8203;</h4>
<div class="ulist">
<ul>
<li>
<p><a href="dsf-okd-how-to-install.adoc">How to install Openshift Origin</a></p>
</li>
<li>
<p><a href="dsf-okd-initial-setup.adoc">Initial setup</a></p>
<div class="ulist">
<ul>
<li>
<p><a href="dsf-okd-s2i.adoc">s2i</a></p>
</li>
<li>
<p><a href="dsf-okd-templates.adoc">templates</a></p>
</li>
<li>
<p><a href="dsf-okd-customize.adoc">Customize Openshift</a></p>
<div class="ulist">
<ul>
<li>
<p><a href="dsf-okd-customize-icons.adoc">Customize icons</a></p>
</li>
<li>
<p><a href="dsf-okd-customize-catalog.adoc">Customize catalog</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_install_okd_openshift_origin"><a class="anchor" href="#_install_okd_openshift_origin"></a>Install OKD <em>(Openshift Origin)</em></h5>

</div>
<div class="sect4">
<h5 id="_pre_requisites"><a class="anchor" href="#_pre_requisites"></a>Pre-requisites</h5>

</div>
<div class="sect4">
<h5 id="_install_docker"><a class="anchor" href="#_install_docker"></a>Install docker</h5>
<div class="paragraph">
<p><a href="https://docs.docker.com/engine/installation/linux/docker-ce/debian/#set-up-the-repository" class="bare">https://docs.docker.com/engine/installation/linux/docker-ce/debian/#set-up-the-repository</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Shell hljs" data-lang="Shell">$ sudo groupadd docker
$ sudo usermod -aG docker $USER</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_download_openshift_origin_client"><a class="anchor" href="#_download_openshift_origin_client"></a>Download Openshift Origin Client</h5>
<div class="paragraph">
<p>Download Openshift Origin Client from <a href="https://www.openshift.org/download.html#oc-platforms">here</a></p>
</div>
<div class="paragraph">
<p>When the download it&#8217;s complete, only extract it on the directory that you want, for example <code>/home/administrador/oc</code></p>
</div>
</div>
<div class="sect4">
<h5 id="_add_oc_to_path"><a class="anchor" href="#_add_oc_to_path"></a>Add oc to path</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Shell hljs" data-lang="Shell">$ export PATH=$PATH:/home/administrador/oc</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_install_openshift_cluster"><a class="anchor" href="#_install_openshift_cluster"></a>Install Openshift Cluster</h5>

</div>
<div class="sect4">
<h5 id="_add_the_insecure_registry"><a class="anchor" href="#_add_the_insecure_registry"></a>Add the insecure registry</h5>
<div class="paragraph">
<p>Create file <code><code>/etc/docker/daemon.json</code></code> with the next content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "insecure-registries" : [ "172.30.0.0/16" ]
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_download_docker_images_for_openshift"><a class="anchor" href="#_download_docker_images_for_openshift"></a>Download docker images for openshift</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Shell hljs" data-lang="Shell">$ oc cluster up</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_install_oc_cluster_wrapper"><a class="anchor" href="#_install_oc_cluster_wrapper"></a>Install Oc Cluster Wrapper</h5>
<div class="paragraph">
<p>To manage easier the cluster persistent, we are going to use oc cluster wrapper.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Shell hljs" data-lang="Shell">cd /home/administrador/oc
wget https://raw.githubusercontent.com/openshift-evangelists/oc-cluster-wrapper/master/oc-cluster</code></pre>
</div>
</div>
<div class="paragraph">
<p>oc-cluster up devonfw-shop-floor --public-hostname X.X.X.X</p>
</div>
</div>
<div class="sect4">
<h5 id="_configure_iptables"><a class="anchor" href="#_configure_iptables"></a>Configure iptables</h5>
<div class="paragraph">
<p>We must create iptables rules to allow traffic from other machines.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-diff hljs" data-lang="diff">- The next commands it's to let all traffic, don't do it on a real server.

- $ iptables -F
- $ iptables -X
- $ iptables -t nat -F
- $ iptables -t nat -X
- $ iptables -t mangle -F
- $ iptables -t mangle -X
- $ iptables -P INPUT ACCEPT
- $ iptables -P OUTPUT ACCEPT
- $ iptables -P FORWARD ACCEPT</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_how_to_use_oc_cluster_wrapper"><a class="anchor" href="#_how_to_use_oc_cluster_wrapper"></a>How to use Oc Cluster Wrapper</h5>
<div class="paragraph">
<p>With oc cluster wrapper we could have different clusters with different context.</p>
</div>
</div>
<div class="sect4">
<h5 id="_cluster_up"><a class="anchor" href="#_cluster_up"></a>Cluster up</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Shell hljs" data-lang="Shell">$ oc-cluster up devonfw-shop-floor --public-hostname X.X.X.X</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_cluster_down"><a class="anchor" href="#_cluster_down"></a>Cluster down</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Shell hljs" data-lang="Shell">$ oc-cluster down</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_use_non_persistent_cluster"><a class="anchor" href="#_use_non_persistent_cluster"></a>Use non-persistent cluster</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Shell hljs" data-lang="Shell">oc cluster up --image openshift/origin --public-hostname X.X.X.X --routing-suffix apps.X.X.X.X.nip.io</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_devonfw_openshift_origin_initial_setup"><a class="anchor" href="#_devonfw_openshift_origin_initial_setup"></a>devonfw Openshift Origin Initial Setup</h5>
<div class="paragraph">
<p>These are scripts to customize an Openshift cluster to be a devonfw Openshift.</p>
</div>
</div>
<div class="sect4">
<h5 id="_how_to_use"><a class="anchor" href="#_how_to_use"></a>How to use</h5>

</div>
<div class="sect4">
<h5 id="_prerequisite_customize_openshift"><a class="anchor" href="#_prerequisite_customize_openshift"></a>Prerequisite: Customize Openshift</h5>
<div class="paragraph">
<p>devonfw Openshift Origin use custom icons, and we need to add it to openshift. More information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="dsf-okd-customize.adoc">Customize Openshift</a></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_script_initial_setup"><a class="anchor" href="#_script_initial_setup"></a>Script initial-setup</h5>
<div class="paragraph">
<p>Download <a href="https://raw.githubusercontent.com/devonfw/devonfw-shop-floor/master/dsf4openshift/openshift-cluster-setup/initial-setup/initial-setup.sh">this</a> script and execute it.</p>
</div>
<div class="paragraph">
<p>More information about what this script does <a href="https://raw.githubusercontent.com/devonfw/devonfw-shop-floor/master/dsf4openshift/openshift-cluster-setup/initial-setup#script-initial-setup">here</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_known_issues"><a class="anchor" href="#_known_issues"></a>Known issues</h5>

</div>
<div class="sect4">
<h5 id="_failed_to_push_image"><a class="anchor" href="#_failed_to_push_image"></a>Failed to push image</h5>
<div class="paragraph">
<p>If you receive an error like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>error: build error: Failed to push image: After retrying 6 times, Push image still failed due to error: Get http://172.30.1.1:5000/v2/:  dial tcp 172.30.1.1:5000: getsockopt: connection refused</code></pre>
</div>
</div>
<div class="paragraph">
<p>It&#8217;s because the registry isn&#8217;t working, go to openshift console and enter into the <strong>default</strong> project <code><code><a href="https://x.x.x.x:8443/console/project/default/overview" class="bare">https://x.x.x.x:8443/console/project/default/overview</a></code></code> and you must see two resources, <strong>docker-registry</strong> and <strong>router</strong> they must be running. If they don&#8217;t work, try to deploy them and look at the logs what is happen.</p>
</div>
</div>
<div class="sect4">
<h5 id="_s2i_devonfw"><a class="anchor" href="#_s2i_devonfw"></a>s2i devonfw</h5>
<div class="paragraph">
<p>This are the s2i source and templates to build an s2i images. It provides OpenShift builder images for components of the devonfw (at this moment only for angular and java).</p>
</div>
<div class="paragraph">
<p>This work is totally based on the implementation of  <a href="https://github.com/Mickuehl">Michael Kuehl</a> from RedHat for Oasp s2i.</p>
</div>
<div class="paragraph">
<p>All this information is used as a part of the <a href="dsf-okd-initial-setup.adoc">initial setup</a> for openshift.</p>
</div>
</div>
<div class="sect4">
<h5 id="_previous_setup"><a class="anchor" href="#_previous_setup"></a>Previous setup</h5>
<div class="paragraph">
<p>In order to build all of this, it will be necessary, first, to have a running OpenShift cluster. How to install it <a href="dsf-okd-how-to-install.adoc">here</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_usage"><a class="anchor" href="#_usage"></a>Usage</h5>
<div class="paragraph">
<p>Before using the builder images, add them to the OpenShift cluster.</p>
</div>
</div>
<div class="sect4">
<h5 id="_deploy_the_source_2_image_builder_images"><a class="anchor" href="#_deploy_the_source_2_image_builder_images"></a>Deploy the Source-2-Image builder images</h5>
<div class="paragraph">
<p>First, create a dedicated <code>devonfw</code> project as admin.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Shell hljs" data-lang="Shell">$ oc new-project devonfw --display-name='devonfw' --description='devonfw Application Standard Platform'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now add the builder image configuration and start their build.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Shell hljs" data-lang="Shell">oc create -f https://raw.githubusercontent.com/devonfw/devonfw-shop-floor/master/dsf4openshift/openshift-devonfw-deployment/s2i/java/s2i-devonfw-java-imagestream.json --namespace=devonfw
oc create -f https://raw.githubusercontent.com/devonfw/devonfw-shop-floor/master/dsf4openshift/openshift-devonfw-deployment/s2i/angular/s2i-devonfw-angular-imagestream.json --namespace=devonfw
oc start-build s2i-devonfw-java --namespace=devonfw
oc start-build s2i-devonfw-angular --namespace=devonfw</code></pre>
</div>
</div>
<div class="paragraph">
<p>Make sure other projects can access the builder images:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Shell hljs" data-lang="Shell">oc policy add-role-to-group system:image-puller system:authenticated --namespace=devonfw</code></pre>
</div>
</div>
<div class="paragraph">
<p>That&#8217;s all!</p>
</div>
</div>
<div class="sect4">
<h5 id="_deploy_devonfw_templates"><a class="anchor" href="#_deploy_devonfw_templates"></a>Deploy devonfw templates</h5>
<div class="paragraph">
<p>Now, it&#8217;s time to create devonfw templates to use this s2i and add it to the browse catalog. More information <a href="dsf-okd-templates.adoc">here</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_build_all"><a class="anchor" href="#_build_all"></a>Build All</h5>
<div class="paragraph">
<p>Use <a href="https://raw.githubusercontent.com/devonfw/devonfw-shop-floor/master/dsf4openshift/openshift-cluster-setup/initial-setup/initial-setup.sh">this</a> script to automatically install and build all image streams. The script also creates templates devonfw-angular and devonfw-java inside the project 'openshift' to be used by everyone.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open a bash shell as Administrator</p>
</li>
<li>
<p>Execute shell file:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Shell hljs" data-lang="Shell">$ /PATH/TO/BUILD/FILE/initial-setup.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>More information about what this script does <a href="https://raw.githubusercontent.com/devonfw/devonfw-shop-floor/master/dsf4openshift/openshift-cluster-setup/initial-setup#script-initial-setup">here</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_links_references"><a class="anchor" href="#_links_references"></a>Links &amp; References</h5>
<div class="paragraph">
<p>This is a list of useful articles, etc, that I found while creating the templates.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/openshift/openshift-docs/issues/1329">Template Icons</a></p>
</li>
<li>
<p><a href="https://github.com/jbossdemocentral/coolstore-microservice">Red Hat Cool Store Microservice Demo</a></p>
</li>
<li>
<p><a href="https://docs.openshift.com/container-platform/4.9/web_console/customizing-the-web-console.html">Openshift Web Console Customization</a></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_devonfw_templates"><a class="anchor" href="#_devonfw_templates"></a>devonfw templates</h5>
<div class="paragraph">
<p>This are the devonfw templates to build devonfw apps for Openshift using the s2i images. They are based on the work of Mickuehl in Oasp templates/mythaistar for deploy My Thai Star.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Inside the <code>example-mythaistar</code> we have an example to deploy My Thai Star application using devonfw templates.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All this information is used as a part of the <a href="dsf-okd-initial-setup.adoc">initial setup</a> for openshift.</p>
</div>
</div>
<div class="sect4">
<h5 id="_how_to_use_2"><a class="anchor" href="#_how_to_use_2"></a>How to use</h5>

</div>
<div class="sect4">
<h5 id="_previous_requirements"><a class="anchor" href="#_previous_requirements"></a>Previous requirements</h5>

</div>
<div class="sect4">
<h5 id="_deploy_the_source_2_image_builder_images_2"><a class="anchor" href="#_deploy_the_source_2_image_builder_images_2"></a>==  Deploy the Source-2-Image builder images</h5>
<div class="paragraph">
<p>Remember that this templates need a build image from s2i-devonfw-angular and s2i-devonfw-java. More information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="dsf-okd-s2i#deploy-the-source-2-image-builder-images.adoc">Deploy the Source-2-Image builder images</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_customize_openshift"><a class="anchor" href="#_customize_openshift"></a>==  Customize Openshift</h5>
<div class="paragraph">
<p>Remember that this templates also have custom icons, and to use it, we must modify the master-config.yml inside openshift. More information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="dsf-okd-customize.adoc">Customize Openshift</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_deploy_devonfw_templates_2"><a class="anchor" href="#_deploy_devonfw_templates_2"></a>Deploy devonfw templates</h5>
<div class="paragraph">
<p>Now, it&#8217;s time to create devonfw templates to use this s2i and add it to the browse catalog.</p>
</div>
<div class="paragraph">
<p>To let all user to use these templates in all openshift projects, we should create it in an openshift namespace. To do that, we must log in as an admin.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Shell hljs" data-lang="Shell">oc create -f https://raw.githubusercontent.com/devonfw/devonfw-shop-floor/master/dsf4openshift/openshift-devonfw-deployment/templates/devonfw-java-template.json --namespace=openshift
oc create -f https://raw.githubusercontent.com/devonfw/devonfw-shop-floor/master/dsf4openshift/openshift-devonfw-deployment/templates/devonfw-angular-template.json --namespace=openshift</code></pre>
</div>
</div>
<div class="paragraph">
<p>When it finishes, remember to logout as an admin and enter with our normal user.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Shell hljs" data-lang="Shell">$ oc login</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_how_to_use_devonfw_templates_in_openshift"><a class="anchor" href="#_how_to_use_devonfw_templates_in_openshift"></a>How to use devonfw templates in openshift</h5>
<div class="paragraph">
<p>To use these templates with openshift, we can override any parameter values defined in the file by adding the --param-file=paramfile option.</p>
</div>
<div class="paragraph">
<p>This file must be a list of &lt;name&gt;=&lt;value&gt; pairs. A parameter reference may appear in any text field inside the template items.</p>
</div>
<div class="paragraph">
<p><strong>The parameters that we must override are the following</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Shell hljs" data-lang="Shell">$ cat paramfile
  APPLICATION_NAME=app-Name
  APPLICATION_GROUP_NAME=group-Name
  GIT_URI=Git uri
  GIT_REF=master
  CONTEXT_DIR=/context</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>The following parameters are optional</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Shell hljs" data-lang="Shell">$ cat paramfile
  APPLICATION_HOSTNAME=Custom hostname for service routes. Leave blank for default hostname, e.g.: &lt;application-name&gt;.&lt;project&gt;.&lt;default-domain-suffix&gt;,
  # Only for angular
  REST_ENDPOINT_URL=The URL of the backend's REST API endpoint. This can be declared after,
  REST_ENDPOINT_PATTERN=The pattern URL of the backend's REST API endpoint that must be modify by the REST_ENDPOINT_URL variable,</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>For example, to deploy My Thai Star Java</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Shell hljs" data-lang="Shell">$ cat paramfile
  APPLICATION_NAME="mythaistar-java"
  APPLICATION_GROUP_NAME="My-Thai-Star"
  GIT_URI="https://github.com/devonfw/my-thai-star.git"
  GIT_REF="develop"
  CONTEXT_DIR="/java/mtsj"

$ oc new-app --template=devonfw-java --namespace=mythaistar --param-file=paramfile</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_customize_openshift_origin_for_devonfw"><a class="anchor" href="#_customize_openshift_origin_for_devonfw"></a>Customize Openshift Origin for devonfw</h5>
<div class="paragraph">
<p>This is a guide to customize Openshift cluster.</p>
</div>
</div>
<div class="sect4">
<h5 id="_images_styles"><a class="anchor" href="#_images_styles"></a>Images Styles</h5>
<div class="paragraph">
<p>The icons for templates must measure the same as below or the images don&#8217;t show right:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Openshift logo</code>: 230px x 40px.</p>
</li>
<li>
<p><code>Template logo</code>: 50px x 50px.</p>
</li>
<li>
<p><code>Category logo</code>: 110px x 36px.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_how_to_use_3"><a class="anchor" href="#_how_to_use_3"></a>How to use</h5>
<div class="paragraph">
<p>To use it, we need to enter in openshift as an admin and use the next command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Shell hljs" data-lang="Shell">$ oc login

$ oc edit configmap/webconsole-config -n openshift-web-console</code></pre>
</div>
</div>
<div class="paragraph">
<p>After this, we can see in our shell the webconsole-config.yaml, we only need to navigate until <strong>extensions</strong> and add the url for our own <code>css</code> in the <strong>stylesheetURLs</strong> and <code>javascript</code> in the <strong>scriptURLs</strong> section.</p>
</div>
<div class="paragraph">
<p><strong>IMPORTANT: Scripts and stylesheets must be served with the correct content type or they will not be run by the browser. Scripts must be served with Content-Type: application/javascript and stylesheets with Content-Type: text/css.</strong></p>
</div>
<div class="paragraph">
<p>In git repositories, the content type of raw is text/plain. You can use <a href="https://rawgit.com/">rawgit</a> to convert a raw from a git repository to the correct content type.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-YAML hljs" data-lang="YAML">webconsole-config.yaml: |
  [...]
    extensions:
      scriptURLs:
        - https://cdn.rawgit.com/devonfw/devonfw-shop-floor/master/dsf4openshift/openshift-cluster-setup/initial-setup/customizeOpenshift/scripts/catalog-categories.js
      stylesheetURLs:
        - https://cdn.rawgit.com/devonfw/devonfw-shop-floor/master/dsf4openshift/openshift-cluster-setup/initial-setup/customizeOpenshift/stylesheet/icons.css
  [...]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_more_information"><a class="anchor" href="#_more_information"></a>More information</h5>
<div class="ulist">
<ul>
<li>
<p><a href="dsf-okd-customize-icons.adoc">Customize icons</a> for Openshift.</p>
</li>
<li>
<p><a href="dsf-okd-customize-catalog.adoc">Customize catalog</a> for Openshift.</p>
</li>
<li>
<p><a href="https://docs.openshift.com/container-platform/latest/install_config/web_console_customization.html#loading-custom-scripts-and-stylesheets">Openshift docs</a> about customization.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_old_versions"><a class="anchor" href="#_old_versions"></a>Old versions</h5>
<div class="ulist">
<ul>
<li>
<p>Customize Openshift for <a href="dsf-okd-customize-v3-7.adoc">version 3.7</a>.</p>
</li>
</ul>
</div>
<div class="sect6">
<h7 id="_how_to_add_custom_icons_inside_openshift"><a class="anchor" href="#_how_to_add_custom_icons_inside_openshift"></a>How to add Custom Icons inside openshift</h7>
<div class="paragraph">
<p>This is a guide to add custom icons into an Openshift cluster.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/devonfw/devonfw-shop-floor/tree/master/dsf4openshift/openshift-cluster-setup/initial-setup/customizeOpenshift/stylesheet">Here</a> we can find an icons.css example to use the devonfw icons.</p>
</div>
</div>
<div class="sect6">
<h7 id="_images_styles_2"><a class="anchor" href="#_images_styles_2"></a>Images Styles</h7>
<div class="paragraph">
<p>The icons for templates must measure the same as below or the images don&#8217;t show right:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Openshift logo</code>: 230px x 40px.</p>
</li>
<li>
<p><code>Template logo</code>: 50px x 50px.</p>
</li>
<li>
<p><code>Category logo</code>: 110px x 36px.</p>
</li>
</ul>
</div>
</div>
<div class="sect6">
<h7 id="_create_a_css"><a class="anchor" href="#_create_a_css"></a>Create a css</h7>

</div>
<div class="sect6">
<h7 id="_custom_logo_for_openshift_cluster"><a class="anchor" href="#_custom_logo_for_openshift_cluster"></a>Custom logo for openshift cluster</h7>
<div class="paragraph">
<p>For this example, we are going to call the css icons.css but you can call as you wish.
Openshift cluster draw their icon by the id header-logo, then we only need to add to our icons.css the next Style Attribute ID</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-CSS hljs" data-lang="CSS">#header-logo {
  background-image: url("https://raw.githubusercontent.com/devonfw/devonfw-shop-floor/master/dsf4openshift/openshift-cluster-setup/initial-setup/customizeOpenshift/images/devonfw-openshift.png);
  width: 230px;
  height: 40px;
}</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_custom_icons_for_templates"><a class="anchor" href="#_custom_icons_for_templates"></a>Custom icons for templates</h7>
<div class="paragraph">
<p>To use a custom icon to a template openshift use a class name. Then, we need to insert inside our icons.css the next Style Class</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-CSS hljs" data-lang="CSS">.devonfw-logo {
  background-image: url("https://raw.githubusercontent.com/devonfw/devonfw-shop-floor/master/dsf4openshift/openshift-cluster-setup/initial-setup/customizeOpenshift/images/devonfw.png");
  width: 50px;
  height: 50px;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To show that custom icon on a template, we only need to write the name of our class in the tag "iconClass" of our template.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-JSON hljs" data-lang="JSON">{
    ...
    "items": [
        {
            ...
            "metadata": {
                ...
                "annotations": {
                    ...
                    "iconClass": "devonfw-logo",
                    ...
                }
            },
            ...
        }
    ]
}</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_use_our_own_css_inside_openshift"><a class="anchor" href="#_use_our_own_css_inside_openshift"></a>Use our own css inside openshift</h7>
<div class="paragraph">
<p>To do that, we need to enter in openshift as an admin and use the next command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Shell hljs" data-lang="Shell">$ oc login
$ oc edit configmap/webconsole-config -n openshift-web-console</code></pre>
</div>
</div>
<div class="paragraph">
<p>After this, we can see in our shell the webconsole-config.yaml, we only need to navigate until <strong>extensions</strong> and add the url for our own <code>css</code> in the <strong>stylesheetURLs</strong> section.</p>
</div>
<div class="paragraph">
<p><strong>IMPORTANT: Scripts and stylesheets must be served with the correct content type or they will not be run by the browser. stylesheets must be served with Content-Type: text/css.</strong></p>
</div>
<div class="paragraph">
<p>In git repositories, the content type of raw is text/plain. You can use <a href="https://rawgit.com/">rawgit</a> to convert a raw from a git repository to the correct content type.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-YAML hljs" data-lang="YAML">webconsole-config.yaml: |
	[...]
    extensions:
      stylesheetURLs:
		- https://cdn.rawgit.com/devonfw/devonfw-shop-floor/master/dsf4openshift/openshift-cluster-setup/initial-setup/customizeOpenshift/stylesheet/icons.css
    [...]</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_how_to_add_custom_catalog_categories_inside_openshift"><a class="anchor" href="#_how_to_add_custom_catalog_categories_inside_openshift"></a>How to add custom catalog categories inside openshift</h7>
<div class="paragraph">
<p>This is a guide to add custom <code>Catalog Categories</code> into an Openshift cluster.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/devonfw/devonfw-shop-floor/tree/master/dsf4openshift/openshift-cluster-setup/initial-setup/customizeOpenshift/scripts">Here</a> we can find a catalog-categories.js example to use the devonfw catalog categories.</p>
</div>
</div>
<div class="sect6">
<h7 id="_create_a_scrip_to_add_custom_langauges_and_custom_catalog_categories"><a class="anchor" href="#_create_a_scrip_to_add_custom_langauges_and_custom_catalog_categories"></a>Create a scrip to add custom langauges and custom catalog categories</h7>

</div>
<div class="sect6">
<h7 id="_custom_language"><a class="anchor" href="#_custom_language"></a>Custom language</h7>
<div class="paragraph">
<p>For this example, we are going add a new language into the languages category. To do that we must create a script and we named as catalog-categories.js</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Javascript hljs" data-lang="Javascript">// Find the Languages category.
var category = _.find(window.OPENSHIFT_CONSTANTS.SERVICE_CATALOG_CATEGORIES,
                      { id: 'languages' });
// Add Go as a new subcategory under Languages.
category.subCategories.splice(2,0,{ // Insert at the third spot.
  // Required. Must be unique.
  id: "devonfw-languages",
  // Required.
  label: "devonfw",
  // Optional. If specified, defines a unique icon for this item.
  icon: "devonfw-logo-language",
  // Required. Items matching any tag will appear in this subcategory.
  tags: [
    "devonfw",
    "devonfw-angular",
    "devonfw-java"
  ]
});</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_custom_category"><a class="anchor" href="#_custom_category"></a>Custom category</h7>
<div class="paragraph">
<p>For this example, we are going add a new category into the category tab. To do that we must create a script and we named as catalog-categories.js</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Javascript hljs" data-lang="Javascript">// Add a Featured category as the first category tab.
window.OPENSHIFT_CONSTANTS.SERVICE_CATALOG_CATEGORIES.unshift({
  // Required. Must be unique.
  id: "devonfw-featured",
  // Required
  label: "devonfw",
  subCategories: [
    {
      // Required. Must be unique.
      id: "devonfw-languages",
      // Required.
      label: "devonfw",
      // Optional. If specified, defines a unique icon for this item.
      icon: "devonfw-logo-language",
      // Required. Items matching any tag will appear in this subcategory.
      tags: [
        "devonfw",
        "devonfw-angular",
        "devonfw-java"
      ]
    }
  ]
});</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_use_our_own_javascript_inside_openshift"><a class="anchor" href="#_use_our_own_javascript_inside_openshift"></a>Use our own javascript inside openshift</h7>
<div class="paragraph">
<p>To do that, we need to enter in openshift as an admin and use the next command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Shell hljs" data-lang="Shell">$ oc login
$ oc edit configmap/webconsole-config -n openshift-web-console</code></pre>
</div>
</div>
<div class="paragraph">
<p>After this, we can see in our shell the webconsole-config.yaml, we only need to navigate until <strong>extensions</strong> and add the url for our own <code>javascript</code> in the <strong>scriptURLs</strong> section.</p>
</div>
<div class="paragraph">
<p><strong>IMPORTANT: Scripts and stylesheets must be served with the correct content type or they will not be run by the browser. Scripts must be served with Content-Type: application/javascript.</strong></p>
</div>
<div class="paragraph">
<p>In git repositories, the content type of raw is text/plain. You can use <a href="https://rawgit.com/">rawgit</a> to convert a raw from a git repository to the correct content type.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-YAML hljs" data-lang="YAML">webconsole-config.yaml: |
  [...]
    extensions:
      scriptURLs:
        - https://cdn.rawgit.com/devonfw/devonfw-shop-floor/master/dsf4openshift/openshift-cluster-setup/initial-setup/customizeOpenshift/scripts/catalog-categories.js
  [...]</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_customize_openshift_origin_v3_7_for_devonfw"><a class="anchor" href="#_customize_openshift_origin_v3_7_for_devonfw"></a>Customize Openshift Origin v3.7 for devonfw</h7>
<div class="paragraph">
<p>This is a guide to customize Openshift cluster. For more information read the next:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.openshift.com/container-platform/3.7/install_config/web_console_customization.html#loading-custom-scripts-and-stylesheets">Openshift docs customization</a> for the version 3.7.</p>
</li>
</ul>
</div>
</div>
<div class="sect6">
<h7 id="_images_styles_3"><a class="anchor" href="#_images_styles_3"></a>Images Styles</h7>
<div class="paragraph">
<p>The icons for templates must measure the same as below or the images don&#8217;t show right:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Openshift logo</code>: 230px x 40px.</p>
</li>
<li>
<p><code>Template logo</code>: 50px x 50px.</p>
</li>
<li>
<p><code>Category logo</code>: 110px x 36px.</p>
</li>
</ul>
</div>
</div>
<div class="sect6">
<h7 id="_quick_use"><a class="anchor" href="#_quick_use"></a>Quick Use</h7>
<div class="paragraph">
<p>This is a quick example to add custom icons and categories inside openshift.</p>
</div>
<div class="paragraph">
<p>To modify the icons inside openshift, we must to modify our master-config.yaml of our openshift cluster. This file is inside the openshift container and to obtain a copy of it, we must to know what&#8217;s our openshift container name.</p>
</div>
</div>
<div class="sect6">
<h7 id="_obtain_the_master_config_yaml_of_our_openshift_cluster"><a class="anchor" href="#_obtain_the_master_config_yaml_of_our_openshift_cluster"></a>Obtain the master-config.yaml of our openshift cluster</h7>

</div>
<div class="sect6">
<h7 id="_obtain_the_name_of_our_openshift_container"><a class="anchor" href="#_obtain_the_name_of_our_openshift_container"></a>==  Obtain the name of our openshift container</h7>
<div class="paragraph">
<p>To obtain it, we can know it executing the next:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Shell hljs" data-lang="Shell">$ docker container ls
CONTAINER ID        IMAGE                                           COMMAND                  CREATED             STATUS              PORTS                                     NAMES
83a4e3acda5b        openshift/origin:v3.7.0                         "/usr/bin/openshift …"   6 days ago          Up 6 days                                                     origin</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here we can see that the name of the container is origin. Normaly the container it&#8217;s called as origin.</p>
</div>
</div>
<div class="sect6">
<h7 id="_copy_the_master_config_yaml_of_our_openshift_container_to_our_directory"><a class="anchor" href="#_copy_the_master_config_yaml_of_our_openshift_container_to_our_directory"></a>==  Copy the master-config.yaml of our openshift container to our directory</h7>
<div class="paragraph">
<p>This file is inside the openshift container in the next directory: /var/lib/origin/openshift.local.config/master/<code>master-config.yaml</code> and we can copy it with the next command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Shell hljs" data-lang="Shell">$ docker cp origin:/var/lib/origin/openshift.local.config/master/master-config.yaml ./</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we have a file with the configuration of our openshift cluster.</p>
</div>
</div>
<div class="sect6">
<h7 id="_copy_all_customize_files_inside_the_openshift_container"><a class="anchor" href="#_copy_all_customize_files_inside_the_openshift_container"></a>Copy all customize files inside the openshift container</h7>
<div class="paragraph">
<p>To use our customization of devonfw Openshift, we need to copy our files inside the openshift container.</p>
</div>
<div class="paragraph">
<p>To do this we need to copy the images, scripts and stylesheets from <a href="https://github.com/devonfw/devonfw-shop-floor/tree/master/dsf4openshift/openshift-cluster-setup/initial-setup/customizeOpenshift">here</a> inside openshift
container, for example, we could put it all inside a folder called openshift.local.devonfw. On the step one we obtain the name of this container, for this example we assume that it&#8217;s called origin. Then our images are located inside openshift container and we can see an access it in <code>/var/lib/origin/openshift.local.devonfw/images</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Shell hljs" data-lang="Shell">$ docker cp ./openshift.local.devonfw origin:/var/lib/origin/</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_edit_and_copy_the_master_config_yaml_to_use_our_customize_files"><a class="anchor" href="#_edit_and_copy_the_master_config_yaml_to_use_our_customize_files"></a>Edit and copy the master-config.yaml to use our customize files</h7>
<div class="paragraph">
<p>The master-config.yaml have a sections to charge our custom files. All these sections are inside the <code>assetConfig</code> and their names are the next:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The custom stylessheets are into <code>extensionStylesheets</code>.</p>
</li>
<li>
<p>The custom scripts are into <code>extensionScripts</code>.</p>
</li>
<li>
<p>The custom images are into <code>extensions</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To use all our custom elements only need to add the directory routes of each element in their appropriate section of the master-config.yaml</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">...
assetConfig:
  ...
  extensionScripts:
  - /var/lib/origin/openshift.local.devonfw/scripts/catalog-categories.js
  extensionStylesheets:
  - /var/lib/origin/openshift.local.devonfw/stylesheet/icons.css
  extensions:
  - name: images
    sourceDirectory: /var/lib/origin/openshift.local.devonfw/images
  ...
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we only need to copy that master-config.yaml inside openshift, and restart it to load the new configuration. To do that execute the next:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Shell hljs" data-lang="Shell">$ docker cp ./master-config.yaml origin:/var/lib/origin/openshift.local.config/master/master-config.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>To re-start openshift do <code>oc cluster down</code> and start again your persistent openshift cluster.</p>
</div>
</div>
<div class="sect6">
<h7 id="_more_information_2"><a class="anchor" href="#_more_information_2"></a>More information</h7>
<div class="ulist">
<ul>
<li>
<p><a href="dsf-okd-customize-icons.adoc">Customize icons</a> for Openshift.</p>
</li>
<li>
<p><a href="dsf-okd-customize-catalog.adoc">Customize catalog</a> for Openshift.</p>
</li>
<li>
<p><a href="https://docs.openshift.com/container-platform/latest/install_config/web_console_customization.html#loading-custom-scripts-and-stylesheets">Openshift docs</a> about customization.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
