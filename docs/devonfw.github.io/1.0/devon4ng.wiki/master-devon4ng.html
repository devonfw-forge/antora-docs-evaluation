<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: Devonfw.github.io Docs</title>
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../..">Devonfw.github.io Docs</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="devonfw.github.io" data-version="1.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-explore is-active" data-panel="explore">
  <div class="context">
    <span class="title">devonfw.github.io</span>
    <span class="version">1.0</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../../../architecture-guidelines/1.0/index.html">Architecture-guidelines</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../architecture-guidelines/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../cicdgen/1.0/index.html">Cicdgen</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../cicdgen/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../cobigen/1.0/index.html">Cobigen</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../cobigen/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../dashboard/1.0/index.html">Dashboard</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../dashboard/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../devon4j/1.0/index.html">Devon4j</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../devon4j/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../devon4net/1.0/index.html">Devon4net</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../devon4net/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../devon4ng/1.0/index.html">Devon4ng</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../devon4ng/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../devon4node/1.0/index.html">Devon4node</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../devon4node/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../devon4quarkus/1.0/index.html">Devon4quarkus</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../devon4quarkus/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../devon4ts/1.0/index.html">Devon4ts</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../devon4ts/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="../index.html">devonfw.github.io</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../getting-started/1.0/index.html">Getting-started</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../getting-started/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../github/1.0/index.html">Github</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../github/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../hangar/1.0/index.html">Hangar</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../hangar/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../ide/1.0/index.html">IDE</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../ide/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../jump-the-queue/1.0/index.html">Jump-the-queue</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../jump-the-queue/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../mrchecker/1.0/index.html">Mrchecker</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../mrchecker/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../my-thai-star/1.0/index.html">My-thai-star</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../my-thai-star/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../production-line/1.0/index.html">Production-line</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../production-line/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../shop-floor/1.0/index.html">Shop-floor</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../shop-floor/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../solicitor/1.0/index.html">Solicitor</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../solicitor/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../sonar-devon4j-plugin/1.0/index.html">Sonar-devon4j-plugin</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../sonar-devon4j-plugin/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
</nav>
  <div class="edit-this-page"><a href="https://github.com/marvdan/devonfw.github.io/edit/developAntoraGhPage/docs/modules/ROOT/pages/devon4ng.wiki/master-devon4ng.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<div class="sect1">
<h2 id="_angular"><a class="anchor" href="#_angular"></a>Angular</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_introduction"><a class="anchor" href="#_introduction"></a>Introduction</h2>
<div class="sectionbody">
<!-- toc disabled -->
<div class="sect3">
<h4 id="devon4ng"><a class="anchor" href="#devon4ng"></a>devon4ng</h4>
<div class="paragraph">
<p>This guide describes an application architecture for web client development with <a href="https://angular.io/">Angular</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="motivation"><a class="anchor" href="#motivation"></a>Motivation</h4>
<div class="paragraph">
<p>Front-end development is a very difficult task since there are a lot of different frameworks, patterns and practices nowadays. For that reason, in devonfw we decided to make use of Angular since it is a full front-end framework that includes almost all the different patterns and features that any SPA may need and provides a well defined architecture to development, build and deploy.</p>
</div>
<div class="paragraph">
<p>The idea with <strong>devon4ng</strong> is to define an architecture which is a compromise between, on the one hand, leveraging the best practices and latest trends like reactive style development, on the other hand, providing a short on-boarding time while still using an architecture that helps us scale and be productive at the same time.</p>
</div>
<div class="paragraph">
<p>At the same time <strong>devon4ng</strong> aims to help developers to solve common problems that appear in many projects and provide samples and blueprints to show how to apply this solutions in real situations.</p>
</div>
</div>
<div class="sect3">
<h4 id="contents"><a class="anchor" href="#contents"></a>Contents</h4>
<div class="ulist">
<ul>
<li>
<p><a href="architecture">Architecture Overview</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This section introduces in an easy way the main principles and guidelines based on Angular Style Guide.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="meta-architecture">Client Meta Architecture</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The goal of this topic is to support the non-functional requirements for the client, i.e. mostly maintainability, scalability, efficiency and portability. As such it provides a component-oriented architecture following the same principles listed already in the devonfw architecture overview.</p>
</div>
</div>
<div class="sect3">
<h4 id="layers"><a class="anchor" href="#layers"></a>Layers</h4>
<div class="paragraph">
<p>This section provides a condensed explanation about the different layers a good Angular application must provide.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="components-layer">Components Layer</a></p>
</li>
<li>
<p><a href="services-layer">Services Layer</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="guides"><a class="anchor" href="#guides"></a>Guides</h4>
<div class="paragraph">
<p>This section introduces concepts to help developers with the tooling and package managers.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="guide-package-managers">Package Managers</a></p>
</li>
<li>
<p><a href="guide-npm-yarn-workflow">Package Managers Workflow</a></p>
</li>
<li>
<p><a href="guide-yarn-2-support">Yarn 2 Support</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="angular"><a class="anchor" href="#angular"></a>Angular</h4>
<div class="paragraph">
<p>This is the main section of the documentation, where the developer will find guidelines for accessibility, how to use the Angular toolchain, how to refactor components, create libraries and, in general, maintain Angular applications. But last and not least, developers will also find solutions to common problems many of the Angular projects may have.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
All the different topics are demonstrated in the <code>samples</code> folder with a small application.
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="guide-accessibility">Accessibility</a></p>
</li>
<li>
<p><a href="guide-angular-elements">Angular Elements</a></p>
</li>
<li>
<p><a href="guide-angular-lazy-loading">Angular Lazy Loading</a></p>
</li>
<li>
<p><a href="guide-angular-library">Angular Library</a></p>
</li>
<li>
<p><a href="guide-angular-theming">Angular Material Theming</a></p>
</li>
<li>
<p><a href="guide-angular-pwa">Angular Progressive Web Apps</a></p>
</li>
<li>
<p><a href="guide-app-initializer"><code>App Initializer</code></a></p>
</li>
<li>
<p><a href="guide-component-decomposition">Component Decomposition</a></p>
</li>
<li>
<p><a href="guide-consuming-rest-services">Consuming REST services</a></p>
</li>
<li>
<p><a href="guide-error-handler">Error Handler</a></p>
</li>
<li>
<p><a href="guide-file-structure">File Structure</a></p>
</li>
<li>
<p><a href="guide-internationalization">Internationalization</a></p>
</li>
<li>
<p><a href="guide-routing">Routing</a></p>
</li>
<li>
<p><a href="guide-testing">Testing</a></p>
</li>
<li>
<p><a href="guide-update-angular-cli">Update Angular CLI</a></p>
</li>
<li>
<p><a href="guide-upgrade-devon4ng">Upgrade devon4ng applications</a></p>
</li>
<li>
<p><a href="guide-working-with-angular-cli">Working with Angular CLI</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="ionic"><a class="anchor" href="#ionic"></a>Ionic</h4>
<div class="paragraph">
<p>As part of the devon4ng stack, we include a small section to explain how to develop hybrid mobile Ionic/Angular applications and create <code>PWAs</code> with this UI library. As the previous section, the contents are demonstrated in the <code>samples</code> folder.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="guide-ionic-getting-started">Ionic Getting started</a></p>
</li>
<li>
<p><a href="guide-ionic-from-code-to-android">Ionic to Android</a></p>
</li>
<li>
<p><a href="guide-ionic-pwa">Ionic Progressive Web Apps</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="layouts"><a class="anchor" href="#layouts"></a>Layouts</h4>
<div class="paragraph">
<p>Any SPA application must have a layout. So, the purpose of this section is to explain the Angular Material approach.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="guide-layout-with-angular-material">Angular Material Layout</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="ngrx"><a class="anchor" href="#ngrx"></a>NgRx</h4>
<div class="paragraph">
<p>State Management is a big topic in big front-end application. This section explains the fundamentals of the industry standard library NgRx, showing its main components.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="guide-ngrx-getting-started">Introduction</a></p>
</li>
<li>
<p><a href="guide-ngrx-simple-store">State, Selection and Reducers</a></p>
</li>
<li>
<p><a href="guide-ngrx-effects">Side effects with NgRx/Effects</a></p>
</li>
<li>
<p><a href="guide-ngrx-entity">Simplifying CRUD with NgRx/Entity</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="cookbook"><a class="anchor" href="#cookbook"></a>Cookbook</h4>
<div class="paragraph">
<p>The Cookbook section aims to provide solutions to cross-topic challenges that at this moment do not fit in the previous sections. As the <strong>Angular</strong> section, some of the topics are demonstrated with a sample located in the <code>samples</code> folder.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="cookbook-abstract-class-store">Abstract Class Store</a></p>
</li>
<li>
<p><a href="guide-add-electron">Angular Electron</a></p>
</li>
<li>
<p><a href="guide-angular-mock-service">Mock Service</a></p>
</li>
<li>
<p><a href="guide-cypress">Cypress e2e testing</a></p>
</li>
<li>
<p><a href="guide-eslint">Angular ESLint</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="devon4ng-templates"><a class="anchor" href="#devon4ng-templates"></a>devon4ng templates</h4>
<div class="paragraph">
<p>In order to support CobiGen generation tool for Angular applications, devon4ng demos realization and provide more opinionated samples, the following templates are also included in devon4ng contents:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/devonfw/devon4ng-application-template">devon4ng-application-template</a>: It is the Angular application template used by the CobiGen code generation tool.</p>
</li>
<li>
<p><a href="https://github.com/devonfw/devon4ng-ngrx-template">devon4ng-ngrx-template</a>: It is the Angular application template used by the CobiGen code generation tool that makes use of NgRx for state management.</p>
</li>
<li>
<p><a href="https://github.com/devonfw/devon4ng-ionic-application-template">devon4ng-ionic-application-template</a>: It is the Ionic mobile application template used by the CobiGen code generation tool.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="architecture"><a class="anchor" href="#architecture"></a>Architecture</h2>
<div class="sectionbody">
<!-- toc disabled -->
<div class="sect3">
<h4 id="architecture-2"><a class="anchor" href="#architecture-2"></a>Architecture</h4>
<div class="paragraph">
<p>The following principles and guidelines are based on Angular Style Guide - especially Angular modules (see <a href="https://angular.io/guide/ngmodule">Angular Docs</a>).
It extends those where additional guidance is needed to define an architecture which is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>maintainable across applications and teams</p>
</li>
<li>
<p>easy to understand, especially when coming from a classic Java/.Net perspective - so whenever possible the same principles apply both to the server and the client</p>
</li>
<li>
<p>pattern based to solve common problems</p>
</li>
<li>
<p>based on best of breed solutions coming from open source and Capgemini project experiences</p>
</li>
<li>
<p>gives as much guidance as necessary and as little as possible</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="overview"><a class="anchor" href="#overview"></a>Overview</h4>
<div class="paragraph">
<p>When using Angular the web client architecture is driven by the framework in a certain way Google and the Angular community think about web client architecture.
Angular gives an opinion on how to look at architecture.
It is a component based like devon4j but uses different terms which are common language in web application development.
The important term is <em>module</em> which is used instead of <em>component</em>. The primary reason is the naming collision with the <em>Web Components</em> standard (see <a href="https://www.w3.org/standards/techs/components">Web Components</a>).<br>
To clarify this:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <em>component</em> describes an UI element containing HTML, CSS and JavaScript - structure, design and logic encapsulated inside a reusable container called component.</p>
</li>
<li>
<p>A <em>module</em> describes an applications feature area. The application flight-app may have a module called booking.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An application developed using Angular consists of multiple modules.
There are feature modules and special modules described by the Angular Style Guide - <a href="https://angular.io/guide/ngmodule#the-core-module"><em>core</em></a> and <a href="https://angular.io/guide/ngmodule#shared-module"><em>shared</em></a>.
Angular or Angular Style Guide give no guidance on how to structure a module internally.
This is where this architecture comes in.</p>
</div>
</div>
<div class="sect3">
<h4 id="layers-2"><a class="anchor" href="#layers-2"></a>Layers</h4>
<div class="paragraph">
<p>The architecture describes two layers. The terminology is based on common language in web development.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/architecture-layers.svg"><img src="../_images/images/architecture-layers.svg" alt="Architecture - Layers" width="450"></a>
</div>
<div class="title">Figure 1. Layers</div>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="components-layer"><strong>Components Layer</strong></a> encapsulates components which present the current application state.
Components are separated into <a href="components-layer"><em>Smart</em> and <em>Dumb Components</em></a>.
The only logic present is view logic inside <em>Smart Components</em>.</p>
</li>
<li>
<p><a href="services-layer"><strong>Services Layer</strong></a> is more or less what we call 'business logic layer' on the server side.
The layer defines the applications state, the transitions between state and classic business logic.
Stores contain application state over time to which <em>Smart Components</em> subscribe to.
Adapters are used to perform XHR, <code>WebSocket</code> connections, etc.
The business model is described inside the module.
Use case services perform business logic needed for use cases.
A use case services interacts with the store and adapters.
Methods of use case services are the API for <em>Smart Components</em>.
Those methods are <em>Actions</em> in reactive terminology.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="modules"><a class="anchor" href="#modules"></a>Modules</h4>
<div class="paragraph">
<p>Angular requires a module called <em>app</em> which is the main entrance to an application at runtime - this module gets bootstrapped.
Angular Style Guide defines feature modules and two special modules - <a href="https://angular.io/guide/ngmodule#the-core-module"><em>core</em></a> and <a href="https://angular.io/guide/ngmodule#shared-module"><em>shared</em></a>.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/architecture-modules.svg"><img src="../_images/images/architecture-modules.svg" alt="Architecture - Modules" width="450"></a>
</div>
<div class="title">Figure 2. Modules</div>
</div>
<div class="paragraph">
<p>A feature module is basically a vertical cut through both layers.
The <em>shared</em> module consists of components shared across feature modules.
The <em>core</em> module holds services shared across modules.
So <em>core</em> module is a module only having a services layer
and <em>shared</em> module is a module only having a components layer.</p>
</div>
<!-- toc disabled -->
</div>
<div class="sect3">
<h4 id="meta-architecture"><a class="anchor" href="#meta-architecture"></a>Meta Architecture</h4>

</div>
<div class="sect3">
<h4 id="introduction"><a class="anchor" href="#introduction"></a>Introduction</h4>

</div>
<div class="sect3">
<h4 id="purpose-of-this-document"><a class="anchor" href="#purpose-of-this-document"></a>Purpose of this document</h4>
<div class="paragraph">
<p>In our business applications, the client easily gets underestimated. Sometimes the client is more complex to develop and design than the server. While the server architecture is nowadays easily to agree as common sense, for clients this is not as obvious and stable especially as it typically depends on the client framework used. Finding a concrete architecture applicable for all clients may therefore be difficult to accomplish.</p>
</div>
<div class="paragraph">
<p>This document tries to define on a high abstract level, a reference architecture which is supposed to be a mental image and frame for orientation regarding the evaluation and appliance of different client frameworks. As such it defines terms and concepts required to be provided for in any framework and thus gives a common ground of understanding for those acquainted with the reference architecture. This allows better comparison between the various frameworks out there, each having their own terms for essentially the same concepts. It also means that for each framework we need to explicitly map how it implements the concepts defined in this document.</p>
</div>
<div class="paragraph">
<p>The architecture proposed herein is neither new nor was it developed from scratch. Instead it is the gathered and consolidated knowledge and best practices of various projects (s. References).</p>
</div>
</div>
<div class="sect3">
<h4 id="goal-of-the-client-architecture"><a class="anchor" href="#goal-of-the-client-architecture"></a>Goal of the Client Architecture</h4>
<div class="paragraph">
<p>The goal of the client architecture is to support the non-functional requirements for the client, i.e. mostly maintainability, scalability, efficiency and portability. As such it provides a component-oriented architecture following the same principles listed already in the devonfw architecture overview. Furthermore it ensures a homogeneity regarding how different concrete UI technologies are being applied in the projects, solving the common requirements in the same way.</p>
</div>
</div>
<div class="sect3">
<h4 id="architecture-views"><a class="anchor" href="#architecture-views"></a>Architecture Views</h4>
<div class="paragraph">
<p>As for the server we distinguish between the business and the technical architecture. Where the business architecture is different from project to project and relates to the concrete design of dialog components given concrete requirements, the technical architecture can be applied to multiple projects.</p>
</div>
<div class="paragraph">
<p>The focus of this document is to provide a technical reference architecture on the client on a very abstract level defining required layers and components. How the architecture is implemented has to be defined for each UI technology.</p>
</div>
<div class="paragraph">
<p>The technical infrastructure architecture is out of scope for this document and although it needs to be considered, the concepts of the reference architecture should work across multiple TI architecture, i.e. native or web clients.</p>
</div>
</div>
<div class="sect3">
<h4 id="devonfw-reference-client-architecture"><a class="anchor" href="#devonfw-reference-client-architecture"></a>devonfw Reference Client Architecture</h4>
<div class="paragraph">
<p>The following gives a complete overview of the proposed reference architecture. It will be built up incrementally in the following sections.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/devonfw-methodology/OASP_ClientArchitecture_CompleteOverview.png"><img src="../_images/images/devonfw-methodology/OASP_ClientArchitecture_CompleteOverview.png" alt="Complete Client Architecture Overview" width="450"></a>
</div>
</div>
<div class="paragraph">
<p><em>Figure 1 Overview</em></p>
</div>
</div>
<div class="sect3">
<h4 id="client-architecture"><a class="anchor" href="#client-architecture"></a>Client Architecture</h4>
<div class="paragraph">
<p>On the highest level of abstraction we see the need to differentiate between dialog components and their container they are managed in, as well as the access to the application server being the back-end for the client (e.g. an devon4j instance). This section gives a summary of these components and how they relate to each other. Detailed architectures for each component will be supplied in subsequent sections</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/devonfw-methodology/OASP_ClientArchitecture_Overview.png"><img src="../_images/images/devonfw-methodology/OASP_ClientArchitecture_Overview.png" alt="Client Architecture Overview" width="450"></a>
</div>
</div>
<div class="paragraph">
<p><em>Figure 2 Overview of Client Architecture</em></p>
</div>
</div>
<div class="sect3">
<h4 id="dialog-component"><a class="anchor" href="#dialog-component"></a>==  Dialog Component</h4>
<div class="paragraph">
<p>A dialog component is a logical, self-contained part of the user interface. It accepts user input and actions and controls communication with the user. Dialog components use the services provided by the dialog container in order to execute the business logic. They are self-contained, i.e. they possess their own user interface together with the associated logic, data and states.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Dialog components can be composed of other dialog components forming a hierarchy</p>
</li>
<li>
<p>Dialog components can interact with each other. This includes communication of a parent to its children, but also between components independent of each other regarding the hierarchy.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="dialog-container"><a class="anchor" href="#dialog-container"></a>==  Dialog Container</h4>
<div class="paragraph">
<p>Dialog components need to be managed in their life-cycle and how they can be coupled to each other. The dialog container is responsible for this along with the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Bootstrapping the client application and environment</p>
<div class="ulist">
<ul>
<li>
<p>Configuration of the client</p>
</li>
<li>
<p>Initialization of the application server access component</p>
</li>
</ul>
</div>
</li>
<li>
<p>Dialog Component Management</p>
<div class="ulist">
<ul>
<li>
<p>Controlling the life-cycle</p>
</li>
<li>
<p>Controlling the dialog flow</p>
</li>
<li>
<p>Providing means of interaction between the dialogs</p>
</li>
<li>
<p>Providing application server access</p>
</li>
<li>
<p>Providing services to the dialog components<br>
(e.g. printing, caching, data storage)</p>
</li>
</ul>
</div>
</li>
<li>
<p>Shutdown of the application</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="application-server-access"><a class="anchor" href="#application-server-access"></a>==  Application Server Access</h4>
<div class="paragraph">
<p>Dialogs will require a back-end application server in order to execute their business logic. Typically in an devonfw application the service layer will provide interfaces for the functionality exposed to the client. These business oriented interfaces should also be present on the client backed by a proxy handling the concrete call of the server over the network. This component provides the set of interfaces as well as the proxy.</p>
</div>
</div>
<div class="sect3">
<h4 id="dialog-container-architecture"><a class="anchor" href="#dialog-container-architecture"></a>Dialog Container Architecture</h4>
<div class="paragraph">
<p>The dialog container can be further structured into the following components with their respective tasks described in own sections:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/devonfw-methodology/OASP_ClientArchitecture_DialogContainer.png"><img src="../_images/images/devonfw-methodology/OASP_ClientArchitecture_DialogContainer.png" alt="Dialog Container Architecture Overview" width="450"></a>
</div>
</div>
<div class="paragraph">
<p><em>Figure 3 Dialog Container Architecture</em></p>
</div>
</div>
<div class="sect3">
<h4 id="application"><a class="anchor" href="#application"></a>==  Application</h4>
<div class="paragraph">
<p>The application component represents the overall client in our architecture. It is responsible for bootstrapping all other components and connecting them with each other. As such it initializes the components below and provides an environment for them to work in.</p>
</div>
</div>
<div class="sect3">
<h4 id="configuration-management"><a class="anchor" href="#configuration-management"></a>==  Configuration Management</h4>
<div class="paragraph">
<p>The configuration management manages the configuration of the client, so the client can be deployed in different environments. This includes configuration of the concrete application server to be called or any other environment-specific property.</p>
</div>
</div>
<div class="sect3">
<h4 id="dialog-management"><a class="anchor" href="#dialog-management"></a>==  Dialog Management</h4>
<div class="paragraph">
<p>The Dialog Management component provides the means to define, create and destroy dialog components. It therefore offers basic life-cycle capabilities for a component. In addition it also allows composition of dialog components in a hierarchy. The life-cycle is then managed along the hierarchy, meaning when creating/destroying a parent dialog, this affects all child components, which are created/destroyed as well.</p>
</div>
</div>
<div class="sect3">
<h4 id="service-registry"><a class="anchor" href="#service-registry"></a>==  Service Registry</h4>
<div class="paragraph">
<p>Apart from dialog components, a client application also consists of services offered to these. A service can thereby encompass among others:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Access to the application server</p>
</li>
<li>
<p>Access to the dialog container functions for managing dialogs or accessing the configuration</p>
</li>
<li>
<p>Dialog independent client functionality such as Printing, Caching, Logging, Encapsulated business logic such as tax calculation</p>
</li>
<li>
<p>Dialog component interaction</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The service registry offers the possibility to define, register and lookup these services. Note that these services could be dependent on the dialog hierarchy, meaning different child instances could obtain different instances / implementations of a service via the service registry, depending on which service implementations are registered by the parents.</p>
</div>
<div class="paragraph">
<p>Services should be defined as interfaces allowing for different implementations and thus loose coupling.</p>
</div>
</div>
<div class="sect3">
<h4 id="dialog-component-architecture"><a class="anchor" href="#dialog-component-architecture"></a>Dialog Component Architecture</h4>
<div class="paragraph">
<p>A dialog component has to support all or a subset of the following tasks:<br>
(T1)	Displaying the user interface incl. internationalization<br>
(T2)	Displaying business data incl. changes made to the data due to user interactions and localization of the data<br>
(T3)	Accepting user input including possible conversion from e.g. entered Text to an Integer<br>
(T4)	Displaying the dialog state<br>
(T5)	Validation of user input<br>
(T6)	Managing the business data incl. business logic altering it due to user interactions<br>
(T7)	Execution of user interactions<br>
(T8)	Managing the state of the dialog (e.g. Edit vs. View)<br>
(T9)	Calling the application server in the course of user interactions</p>
</div>
<div class="paragraph">
<p>Following the principle of separation of concerns, we further structure a dialog component in an own architecture allowing us the distribute responsibility for these tasks along the defined components:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/devonfw-methodology/OASP_ClientArchitecture_DialogComponent.png"><img src="../_images/images/devonfw-methodology/OASP_ClientArchitecture_DialogComponent.png" alt="Dialog Component Architecture" width="450"></a>
</div>
</div>
<div class="paragraph">
<p><em>Figure 4 Overview of dialog component architecture</em></p>
</div>
</div>
<div class="sect3">
<h4 id="presentation-layer"><a class="anchor" href="#presentation-layer"></a>==  Presentation Layer</h4>
<div class="paragraph">
<p>The presentation layer generates and displays the user interface, accepts user input and user actions and binds these to the dialog core layer (T1-5). The tasks of the presentation layer fall into two categories:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Provision of the visual representation (View component)</strong><br>
The presentation layer generates and displays the user interface and accepts user input and user actions. The logical processing of the data, actions and states is performed in the dialog core layer. The data and user interface are displayed in localized and internationalized form.</p>
</li>
<li>
<p><strong>Binding of the visual representation to the dialog core layer</strong><br>
The presentation layer itself does not contain any dialog logic. The data or actions entered by the user are then processed in the dialog core layer. There are three aspects to the binding to the dialog core layer. We refer to “data binding”, “state binding” and “action binding”. Syntactical and (to a certain extent) semantic validations are performed during data binding (e.g. cross-field plausibility checks). Furthermore, the formatted, localized data in the presentation layer is converted into the presentation-independent, neutral data in the dialog core layer (parsing) and vice versa (formatting).</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="dialog-core-layer"><a class="anchor" href="#dialog-core-layer"></a>==  Dialog Core Layer</h4>
<div class="paragraph">
<p>The dialog core layer contains the business logic, the control logic, and the logical state of the dialog. It therefore covers tasks T5-9:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Maintenance of the logical dialog state and the logical data</strong><br>
The dialog core layer maintains the logical dialog state and the logical data in a form which is independent of the presentation. The states of the presentation (e.g. individual widgets) must not be maintained in the dialog core layer, e.g. the view state could lead to multiple presentation states disabling all editable widgets on the view.</p>
</li>
<li>
<p><strong>Implementation of the dialog and dialog control logic</strong><br>
The component parts in the dialog core layer implement the client specific business logic and the dialog control logic. This includes, for example, the manipulation of dialog data and dialog states as well as the opening and closing of dialogs.</p>
</li>
<li>
<p><strong>Communication with the application server</strong><br>
The dialog core layer calls the interfaces of the application server via the application server access component services.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The dialog core layer should not depend on the presentation layer enforcing a strict layering and thus minimizing dependencies.</p>
</div>
</div>
<div class="sect3">
<h4 id="interactions-between-dialog-components"><a class="anchor" href="#interactions-between-dialog-components"></a>==  Interactions between dialog components</h4>
<div class="paragraph">
<p>Dialog components can interact in the following ways:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/devonfw-methodology/OASP_ClientArchitecture_DialogInteractions.png"><img src="../_images/images/devonfw-methodology/OASP_ClientArchitecture_DialogInteractions.png" alt="Dialog Interactions" width="450"></a>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Embedding of dialog components</strong><br>
As already said dialog components can be hierarchically composed. This composition works by embedding on dialog component within the other. Apart from the life-cycle managed by the dialog container, the embedding needs to cope for the visual embedding of the presentation and core layer.</p>
<div class="ulist">
<ul>
<li>
<p><strong>Embedding dialog presentation</strong><br>
The parent dialog needs to either integrate the embedded dialog in its layout or open it in an own model window.</p>
</li>
<li>
<p><strong>Embedding dialog core</strong><br>
The parent dialog needs to be able to access the embedded instance of its children. This allows initializing and changing their data and states. On the other hand the children might require context information offered by the parent dialog by registering services in the hierarchical service registry.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Dialog flow</strong><br>
Apart from the embedding of dialog components representing a tight coupling, dialogs can interact with each other by passing the control of the UI, i.e. switching from one dialog to another.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When interacting, dialog components should interact only between the same or lower layers, i.e. the dialog core should not access the presentation layer of another dialog component.</p>
</div>
</div>
<div class="sect3">
<h4 id="appendix"><a class="anchor" href="#appendix"></a>Appendix</h4>

</div>
<div class="sect3">
<h4 id="notes-about-quasar-client"><a class="anchor" href="#notes-about-quasar-client"></a>Notes about Quasar Client</h4>
<div class="paragraph">
<p>The Quasar client architecture as the consolidated knowledge of our CSD projects is the major source for the above drafted architecture. However, the above is a much simplified and more agile version thereof:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Quasar Client tried to abstract from the concrete UI library being used, so it could decouple the business from the technical logic of a dialog. The presentation layer should be the only one knowing the concrete UI framework used. This level of abstraction was dropped in this reference architecture, although it might of course still make sense in some projects. For fast-moving agile projects in the web however introducing such a level of abstraction takes effort with little gained benefits. With frameworks like Angular 2 we would even introduce one additional seemingly artificial and redundant layer, since it already separates the dialog core from its presentation.</p>
</li>
<li>
<p>In the past and in the days of Struts, JSF, etc. the concept of session handling was important for the client since part of the client was sitting on a server with a session relating it to its remote counterpart on the users PC. Quasar Client catered for this need, by very prominently differentiating between session and application in the root of the dialog component hierarchy. However, in the current days of SPA applications and the lowered importance of servers-side web clients, this prominent differentiation was dropped. When still needed the referenced documents will provide in more detail how to tailor the respective architecture to this end.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="references"><a class="anchor" href="#references"></a>References</h4>
<div class="ulist">
<ul>
<li>
<p>Architecture Guidelines for Application Design:
<a href="https://troom.capgemini.com/sites/vcc/engineering/Cross%20Cutting/ArchitectureGuide/Architecture_Guidelines_for_Application_Design_v2.0.docx" class="bare">https://troom.capgemini.com/sites/vcc/engineering/Cross%20Cutting/ArchitectureGuide/Architecture_Guidelines_for_Application_Design_v2.0.docx</a></p>
</li>
<li>
<p>Quasar Client Architecture:
<a href="https://troom.capgemini.com/sites/vcc/Shared%20Documents/CrossCuttingContent/TopicOrientedCCC/QuasarOverview/NCE%20Quasar%20Review%20Workshop%202009-11-17/Quasar%20Development/Quasar-Client-Architectures.doc" class="bare">https://troom.capgemini.com/sites/vcc/Shared%20Documents/CrossCuttingContent/TopicOrientedCCC/QuasarOverview/NCE%20Quasar%20Review%20Workshop%202009-11-17/Quasar%20Development/Quasar-Client-Architectures.doc</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="layers-3"><a class="anchor" href="#layers-3"></a>Layers</h2>
<div class="sectionbody">
<!-- toc disabled -->
<div class="sect3">
<h4 id="components-layer"><a class="anchor" href="#components-layer"></a>Components Layer</h4>
<div class="paragraph">
<p>The components layer encapsulates all components presenting the current application view state, which means data to be shown to the user.
The term component refers to a component described by the standard <a href="https://www.w3.org/standards/techs/components">Web Components</a>.
So this layer has all Angular components, directives and pipes defined for an application.
The main challenges are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>how to structure the components layer (see <a href="guide-file-structure">File Structure Guide</a>)</p>
</li>
<li>
<p>decompose components into maintainable chunks (see <a href="guide-component-decomposition">Component Decomposition Guide</a>)</p>
</li>
<li>
<p>handle component interaction</p>
</li>
<li>
<p>manage calls to the services layer</p>
</li>
<li>
<p>apply a maintainable data and event flow throughout the component tree</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="smart-and-dumb-components"><a class="anchor" href="#smart-and-dumb-components"></a>Smart and Dumb Components</h4>
<div class="paragraph">
<p>The architecture applies the concept of <em>Smart</em> and <em>Dumb Components</em> (syn. <em>Containers</em> and <em>Presenters</em>).
The concept means that components are divided into <em>Smart</em> and <em>Dumb Components</em>.</p>
</div>
<div class="paragraph">
<p>A <em>Smart Component</em> typically is a top-level dialog inside the component tree.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a component, that can be routed to</p>
</li>
<li>
<p>a modal dialog</p>
</li>
<li>
<p>a component, which is placed inside <code>AppComponent</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A <em>Dumb Component</em> can be used by one to many <em>Smart Components</em>.
Inside the component tree a <em>Dumb Component</em> is a child of a <em>Smart Component</em>.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<a class="image" href="images/component-tree.svg"><img src="../_images/images/component-tree.svg" alt="Component Tree" width="450"></a>
</div>
<div class="title">Figure 3. Component tree example</div>
</div>
<div class="paragraph">
<p>As shown the topmost component is always the <code>AppComponent</code> in Angular applications.
The component tree describes the hierarchy of components starting from <code>AppComponent</code>.
The figure shows <em>Smart Components</em> in blue and <em>Dumb Components</em> in green.
<code>AppComponent</code> is a <em>Smart Component</em> by definition.
Inside the template of <code>AppComponent</code> placed components are static components inside the component tree.
So they are always displayed.
In the example <code>OverviewComponent</code> and <code>DetailsComponent</code> are rendered by Angular compiler depending on current URL the application displays.
So <code>OverviewComponents</code> sub-tree is displayed if the URL is <code>/overview</code> and <code>DetailsComponents</code> sub-tree is displayed if the URL is <code>/details</code>.
To clarify this distinction further the following table shows the main differences.</p>
</div>
<div class="paragraph">
<div class="title">Smart vs Dumb Components</div>
<p>|== =
|<em>Smart Components</em> |<em>Dumb Components</em></p>
</div>
<div class="paragraph">
<p>|contain the current view state
|show data via binding (<code>@Input</code>) and contain no view state</p>
</div>
<div class="paragraph">
<p>|handle events emitted by <em>Dumb Components</em>
|pass events up the component tree to be handled by <em>Smart Components</em> (<code>@Output</code>)</p>
</div>
<div class="paragraph">
<p>|call the services layer
|never call the services layer</p>
</div>
<div class="paragraph">
<p>|use services
|do not use services</p>
</div>
<div class="paragraph">
<p>|consists of n <em>Dumb Components</em>
|is independent of <em>Smart Components</em>
|== =</p>
</div>
</div>
<div class="sect3">
<h4 id="interaction-of-smart-and-dumb-components"><a class="anchor" href="#interaction-of-smart-and-dumb-components"></a>Interaction of Smart and Dumb Components</h4>
<div class="paragraph">
<p>With the usage of the <em>Smart</em> and <em>Dumb Components</em> pattern one of the most important part is component interaction.
Angular comes with built in support for component interaction with <code>@Input()</code> and <code>@Output()</code> Decorators.
The following figure illustrates an unidirectional data flow.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Data always goes down the component tree - from a <em>Smart Component</em> down its children.</p>
</li>
<li>
<p>Events bubble up, to be handled by a <em>Smart Component</em>.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<a class="image" href="images/smart-dumb-components-interaction.svg"><img src="../_images/images/smart-dumb-components-interaction.svg" alt="Smart and Dumb Components Interaction" width="450"></a>
</div>
<div class="title">Figure 4. Smart and Dumb Component Interaction</div>
</div>
<div class="paragraph">
<p>As shown a <em>Dumb Components</em> role is to define a signature by declaring Input and Output Bindings.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>@Input()</code> defines what data is necessary for that component to work</p>
</li>
<li>
<p><code>@Output()</code> defines which events can be listened on by the parent component</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Listing 1. Dumb Components define a signature</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">export class ValuePickerComponent {

  @Input() columns: string[];
  @Input() items: {}[];
  @Input() selected: {};
  @Input() filter: string;
  @Input() isChunked = false;
  @Input() showInput = true;
  @Input() showDropdownHeader = true;

  @Output() elementSelected = new EventEmitter&lt;{}&gt;();
  @Output() filterChanged = new EventEmitter&lt;string&gt;();
  @Output() loadNextChunk = new EventEmitter();
  @Output() escapeKeyPressed = new EventEmitter();

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The example shows the <em>Dumb Component</em> <code>ValuePickerComponent</code>.
It describes seven input bindings with <code>isChunked</code>, <code>showHeader</code> and <code>showDropdownHeader</code> being non mandatory as they have a default value.
Four output bindings are present. Typically, a <em>Dumb Component</em> has very little code to no code inside the TypeScript class.</p>
</div>
<div class="listingblock">
<div class="title">Listing 2. Smart Components use the Dumb Components signature inside the template</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;div&gt;

  &lt;value-input
    ...&gt;
  &lt;/value-input&gt;

  &lt;value-picker
    *ngIf="isValuePickerOpen"
    [columns]="columns"
    [items]="filteredItems"
    [isChunked]="isChunked"
    [filter]="filter"
    [selected]="selectedItem"
    [showDropdownHeader]="showDropdownHeader"
    (loadNextChunk)="onLoadNextChunk()"
    (elementSelected)="onElementSelected($event)"
    (filterChanged)="onFilterChanged($event)"
    (escapeKeyPressed)="onEscapePressedInsideChildTable()"&gt;
  &lt;/value-picker&gt;

&lt;/div&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Inside the <em>Smart Components</em> template the events emitted by <em>Dumb Components</em> are handled.
It is a good practice to name the handlers with the prefix <code>on*</code> (e.g. <code>onInputChanged()</code>).</p>
</div>
<!-- toc disabled -->
</div>
<div class="sect3">
<h4 id="services-layer"><a class="anchor" href="#services-layer"></a>Services Layer</h4>
<div class="paragraph">
<p>The services layer is more or less what we call 'business logic layer' on the server side.
It is the layer where the business logic is placed.
The main challenges are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Define application state and an API for the components layer to use it</p>
</li>
<li>
<p>Handle application state transitions</p>
</li>
<li>
<p>Perform back-end interaction (XHR, WebSocket, etc.)</p>
</li>
<li>
<p>Handle business logic in a maintainable way</p>
</li>
<li>
<p>Configuration management</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All parts of the services layer are described in this chapter.
An example which puts the concepts together can be found at the end <a href="#interaction-of-smart-components-through-the-services-layer">Interaction of Smart Components through the services layer</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="boundaries"><a class="anchor" href="#boundaries"></a>Boundaries</h4>
<div class="paragraph">
<p>There are two APIs for the components layer to interact with the services layer:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A store can be subscribed to for receiving state updates over time</p>
</li>
<li>
<p>A use case service can be called to trigger an action</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To illustrate the fact the following figure shows an abstract overview.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/components-layer-service-layer-boundaries.svg"><img src="../_images/images/components-layer-service-layer-boundaries.svg" alt="Smart and Dumb Components Interaction" width="450"></a>
</div>
<div class="title">Figure 5. Boundaries to components layer</div>
</div>
</div>
<div class="sect3">
<h4 id="store"><a class="anchor" href="#store"></a>Store</h4>
<div class="paragraph">
<p>A store is a class which defines and handles application state with its transitions over time.
Interaction with a store is always synchronous.
A basic implementation using RxJS can look like this.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
A more profound implementation taken from a real-life project can be found here (<a href="cookbook-abstract-class-store">Abstract Class Store</a>).
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Listing 3. Store defined using RxJS</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">@Injectable()
export class ProductSearchStore {

  private stateSource = new BehaviorSubject&lt;ProductSearchState&gt;(defaultProductSearchState);
  state$ = this.stateSource.asObservable();

  setLoading(isLoading: boolean) {
    const currentState = this.stateSource.getValue();
    this.stateSource.next({
      isLoading: isLoading,
      products: currentState.products,
      searchCriteria: currentState.searchCriteria
    });
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example <code>ProductSearchStore</code> handles state of type <code>ProductSearchState</code>.
The public API is the property <code>state$</code> which is an observable of type <code>ProductSearchState</code>.
The state can be changed with method calls.
So every desired change to the state needs to be modeled with an method.
In reactive terminology this would be an <em>Action</em>.
The store does not use any services.
Subscribing to the <code>state$</code> observable leads to the subscribers receiving every new state.</p>
</div>
<div class="paragraph">
<p>This is basically the <em>Observer Pattern</em>:<br>
The store consumer registers itself to the observable via <code>state$.subscribe()</code> method call.
The first parameter of <code>subscribe()</code> is a callback function to be called when the subject changes.
This way the consumer - the observer - is registered.
When next() is called with a new state inside the store, all callback functions are called with the new value.
So every observer is notified of the state change.
This equals the <em>Observer Pattern</em> push type.</p>
</div>
<div class="paragraph">
<p>A store is the API for <em>Smart Components</em> to receive state from the service layer.
State transitions are handled automatically with <em>Smart Components</em> registering to the <code>state$</code> observable.</p>
</div>
</div>
<div class="sect3">
<h4 id="use-case-service"><a class="anchor" href="#use-case-service"></a>Use Case Service</h4>
<div class="paragraph">
<p>A use case service is a service which has methods to perform asynchronous state transitions.
In reactive terminology this would be an <em>Action of Actions</em> - a thunk (<code>redux</code>) or an effect (<code>@ngrx</code>).</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/use-case-service.svg"><img src="../_images/images/use-case-service.svg" alt="Use Case Service" width="450"></a>
</div>
<div class="title">Figure 6. Use case services are the main API to trigger state transitions</div>
</div>
<div class="paragraph">
<p>A use case services method - an action - interacts with adapters, business services and stores.
So use case services orchestrate whole use cases.
For an example see <code><a href="#usecaseservice-example">use case service example</a></code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="adapter"><a class="anchor" href="#adapter"></a>Adapter</h4>
<div class="paragraph">
<p>An adapter is used to communicate with the back-end.
This could be a simple XHR request, a WebSocket connection, etc.
An adapter is simple in the way that it does not add anything other than the pure network call.
So there is no caching or logging performed here.
The following listing shows an example.</p>
</div>
<div class="paragraph">
<p>For further information on back-end interaction see <a href="guide-consuming-rest-services">Consuming REST Services</a></p>
</div>
<div class="listingblock">
<div class="title">Listing 4. Calling the back-end via an adapter</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">@Injectable()
export class ProducsAdapter {

  private baseUrl = environment.baseUrl;

  constructor(private http: HttpClient) { }

  getAll(): Observable&lt;Product[]&gt; {
    return this.http.get&lt;Product[]&gt;(this.baseUrl + '/products');
  }

}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="interaction-of-smart-components-through-the-services-layer"><a class="anchor" href="#interaction-of-smart-components-through-the-services-layer"></a>Interaction of Smart Components through the services layer</h4>
<div class="paragraph">
<p>The interaction of smart components is a classic problem which has to be solved in every UI technology.
It is basically how one dialog tells the other something has changed.</p>
</div>
<div class="paragraph">
<p>An example is <em>adding an item to the shopping basket</em>.
With this action there need to be multiple state updates.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The small logo showing how many items are currently inside the basket needs to be updated from 0 to 1</p>
</li>
<li>
<p>The price needs to be recalculated</p>
</li>
<li>
<p>Shipping costs need to be checked</p>
</li>
<li>
<p>Discounts need to be updated</p>
</li>
<li>
<p>Ads need to be updated with related products</p>
</li>
<li>
<p>etc.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="pattern"><a class="anchor" href="#pattern"></a>Pattern</h4>
<div class="paragraph">
<p>To handle this interaction in a scalable way we apply the following pattern.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/smart-component-interaction-via-services-layer.svg"><img src="../_images/images/smart-component-interaction-via-services-layer.svg" alt="Interaction of Smart Components via services layer" width="450"></a>
</div>
<div class="title">Figure 7. Smart Component interaction</div>
</div>
<div class="paragraph">
<p>The state of interest is encapsulated inside a store. All <em>Smart Components</em> interested in the state have to subscribe to the store&#8217;s API served by the public observable. Thus, with every update to the store the subscribed components receive the new value. The components basically react to state changes. Altering a store can be done directly if the desired change is synchronous. Most actions are of asynchronous nature so the <code>UseCaseService</code> comes into play. Its actions are <code>void</code> methods, which implement a use case, i.e., adding a new item to the basket. It calls asynchronous actions and can perform multiple store updates over time.</p>
</div>
<div class="paragraph">
<p>To put this pattern into perspective the <code>UseCaseService</code> is a programmatic alternative to <code>redux-thunk</code> or <code>@ngrx/effects</code>. The main motivation here is to use the full power of TypeScript <code>--strictNullChecks</code> and to let the learning curve not to become as steep as it would be when learning a new state management framework. This way actions are just <code>void</code> method calls.</p>
</div>
</div>
<div class="sect3">
<h4 id="example"><a class="anchor" href="#example"></a>Example</h4>
<div class="imageblock">
<div class="content">
<a class="image" href="images/smart-smart-components-example.svg"><img src="../_images/images/smart-smart-components-example.svg" alt="Smart component interaction example" width="450"></a>
</div>
<div class="title">Figure 8. Smart Components interaction example</div>
</div>
<div class="paragraph">
<p>The example shows two <em>Smart Components</em> sharing the <code>FlightSearchState</code> by using the <code>FlightSearchStore</code>.
The use case shown is started by an event in the <em>Smart Component</em> <code>FlightSearchComponent</code>. The action <code>loadFlight()</code> is called. This could be submitting a search form.
The <code>UseCaseService</code> is <code>FlightSearchService</code>, which handles the use case <em>Load Flights</em>.</p>
</div>
<div class="paragraph">
<div class="title"><code>UseCaseService</code> example</div>
<p><code><a id="usecaseservice-example"></a></code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">export class FlightSearchService {

  constructor(
    private flightSearchAdapter: FlightSearchAdapter,
    private store: FlightSearchStore
  ) { }

  loadFlights(criteria: FlightSearchCriteria): void {
    this.store.setLoadingFlights(true);
    this.store.clearFlights();

    this.flightSearchAdapter.getFlights(criteria.departureDate,
        {
          from: criteria.departureAirport,
          to: criteria.destinationAirport
        })
      .finally(() =&gt; this.store.setLoadingFlights(false))
      .subscribe((result: FlightTo[]) =&gt; this.store.setFlights(result, criteria));
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>First the loading flag is set to <code>true</code> and the current flights are cleared. This leads the <em>Smart Component</em> showing a spinner indicating the loading action. Then the asynchronous XHR is triggered by calling the adapter. After completion the loading flag is set to <code>false</code> causing the loading indication no longer to be shown. If the XHR was successful, the data would be put into the store. If the XHR was not successful, this would be the place to handle a custom error. All general network issues should be handled in a dedicated class, i.e., an interceptor. So for example the basic handling of 404 errors is not done here.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="guides-2"><a class="anchor" href="#guides-2"></a>Guides</h2>
<div class="sectionbody">
<!-- toc disabled -->
<div class="sect3">
<h4 id="package-managers"><a class="anchor" href="#package-managers"></a>Package Managers</h4>
<div class="paragraph">
<p>There are two major package managers currently used for JavaScript / TypeScript projects which leverage NodeJS as a build platform.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="https://www.npmjs.com/">npm</a></p>
</li>
<li>
<p><a href="https://yarnpkg.com">yarn</a></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Our recommendation is to use yarn but both package managers are fine.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
When using npm it is important to use a version greater 5.0 as npm 3 has major drawbacks compared to yarn.
The following guide assumes that you are using npm &gt;= 5 or yarn.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Before you start reading further, please take a look at the docs:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://yarnpkg.com/en/docs/getting-started">yarn getting started</a></p>
</li>
<li>
<p><a href="https://docs.npmjs.com/getting-started/what-is-npm">npm getting started</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following guide will describe best practices for working with yarn / npm.</p>
</div>
</div>
<div class="sect3">
<h4 id="semantic-versioning"><a class="anchor" href="#semantic-versioning"></a>Semantic Versioning</h4>
<div class="paragraph">
<p>When working with package managers it is very important to understand the concept of <a href="https://semver.org/">semantic versioning</a>.</p>
</div>
<div class="paragraph">
<div class="title">Version example 1.2.3</div>
<p>|== == == =
|Version                        |1.             |2.             |3
|Version name when incrementing |Major (2.0.0)  |Minor (1.3.0)  |Patch (1.2.4)
|Has breaking changes           |yes            |no             |no
|Has features                   |yes            |yes            |no
|Has bug fixes                   |yes            |yes            |yes
|== == == =</p>
</div>
<div class="paragraph">
<p>The table gives an overview of the most important parts of semantic versioning.
In the header version 1.2.3 is displayed.
The first row shows the name and the resulting version when incrementing a part of the version.
The next rows show specifics of the resulting version - e.g. a major version can have breaking changes, features and bug fixes.</p>
</div>
<div class="paragraph">
<p>Packages from npm and yarn leverage semantic versioning and instead of selecting a fixed version one can specify a selector.
The most common selectors are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>^1.2.3</strong>
At least 1.2.3 - 1.2.4 or 1.3.0 can be used, 2.0.0 can not be used</p>
</li>
<li>
<p><strong>~1.2.3</strong>
At lease 1.2.3 - 1.2.4 can be used, 2.0.0 and 1.3.0 can not be used</p>
</li>
<li>
<p><strong>&gt;=1.2.3</strong>
At least 1.2.3 - every version greater can also be used</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This achieves a lower number of duplicates.
To give an example:</p>
</div>
<div class="paragraph">
<p>If package A needs version 1.3.0 of package C and package B needs version 1.4.0 of package C one would end up with 4 packages.</p>
</div>
<div class="paragraph">
<p>If package A needs version ^1.3.0 of package C and package B needs version 1.4.0 of package C one would end up with 3 packages.
A would use the same version of C as B - 1.4.0.</p>
</div>
</div>
<div class="sect3">
<h4 id="do-not-modify-package-json-and-lock-files-by-hand"><a class="anchor" href="#do-not-modify-package-json-and-lock-files-by-hand"></a>Do not modify package.json and lock files by hand</h4>
<div class="paragraph">
<p>Dependencies are always added using a yarn or npm command.
Altering the package.json, package-json.lock or yarn.lock file by hand is not recommended.</p>
</div>
<div class="paragraph">
<p>Always use a yarn or npm command to add a new dependency.</p>
</div>
<div class="paragraph">
<p>Adding the package <code>express</code> with yarn to dependencies.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">yarn add express</code></pre>
</div>
</div>
<div class="paragraph">
<p>Adding the package <code>express</code> with npm to dependencies.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">npm install express</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="what-does-the-lock-file-do"><a class="anchor" href="#what-does-the-lock-file-do"></a>What does the lock file do</h4>
<div class="paragraph">
<p>The purpose of files <code>yarn.lock</code> and <code>package-json.lock</code> is to freeze versions for a short time.</p>
</div>
<div class="paragraph">
<p>The following problem is solved:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Developer A upgrades the dependency <code>express</code> to fixed version <code>4.16.3</code>.</p>
</li>
<li>
<p><code>express</code> has sub-dependency <code>accepts</code> with version selector <code>~1.3.5</code></p>
</li>
<li>
<p>His local <code>node_modules</code> folder receives <code>accepts</code> in version <code>1.3.5</code></p>
</li>
<li>
<p>On his machine everything is working fine</p>
</li>
<li>
<p>Afterward version <code>1.3.6</code> of <code>accepts</code> is published - it contains a major bug</p>
</li>
<li>
<p>Developer B now clones the repo and loads the dependencies.</p>
</li>
<li>
<p>He receives version <code>1.3.6</code> of <code>accepts</code> and blames developer A for upgrading to a broken version.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Both <code>yarn.lock</code> and <code>package-json.lock</code> freeze all the dependencies.
For example in yarn lock you will find.</p>
</div>
<div class="listingblock">
<div class="title">Listing 5. yarn.lock example (excerp)</div>
<div class="content">
<pre class="highlightjs highlight"><code>accepts@~1.3.5:
  version "1.3.5"
  resolved "[...URL to registry]"
  dependencies:
    mime-types "~2.1.18"
    negotiator "0.6.1"

mime-db@~1.33.0:
  version "1.33.0"
  resolved "[...URL to registry]"

mime-types@~2.1.18:
  version "2.1.18"
  resolved "[...URL to registry]"
  dependencies:
    mime-db "~1.33.0"

negotiator@0.6.1:
  version "0.6.1"
  resolved "[...URL to registry]"</code></pre>
</div>
</div>
<div class="paragraph">
<p>The described problem is solved by the example yarn.lock file.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>accepts</code> is frozen at version <code>~1.3.5</code></p>
</li>
<li>
<p>All of its sub-dependencies are also frozen.
It needs <code>mime-types</code> at version <code>~2.1.18</code> which is frozen at <code>2.1.18</code>.
<code>mime-types</code> needs <code>mime-db</code> at <code>~1.33.0</code> which is frozen at <code>1.33.0</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Every developer will receive the same versions of every dependency.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
You have to make sure all your developers are using the same npm/yarn version - this includes the CI build.
</td>
</tr>
</table>
</div>
<!-- toc disabled -->
</div>
<div class="sect3">
<h4 id="package-managers-workflow"><a class="anchor" href="#package-managers-workflow"></a>Package Managers Workflow</h4>

</div>
<div class="sect3">
<h4 id="introduction-2"><a class="anchor" href="#introduction-2"></a>Introduction</h4>
<div class="paragraph">
<p>This document aims to provide you the necessary documentation and sources in order to help you understand the importance of dependencies between packages.</p>
</div>
<div class="paragraph">
<p>Projects in NodeJS make use of modules, chunks of reusable code made by other people or teams. These small chunks of reusable code are called packages <sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup>. Packages are used to solve specific problems or tasks. These relations between your project and the external packages are called dependencies.</p>
</div>
<div class="paragraph">
<p>For example, imagine we are doing a small program that takes your birthday as an input and tells you how many days are left until your birthday. We search in the repository if someone has published a package to retrieve the actual date and manage date types, and maybe we could search for another package to show a calendar, because we want to optimize our time, and we wish the user to click a calendar button and choose the day in the calendar instead of typing it.</p>
</div>
<div class="paragraph">
<p>As you can see, packages are convenient. In some cases, they may be even needed, as they can manage aspects of your program you may not be proficient in, or provide an easier use of them.</p>
</div>
<div class="paragraph">
<p>For more comprehensive information visit <a href="https://docs.npmjs.com/getting-started/what-is-npm">npm definition</a></p>
</div>
</div>
<div class="sect3">
<h4 id="package-json"><a class="anchor" href="#package-json"></a>Package.json</h4>
<div class="paragraph">
<p>Dependencies in your project are stored in a file called package.json. Every package.json must contain, at least, the name and version of your project.</p>
</div>
<div class="paragraph">
<p>Package.json is located in the root of your project.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
If package.json is not on your root directory refer to <a href="#problems-you-may-encounter">Problems you may encounter</a> section
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you wish to learn more information about package.json, click on the following links:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://yarnpkg.com/en/docs/package-json">Yarn Package.json</a></p>
</li>
<li>
<p><a href="https://docs.npmjs.com/getting-started/using-a-package.json">npm Package.json</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="content-of-package-json"><a class="anchor" href="#content-of-package-json"></a>==  Content of package.json</h4>
<div class="paragraph">
<p>As you noticed, package.json is a really important file in your project. It contains essential information about our project, therefore you need to understand what&#8217;s inside.</p>
</div>
<div class="paragraph">
<p>The structure of package.json is divided in blocks, inside the first one you can find essential information of your project such as the name, version, license and optionally some <a href="#Scripts">[Scripts]</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "name": "exampleproject",
  "version": "0.0.0",
  "license": "MIT",
  "scripts": {
    "ng": "ng",
    "start": "ng serve",
    "build": "ng build",
    "test": "ng test",
    "lint": "ng lint",
    "e2e": "ng e2e"
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The next block is called <em>dependencies</em> and contains the packages that project needs in order to be developed, compiled and executed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">"private": true,
  "dependencies": {
    "@angular/animations": "^4.2.4",
    "@angular/common": "^4.2.4",
    "@angular/forms": "^4.2.4",
    ...
    "zone.js": "^0.8.14"
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>After <em>dependencies</em> we find <code><strong><em>devDependencies</em></strong></code>, another kind of dependencies present in the development of the application but unnecessary for its execution. One example is typescript. Code is written in typescript, and then, <em>transpiled</em> to JavaScript. This means the application is not using typescript in execution and consequently not included in the deployment of our application.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">"devDependencies": {
    "@angular/cli": "1.4.9",
    "@angular/compiler-cli": "^4.2.4",
    ...
    "@types/node": "~6.0.60",
    "typescript": "~2.3.3"
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Having a peer dependency means that your package needs a dependency that is the same exact dependency as the person installing your package</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">"peerDependencies": {
    "package-123": "^2.7.18"
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Optional dependencies are just that: optional. If they fail to install, Yarn will still say the install process was successful.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">"optionalDependencies": {
    "package-321": "^2.7.18"
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally you can have bundled dependencies which are packages bundled together when publishing your package in a repository.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "bundledDependencies": [
    "package-4"
  ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is the link to an in-depth explanation of <a href="https://yarnpkg.com/en/docs/dependency-types">dependency types</a>&#8203;.</p>
</div>
</div>
<div class="sect3">
<h4 id="scripts"><a class="anchor" href="#scripts"></a>==  Scripts</h4>
<div class="paragraph">
<p>Scripts are a great way of automating tasks related to your package, such as simple build processes or development tools.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "name": "exampleproject",
  "version": "0.0.0",
  "license": "MIT",
  "scripts": {
    "build-project": "node hello-world.js",
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can run that script by running the command <code>yarn (run) script</code> or <code>npm run script</code>, check the example below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ yarn (run) build-project    # run is optional
$ npm run build-project</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are special reserved words for scripts, like pre-install, which will execute the script automatically
before the package you install are installed.</p>
</div>
<div class="paragraph">
<p>Check different uses for scripts in the following links:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://yarnpkg.com/en/docs/package-json#toc-scripts">Yarn scripts documentation</a></p>
</li>
<li>
<p><a href="https://docs.npmjs.com/misc/scripts">npm scripts documentation</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Or you can go back to
<a href="#Content of package.json">[Content of package.json]</a>&#8203;.<br></p>
</div>
</div>
<div class="sect3">
<h4 id="managing-dependencies"><a class="anchor" href="#managing-dependencies"></a>Managing dependencies</h4>
<div class="paragraph">
<p>In order to manage dependencies we recommend using package managers in your projects.</p>
</div>
<div class="paragraph">
<p>A big reason is their usability. Adding or removing a package is really easy, and by doing so, packet manager update the package.json and copies (or removes) the package in the needed location, with a single command.</p>
</div>
<div class="paragraph">
<p>Another reason, closely related to the first one, is reducing human error by automating the package management process.</p>
</div>
<div class="paragraph">
<p>Two of the package managers you can use in NodeJS projects are "yarn" and "npm". While you can use both, we encourage you to use only one of them while working on projects. Using both may lead to different dependencies between members of the team.</p>
</div>
</div>
<div class="sect3">
<h4 id="npm"><a class="anchor" href="#npm"></a>==  npm</h4>
<div class="paragraph">
<p>We&#8217;ll start by installing npm following this small guide <a href="https://docs.npmjs.com/getting-started/installing-node">here</a>.</p>
</div>
<div class="paragraph">
<p>As stated on the web, npm comes inside of NodeJS, and must be updated after installing NodeJS, in the same guide you used earlier are written the instructions to update npm.</p>
</div>
<div class="paragraph">
<p><strong>How npm works</strong></p>
</div>
<div class="paragraph">
<p>In order to explain how npm works, let&#8217;s take a command as an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ npm install @angular/material @angular/cdk</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command tells npm to look for the packages <code>@angular/material</code> and <code>@angular/cdk</code> in the npm registry, download and decompress them in the folder node_modules along with their own dependencies. Additionally, npm will update package.json and create a new file called package-lock.json.</p>
</div>
<div class="paragraph">
<p>After initialization and installing the first package there will be a new folder called node_modules in your project. This folder is where your packages are unzipped and stored, following a tree scheme.</p>
</div>
<div class="paragraph">
<p>Take in consideration both npm and yarn need a package.json in the root of your project in order to work properly. If after creating your project don&#8217;t have it, download again the package.json from the repository or you&#8217;ll have to start again.</p>
</div>
<div class="paragraph">
<p><strong>Brief overview of commands</strong></p>
</div>
<div class="paragraph">
<p>If we need to create a package.json from scratch, we can use the command <strong>init</strong>. This command asks the user for basic information about the project and creates a brand new package.json.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ npm init</code></pre>
</div>
</div>
<div class="paragraph">
<p>Install (or i) installs all modules listed as dependencies in package.json <strong>locally</strong>. You can also specify a package, and install that package. Install can also be used with the parameter <code>-g</code>, which tells npm to install the <a href="#Global package">[Global package]</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ npm install
$ npm i
$ npm install Package</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Earlier versions of npm did <strong>not</strong> add dependencies to package.json unless it was used with the flag <code>--save</code>, so npm install package would be npm install <code>--save</code> package, you have one example below.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ npm install --save Package</code></pre>
</div>
</div>
<div class="paragraph">
<p>Npm needs flags in order to know what kind of dependency you want in your project, in npm you need to put the flag <code>-D</code> or <code>--save-dev</code> to install <code>devDependencies</code>, for more information consult the links at the end of this section.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ npm install -D package
$ npm install --save-dev package</code></pre>
</div>
</div>
<div class="paragraph">
<p>&#8203;</p>
</div>
<div class="paragraph">
<p>The next command uninstalls the module you specified in the command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ npm uninstall Package</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>ls</code> command shows us the dependencies like a nested tree, useful if you have few packages, not so useful when you need a lot of packages.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ npm ls</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>npm@@VERSION@ /path/to/npm
└─┬ init-package-json@0.0.4
  └── promzard@0.1.5</pre>
</div>
</div>
<div class="paragraph">
<div class="title">example tree</div>
<p>We recommend you to learn more about npm commands in the following <a href="https://docs.npmjs.com/">link</a>, navigating to the section CLI commands.</p>
</div>
<div class="paragraph">
<p><strong>About Package-lock.json</strong></p>
</div>
<div class="paragraph">
<p>Package-lock.json describes the dependency tree resulting of using package.json and npm.
Whenever you update, add or remove a package, package-lock.json is deleted and redone with
the new dependencies.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json"> "@angular/animations": {
      "version": "4.4.6",
      "resolved": "https://registry.npmjs.org/@angular/animations/-/animations-4.4.6.tgz",
      "integrity": "sha1-+mYYmaik44y3xYPHpcl85l1ZKjU=",
      "requires": {
        "tslib": "1.8.0"
      }</code></pre>
</div>
</div>
<div class="paragraph">
<p>This lock file is checked every time the command npm i (or npm install) is used without specifying a package,
in the case it exists and it&#8217;s valid, npm will install the exact tree that was generated, such that subsequent
installs are able to generate identical dependency trees.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
It is <strong>not</strong> recommended to modify this file yourself. It&#8217;s better to leave its management to npm.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>More information is provided by the npm team at <a href="https://docs.npmjs.com/files/package-lock.json">package-lock.json</a></p>
</div>
</div>
<div class="sect3">
<h4 id="yarn"><a class="anchor" href="#yarn"></a>==  Yarn</h4>
<div class="paragraph">
<p>Yarn is an alternative to npm, if you wish to install yarn follow the guide <a href="https://yarnpkg.com/en/docs/install">getting started with yarn</a> and download the correct version for your operative system. NodeJS is also needed you can find it <a href="https://nodejs.org/en/">here</a>.</p>
</div>
<div class="paragraph">
<p><strong>Working with yarn</strong></p>
</div>
<div class="paragraph">
<p>Yarn is used like npm, with small differences in syntax, for example <em>npm install module</em> is changed to <em>yarn add module</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ yarn add @covalent</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command is going to download the required packages, modify package.json, put the package in the folder node_modules and makes a new yarn.lock with the new dependency.</p>
</div>
<div class="paragraph">
<p>However, unlike npm, yarn maintains a cache with packages you download inside. You don&#8217;t need to download every file every time you do a general installation. This means installations faster than npm.</p>
</div>
<div class="paragraph">
<p>Similarly to npm, yarn creates and maintains his own lock file, called yarn.lock. Yarn.lock gives enough information about the project for dependency tree to be reproduced.</p>
</div>
<div class="paragraph">
<p><strong>yarn commands</strong></p>
</div>
<div class="paragraph">
<p>Here we have a brief description of yarn&#8217;s most used commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ yarn add Package
$ yarn add --dev Package</code></pre>
</div>
</div>
<div class="paragraph">
<p>Adds a package <strong>locally</strong> to use in your package. Adding the flags <code>--dev</code> or <code>-D</code> will add them to <code>devDependencies</code> instead of the default dependencies, if you need more information check the links at the end of the section.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ yarn init</code></pre>
</div>
</div>
<div class="paragraph">
<p>Initializes the development of a package.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ yarn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>Installs all the dependencies defined in a package.json file, you can also write "yarn" to achieve the same effect.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ yarn remove Package</code></pre>
</div>
</div>
<div class="paragraph">
<p>You use it when you wish to remove a package from your project.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ yarn global add Package</code></pre>
</div>
</div>
<div class="paragraph">
<p>Installs the <a href="#Global package">[Global package]</a>.</p>
</div>
<div class="paragraph">
<p>Please, refer to the documentation to learn more about yarn commands and their attributes: <a href="https://yarnpkg.com/en/docs/cli/">yarn commands</a></p>
</div>
<div class="paragraph">
<p><strong>yarn.lock</strong></p>
</div>
<div class="paragraph">
<p>This file has the same purpose as Package-lock.json, to guide the packet manager, in this case yarn,
to install the dependency tree specified in yarn.lock.</p>
</div>
<div class="paragraph">
<p>Yarn.lock and package.json are
essential files when collaborating in a project more co-workers and may be a
source of errors if programmers do not use the same manager.</p>
</div>
<div class="paragraph">
<p>Yarn.lock follows the same structure as package-lock.json, you can find an example of dependency below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">"@angular/animations@^4.2.4":
  version "4.4.6"
  resolved "https://registry.yarnpkg.com/@angular/animations/-/animations-4.4.6.tgz#fa661899a8a4e38cb7c583c7a5c97ce65d592a35"
  dependencies:
    tslib "^1.7.1"</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
As with package-lock.json, it&#8217;s strongly <strong>not</strong> advised to modify this file. Leave its management to yarn
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can learn more about yarn.lock here: <a href="https://yarnpkg.com/en/docs/yarn-lock">yarn.lock</a></p>
</div>
</div>
<div class="sect3">
<h4 id="global-package"><a class="anchor" href="#global-package"></a>==  Global package</h4>
<div class="paragraph">
<p>Global packages are packages installed in your operative system instead of your local project,
global packages useful for developer tooling that is not part of any individual project but instead is used for local commands.</p>
</div>
<div class="paragraph">
<p>A good example of global package is <code>@angular/cli</code>, a command line interface for angular used in our projects. You can install
a global package in npm with "npm install -g package" and "yarn global add package" with yarn, you have a npm example below:</p>
</div>
<div class="listingblock">
<div class="title">Listing 6. npm global package</div>
<div class="content">
<pre>npm install –g @angular/cli</pre>
</div>
</div>
<div class="paragraph">
<p><a href="https://docs.npmjs.com/getting-started/installing-npm-packages-globally">Global npm</a><br>
<a href="https://yarnpkg.com/lang/en/docs/cli/global/">Global yarn</a></p>
</div>
</div>
<div class="sect3">
<h4 id="package-version"><a class="anchor" href="#package-version"></a>==  Package version</h4>
<div class="paragraph">
<p>Dependencies are critical to the success of a package. You must be extra careful about
which version packages are using, one package in a different version may break your code.</p>
</div>
<div class="paragraph">
<p>Versioning in npm and yarn, follows a semantic called semver, following the logic
MAJOR.MINOR.PATCH, like for example, @angular/animations: 4.4.6.</p>
</div>
<div class="paragraph">
<p><strong>Different versions</strong></p>
</div>
<div class="paragraph">
<p>Sometimes, packages are installed with a different version from the one initially installed.
This happens because package.json also contains the range of versions we allow yarn or npm to
install or update to, example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">"@angular/animations": "^4.2.4"</code></pre>
</div>
</div>
<div class="paragraph">
<p>And here the installed one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json"> "@angular/animations": {
      "version": "4.4.6",
      "resolved": "https://registry.npmjs.org/@angular/animations/-/animations-4.4.6.tgz",
      "integrity": "sha1-+mYYmaik44y3xYPHpcl85l1ZKjU=",
      "requires": {
        "tslib": "1.8.0"
      }</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, the version we initially added is 4.2.4, and the version finally installed after
a global installation of all packages, 4.4.6.</p>
</div>
<div class="paragraph">
<p>Installing packages without package-lock.json or yarn.lock using their respective packet managers, will always
end with npm or yarn installing the latest version allowed by package.json.</p>
</div>
<div class="paragraph">
<p>"@angular/animations": "^4.2.4" contains not only the version we added, but also the range we allow npm and yarn
to update. Here are some examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">"@angular/animations": "&lt;4.2.4"</code></pre>
</div>
</div>
<div class="paragraph">
<p>The version installed must be lower than 4.2.4 .</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">"@angular/animations": "&gt;=4.2.4"</code></pre>
</div>
</div>
<div class="paragraph">
<p>The version installed must be greater than or equal to 4.2.4 .</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">"@angular/animations": "=4.2.4"</code></pre>
</div>
</div>
<div class="paragraph">
<p>the version installed must be equal to 4.2.4 .</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">"@angular/animations": "^4.2.4"</code></pre>
</div>
</div>
<div class="paragraph">
<p>The version installed cannot modify the first non zero digit, for example in this case
it cannot surpass 5.0.0 or be lower than 4.2.4 .</p>
</div>
<div class="paragraph">
<p>You can learn more about this in <a href="https://yarnpkg.com/en/docs/dependency-versions">Versions</a></p>
</div>
</div>
<div class="sect3">
<h4 id="problems-you-may-encounter"><a class="anchor" href="#problems-you-may-encounter"></a>Problems you may encounter</h4>
<div class="paragraph">
<p>If you can&#8217;t find package.json, you may have deleted the one you had previously,
which means you have to download the package.json from the repository.
In the case you are creating a new project you can create a new package.json. More information
in the links below. Click on <a href="#package-json">Package.json</a> if you come from that section. <br></p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://yarnpkg.com/en/docs/cli/init">Creating new package.json in yarn</a><br></p>
</li>
<li>
<p><a href="https://docs.npmjs.com/cli/init">Creating new package.json in npm</a><br></p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Using npm install or yarn without package.json in your projects will
result in compilation errors. As we mentioned earlier,
Package.json contains essential information about your project.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you have package.json, but you don&#8217;t have package-lock.json or yarn.lock the use of
command "npm install" or "yarn"  may result in a different dependency tree.</p>
</div>
<div class="paragraph">
<p>If you are trying to import a module and visual code studio is not able to find it,
is usually caused by error adding the package to the project, try to add the module again with yarn or npm,
and restart Visual Studio Code.</p>
</div>
<div class="paragraph">
<p>Be careful with the semantic versioning inside your package.json of the packages,
or you may find a new update on one of your dependencies breaking your code.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
In the following <a href="https://yarnpkg.com/en/docs/selective-version-resolutions">link</a>
there is a solution to a problematic update to one package.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A list of common errors of npm can be found in: <a href="https://docs.npmjs.com/troubleshooting/common-errors">npm errors</a></p>
</div>
</div>
<div class="sect3">
<h4 id="recomendations"><a class="anchor" href="#recomendations"></a>==  Recomendations</h4>
<div class="paragraph">
<p>Use yarn <strong>or</strong> npm in your project, reach an agreement with your team in order to choose one, this will avoid
undesired situations like forgetting to upload an updated yarn.lock or package-lock.json.
Be sure to have the latest version of your project when possible.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Pull your project every time it&#8217;s updated. Erase your node_modules folder and reinstall all
dependencies. This assures you to be working with the same dependencies your team has.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>AD Center recommends the use of yarn.</p>
</div>
<!-- toc disabled -->
</div>
<div class="sect3">
<h4 id="yarn-2"><a class="anchor" href="#yarn-2"></a>Yarn 2</h4>
<div class="paragraph">
<p>Yarn v2 is a very different software from the v1. The following list contains the main new features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://yarnpkg.com/features/constraints">Constraints</a></p>
</li>
<li>
<p><a href="https://yarnpkg.com/features/offline-cache">Offline Cache</a></p>
</li>
<li>
<p><a href="https://yarnpkg.com/features/pnp">Plug&#8217;n&#8217;Play</a></p>
</li>
<li>
<p><a href="https://yarnpkg.com/features/plugins">Plugins</a></p>
</li>
<li>
<p><a href="https://yarnpkg.com/features/protocols">Protocols</a></p>
</li>
<li>
<p><a href="https://yarnpkg.com/features/release-workflow">Release Workflow</a></p>
</li>
<li>
<p><a href="https://yarnpkg.com/features/workspaces">Workspaces</a></p>
</li>
<li>
<p><a href="https://yarnpkg.com/features/zero-installs">Zero-Installs</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Please, read them carefully to decide if your current project is suitable to use Yarn 2 as package manager.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Some features are still experimental, so please do not use them in production environments.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>More info at <a href="https://yarnpkg.com/" class="bare">https://yarnpkg.com/</a></p>
</div>
</div>
<div class="sect3">
<h4 id="global-install"><a class="anchor" href="#global-install"></a>Global Install</h4>
<div class="paragraph">
<p>Installing Yarn 2.x globally is discouraged as Yarn team is moving to a per-project install strategy. We advise you to keep Yarn 1.x (Classic) as your global binary by installing it via the instructions you can find <a href="https://classic.yarnpkg.com/en/docs/install">here</a>.</p>
</div>
<div class="paragraph">
<p>Once you&#8217;ve followed the instructions (running yarn --version from your home directory should yield something like 1.22.0), go to the next section to see how to enable Yarn 2 on your project.</p>
</div>
</div>
<div class="sect3">
<h4 id="per-project-install"><a class="anchor" href="#per-project-install"></a>Per-project install</h4>
<div class="paragraph">
<p>Follow these instructions to update your current devon4ng project to Yarn 2:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Follow the global install instructions.</p>
</li>
<li>
<p>Move into your project folder:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd ~/path/to/project</code></pre>
</div>
</div>
</li>
<li>
<p>Run the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">yarn policies set-version berry # below v1.22
yarn set version berry          # on v1.22+</code></pre>
</div>
</div>
</li>
<li>
<p>Since Angular CLI still is not fully supported with the new <a href="https://yarnpkg.com/advanced/architecture">Yarn architecture</a> as it is not compatible with PnP it is necessary to include the <a href="https://github.com/yarnpkg/berry/tree/master/packages/plugin-nm"><code>node-modules</code></a> plugin adding the following line in the <code>.yarnrc.yml</code> file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yml hljs" data-lang="yml">nodeLinker: node-modules</code></pre>
</div>
</div>
</li>
<li>
<p>Commit the <code>.yarn</code> and <code>.yarnrc.yml</code> changes</p>
</li>
<li>
<p>Run again <code>yarn install</code>.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For more advanced migration topics please refer to <a href="https://yarnpkg.com/advanced/migration" class="bare">https://yarnpkg.com/advanced/migration</a>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="which-files-should-be-added-to-gitignore-file"><a class="anchor" href="#which-files-should-be-added-to-gitignore-file"></a>Which files should be added to gitignore file?</h4>
<div class="paragraph">
<p>If you&#8217;re using Zero-Installs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-gitignore hljs" data-lang="gitignore">.yarn/*
!.yarn/cache
!.yarn/releases
!.yarn/plugins</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you&#8217;re not using Zero-Installs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-gitignore hljs" data-lang="gitignore">.yarn/*
!.yarn/releases
!.yarn/plugins
.pnp.*</code></pre>
</div>
</div>
<div class="paragraph">
<p>More details at <a href="https://yarnpkg.com/advanced/qa#details" class="bare">https://yarnpkg.com/advanced/qa#details</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="angular-2"><a class="anchor" href="#angular-2"></a>Angular</h2>
<div class="sectionbody">
<!-- toc disabled -->
<div class="sect3">
<h4 id="accessibility"><a class="anchor" href="#accessibility"></a>Accessibility</h4>
<div class="paragraph">
<p>Multiple studies suggest that around 15-20% of the population are living with a disability of some kind. In comparison, that number is higher than any single browser demographic currently, other than Chrome2. Not considering those users when developing an application means excluding a large number of people from being able to use it comfortable or at all.</p>
</div>
<div class="paragraph">
<p>Some people are unable to use the mouse, view a screen, see low contrast text, Hear dialogue or music and some people having difficulty to understanding the complex language.This kind of people needed the support like Keyboard support, screen reader support, high contrast text, captions and transcripts and Plain language support. This disability may change the from permanent to the situation.</p>
</div>
</div>
<div class="sect3">
<h4 id="key-concerns-of-accessible-web-applications"><a class="anchor" href="#key-concerns-of-accessible-web-applications"></a>Key Concerns of Accessible Web Applications</h4>
<div class="ulist">
<ul>
<li>
<p><strong>Semantic Markup</strong> - Allows the application to be understood on a more general level rather than just details of whats being rendered</p>
</li>
<li>
<p><strong>Keyboard Accessibility</strong> - Applications must still be usable when using only a keyboard</p>
</li>
<li>
<p><strong>Visual Assistance</strong> - color contrast, focus of elements and text representations of audio and events</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="semantic-markup"><a class="anchor" href="#semantic-markup"></a>Semantic Markup</h4>
<div class="paragraph">
<p>If you&#8217;re creating custom element directives, Web Components or HTML in general, use native elements wherever possible to utilize built-in events and properties. Alternatively, use ARIA to communicate semantic meaning.</p>
</div>
<div class="paragraph">
<p>HTML tags have attributes that providers extra context on what&#8217;s being displayed on the browser. For example, the  <code>&lt;img&gt;</code>  tag&#8217;s  alt  attribute lets the reader know what is being shown using a short description.However, native tags don&#8217;t cover all cases. This is where ARIA fits in. ARIA attributes can provide context on what roles specific elements have in the application or on how elements within the document relate to each other.</p>
</div>
<div class="paragraph">
<p>A modal component can be given the role of <code>dialog</code> or <code>alertdialog</code> to let the browser know that that component is acting as a modal. The modal component template can use the ARIA attributes  <code>aria-labelledby</code> and aria-described to describe to readers what the title and purpose of the modal is.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">@Component({
    selector: 'ngc2-app',
    template: `
      &lt;ngc2-notification-button
        message="Hello!"
        label="Greeting"
        role="button"&gt;
      &lt;/ngc2-notification-button&gt;
      &lt;ngc2-modal
        [title]="modal.title"
        [description]="modal.description"
        [visible]="modal.visible"
        (close)="modal.close()"&gt;
      &lt;/ngc2-modal&gt;
    `
})
export class AppComponent {
  constructor(private modal: ModalService) { }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>notification-button.component.ts</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">@Component({
  selector: 'ngc2-modal',
  template: `
    &lt;div
      role="dialog"
      aria-labelledby="modal-title"
      aria-describedby="modal-description"&gt;
      &lt;div id="modal-title"&gt;{{title}}&lt;/div&gt;
      &lt;p id="modal-description"&gt;{{description}}&lt;/p&gt;
      &lt;button (click)="close.emit()"&gt;OK&lt;/button&gt;
    &lt;/div&gt;
  `
})
export class ModalComponent {
  ...
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="keyboard-accessibility"><a class="anchor" href="#keyboard-accessibility"></a>Keyboard Accessibility</h4>
<div class="paragraph">
<p>Keyboard accessibility is the ability of your application to be interacted with using just a keyboard. The more streamlined the site can be used this way, the more keyboard accessible it is. Keyboard accessibility is one of the largest aspects of web accessibility since it targets:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>those with motor disabilities who can&#8217;t use a mouse</p>
</li>
<li>
<p>users who rely on screen readers and other assistive technology, which require keyboard navigation</p>
</li>
<li>
<p>those who prefer not to use a mouse</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="focus"><a class="anchor" href="#focus"></a>==  Focus</h4>
<div class="paragraph">
<p>Keyboard interaction is driven by something called focus. In web applications, only one element on a document has focus at a time, and keypress will activate whatever function is bound to that element.
Focus element border can be styled with CSS using the  outline  property, but it should not be removed. Elements can also be styled using the  :focus  psuedo-selector.</p>
</div>
</div>
<div class="sect3">
<h4 id="tabbing"><a class="anchor" href="#tabbing"></a>==  Tabbing</h4>
<div class="paragraph">
<p>The most common way of moving focus along the page is through the  tab  key. Elements will be traversed in the order they appear in the document outline - so that order must be carefully considered during development.
There is way change the default behavior or tab order. This can be done through the  <code>tabindex</code>  attribute. The  <code>tabindex</code>  can be given the values:
* less than zero - to let readers know that an element should be focusable but not keyboard accessible
* 0 - to let readers know that that element should be accessible by keyboard
* greater than zero - to let readers know the order in which the focusable element should be reached using the keyboard. Order is calculated from lowest to highest.</p>
</div>
</div>
<div class="sect3">
<h4 id="transitions"><a class="anchor" href="#transitions"></a>==  Transitions</h4>
<div class="paragraph">
<p>The majority of transitions that happen in an Angular application will not involve a page reload. This means that developers will need to carefully manage what happens to focus in these cases.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">@Component({
  selector: 'ngc2-modal',
  template: `
    &lt;div
      role="dialog"
      aria-labelledby="modal-title"
      aria-describedby="modal-description"&gt;
      &lt;div id="modal-title"&gt;{{title}}&lt;/div&gt;
      &lt;p id="modal-description"&gt;{{description}}&lt;/p&gt;
      &lt;button (click)="close.emit()"&gt;OK&lt;/button&gt;
    &lt;/div&gt;
  `,
})
export class ModalComponent {
  constructor(private modal: ModalService, private element: ElementRef) { }

  ngOnInit() {
    this.modal.visible$.subscribe(visible =&gt; {
      if(visible) {
        setTimeout(() =&gt; {
          this.element.nativeElement.querySelector('button').focus();
        }, 0);
      }
    })
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="visual-assistance"><a class="anchor" href="#visual-assistance"></a>Visual Assistance</h4>
<div class="paragraph">
<p>One large category of disability is visual impairment. This includes not just the blind, but those who are color blind or partially sighted, and require some additional consideration.</p>
</div>
</div>
<div class="sect3">
<h4 id="color-contrast"><a class="anchor" href="#color-contrast"></a>Color Contrast</h4>
<div class="paragraph">
<p>When choosing colors for text or elements on a website, the contrast between them needs to be considered. For WCAG 2.0 AA, this means that the contrast ratio for text or visual representations of text needs to be at least 4.5:1. There are tools online to measure the contrast ratio such as this color contrast checker from WebAIM or be checked with using automation tests.</p>
</div>
</div>
<div class="sect3">
<h4 id="visual-information"><a class="anchor" href="#visual-information"></a>Visual Information</h4>
<div class="paragraph">
<p>Color can help a user&#8217;s understanding of information, but it should never be the only way to convey information to a user. For example, a user with red/green color-blindness may have trouble discerning at a glance if an alert is informing them of success or failure.</p>
</div>
</div>
<div class="sect3">
<h4 id="audiovisual-media"><a class="anchor" href="#audiovisual-media"></a>Audiovisual Media</h4>
<div class="paragraph">
<p>Audiovisual elements in the application such as video, sound effects or audio (that is, podcasts) need related textual representations such as transcripts, captions or descriptions. They also should never auto-play and playback controls should be provided to the user.</p>
</div>
</div>
<div class="sect3">
<h4 id="accessibility-with-angular-material"><a class="anchor" href="#accessibility-with-angular-material"></a>Accessibility with Angular Material</h4>
<div class="paragraph">
<p>The <code>a11y</code> package provides a number of tools to improve accessibility. Import</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">import { A11yModule } from '@angular/cdk/a11y';</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="listkeymanager"><a class="anchor" href="#listkeymanager"></a><code>ListKeyManager</code></h4>
<div class="paragraph">
<p><code>ListKeyManager</code> manages the active option in a list of items based on keyboard interaction. Intended to be used with components that correspond to a <code>role="menu"</code> or <code>role="listbox"</code> pattern . Any component that uses a <code>ListKeyManager</code> will generally do three things:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create a <code>@ViewChildren</code> query for the options being managed.</p>
</li>
<li>
<p>Initialize the <code>ListKeyManager</code>, passing in the options.</p>
</li>
<li>
<p>Forward keyboard events from the managed component to the <code>ListKeyManager</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each option should implement the <code>ListKeyManagerOption</code> interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">interface ListKeyManagerOption {
  disabled?: boolean;
  getLabel?(): string;
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="types-of-listkeymanager"><a class="anchor" href="#types-of-listkeymanager"></a>==  Types of <code>ListKeyManager</code></h4>
<div class="paragraph">
<p>There are two varieties of <code>ListKeyManager</code>, <code>FocusKeyManager</code> and <code>ActiveDescendantKeyManager</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="focuskeymanager"><a class="anchor" href="#focuskeymanager"></a><code>FocusKeyManager</code></h4>
<div class="paragraph">
<p>Used when options will directly receive browser focus. Each item managed must implement the <code>FocusableOption</code> interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">interface FocusableOption extends ListKeyManagerOption {
  focus(): void;
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="activedescendantkeymanager"><a class="anchor" href="#activedescendantkeymanager"></a><code>ActiveDescendantKeyManager</code></h4>
<div class="paragraph">
<p>Used when options will be marked as active via <code>aria-activedescendant</code>. Each item managed must implement the <code>Highlightable</code> interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">interface Highlightable extends ListKeyManagerOption {
  setActiveStyles(): void;
  setInactiveStyles(): void;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Each item must also have an ID bound to the listbox&#8217;s or menu&#8217;s <code>aria-activedescendant</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="focustrap"><a class="anchor" href="#focustrap"></a><code>FocusTrap</code></h4>
<div class="paragraph">
<p>The <code>cdkTrapFocus</code> directive traps Tab key focus within an element. This is intended to be used to create accessible experience for components like modal dialogs, where focus must be constrained. This directive is declared in <code>A11yModule</code>.</p>
</div>
<div class="paragraph">
<p>This directive will not prevent focus from moving out of the trapped region due to mouse interaction.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-HTML hljs" data-lang="HTML">&lt;div class="my-inner-dialog-content" cdkTrapFocus&gt;
  &lt;!-- Tab and Shift + Tab will not leave this element. --&gt;
&lt;/div&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="regions"><a class="anchor" href="#regions"></a>Regions</h4>
<div class="paragraph">
<p>Regions can be declared explicitly with an initial focus element by using the <code>cdkFocusRegionStart</code>, <code>cdkFocusRegionEnd</code> and <code>cdkFocusInitial</code> DOM attributes. When using the tab key, focus will move through this region and wrap around on either end.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-HTML hljs" data-lang="HTML">&lt;a mat-list-item routerLink cdkFocusRegionStart&gt;Focus region start&lt;/a&gt;
&lt;a mat-list-item routerLink&gt;Link&lt;/a&gt;
&lt;a mat-list-item routerLink cdkFocusInitial&gt;Initially focused&lt;/a&gt;
&lt;a mat-list-item routerLink cdkFocusRegionEnd&gt;Focus region end&lt;/a&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="interactivitychecker"><a class="anchor" href="#interactivitychecker"></a><code>InteractivityChecker</code></h4>
<div class="paragraph">
<p><code>InteractivityChecker</code> is used to check the interactivity of an element, capturing disabled, visible, tabbable, and focusable states for accessibility purposes.</p>
</div>
</div>
<div class="sect3">
<h4 id="liveannouncer"><a class="anchor" href="#liveannouncer"></a><code>LiveAnnouncer</code></h4>
<div class="paragraph">
<p><code>LiveAnnouncer</code> is used to announce messages for screen-reader users using an aria-live region.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-HTML hljs" data-lang="HTML">@Component({...})
export class MyComponent {

 constructor(liveAnnouncer: LiveAnnouncer) {
   liveAnnouncer.announce("Hey Google");
 }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="api-reference-for-angular-cdk-a11y"><a class="anchor" href="#api-reference-for-angular-cdk-a11y"></a>API reference for Angular CDK a11y</h4>
<div class="paragraph">
<p><a href="https://material.angular.io/cdk/a11y/api">API reference for Angular CDK a11y</a></p>
</div>
<!-- toc disabled -->
</div>
<div class="sect3">
<h4 id="angular-elements"><a class="anchor" href="#angular-elements"></a>Angular Elements</h4>

</div>
<div class="sect3">
<h4 id="what-are-angular-elements"><a class="anchor" href="#what-are-angular-elements"></a>What are Angular Elements?</h4>
<div class="paragraph">
<p><a href="https://angular.io/guide/elements">Angular elements</a> are Angular components packaged as custom elements, a web standard for defining new HTML elements in a framework-agnostic way.</p>
</div>
<div class="paragraph">
<p>Custom elements are a Web Platform feature currently supported by Chrome, Firefox, Opera, and Safari, and available in other browsers through <a href="https://angular.io/guide/elements#browser-support">Polyfills</a>. A custom element extends HTML by allowing you to define a tag whose content is created and controlled by JavaScript code. The browser maintains a <code>CustomElementRegistry</code> of defined custom elements (also called Web Components), which maps an instantiable JavaScript class to an HTML tag.</p>
</div>
</div>
<div class="sect3">
<h4 id="why-use-angular-elements"><a class="anchor" href="#why-use-angular-elements"></a>Why use Angular Elements?</h4>
<div class="paragraph">
<p>Angular Elements allows Angular to work with different frameworks by using input and output elements. This allows Angular to work with many different frameworks if needed. This is an ideal situation if a slow transformation of an application to <code>Angular</code> is needed or some Angular needs to be added in other web applications(For example. <code>ASP.net</code>, <code>JSP</code> etc )</p>
</div>
</div>
<div class="sect3">
<h4 id="negative-points-about-elements"><a class="anchor" href="#negative-points-about-elements"></a>Negative points about Elements</h4>
<div class="paragraph">
<p>Angular Elements is really powerful but since, the transition between views is going to be handled by another framework or HTML/JavaScript, using Angular <code>Router</code> is not possible. the view transitions have to be handled manually. This fact also eliminates the possibility of just porting an application completely.</p>
</div>
</div>
<div class="sect3">
<h4 id="how-to-use-angular-elements"><a class="anchor" href="#how-to-use-angular-elements"></a>How to use Angular Elements?</h4>
<div class="paragraph">
<p>In a generalized way, a simple <code>Angular component</code> could be transformed to an <code>Angular Element</code> with this steps:</p>
</div>
</div>
<div class="sect3">
<h4 id="installing-angular-elements"><a class="anchor" href="#installing-angular-elements"></a>Installing Angular Elements</h4>
<div class="paragraph">
<p>The first step is going to be install the library using our preferred packet manager:</p>
</div>
</div>
<div class="sect3">
<h4 id="npm-2"><a class="anchor" href="#npm-2"></a>== NPM</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>npm install @angular/elements</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="yarn-3"><a class="anchor" href="#yarn-3"></a>== YARN</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>yarn add @angular/elements</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="preparing-the-components-in-the-modules"><a class="anchor" href="#preparing-the-components-in-the-modules"></a>Preparing the components in the modules</h4>
<div class="paragraph">
<p>Inside the <code>app.module.ts</code>, in addition to the normal declaration of the components inside <code>declarations</code>, the modules inside <code>imports</code> and the services inside <code>providers</code>, the components need to added in <code>entryComponents</code>. If there are components that have their own module, the same logic is going to be applied for them, only adding in the <code>app.module.ts</code> the components that do not have their own module. Here is an example of this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">....
@NgModule({
  declarations: [
    DishFormComponent,
    DishViewComponent
  ],
  imports: [
    CoreModule,  // Module containing Angular Materials
    FormsModule
  ],
  entryComponents: [
    DishFormComponent,
    DishViewComponent
  ],
  providers: [DishShareService]
})
....</code></pre>
</div>
</div>
<div class="paragraph">
<p>After that is done, the constructor of the module is going to be modified to use injector and bootstrap the application defining the components. This is going to allow the <code>Angular Element</code> to get the injections and to define a component tag that will be used later:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">....
})
export class AppModule {
  constructor(private injector: Injector) {

  }

  ngDoBootstrap() {
    const el = createCustomElement(DishFormComponent, {injector: this.injector});
    customElements.define('dish-form', el);

    const elView = createCustomElement(DishViewComponent, {injector: this.injector});
    customElements.define('dish-view', elView);
  }
}
....</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="a-component-example"><a class="anchor" href="#a-component-example"></a>A component example</h4>
<div class="paragraph">
<p>In order to be able to use a component, <code>@Input()</code> and <code>@Output()</code> variables are used. These variables are going to be the ones that will allow the Angular Element to communicate with the framework/JavaScript:</p>
</div>
<div class="paragraph">
<p>Component html</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;mat-card&gt;
    &lt;mat-grid-list cols="1" rowHeight="100px" rowWidth="50%"&gt;
				&lt;mat-grid-tile colspan="1" rowspan="1"&gt;
					&lt;span&gt;{{ platename }}&lt;/span&gt;
				&lt;/mat-grid-tile&gt;
				&lt;form (ngSubmit)="onSubmit(dishForm)" #dishForm="ngForm"&gt;
					&lt;mat-grid-tile colspan="1" rowspan="1"&gt;
						&lt;mat-form-field&gt;
							&lt;input matInput placeholder="Name" name="name" [(ngModel)]="dish.name"&gt;
						&lt;/mat-form-field&gt;
					&lt;/mat-grid-tile&gt;
					&lt;mat-grid-tile colspan="1" rowspan="1"&gt;
						&lt;mat-form-field&gt;
							&lt;textarea matInput placeholder="Description" name="description" [(ngModel)]="dish.description"&gt;&lt;/textarea&gt;
						&lt;/mat-form-field&gt;
					&lt;/mat-grid-tile&gt;
					&lt;mat-grid-tile colspan="1" rowspan="1"&gt;
						&lt;button mat-raised-button color="primary" type="submit"&gt;Submit&lt;/button&gt;
					&lt;/mat-grid-tile&gt;
				&lt;/form&gt;
		&lt;/mat-grid-list&gt;
&lt;/mat-card&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Component ts</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">@Component({
  templateUrl: './dish-form.component.html',
  styleUrls: ['./dish-form.component.scss']
})
export class DishFormComponent implements OnInit {

  @Input() platename;

  @Input() platedescription;

  @Output()
  submitDishEvent = new EventEmitter();

  submitted = false;
  dish = {name: '', description: ''};

  constructor(public dishShareService: DishShareService) { }

  ngOnInit() {
    this.dish.name = this.platename;
    this.dish.description = this.platedescription;
  }

  onSubmit(dishForm: NgForm): void {
    this.dishShareService.createDish(dishForm.value.name, dishForm.value.description);
    this.submitDishEvent.emit('dishSubmited');
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this file there are definitions of multiple variables that will be used as input and output. Since the input variables are going to be used directly by html, only lowercase and underscore strategies can be used for them. On the <code>onSubmit(dishForm: NgForm)</code> a service is used to pass this variables to another component. Finally, as a last thing, the selector inside <code>@Component</code> has been removed since a tag that will be used dynamically was already defined in the last step.</p>
</div>
</div>
<div class="sect3">
<h4 id="solving-the-error"><a class="anchor" href="#solving-the-error"></a>Solving the error</h4>
<div class="paragraph">
<p>In order to be able to use this <code>Angular Element</code> a <code>Polyfills</code>/<code>Browser support</code> related error needs to solved. This error can be solved in two ways:</p>
</div>
</div>
<div class="sect3">
<h4 id="changing-the-target"><a class="anchor" href="#changing-the-target"></a>== Changing the target</h4>
<div class="paragraph">
<p>One solution is to change the target in <code>tsconfig.json</code> to <code>es2015</code>. This might not be doable for every application since maybe a specific target is required.</p>
</div>
</div>
<div class="sect3">
<h4 id="installing-polyfaces"><a class="anchor" href="#installing-polyfaces"></a>== Installing Polyfaces</h4>
<div class="paragraph">
<p>Another solution is to use <code>AutoPollyfill</code>. In order to do so, the library is going to be installed with a packet manager:</p>
</div>
<div class="paragraph">
<p>Yarn</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>yarn add @webcomponents/webcomponentsjs</code></pre>
</div>
</div>
<div class="paragraph">
<p>Npm</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>npm install @webcomponents/webcomponentsjs</code></pre>
</div>
</div>
<div class="paragraph">
<p>After the packet manager has finished, inside the <code>src</code> folder a new file <code>polyfills.ts</code> is found. To solve the error, importing the corresponding adapter (<code>custom-elements-es5-adapter.js</code>) is necessary:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">....
/***************************************************************************************************
 * APPLICATION IMPORTS
 */

import '@webcomponents/webcomponentsjs/custom-elements-es5-adapter.js';
....</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to learn more about polyfills in angular you can do it <a href="https://angular.io/guide/browser-support">here</a></p>
</div>
</div>
<div class="sect3">
<h4 id="building-the-angular-element"><a class="anchor" href="#building-the-angular-element"></a>Building the Angular Element</h4>
<div class="paragraph">
<p>First, before building the <code>Angular Element</code>, every element inside that app component except the module need to be removed. After that, a bash script is created in the root folder,. This script will allow to put every necessary file into a JS.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>ng build "projectName" --configuration production --output-hashing=none &amp;&amp; cat dist/"projectName"/runtime.js dist/"projectName"/polyfills.js dist/"projectName"/scripts.js dist/"projectName"/main.js &gt; ./dist/"projectName"/"nameWantedAngularElement".js</code></pre>
</div>
</div>
<div class="paragraph">
<p>After executing the bash script, it will generate inside the path <code>dist/"projectName"</code> (or <code>dist/apps/projectname</code> in a Nx workspace) a JS file named <code>"nameWantedAngularElement".js</code> and a css file.</p>
</div>
</div>
<div class="sect3">
<h4 id="building-with-ngx-build-plus-recommended"><a class="anchor" href="#building-with-ngx-build-plus-recommended"></a>== Building with <code>ngx-build-plus</code> (Recommended)</h4>
<div class="paragraph">
<p>The library <a href="https://github.com/manfredsteyer/ngx-build-plus"><code>ngx-build-plus</code></a> allows to add different options when building. In addition, it solves some errors that will occur when trying to use multiple angular elements in an application. In order to use it, yarn or npm can be used:</p>
</div>
<div class="paragraph">
<p>Yarn</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>yarn add ngx-build-plus</code></pre>
</div>
</div>
<div class="paragraph">
<p>Npm</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>npm install ngx-build-plus</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to add it to a specific sub project in your projects folder, use the --project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>.... ngx-build-plus --project "project-name"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using this library and the following command, an isolated <code>Angular Element</code> which won&#8217;t have conflict with others can be generated. This <code>Angular Element</code> will not have a polyfill so, the project where we use them will need to include a <code>poliyfill</code> with the <code>Angular Element</code> requirements.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>ng build "projectName" --output-hashing none --single-bundle true --configuration production --bundle-styles false</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command will generate three things:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The main JS bundle</p>
</li>
<li>
<p>The script JS</p>
</li>
<li>
<p>The css</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>These files will be used later instead of the single JS generated in the last step.</p>
</div>
</div>
<div class="sect3">
<h4 id="extra-parameters"><a class="anchor" href="#extra-parameters"></a>== ==  Extra parameters</h4>
<div class="paragraph">
<p>Here are some extra useful parameters that <code>ngx-build-plus</code> provides:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>--keep-polyfills</code>: This parameter is going to allow us to keep the polyfills. This needs to be used with caution, avoiding using multiple different polyfills that could cause an error is necessary.</p>
</li>
<li>
<p><code>--extraWebpackConfig webpack.extra.js</code>: This parameter allows us to create a JavaScript file inside our <code>Angular Elements</code> project with the name of different libraries. Using <code>webpack</code> these libraries will not be included in the <code>Angular Element</code>. This is useful to lower the size of our <code>Angular Element</code> by removing libraries shared. Example:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-JavaScript hljs" data-lang="JavaScript">const webpack = require('webpack');

module.exports = {
    "externals": {
        "rxjs": "rxjs",
        "@angular/core": "ng.core",
        "@angular/common": "ng.common",
        "@angular/common/http": "ng.common.http",
        "@angular/platform-browser": "ng.platformBrowser",
        "@angular/platform-browser-dynamic": "ng.platformBrowserDynamic",
        "@angular/compiler": "ng.compiler",
        "@angular/elements": "ng.elements",
        "@angular/router": "ng.router",
        "@angular/forms": "ng.forms"
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id=""><a class="anchor" href="#"></a>==</h4>
<div class="literalblock">
<div class="content">
<pre>  If some libraries are excluded from the `Angular Element` you will need to add the bundled UMD files of those libraries manually.
== ==</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="using-the-angular-element"><a class="anchor" href="#using-the-angular-element"></a>Using the Angular Element</h4>
<div class="paragraph">
<p>The <code>Angular Element</code> that got generated in the last step can be used in almost every framework. In this case, the <code>Angular Element</code> is going to be used in html:</p>
</div>
<div class="listingblock">
<div class="title">Listing 7. Sample index.html version without <code>ngx-build-plus</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-HTML hljs" data-lang="HTML">&lt;html&gt;
    &lt;head&gt;
        &lt;link rel="stylesheet" href="styles.css"&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;div id="container"&gt;

        &lt;/div&gt;
        &lt;!--Use of the element non dynamically--&gt;
        &lt;!--&lt;plate-form platename="test" platedescription="test"&gt;&lt;/plate-form&gt;--&gt;
        &lt;script src="./devon4ngAngularElements.js"&gt; &lt;/script&gt;
        &lt;script&gt;
                var elContainer = document.getElementById('container');
                var el= document.createElement('dish-form');
                el.setAttribute('platename','test');
                el.setAttribute('platedescription','test');
                el.addEventListener('submitDishEvent',(ev)=&gt;{
                    var elView= document.createElement('dish-view');
                    elContainer.innerHTML = '';
                    elContainer.appendChild(elView);
                });
                elContainer.appendChild(el);
        &lt;/script&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Listing 8. Sample index.html version with <code>ngx-build-plus</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-HTML hljs" data-lang="HTML">&lt;html&gt;
    &lt;head&gt;
        &lt;link rel="stylesheet" href="styles.css"&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;div id="container"&gt;

        &lt;/div&gt;
        &lt;!--Use of the element non dynamically--&gt;
        &lt;!--&lt;plate-form platename="test" platedescription="test"&gt;&lt;/plate-form&gt;--&gt;
         &lt;script src="./polyfills.js"&gt; &lt;/script&gt; &lt;!-- Created using --keep-polyfills options --&gt;
        &lt;script src="./scripts.js"&gt; &lt;/script&gt;
         &lt;script src="./main.js"&gt; &lt;/script&gt;
        &lt;script&gt;
                var elContainer = document.getElementById('container');
                var el= document.createElement('dish-form');
                el.setAttribute('platename','test');
                el.setAttribute('platedescription','test');
                el.addEventListener('submitDishEvent',(ev)=&gt;{
                    var elView= document.createElement('dish-view');
                    elContainer.innerHTML = '';
                    elContainer.appendChild(elView);
                });
                elContainer.appendChild(el);
        &lt;/script&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this html, the css generated in the last step is going to be imported inside the <code>&lt;head&gt;</code> and then, the JavaScript element is going to be imported at the end of the body. After that is done, There is two uses of <code>Angular Elements</code> in the html, one directly with use of the <code>@input()</code> variables as parameters commented in the html:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">....
        &lt;!--Use of the element non dynamically--&gt;
        &lt;!--&lt;plate-form platename="test" platedescription="test"&gt;&lt;/plate-form&gt;--&gt;
....</code></pre>
</div>
</div>
<div class="paragraph">
<p>and one dynamically inside the script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">....
        &lt;script&gt;
                var elContainer = document.getElementById('container');
                var el= document.createElement('dish-form');
                el.setAttribute('platename','test');
                el.setAttribute('platedescription','test');
                el.addEventListener('submitDishEvent',(ev)=&gt;{
                    var elView= document.createElement('dish-view');
                    elContainer.innerHTML = '';
                    elContainer.appendChild(elView);
                });
                elContainer.appendChild(el);
        &lt;/script&gt;
....</code></pre>
</div>
</div>
<div class="paragraph">
<p>This JavaScript is an example of how to create dynamically an <code>Angular Element</code> inserting attributed to fill our <code>@Input()</code> variables and listen to the <code>@Output()</code> that was defined earlier. This is done with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">                el.addEventListener('submitDishEvent',(ev)=&gt;{
                    var elView= document.createElement('dish-view');
                    elContainer.innerHTML = '';
                    elContainer.appendChild(elView);
                });</code></pre>
</div>
</div>
<div class="paragraph">
<p>This allows JavaScript to hook with the <code>@Output()</code> event emitter that was defined. When this event gets called, another component that was defined gets inserted dynamically.</p>
</div>
</div>
<div class="sect3">
<h4 id="angular-element-within-another-angular-project"><a class="anchor" href="#angular-element-within-another-angular-project"></a>Angular Element within another Angular project</h4>
<div class="paragraph">
<p>In order to use an <code>Angular Element</code> within another <code>Angular</code> project the following steps need to be followed:</p>
</div>
</div>
<div class="sect3">
<h4 id="copy-bundled-script-and-css-to-resources"><a class="anchor" href="#copy-bundled-script-and-css-to-resources"></a>Copy bundled script and css to resources</h4>
<div class="paragraph">
<p>First copy the generated <code>.js</code> and <code>.css</code> inside assets in the corresponding folder.</p>
</div>
</div>
<div class="sect3">
<h4 id="add-bundled-script-to-angular-json"><a class="anchor" href="#add-bundled-script-to-angular-json"></a>Add bundled script to angular.json</h4>
<div class="paragraph">
<p>Inside <code>angular.json</code> both of the files that were copied in the last step are going to be included. This will be done both, in <code>test</code> and in <code>build</code>. Including it on the test, will allow to perform unitary tests.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
....
  "architect": {
    ....
    "build": {
      ....
      "styles": [
        ....
          "src/assets/css/devon4ngAngularElements.css"
        ....
      ]
      ....
      "scripts": [
        "src/assets/js/devon4ngAngularElements.js"
      ]
      ....
    }
    ....
    "test": {
      ....
      "styles": [
        ....
          "src/assets/css/devon4ngAngularElements.css"
        ....
      ]
      ....
      "scripts": [
        "src/assets/js/devon4ngAngularElements.js"
      ]
      ....
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>By declaring the files in the <code>angular.json</code> angular will take care of including them in a proper way.</p>
</div>
</div>
<div class="sect3">
<h4 id="-2"><a class="anchor" href="#-2"></a>==</h4>
<div class="literalblock">
<div class="content">
<pre>  If you are using Nx, the configuration file `angular.json` might be named as `workspace.json`, depending on how you had setup the workspace. The structure of the file remains similar though.
== ==</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="using-angular-element"><a class="anchor" href="#using-angular-element"></a>Using Angular Element</h4>
<div class="paragraph">
<p>There are two ways that <code>Angular Element</code> can be used:</p>
</div>
</div>
<div class="sect3">
<h4 id="create-component-dynamically"><a class="anchor" href="#create-component-dynamically"></a>== Create component dynamically</h4>
<div class="paragraph">
<p>In order to add the component in a dynamic way, first adding a container is necessary:</p>
</div>
<div class="paragraph">
<p><code>app.component.html</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">....
&lt;div id="container"&gt;
&lt;/div&gt;
....</code></pre>
</div>
</div>
<div class="paragraph">
<p>With this container created, inside the <code>app.component.ts</code> a method is going to be created. This method is going to find the container, create the dynamic element and append it into the container.</p>
</div>
<div class="paragraph">
<p><code>app.component.ts</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">export class AppComponent implements OnInit {
  ....
  ngOnInit(): void {
    this.createComponent();
  }
  ....
  createComponent(): void {
    const container = document.getElementById('container');
    const component = document.createElement('dish-form');
    container.appendChild(component);
  }
  ....</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="using-it-directly"><a class="anchor" href="#using-it-directly"></a>== Using it directly</h4>
<div class="paragraph">
<p>In order to use it directly on the templates, in the <code>app.module.ts</code> the <code>CUSTOM_ELEMENTS_SCHEMA</code> needs to be added:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">....
import { NgModule, CUSTOM_ELEMENTS_SCHEMA } from '@angular/core';
....
@NgModule({
  ....
  schemas: [ CUSTOM_ELEMENTS_SCHEMA ],</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is going to allow the use of the <code>Angular Element</code> in the templates directly:</p>
</div>
<div class="paragraph">
<p><code>app.component.html</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">....
&lt;div id="container"&gt;
  &lt;dish-form&gt;&lt;/dish-form&gt;
&lt;/div&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can find a working example of Angular Elements in our <a href="https://github.com/devonfw-sample/devon4ts-samples">devon4ts-samples</a> repo by referring the samples named angular-elements and angular-elements-test.</p>
</div>
<!-- toc disabled -->
</div>
<div class="sect3">
<h4 id="angular-lazy-loading"><a class="anchor" href="#angular-lazy-loading"></a>Angular Lazy loading</h4>
<div class="paragraph">
<p>When the development of an application starts, it just contains a small set of features so the app usually loads fast. However, as new features are added, the overall application size grows up  and its loading speed decreases. It is in this context where Lazy loading finds its place.
Lazy loading is a design pattern that defers initialization of objects until it is needed, so, for example, users that just access to a website&#8217;s home page do not need to have other areas loaded.
Angular handles lazy loading through the routing module which redirects to requested pages. Those pages can be loaded at start or on demand.</p>
</div>
</div>
<div class="sect3">
<h4 id="an-example-with-angular"><a class="anchor" href="#an-example-with-angular"></a>An example with Angular</h4>
<div class="paragraph">
<p>To explain how lazy loading is implemented using angular, a basic sample app is going to be developed. This app will consist in a window named "level 1" that contains two buttons that redirects to other windows in a "second level". It is a simple example, but useful to understand the relation between angular modules and lazy loading.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/angular/angular-lazy/levels-app.png" alt="Levels app structure" width="500 link="images/angular/angular-lazy/levels-app.png"">
</div>
<div class="title">Figure 9. Levels app structure.</div>
</div>
<div class="paragraph">
<p>This graphic shows that modules acts as gates to access components "inside" them.</p>
</div>
<div class="paragraph">
<p>Because the objective of this guide is related mainly with logic, the html structure and SCSS styles are less relevant, but the complete code can be found as a sample <a href="https://github.com/devonfw-sample/devon4ts-samples/tree/master/apps/angular-lazy-loading">here</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="implementation"><a class="anchor" href="#implementation"></a>Implementation</h4>
<div class="paragraph">
<p>First write in a console <code>ng new level-app --routing</code>, to generate a new project called level-app including an app-routing.module.ts file (<strong>--routing</strong> flag). If you are using Nx, the command would be <code>nx generate @nrwl/angular:app level-app --routing</code> in your Nx workspace.</p>
</div>
<div class="paragraph">
<p>In the file app.component.html delete all the content except the router-outlet tag.</p>
</div>
<div class="listingblock">
<div class="title">Listing 9. File app.component.html</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;router-outlet&gt;&lt;/router-outlet&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The next steps consists on creating features modules.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>run <code>ng generate module first --routing</code>  to generate a module named <em>first</em>.</p>
</li>
<li>
<p>run <code>ng generate module first/second-left --routing</code> to generate a module named <em>second-left</em> under <em>first</em>.</p>
</li>
<li>
<p>run <code>ng generate module first/second-right --routing</code> to generate a module <em>second-right</em> under <em>first</em>.</p>
</li>
<li>
<p>run <code>ng generate component first/first</code> to generate a component named <em>first</em> inside the module <em>first</em>.</p>
</li>
<li>
<p>run <code>ng generate component first/second-left/content</code> to generate a component <em>content</em> inside the module <em>second-left</em>.</p>
</li>
<li>
<p>run <code>ng generate component first/second-right/content</code> to generate a component <em>content</em> inside the module <em>second-right</em>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="-3"><a class="anchor" href="#-3"></a>==</h4>
<div class="literalblock">
<div class="content">
<pre>  If you are using Nx, you have to specify the project name (level-app) along with the --project flag. For example, command for generating the first module will be `ng generate module first --project=level-app --routing`
== ==</pre>
</div>
</div>
<div class="paragraph">
<p>To move between components we have to configure the routes used:</p>
</div>
<div class="paragraph">
<p>In <strong>app-routing.module.ts</strong> add a path <strong>'first'</strong> to <code>FirstComponent</code> and a redirection from <strong>''</strong> to <strong>'first'</strong>.</p>
</div>
<div class="listingblock">
<div class="title">Listing 10. File app-routing.module.ts.</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">...
import { FirstComponent } from './first/first/first.component';

const routes: Routes = [
  {
    path: 'first',
    component: FirstComponent
  },
  {
    path: '',
    redirectTo: 'first',
    pathMatch: 'full',
  },
];

@NgModule({
  imports: [RouterModule.forRoot(routes)],
  exports: [RouterModule],
})
export class AppRoutingModule {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In <strong>app.module.ts</strong> import the module which includes <code>FirstComponent</code>.</p>
</div>
<div class="listingblock">
<div class="title">Listing 11. File app.module.ts</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">....
import { FirstModule } from './first/first.module';

@NgModule({
  ...
  imports: [
    ....
    FirstModule
  ],
  ...
})
export class AppModule { }</code></pre>
</div>
</div>
<div class="paragraph">
<p>In <strong>first-routing.module.ts</strong> add routes that direct to the content of <code>SecondRightModule</code> and <code>SecondLeftModule</code>. The content of both modules have the same name so, in order to avoid conflicts the name of the components are going to be changed using <strong>as</strong> ( original-name as new-name).</p>
</div>
<div class="listingblock">
<div class="title">Listing 12. File first-routing.module.ts</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">...
import { ContentComponent as ContentLeft} from './second-left/content/content.component';
import { ContentComponent as ContentRight} from './second-right/content/content.component';
import { FirstComponent } from './first/first.component';

const routes: Routes = [
  {
    path: '',
    component: FirstComponent
  },
  {
    path: 'first/second-left',
    component: ContentLeft
  },
  {
    path: 'first/second-right',
    component: ContentRight
  }
];

@NgModule({
  imports: [RouterModule.forChild(routes)],
  exports: [RouterModule]
})
export class FirstRoutingModule { }</code></pre>
</div>
</div>
<div class="paragraph">
<p>In first.module.ts import <code>SecondLeftModule</code> and <code>SecondRightModule</code>.</p>
</div>
<div class="listingblock">
<div class="title">Listing 13. File first.module.ts</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">...
import { SecondLeftModule } from './second-left/second-left.module';
import { SecondRightModule } from './second-right/second-right.module';

@NgModule({
  ...
  imports: [
    ...
    SecondLeftModule,
    SecondRightModule,
  ]
})
export class FirstModule { }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using the current configuration, we have a project that loads all the modules in a eager way. Run <code>ng serve</code> (with <code>--project=level-app</code> in an Nx workspace) to see what happens.</p>
</div>
<div class="paragraph">
<p>First, during the compilation we can see that just a main file is built.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/angular/angular-lazy/compile-eager.png" alt="Compile eager" width="800 link="images/angular/angular-lazy/compile-eager.png"">
</div>
<div class="title">Figure 10. Compile eager.</div>
</div>
<div class="paragraph">
<p>If we go to <code><a href="http://localhost:4200/first" class="bare">http://localhost:4200/first</a></code> and open developer options (F12 on Chrome), it is found that a document named "first" is loaded.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/angular/angular-lazy/first-lvl-eager.png" alt="First level eager" width="800 link="images/angular/angular-lazy/first-lvl-eager.png"">
</div>
<div class="title">Figure 11. First level eager.</div>
</div>
<div class="paragraph">
<p>If we click on <strong>[Go to right module]</strong> a second level module opens, but there is no 'second-right' document.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/angular/angular-lazy/second-lvl-right-eager.png" alt="Second level right eager" width="800 link="images/angular/angular-lazy/second-lvl-right-eager.png"">
</div>
<div class="title">Figure 12. Second level right eager.</div>
</div>
<div class="paragraph">
<p>But, typing the URL directly will load 'second-right' but no 'first', even if we click on <strong>[Go back]</strong></p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/angular/angular-lazy/second-lvl-right-eager-d.png" alt="Second level right eager" width="800 link="images/angular/angular-lazy/second-lvl-right-eager-d.png"">
</div>
<div class="title">Figure 13. Second level right eager direct URL.</div>
</div>
<div class="paragraph">
<p>Modifying an angular application to load its modules lazily is easy, you have to change the routing configuration of the desired module (for example <code>FirstModule</code>).</p>
</div>
<div class="listingblock">
<div class="title">Listing 14. File app-routing.module.ts.</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">const routes: Routes = [
  {
    path: 'first',
    loadChildren: () =&gt; import('./first/first.module').then(m =&gt; m.FirstModule),
  },
  {
    path: '',
    redirectTo: 'first',
    pathMatch: 'full',
  },
];

@NgModule({
  imports: [RouterModule.forRoot(routes)],
  exports: [RouterModule],
})
export class AppRoutingModule {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that instead of loading a component, you dynamically import it in a <code>loadChildren</code> attribute because modules acts as gates to access components "inside" them. Updating the app to load lazily has four consequences:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>No component attribute.</p>
</li>
<li>
<p>No import of <code>FirstComponent</code>.</p>
</li>
<li>
<p><code>FirstModule</code> import has to be removed from the imports array at app.module.ts.</p>
</li>
<li>
<p>Change of context.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If we check <strong>first-routing.module.ts</strong> again, we can see that the path for <code>ContentLeft</code> and <code>ContentRight</code> is set to 'first/second-left' and 'first/second-right' respectively, so writing <code><a href="http://localhost:4200/first/second-left" class="bare">http://localhost:4200/first/second-left</a></code> will redirect us to <code>ContentLeft</code>. However, after loading a module with <code>loadChildren</code> setting the path to '<em>second-left</em>' and '<em>second-right</em>' is enough because it acquires the context set by <code>AppRoutingModule</code>.</p>
</div>
<div class="listingblock">
<div class="title">Listing 15. File first-routing.module.ts</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">const routes: Routes = [
  {
    path: '',
    component: FirstComponent
  },
  {
    path: 'second-left',
    component: ContentLeft
  },
  {
    path: 'second-right',
    component: ContentRight
  }
];</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we go to '<em>first</em>' then <code>FirstModule</code> is situated in '<em>/first</em>' but also its children <code>ContentLeft</code> and <code>ContentRight</code>, so it is not necessary to write in their path '<em>first/second-left</em>' and '<em>first/second-right</em>', because that will situate the components on '<em>first/first/second-left</em>' and  '<em>first/first/second-right</em>'.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/angular/angular-lazy/first-lvl-wrong-path.png" alt="First level wrong path" width="800 link="images/angular/angular-lazy/first-lvl-wrong-path.png"">
</div>
<div class="title">Figure 14. First level lazy wrong path.</div>
</div>
<div class="paragraph">
<p>When we compile an app with lazy loaded modules, files containing them will be generated</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/angular/angular-lazy/compile-first-lazy.png" alt="First level lazy compilation" width="800 link="images/angular/angular-lazy/compile-first-lazy.png"">
</div>
<div class="title">Figure 15. First level lazy compilation.</div>
</div>
<div class="paragraph">
<p>And if we go to <em>developer tools &#8594; network</em>, we can find those modules loaded (if they are needed).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/angular/angular-lazy/first-lvl-lazy.png" alt="First level lazy" width="800 link="images/angular/angular-lazy/first-lvl-lazy.png"">
</div>
<div class="title">Figure 16. First level lazy.</div>
</div>
<div class="paragraph">
<p>To load the component <code>ContentComponent</code> of <code>SecondLeftModule</code> lazily, we have to load <code>SecondLeftModule</code> as a children of <code>FirstModule</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Change <strong>component</strong> to <code>loadChildren</code> and reference <code>SecondLeftModule</code>.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Listing 16. File first-routing.module.ts.</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">const routes: Routes = [
  {
    path: '',
    component: FirstComponent
  },
  {
    path: 'second-left',
    loadChildren: () =&gt; import('./second-left/second-left.module').then(m =&gt; m.SecondLeftModule),
  },
  {
    path: 'second-right',
    component: ContentRight
  }
];</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Remove <code>SecondLeftModule</code> at first.component.ts</p>
</li>
<li>
<p>Route the components inside <code>SecondLeftModule</code>. Without this step nothing would be displayed.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Listing 17. File second-left-routing.module.ts.</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">...
import { ContentComponent } from './content/content.component';

const routes: Routes = [
  {
    path: '',
    component: ContentComponent
  }
];

@NgModule({
  imports: [RouterModule.forChild(routes)],
  exports: [RouterModule]
})
export class SecondLeftRoutingModule { }</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>run <code>ng serve</code> to generate files containing the lazy modules.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/angular/angular-lazy/second-lvl-lazy.png" alt="Second level lazy" width="800 link="images/angular/angular-lazy/second-lvl-lazy.png"">
</div>
<div class="title">Figure 17. Second level lazy loading compilation.</div>
</div>
<div class="paragraph">
<p>Clicking on <strong>[Go to left module]</strong> triggers the load of <code>SecondLeftModule</code>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/angular/angular-lazy/second-lvl-left-lazy.png" alt="Second level lazy network" width="800 link="images/angular/angular-lazy/second-lvl-left-lazy.png"">
</div>
<div class="title">Figure 18. Second level lazy loading network.</div>
</div>
</div>
<div class="sect3">
<h4 id="conclusion"><a class="anchor" href="#conclusion"></a>Conclusion</h4>
<div class="paragraph">
<p>Lazy loading is a pattern useful when new features are added, these features are usually identified as modules which can be loaded only if needed as shown in this document, reducing the time spent loading an application.</p>
</div>
<!-- toc disabled -->
</div>
<div class="sect3">
<h4 id="angular-library"><a class="anchor" href="#angular-library"></a>Angular Library</h4>
<div class="paragraph">
<p><code>Angular CLI</code> provides us with methods that allow the creation of a library. After that, using a packet manager (either <code>npm</code> or <code>yarn</code>) the library can be build and packed which will allow later to install/publish it.</p>
</div>
</div>
<div class="sect3">
<h4 id="whats-a-library"><a class="anchor" href="#whats-a-library"></a>Whats a library?</h4>
<div class="paragraph">
<p>From <a href="https://en.wikipedia.org/wiki/Library_(computing)">wikipedia</a>: a library is a collection of non-volatile resources used by computer programs, often for software development. These may include configuration data, documentation, help data, message templates, pre-written code and subroutines, classes, values or type specifications.</p>
</div>
</div>
<div class="sect3">
<h4 id="how-to-build-a-library"><a class="anchor" href="#how-to-build-a-library"></a>How to build a library</h4>
<div class="paragraph">
<p>In this section, a library is going to be build step by step. Please note, we will be explaining the steps using both Angular CLI and Nx CLI. You are free to choose either one for your development.</p>
</div>
</div>
<div class="sect3">
<h4 id="1-creating-an-empty-application"><a class="anchor" href="#1-creating-an-empty-application"></a>1. Creating an empty application</h4>
<div class="paragraph">
<p>First, using <code>Angular CLI</code> we are going to generate a empty application which will be later filled with the generated library. In order to do so, <code>Angular CLI</code> allows us to add to <code>ng new "application-name"</code> an option (<code>--create-application</code>). This option is going to tell <code>Angular CLI</code> not to create the initial <code>app</code> project. This is convenient since a library is going to be generated in later steps. Using this command <code>ng new "application-name" --create-application=false</code> an empty project with the name wanted is created.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>ng new "application-name" --create-application=false</code></pre>
</div>
</div>
<div class="paragraph">
<p>This step is much more easier and straight-forward when using Nx. Nx allows us to work in a monorepo workspace, where you can develop a project as an application, or a library, or a tool. You can follow <a href="https://github.com/devonfw/devon4ng/wiki/guide-creating-angular-app-with-nx-cli">this guide</a> to get started with Nx.
The command for generating a library in Nx is <code>nx generate @nrwl/angular:library library-name --publishable --importPath=library-name</code>. This will create an empty angular application which we can modify and publish as a library.</p>
</div>
</div>
<div class="sect3">
<h4 id="2-generating-a-library"><a class="anchor" href="#2-generating-a-library"></a>2. Generating a library</h4>
<div class="paragraph">
<p>After generating an empty application, a library is going to be generated. Inside the folder of the project, the <code>Angular CLI</code> command <code>ng generate library "library-name"</code> is going to generate the library as a project (<code>projects/"library-name"</code>). As an addition, the option <code>--prefix="library-prefix-wanted"</code> allows us to switch the default prefix that Angular generated with (<code>lib</code>). Using the option to change the prefix the command will look like this <code>ng generate library "library-name" --prefix="library-prefix-wanted"</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>ng generate library "library-name" --prefix="library-prefix-wanted"</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you are using Nx, this step is not needed as it is already covered in step 1. In this case, the library project will be generated in the <code>libs</code> folder of a Nx workspace.</p>
</div>
</div>
<div class="sect3">
<h4 id="3-modifying-our-library"><a class="anchor" href="#3-modifying-our-library"></a>3. Modifying our library</h4>
<div class="paragraph">
<p>In the last step we generated a library. This automatically generates a <code>module</code>,<code>service</code> and a <code>component</code> inside <code>projects/"library-name"</code> that we can modify adding new methods, components etc that we want to use in other projects. We can generate other elements, using the usual <code>Angular CLI</code> generate commands adding the option <code>--project="library-name"</code>, this will allow to generate elements within our project . An example of this is: <code>ng generate service "name" --project="library-name"</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>ng generate "element" "name" --project="library-name"</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use the same command as above in a Nx workspace.</p>
</div>
</div>
<div class="sect3">
<h4 id="4-exporting-the-generated-things"><a class="anchor" href="#4-exporting-the-generated-things"></a>4. Exporting the generated things</h4>
<div class="paragraph">
<p>Inside the library (<code>projects/"library-name</code>) there&#8217;s a <code>public_api.ts</code> which is the file that exports the elements inside the library. (The file is named as <code>index.ts</code> in an Nx workspace). In case we generated other things, this file needs to be modified adding the extra exports with the generated elements. In addition, changing the library version is possible in the file <code>package.json</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="5-building-our-library"><a class="anchor" href="#5-building-our-library"></a>5. Building our library</h4>
<div class="paragraph">
<p>Once we added the necessary exports, in order to use the library in other applications, we need to build the library. The command <code>ng build "library-name"</code> is going to build the library, generating the necessary files in <code>"project-name"/dist/"library-name"</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>ng build "library-name"</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use the same command in Nx as well. Only the path for the generated files will be slightly different: <code>"project-name"/dist/libs/"library-name"</code></p>
</div>
</div>
<div class="sect3">
<h4 id="id-packing-library"><a class="anchor" href="#id-packing-library"></a>6. Packing the library</h4>
<div class="paragraph">
<p>In this step we are going to pack the build library. In order to do so, we need to go inside <code>dist/"library-name"</code> (or <code>dist/libs/"library-name"</code>) and then run either <code>npm pack</code> or <code>yarn pack</code> to generate a <code>"library-name-version.tgz"</code> file.</p>
</div>
<div class="listingblock">
<div class="title">Listing 18. Packing using npm</div>
<div class="content">
<pre class="highlightjs highlight"><code>npm pack</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Listing 19. Packing using yarn</div>
<div class="content">
<pre class="highlightjs highlight"><code>yarn pack</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="7-publishing-to-npm-repository-optional"><a class="anchor" href="#7-publishing-to-npm-repository-optional"></a>7. Publishing to npm repository (optional)</h4>
<div class="ulist">
<ul>
<li>
<p>Add a <code><em>README.md</em></code> and <em>LICENSE</em> file. The text inside <code><em>README.md</em></code> will be used in you npm package web page as documentation.</p>
</li>
<li>
<p>run <code>npm adduser</code> if you do not have a npm account to create it, otherwise run <code>npm login</code> and introduce your credentials.</p>
</li>
<li>
<p>run <code>npm publish</code> inside <code>dist/"library-name"</code> folder.</p>
</li>
<li>
<p>Check that the library is published: <a href="https://npmjs.com/package/library-name" class="bare">https://npmjs.com/package/library-name</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="8-installing-our-library-in-other-projects"><a class="anchor" href="#8-installing-our-library-in-other-projects"></a>8. Installing our library in other projects</h4>
<div class="paragraph">
<p>In this step we are going to install/add the library on other projects.</p>
</div>
</div>
<div class="sect3">
<h4 id="npm-3"><a class="anchor" href="#npm-3"></a>==  npm</h4>
<div class="paragraph">
<p>In order to add the library in other applications, there are two ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Option 1</strong>: From inside the application where the library is going to get used, using the command <code>npm install "path-to-tgz"/"library-name-version.tgz"</code> allows us to install the <code>.tgz</code> generated in <a href="#id-packing-library">Packing the library</a>.</p>
</li>
<li>
<p><strong>Option 2</strong>: run <code>npm install "library-name"</code> to install it from npm repository.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="yarn-4"><a class="anchor" href="#yarn-4"></a>==  yarn</h4>
<div class="paragraph">
<p>To add the package using yarn:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Option 1</strong>: From inside the application where the library is going to get used, using the command <code>yarn add "path-to-tgz"/"library-name-version.tgz"</code> allows us to install the <code>.tgz</code>  generated in <a href="#id-packing-library">Packing the library</a>.</p>
</li>
<li>
<p><strong>Option 2</strong>: run <code>yarn add "library-name"</code> to install it from npm repository.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="9-using-the-library"><a class="anchor" href="#9-using-the-library"></a>9. Using the library</h4>
<div class="paragraph">
<p>Finally, once the library was installed with either packet manager, you can start using the elements from inside like they would be used in a normal element inside the application. Example <code>app.component.ts</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">import { Component, OnInit } from '@angular/core';
import { MyLibraryService } from 'my-library';

@Component({
  selector: 'app-root',
  templateUrl: './app.component.html',
  styleUrls: ['./app.component.scss']
})
export class AppComponent implements OnInit {

  toUpper: string;

  constructor(private myLibraryService: MyLibraryService) {}
  title = 'devon4ng library test';
  ngOnInit(): void {
    this.toUpper = this.myLibraryService.firstLetterToUpper('test');
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example <code>app.component.html</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">&lt;!--The content below is only a placeholder and can be replaced.--&gt;
&lt;div style="text-align:center"&gt;
  &lt;h1&gt;
    Welcome to {{ title }}!
  &lt;/h1&gt;
  &lt;img width="300" alt="Angular Logo" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNTAgMjUwIj4KICAgIDxwYXRoIGZpbGw9IiNERDAwMzEiIGQ9Ik0xMjUgMzBMMzEuOSA2My4ybDE0LjIgMTIzLjFMMTI1IDIzMGw3OC45LTQzLjcgMTQuMi0xMjMuMXoiIC8+CiAgICA8cGF0aCBmaWxsPSIjQzMwMDJGIiBkPSJNMTI1IDMwdjIyLjItLjFWMjMwbDc4LjktNDMuNyAxNC4yLTEyMy4xTDEyNSAzMHoiIC8+CiAgICA8cGF0aCAgZmlsbD0iI0ZGRkZGRiIgZD0iTTEyNSA1Mi4xTDY2LjggMTgyLjZoMjEuN2wxMS43LTI5LjJoNDkuNGwxMS43IDI5LjJIMTgzTDEyNSA1Mi4xem0xNyA4My4zaC0zNGwxNy00MC45IDE3IDQwLjl6IiAvPgogIDwvc3ZnPg== "&gt;
&lt;/div&gt;
&lt;h2&gt;Here is my library service being used: {{toUpper}}&lt;/h2&gt;
&lt;lib-my-library&gt;&lt;/lib-my-library&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example <code>app.module.ts</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">import { BrowserModule } from '@angular/platform-browser';
import { NgModule } from '@angular/core';

import { AppRoutingModule } from './app-routing.module';
import { AppComponent } from './app.component';

import { MyLibraryModule } from 'my-library';
@NgModule({
  declarations: [
    AppComponent
  ],
  imports: [
    BrowserModule,
    AppRoutingModule,
    MyLibraryModule
  ],
  providers: [],
  bootstrap: [AppComponent]
})
export class AppModule { }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The result from using the library:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/angular-library/result.png"><img src="../_images/images/angular-library/result.png" alt="result"></a>
</div>
</div>
</div>
<div class="sect3">
<h4 id="devon4ng-libraries"><a class="anchor" href="#devon4ng-libraries"></a>devon4ng libraries</h4>
<div class="paragraph">
<p>In <a href="https://github.com/devonfw/devon4ng-library">devonfw/devon4ng-library</a> you can find some useful libraries:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Authorization module</strong>: This devon4ng Angular module adds rights-based authorization to your Angular app.</p>
</li>
<li>
<p><strong>Cache module</strong>: Use this devon4ng Angular module when you want to cache requests to server. You may configure it to store in cache only the requests you need and to set the duration you want.</p>
</li>
</ul>
</div>
<!-- toc disabled -->
</div>
<div class="sect3">
<h4 id="angular-material-theming"><a class="anchor" href="#angular-material-theming"></a>Angular Material Theming</h4>
<div class="paragraph">
<p>Angular Material library offers UI components for developers, those components follows Google Material design baselines but characteristics like colors can be modified in order to adapt them to the needs of the client: corporative colors, corporative identity, dark themes, &#8230;&#8203;</p>
</div>
</div>
<div class="sect3">
<h4 id="theming-basics"><a class="anchor" href="#theming-basics"></a>Theming basics</h4>
<div class="paragraph">
<p>In Angular Material, a theme is created mixing multiple colors. Colors and its light and dark variants conform a <strong>palette</strong>. In general, a theme consists of the following palettes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>primary</strong>: Most used across screens and components.</p>
</li>
<li>
<p><strong>accent</strong>: Floating action button and interactive elements.</p>
</li>
<li>
<p><strong>warn</strong>: Error state.</p>
</li>
<li>
<p><strong>foreground</strong>: Text and icons.</p>
</li>
<li>
<p><strong>background</strong>: Element backgrounds.</p>
</li>
</ul>
</div>
<div id="id_palette_variants" class="imageblock">
<div class="content">
<img src="../_images/images/angular/angular-theming/palette.PNG" alt="Theme palette" width="600 link="images/angular/angular-theming/palette.PNG"">
</div>
<div class="title">Figure 19. Palettes and variants.</div>
</div>
<div class="paragraph">
<p>In angular material, a palette is represented as a SCSS map.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/angular/angular-theming/scss-map.png" alt="SCSS map" width="600 link="images/angular/angular-theming/scss-map.png"">
</div>
<div class="title">Figure 20. SCSS map and palettes.</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Some components can be forced to use primary, accent or warn palettes using the attribute <strong>color</strong>, for example: &lt;mat-toolbar color="primary"&gt;.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="pre-built-themes"><a class="anchor" href="#pre-built-themes"></a>Pre-built themes</h4>
<div class="paragraph">
<p>Available pre-built themes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>deeppurple-amber.css</code></p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/angular/angular-theming/deeppurple-amber.png" alt="`deeppurple-amber theme`" width="600 link="images/angular/angular-theming/deeppurple-amber.png"">
</div>
<div class="title">Figure 21. <code>deeppurple-amber</code> theme.</div>
</div>
<div class="ulist">
<ul>
<li>
<p>indigo-pink.css</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/angular/angular-theming/indigo-pink.png" alt="indigo-pink theme" width="600 link="images/angular/angular-theming/indigo-pink.png"">
</div>
<div class="title">Figure 22. indigo-pink theme.</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>pink-bluegrey.css</code></p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/angular/angular-theming/pink-bluegrey.png" alt="` pink-bluegrey theme`" width="600 link="images/angular/angular-theming/pink-bluegrey.png"">
</div>
<div class="title">Figure 23. <code>ink-bluegrey theme</code>.</div>
</div>
<div class="ulist">
<ul>
<li>
<p>purple-green.css</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/angular/angular-theming/purple-green.png" alt="purple-green theme" width="600 link="images/angular/angular-theming/purple-green.png"">
</div>
<div class="title">Figure 24. purple-green theme.</div>
</div>
<div class="paragraph">
<p>The pre-built themes can be added using <strong>@import</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-css hljs" data-lang="css">@import '@angular/material/prebuilt-themes/deeppurple-amber.css';</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="custom-themes"><a class="anchor" href="#custom-themes"></a>Custom themes</h4>
<div class="paragraph">
<p>Sometimes pre-built themes do not meet the needs of a project, because color schemas are too specific or do not incorporate branding colors, in those situations custom themes can be built to offer a better solution to the client.</p>
</div>
<div class="paragraph">
<p>For this topic, we are going to use a basic layout project that can be found in <a href="https://github.com/devonfw-sample/devon4ts-samples/tree/master/apps/angular-material-basic-layout">devon4ts-samples repository</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="basics"><a class="anchor" href="#basics"></a>Basics</h4>
<div class="paragraph">
<p>Before starting writing custom themes, there are some necessary things that have to be mentioned:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Add a default theme: The project mentioned before has just one global SCSS style sheet <code><strong>styles.scss</strong></code> that includes <code>indigo-pink.scss</code> which will be the default theme.</p>
</li>
<li>
<p>Add <em>@import '~@angular/material/theming';</em> at the beginning of the every style sheet to be able to use angular material pre-built color palettes and functions.</p>
</li>
<li>
<p>Add <em>@include mat-core();</em> <strong>once</strong> per project, so if you are writing multiple themes in multiple files you could import those files from a 'central' one (for example <code>styles.scss</code>). This includes all common styles that are used by multiple components.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/angular/angular-theming/theme-files-structure.png" alt="Theme files structure" width="600 link="images/angular/angular-theming/theme-files-structure.png"">
</div>
<div class="title">Figure 25. Theme files structure.</div>
</div>
</div>
<div class="sect3">
<h4 id="basic-custom-theme"><a class="anchor" href="#basic-custom-theme"></a>Basic custom theme</h4>
<div class="paragraph">
<p>To create a new custom theme, the <code>.scss</code> file containing it has to have imported the angular <code>_theming.scss</code> file (angular/material/theming) file and mat-core included. <code>_theming.scss</code> includes multiple color palettes and some functions that we are going to see below. The file for this basic theme is going to be named <code><strong>styles-custom-dark.scss</strong></code>.</p>
</div>
<div class="paragraph">
<p>First, declare new variables for primary, accent and warn palettes. Those variables are going to store the result of the function <strong>mat-palette</strong>.</p>
</div>
<div class="paragraph">
<p><strong>mat-palette</strong> accepts four arguments: base color palette, main, lighter and darker variants (See <a href="#id_palette_variants">Palettes and variants.</a>) and returns a new palette including some additional map values: default, lighter and darker (<code><a href="#id_scss_map">[id_scss_map]</a></code>). Only the first argument is mandatory.</p>
</div>
<div class="listingblock">
<div class="title">Listing 20. <code>File styles-custom-dark.scss</code>.</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scss hljs" data-lang="scss">$custom-dark-theme-primary: mat-palette($mat-pink);
$custom-dark-theme-accent: mat-palette($mat-blue);
$custom-dark-theme-warn: mat-palette($mat-red);
);</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example we are using colors available in <code>_theming.scss</code>: mat-pink, mat-blue, mat-red. If you want to use a custom color you need to define a new map, for instance:</p>
</div>
<div class="listingblock">
<div class="title">Listing 21. File <code>styles-custom-dark.scss</code> custom pink.</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scss hljs" data-lang="scss">$my-pink: (
    50 : #fcf3f3,
    100 : #f9e0e0,
    200 : #f5cccc,
    300 : #f0b8b8,
    500 : #ea9999,
    900 : #db6b6b,
    A100 : #ffffff,
    A200 : #ffffff,
    A400 : #ffeaea,
    A700 : #ffd0d0,
    contrast: (
        50 : #000000,
        100 : #000000,
        200 : #000000,
        300 : #000000,
        900 : #000000,
        A100 : #000000,
        A200 : #000000,
        A400 : #000000,
        A700 : #000000,
    )
);

$custom-dark-theme-primary: mat-palette($my-pink);
...</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Some pages allows to create these palettes easily, for instance: <a href="http://mcg.mbitson.com" class="bare">http://mcg.mbitson.com</a>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Until now, we just have defined primary, accent and warn palettes but what about foreground and background? Angular material has two functions to change both:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>mat-light-theme</strong>: Receives as arguments primary, accent and warn palettes and return a theme whose foreground is basically black (texts, icons, &#8230;&#8203;), the background is white and the other palettes are the received ones.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/angular/angular-theming/custom-light.png" alt="`deeppurple-amber theme`" width="600 link="images/angular/angular-theming/custom-light.png"">
</div>
<div class="title">Figure 26. Custom light theme.</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>mat-dark-theme</strong>: Similar to mat-light-theme but returns a theme whose foreground is basically white and background black.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/angular/angular-theming/custom-dark.png" alt="`deeppurple-amber theme`" width="600 link="images/angular/angular-theming/custom-dark.png"">
</div>
<div class="title">Figure 27. Custom dark theme.</div>
</div>
<div class="paragraph">
<p>For this example we are going to use mat-dark-theme and save its result in $custom-dark-theme.</p>
</div>
<div class="listingblock">
<div class="title">Listing 22. File <code>styles-custom-dark.scss</code> updated with mat-dark-theme.</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scss hljs" data-lang="scss">...

$custom-dark-theme: mat-dark-theme(
  $custom-dark-theme-primary,
  $custom-dark-theme-accent,
  $custom-dark-theme-warn
);</code></pre>
</div>
</div>
<div class="paragraph">
<p>To apply the saved theme, we have to go to <code><strong>styles.scss</strong></code> and import our <code><strong>styles-custom-dark.scss</strong></code> and include a function called <strong>angular-material-theme</strong> using the theme variable as argument.</p>
</div>
<div class="listingblock">
<div class="title">Listing 23. File <code>styles.scss</code>.</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scss hljs" data-lang="scss">...
@import 'styles-custom-dark.scss';
@include angular-material-theme($custom-dark-theme);</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we have multiple themes it is necessary to add the include statement inside a css class and use it in <code>src/index.html &#8594; app-root component</code>.</p>
</div>
<div class="listingblock">
<div class="title">Listing 24. File <code>styles.scss</code> updated with custom-dark-theme class.</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scss hljs" data-lang="scss">...
@import 'styles-custom-dark.scss';

.custom-dark-theme {
  @include angular-material-theme($custom-dark-theme);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Listing 25. File <code>src/index.html</code>.</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">...
&lt;app-root class="custom-dark-theme"&gt;&lt;/app-root&gt;
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will apply <strong>$custom-dark-theme</strong> theme for the entire application.</p>
</div>
</div>
<div class="sect3">
<h4 id="full-custom-theme"><a class="anchor" href="#full-custom-theme"></a>Full custom theme</h4>
<div class="paragraph">
<p>Sometimes it is needed to custom different elements from background and foreground, in those situations we have to create a new function similar to <em>mat-light-theme</em> and <em>mat-dark-theme</em>. Let&#8217;s focus con mat-light-theme:</p>
</div>
<div id="source-mat-light" class="listingblock">
<div class="title">Listing 26. Source code of mat-light-theme</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scss hljs" data-lang="scss">@function mat-light-theme($primary, $accent, $warn: mat-palette($mat-red)) {
  @return (
    primary: $primary,
    accent: $accent,
    warn: $warn,
    is-dark: false,
    foreground: $mat-light-theme-foreground,
    background: $mat-light-theme-background,
  );
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As we can see, <em>mat-light-theme</em> takes three arguments and returns a map including them as primary, accent and warn color; but there are three more keys in that map: is-dark, foreground and background.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>is-dark</strong>: Boolean true if it is a dark theme, false otherwise.</p>
</li>
<li>
<p><strong>background</strong>: Map that stores the color for multiple background elements.</p>
</li>
<li>
<p><strong>foreground</strong>: Map that stores the color for multiple foreground elements.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To show which elements can be colored lets create a new theme in a file <code><strong>styles-custom-cap.scss</strong></code>:</p>
</div>
<div class="listingblock">
<div class="title">Listing 27. File <code>styles-custom-cap.scss</code>: Background and foreground variables.</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scss hljs" data-lang="scss">@import '~@angular/material/theming';

// custom background and foreground palettes
$my-cap-theme-background: (
  status-bar: #0070ad,
  app-bar: map_get($mat-blue, 900),
  background: #12abdb,
  hover: rgba(white, 0.04),
  card: map_get($mat-red, 800),
  dialog: map_get($mat-grey, 800),
  disabled-button: $white-12-opacity,
  raised-button: map-get($mat-grey, 800),
  focused-button: $white-6-opacity,
  selected-button: map_get($mat-grey, 900),
  selected-disabled-button: map_get($mat-grey, 800),
  disabled-button-toggle: black,
  unselected-chip: map_get($mat-grey, 700),
  disabled-list-option: black,
);

$my-cap-theme-foreground: (
  base: yellow,
  divider: $white-12-opacity,
  dividers: $white-12-opacity,
  disabled: rgba(white, 0.3),
  disabled-button: rgba(white, 0.3),
  disabled-text: rgba(white, 0.3),
  hint-text: rgba(white, 0.3),
  secondary-text: rgba(white, 0.7),
  icon: white,
  icons: white,
  text: white,
  slider-min: white,
  slider-off: rgba(white, 0.3),
  slider-off-active: rgba(white, 0.3),
);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Function which uses the variables defined before to create a new theme:</p>
</div>
<div class="listingblock">
<div class="title">Listing 28. File <code>styles-custom-cap.scss</code>: Creating a new theme function.</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scss hljs" data-lang="scss">// instead of creating a theme with mat-light-theme or mat-dark-theme,
// we will create our own theme-creating function that lets us apply our own foreground and background palettes.
@function create-my-cap-theme($primary, $accent, $warn: mat-palette($mat-red)) {
  @return (
    primary: $primary,
    accent: $accent,
    warn: $warn,
    is-dark: false,
    foreground: $my-cap-theme-foreground,
    background: $my-cap-theme-background
  );
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Calling the new function and storing its value in <strong>$custom-cap-theme</strong>.</p>
</div>
<div class="listingblock">
<div class="title">Listing 29. File <code>styles-custom-cap.scss</code>: Storing the new theme.</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scss hljs" data-lang="scss">// We use create-my-cap-theme instead of mat-light-theme or mat-dark-theme
$custom-cap-theme-primary: mat-palette($mat-green);
$custom-cap-theme-accent: mat-palette($mat-blue);
$custom-cap-theme-warn: mat-palette($mat-red);

$custom-cap-theme: create-my-cap-theme(
  $custom-cap-theme-primary,
  $custom-cap-theme-accent,
  $custom-cap-theme-warn
);</code></pre>
</div>
</div>
<div class="paragraph">
<p>After defining our new theme, we can import it from <code>styles.scss</code>.</p>
</div>
<div class="listingblock">
<div class="title">Listing 30. File <code>styles.scss</code> updated with custom-cap-theme class.</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scss hljs" data-lang="scss">...
@import 'styles-custom-cap.scss';
.custom-cap-theme {
  @include angular-material-theme($custom-cap-theme);
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="multiple-themes-and-overlay-based-components"><a class="anchor" href="#multiple-themes-and-overlay-based-components"></a>Multiple themes and overlay-based components</h4>
<div class="paragraph">
<p>Certain components (e.g. menu, select, dialog, etc.) that are inside of a global overlay container,require an additional step to be affected by the theme&#8217;s css class selector.</p>
</div>
<div class="listingblock">
<div class="title">Listing 31. File app.module.ts</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">import {OverlayContainer} from '@angular/cdk/overlay';

@NgModule({
  // ...
})
export class AppModule {
  constructor(overlayContainer: OverlayContainer) {
    overlayContainer.getContainerElement().classList.add('custom-cap-theme');
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="useful-resources"><a class="anchor" href="#useful-resources"></a>Useful resources</h4>
<div class="ulist">
<ul>
<li>
<p><a href="https://material.angular.io/guide/theming">Angular Material&#8217;s official theming guide</a></p>
</li>
<li>
<p><a href="https://material.io/design/color/#color-theme-creation">Material Design: Color theme creation</a></p>
</li>
<li>
<p><a href="http://mcg.mbitson.com">Palette generator</a></p>
</li>
<li>
<p><a href="https://sass-lang.com/guide">SCSS tutorial</a></p>
</li>
</ul>
</div>
<!-- toc disabled -->
</div>
<div class="sect3">
<h4 id="angular-progressive-web-app"><a class="anchor" href="#angular-progressive-web-app"></a>Angular Progressive Web App</h4>
<div class="paragraph">
<p>Progressive web applications (PWA) are web application that offer better user experience than the traditional ones. In general, they solve problems related with reliability and speed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Reliability</em>:  PWA are stable. In this context stability means than even with slow connections or even with no network at all, the application still works. To achieve this, some basic resources like styles, fonts, requests, &#8230;&#8203; are stored; due to this caching, it is not possible to assure that the content is always up-to-date.</p>
</li>
<li>
<p><em>Speed</em>: When an users opens an application, he or she will expect it to load almost immediately (almost 53% of users abandon sites that take longer that 3 seconds, source: <a href="https://developers.google.com/web/progressive-web-apps/#fast" class="bare">https://developers.google.com/web/progressive-web-apps/#fast</a>).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>PWA uses a script called <a href="https://developers.google.com/web/fundamentals/primers/service-workers/">service worker</a>, which runs in background and essentially act as proxy between web app and network, intercepting requests and acting depending on the network conditions.</p>
</div>
</div>
<div class="sect3">
<h4 id="assumptions"><a class="anchor" href="#assumptions"></a>Assumptions</h4>
<div class="paragraph">
<p>This guide assumes that you already have installed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>NodeJS</p>
</li>
<li>
<p>npm package manager</p>
</li>
<li>
<p>Angular CLI / Nx CLI</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="sample-application"><a class="anchor" href="#sample-application"></a>Sample Application</h4>
<div class="imageblock">
<div class="content">
<img src="../_images/images/angular/angular-pwa/mts-pwa-rec.png" alt="My Thai Star recommendation" width="800 link="images/angular/angular-pwa/mts-pwa-rec.png"">
</div>
<div class="title">Figure 28. Basic angular PWA.</div>
</div>
<div class="paragraph">
<p>To explain how to build PWA using angular, a basic application is going to be built. This app will be able to ask for resources and save in the cache in order to work even offline.</p>
</div>
</div>
<div class="sect3">
<h4 id="step-1-create-a-new-project"><a class="anchor" href="#step-1-create-a-new-project"></a>Step 1: Create a new project</h4>
<div class="paragraph">
<p>This step can be completed with one simple command using the Angular CLI: <code>ng new &lt;name&gt;</code>, where <code>&lt;name&gt;</code> is the name for the app. In this case, the app is going to be named <code><strong>basic-ng-pwa</strong></code>. If you are using Nx CLI, you can use the command <code>nx generate @nrwl/angular:app &lt;name&gt;</code> in your Nx workspace. You can follow <a href="https://github.com/devonfw/devon4ng/wiki/guide-creating-angular-app-with-nx-cli">this guide</a> if you want to get started with Nx workspace.</p>
</div>
</div>
<div class="sect3">
<h4 id="step-2-create-a-service"><a class="anchor" href="#step-2-create-a-service"></a>Step 2: Create a service</h4>
<div class="paragraph">
<p>Web applications usually uses external resources, making necessary the addition of services which can get those resources. This application gets a dish from My Thai Star&#8217;s back-end and shows it. To do so, a new service is going to be created.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>go to project folder: <code>cd basic-ng-pwa</code>. If using Nx, go to the root folder of the workspace.</p>
</li>
<li>
<p>run <code>ng generate service data</code>. For Nx CLI, specify the project name with <code>--project</code> flag. So the command becomes <code>ng generate service data --project=basic-ng-pwa</code></p>
</li>
<li>
<p>Modify <strong>data.service.ts</strong>, <strong>environment.ts</strong>, <strong>environment.prod.ts</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To retrieve data with this service, you have to import the module <code>HttpClient</code> and add it to the service&#8217;s constructor. Once added, use it to create a function <code><strong>getDishes()</strong></code> that sends HTTP request to My Thai Start&#8217;s back-end. The URL of the back-end can be stored as an environment variable <strong>MY_THAI_STAR_DISH</strong>.</p>
</div>
<div class="paragraph">
<p><strong>data.service.ts</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">  ...
  import { HttpClient } from '@angular/common/http';
  import { MY_THAI_STAR_DISH } from '../environments/environment';
  ...

  export class DataService {
    constructor(private http: HttpClient) {}

    /* Get data from Back-end */
    getDishes() {
      return this.http.get(MY_THAI_STAR_DISH);
    }
    ...
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>environments.ts</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">  ...
  export const MY_THAI_STAR_DISH =
  'https://mts-devonfw-core.cloud.okteto.net/api/services/rest/dishmanagement/v1/dish/1';
  ...</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>environments.prod.ts</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">  ...
  export const MY_THAI_STAR_DISH =
  'https://mts-devonfw-core.cloud.okteto.net/api/services/rest/dishmanagement/v1/dish/1';
  ...</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="step-3-use-the-service"><a class="anchor" href="#step-3-use-the-service"></a>Step 3: Use the service</h4>
<div class="paragraph">
<p>The component <code>AppComponent</code> implements the interface <code>OnInit</code> and inside its method <code>ngOnInit()</code> the subscription to the services is done. When a dish arrives, it is saved and shown (app.component.html).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">  ...
  import { DataService } from './data.service';
  export class AppComponent implements OnInit {
  dish: { name: string; description: string } = { name: '', description: ''};

  ...
  ngOnInit() {
    this.data
      .getDishes()
      .subscribe(
        (dishToday: { dish: { name: string; description: string } }) =&gt; {
          this.dish = {
            name: dishToday.dish.name,
            description: dishToday.dish.description,
          };
        },
      );
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="step-4-structures-styles-and-updates"><a class="anchor" href="#step-4-structures-styles-and-updates"></a>Step 4: Structures, styles and updates</h4>
<div class="paragraph">
<p>This step shows code interesting inside the sample app. The complete content can be found in <a href="https://github.com/devonfw-sample/devon4ts-samples/tree/master/apps/angular-basic-pwa">devon4ts-samples</a>.</p>
</div>
<div class="paragraph">
<p><strong>index.html</strong></p>
</div>
<div class="paragraph">
<p>To use the Montserrat font add the following link inside the <code>head</code> tag of the app&#8217;s index.html file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">  &lt;link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet"&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code><strong>styles.scss</strong></code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-css hljs" data-lang="css">  body {
    ...
    font-family: 'Montserrat', sans-serif;
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p><code><strong>app.component.ts</strong></code></p>
</div>
<div class="paragraph">
<p>This file is also used to reload the app if there are any changes.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>SwUpdate</code>: This object comes inside the <code>@angular/pwa</code> package and it is used to detect changes and reload the page if needed.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">  ...
  import { SwUpdate } from '@angular/service-worker';

  export class AppComponent implements OnInit {

  ...
    constructor(updates: SwUpdate, private data: DataService) {
      updates.available.subscribe((event) =&gt; {
        updates.activateUpdate().then(() =&gt; document.location.reload());
      });
    }
    ...
  }</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="step-5-make-it-progressive"><a class="anchor" href="#step-5-make-it-progressive"></a>Step 5: Make it Progressive.</h4>
<div class="paragraph">
<p>Install Angular PWA package with <code>ng add @angular/pwa --project=&lt;name&gt;</code>. As before substitute <code>name</code> with <code><strong>basic-ng-pwa</strong></code>.</p>
</div>
<div class="paragraph">
<p>The above command completes the following actions:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Adds the @angular/service-worker package to your project.</p>
</li>
<li>
<p>Enables service worker build support in the CLI.</p>
</li>
<li>
<p>Imports and registers the service worker in the app module.</p>
</li>
<li>
<p>Updates the <code>index.html</code> file:</p>
<div class="ulist">
<ul>
<li>
<p>Includes a link to add the <code>manifest.json</code> file.</p>
</li>
<li>
<p>Adds meta tags for theme-color.</p>
</li>
<li>
<p>Installs icon files to support the installed Progressive Web App (PWA).</p>
</li>
<li>
<p>Creates the service worker configuration file called <code>ngsw-config.json</code>, which specifies the caching behaviors and other settings.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="manifest-json"><a class="anchor" href="#manifest-json"></a>==  <code>manifest.json</code></h4>
<div class="paragraph">
<p>manifest.json is a file that allows to control how the app is displayed in places where native apps are displayed.</p>
</div>
<div class="paragraph">
<p><strong>Fields</strong></p>
</div>
<div class="paragraph">
<p><code>name</code>: Name of the web application.</p>
</div>
<div class="paragraph">
<p><code>short_name</code>: Short version of name.</p>
</div>
<div class="paragraph">
<p><code>theme_color</code>: Default theme color for an application context.</p>
</div>
<div class="paragraph">
<p><code>background_color</code>: Expected background color of the web application.</p>
</div>
<div class="paragraph">
<p><code>display</code>: Preferred display mode.</p>
</div>
<div class="paragraph">
<p><code>scope</code>: Navigation scope of this web application&#8217;s application context.</p>
</div>
<div class="paragraph">
<p><code>start_url</code>: URL loaded when the user launches the web application.</p>
</div>
<div class="paragraph">
<p><code>icons</code>: Array of icons that serve as representations of the web app.</p>
</div>
<div class="paragraph">
<p>Additional information can be found <a href="https://developers.google.com/web/fundamentals/web-app-manifest/">here</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="ngsw-config-json"><a class="anchor" href="#ngsw-config-json"></a>==  <code>ngsw-config.json</code></h4>
<div class="paragraph">
<p>ngsw-config.json specifies which files and data URLs have to be cached and updated by the Angular service worker.</p>
</div>
<div class="paragraph">
<p><strong>Fields</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>index</em>: File that serves as index page to satisfy navigation requests.</p>
</li>
<li>
<p><code><em>assetGroups</em></code>: Resources that are part of the app version that update along with the app.</p>
<div class="ulist">
<ul>
<li>
<p><em>name</em>: Identifies the group.</p>
</li>
<li>
<p><code><em>installMode</em></code>: How the resources are cached (pre-fetch or lazy).</p>
</li>
<li>
<p><code><em>updateMode</em></code>: Caching behavior when a new version of the app is found (pre-fetch or lazy).</p>
</li>
<li>
<p><em>resources</em>: Resources to cache. There are three groups.</p>
<div class="ulist">
<ul>
<li>
<p><em>files</em>: Lists patterns that match files in the distribution directory.</p>
</li>
<li>
<p><code><em>urls</em></code>:  URL patterns matched at runtime.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><code><em>dataGroups</em></code>: <code>UsefulIdentifies</code> the group. for API requests.</p>
<div class="ulist">
<ul>
<li>
<p><em>name</em>: Identifies the group.</p>
</li>
<li>
<p><code><em>urls</em></code>: URL patterns matched at runtime.</p>
</li>
<li>
<p><em>version</em>:  Indicates that the resources being cached have been updated in a backwards-incompatible way.</p>
</li>
<li>
<p><code><em>cacheConfig</em></code>: Policy by which matching requests will be cached</p>
<div class="ulist">
<ul>
<li>
<p><code><em>maxSize</em></code>: The maximum number of entries, or responses, in the cache.</p>
</li>
<li>
<p><code><em>maxAge</em></code>: How long responses are allowed to remain in the cache.</p>
<div class="ulist">
<ul>
<li>
<p>d: days. (5d = 5 days).</p>
</li>
<li>
<p>h: hours</p>
</li>
<li>
<p>m: minutes</p>
</li>
<li>
<p>s: seconds. (5m20s = 5 minutes and 20 seconds).</p>
</li>
<li>
<p>u: milliseconds</p>
</li>
</ul>
</div>
</li>
<li>
<p><em>timeout</em>: How long the Angular service worker will wait for the network to respond before using a cached response. Same <code>dataformat</code> as <code>maxAge</code>.</p>
</li>
<li>
<p><em>strategy</em>: Caching strategies (performance or freshness).</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><code><em>navigationUrls</em></code>: List of URLs that will be redirected to the index file.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Additional information can be found <a href="https://angular.io/guide/service-worker-config">here</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="step-6-configure-the-app"><a class="anchor" href="#step-6-configure-the-app"></a>Step 6: Configure the app</h4>
<div class="paragraph">
<p><strong>manifest.json</strong></p>
</div>
<div class="paragraph">
<p>Default configuration.</p>
</div>
<div class="paragraph">
<p>&#160;<br>
&#160;<br></p>
</div>
<div class="paragraph">
<p><code><strong>ngsw-config.json</strong></code></p>
</div>
<div class="paragraph">
<p>At <code><em>assetGroups &#8594; resources &#8594; urls</em></code>: In this field the google fonts API is added in order to use Montserrat font even without network.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>  "urls": [
          "https://fonts.googleapis.com/**"
        ]</code></pre>
</div>
</div>
<div class="paragraph">
<p>At the root of the json: A data group to cache API calls.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>  {
    ...
    "dataGroups": [{
      "name": "mythaistar-dishes",
      "urls": [
        "https://mts-devonfw-core.cloud.okteto.net/api/services/rest/dishmanagement/v1/dish/1"
      ],
      "cacheConfig": {
        "maxSize": 100,
        "maxAge": "1h",
        "timeout": "10s",
        "strategy": "freshness"
      }
    }]
  }</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="step-7-check-that-your-app-is-a-pwa"><a class="anchor" href="#step-7-check-that-your-app-is-a-pwa"></a>Step 7: Check that your app is a PWA</h4>
<div class="paragraph">
<p>To check if an app is a PWA lets compare its normal behavior against itself but built for production. Run in the project&#8217;s root folder the commands below:</p>
</div>
<div class="paragraph">
<p><code>ng build --prod</code> to build the app using production settings.(<code>nx build &lt;name&gt; --prod</code> in Nx CLI)</p>
</div>
<div class="paragraph">
<p><code>npm install http-server</code> to install an npm module that can serve your built application. Documentation <a href="https://www.npmjs.com/package/http-server">here</a>.</p>
</div>
<div class="paragraph">
<p>Go to the <code>dist/basic-ng-pwa/</code> folder running <code>cd dist/basic-ng-pwa</code>. In an Nx workspace, the path will be <code>dist/apps/basic-ng-pwa</code></p>
</div>
<div class="paragraph">
<p><code>http-server -o</code> to serve your built app.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/angular/angular-pwa/http-serve.png" alt="Http server running" width="600 link="images/angular/angular-pwa/http-serve.png"">
</div>
<div class="title">Figure 29. Http server running on localhost:8081.</div>
</div>
<div class="paragraph">
<p>&#160;</p>
</div>
<div class="paragraph">
<p>In another console instance run <code>ng serve</code> (or <code>nx serve basic-ng-pwa</code> for Nx) to open the common app (not built).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/angular/angular-pwa/ng-serve.png" alt=".Angular server running" width="600 link="images/angular/angular-pwa/ng-serve.png"">
</div>
<div class="title">Figure 30. Angular server running on localhost:4200.</div>
</div>
<div class="paragraph">
<p>&#160;</p>
</div>
<div class="paragraph">
<p>The first difference can be found on <em>Developer tools &#8594; application</em>, here it is seen that the PWA application (left) has a service worker and the common (right) one does not.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/angular/angular-pwa/pwa-nopwa-app-ng.png" alt="Application comparison" width="800 link="images/angular/angular-pwa/pwa-nopwa-app-ng.png"">
</div>
<div class="title">Figure 31. Application service worker comparison.</div>
</div>
<div class="paragraph">
<p>&#160;</p>
</div>
<div class="paragraph">
<p>If the "offline" box is checked, it will force a disconnection from network. In situations where users do not have connectivity or have a slow, one the PWA can still be accessed and used.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/angular/angular-pwa/online-offline-ng.png" alt="Online offline apps" width="800 link="images/angular/angular-pwa/online-offline-ng.png"">
</div>
<div class="title">Figure 32. Offline application.</div>
</div>
<div class="paragraph">
<p>&#160;</p>
</div>
<div class="paragraph">
<p>Finally, browser extensions like <a href="https://chrome.google.com/webstore/detail/lighthouse/blipmdconlkpinefehnmjammfjpmpbjk">Lighthouse</a> can be used to test whether an application is progressive or not.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/angular/angular-pwa/lighthouse-ng.png" alt="Lighthouse report" width="800 link="images/angular/angular-pwa/lighthouse-ng.png"">
</div>
<div class="title">Figure 33. Lighthouse report.</div>
</div>
<!-- toc disabled -->
</div>
<div class="sect3">
<h4 id="app_initializer"><a class="anchor" href="#app_initializer"></a><code>APP_INITIALIZER</code></h4>

</div>
<div class="sect3">
<h4 id="what-is-the-app_initializer-pattern"><a class="anchor" href="#what-is-the-app_initializer-pattern"></a>What is the <code>APP_INITIALIZER</code> pattern</h4>
<div class="paragraph">
<p>The <code>APP_INITIALIZER</code> pattern allows an application to choose which configuration is going to be used in the start of the application, this is useful because it allows to setup different configurations, for example, for docker or a remote configuration. This provides benefits since this is done on <code>runtime</code>, so there&#8217;s no need to recompile the whole application to switch from configuration.</p>
</div>
</div>
<div class="sect3">
<h4 id="what-is-app_initializer"><a class="anchor" href="#what-is-app_initializer"></a>What is <code>APP_INITIALIZER</code></h4>
<div class="paragraph">
<p><code>APP_INITIALIZER</code> allows to provide a service in the initialization of the application in a <code>@NgModule</code>. It also allows to use a factory, allowing to create a singleton in the same service. An example can be found in <code>MyThaiStar</code> <code>/core/config/config.module.ts</code>:</p>
</div>
</div>
<div class="sect3">
<h4 id="-4"><a class="anchor" href="#-4"></a>==</h4>
<div class="paragraph">
<p>The provider expects the return of a <code>Promise</code>, if it is using Observables, a change with the method <code>toPromise()</code> will allow a switch from <code>Observable</code> to <code>Promise</code>
== ==</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">import { NgModule, APP_INITIALIZER } from '@angular/core';
import { HttpClientModule } from '@angular/common/http';

import { ConfigService } from './config.service';

@NgModule({
  imports: [HttpClientModule],
  providers: [
    ConfigService,
    {
      provide: APP_INITIALIZER,
      useFactory: ConfigService.factory,
      deps: [ConfigService],
      multi: true,
    },
  ],
})
export class ConfigModule {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is going to allow the creation of a <code>ConfigService</code> where, using a singleton, the service is going to load an external config depending on a route. This dependence with a route, allows to setup different configuration for docker etc. This is seen in the <code>ConfigService</code> of <code>MyThaiStar</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">import { Injectable } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { Config, config } from './config';

@Injectable()
export class ConfigService {
  constructor(private httpClient: HttpClient) {}

  static factory(appLoadService: ConfigService) {
    return () =&gt; appLoadService.loadExternalConfig();
  }

  // this method gets external configuration calling /config endpoint
  //and merges into config object
  loadExternalConfig(): Promise&lt;any&gt; {
    if (!environment.loadExternalConfig) {
      return Promise.resolve({});
    }

    const promise = this.httpClient
      .get('/config')
      .toPromise()
      .then((settings) =&gt; {
        Object.keys(settings || {}).forEach((k) =&gt; {
          config[k] = settings[k];
        });
        return settings;
      })
      .catch((error) =&gt; {
        return 'ok, no external configuration';
      });

    return promise;
  }

  getValues(): Config {
    return config;
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As it is mentioned earlier, you can see the use of a factory to create a singleton at the start. After that, <code>loadExternalConfig</code> is going to look for a Boolean inside the corresponding environment file inside the path <code>src/environments/</code>, this Boolean <code>loadExternalConfig</code> is going to easily allow to switch to a external config. If it is true, it generates a promise that overwrites the parameters of the local config, allowing to load the external config. Finally, the last method <code>getValues()</code> is going to allow to return the file config with the values (overwritten or not). The local <code>config</code> file from <code>MyThaiStar</code> can be seen here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">export enum BackendType {
  IN_MEMORY,
  REST,
  GRAPHQL,
}

interface Role {
  name: string;
  permission: number;
}

interface Lang {
  label: string;
  value: string;
}

export interface Config {
  version: string;
  backendType: BackendType;
  restPathRoot: string;
  restServiceRoot: string;
  pageSizes: number[];
  pageSizesDialog: number[];
  roles: Role[];
  langs: Lang[];
}

export const config: Config = {
  version: 'dev',
  backendType: BackendType.REST,
  restPathRoot: 'http://localhost:8081/mythaistar/',
  restServiceRoot: 'http://localhost:8081/mythaistar/services/rest/',
  pageSizes: [8, 16, 24],
  pageSizesDialog: [4, 8, 12],
  roles: [
    { name: 'CUSTOMER', permission: 0 },
    { name: 'WAITER', permission: 1 },
  ],
  langs: [
    { label: 'English', value: 'en' },
    { label: 'Deutsch', value: 'de' },
    { label: 'Español', value: 'es' },
    { label: 'Català', value: 'ca' },
    { label: 'Français', value: 'fr' },
    { label: 'Nederlands', value: 'nl' },
    { label: 'हिन्दी', value: 'hi' },
    { label: 'Polski', value: 'pl' },
    { label: 'Русский', value: 'ru' },
    { label: 'български', value: 'bg' },
  ],
};</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, inside a environment file <code>src/environments/environment.ts</code> the use of the Boolean <code>loadExternalConfig</code> is seen:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">// The file contents for the current environment will overwrite these during build.
// The build system defaults to the dev environment which uses `environment.ts`, but if you do
// `ng build --env=prod` then `environment.prod.ts` will be used instead.
// The list of which env maps to which file can be found in `.angular-cli.json`.

export const environment: {
  production: boolean;
  loadExternalConfig: boolean;
} = { production: false, loadExternalConfig: false };</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="creating-a-app_initializer-configuration"><a class="anchor" href="#creating-a-app_initializer-configuration"></a>Creating a <code>APP_INITIALIZER</code> configuration</h4>
<div class="paragraph">
<p>This section is going to be used to create a new <code>APP_INITIALIZER</code> basic example. For this, a basic app with angular is going to be generated using <code>ng new "appname"</code> substituting <code>appname</code> for the name of the app opted.
If you are using Nx, the command would be <code>nx generate @nrwl/angular:app "appname"</code> in your Nx workspace. <a href="https://github.com/devonfw/devon4ng/wiki/guide-creating-angular-app-with-nx-cli">Click here</a> to get started with using Nx.</p>
</div>
</div>
<div class="sect3">
<h4 id="setting-up-the-config-files"><a class="anchor" href="#setting-up-the-config-files"></a>Setting up the config files</h4>

</div>
<div class="sect3">
<h4 id="docker-external-configuration-optional"><a class="anchor" href="#docker-external-configuration-optional"></a>Docker external configuration (Optional)</h4>
<div class="paragraph">
<p>This section is only done if there is a docker configuration in the app you are setting up this type of configuration.</p>
</div>
<div class="paragraph">
<p>1.- Create in the root folder <code>/docker-external-config.json</code>. This external config is going to be used when the application is loaded with docker (if the Boolean to load the external configuration is set to true). Here you need to add all the config parameter you want to load with docker:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "version": "docker-version"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>2.- In the root, in the file <code>/Dockerfile</code> angular is going to copy the <code>docker-external-config.json</code> that was created before into the Nginx html route:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>....
COPY docker-external-config.json /usr/share/nginx/html/docker-external-config.json
....</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="external-json-configuration"><a class="anchor" href="#external-json-configuration"></a>External json configuration</h4>
<div class="paragraph">
<p>1.- Create a json file in the route <code>/src/external-config.json</code>. This external config is going to be used when the application is loaded with the start script (if the Boolean to load the external configuration is set to true). Here you need to add all the config parameter you want to load:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "version": "external-config"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>2.- The file named <code>/angular.json</code> (<code>/workspace.json</code> if using Nx) located at the root is going to be modified to add the file <code>external-config.json</code> that was just created to both <code>"assets"</code> inside <code>Build</code> and <code>Test</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">	....
	"build": {
          ....
            "assets": [
              "src/assets",
              "src/data",
              "src/favicon.ico",
              "src/manifest.json",
              "src/external-config.json"
            ]
	        ....
        "test": {
	  ....
	   "assets": [
              "src/assets",
              "src/data",
              "src/favicon.ico",
              "src/manifest.json",
              "src/external-config.json"
            ]
	  ....</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="setting-up-the-proxies"><a class="anchor" href="#setting-up-the-proxies"></a>Setting up the proxies</h4>
<div class="paragraph">
<p>This step is going to setup two proxies. This is going to allow to load the config desired by the context, in case that it is using docker to load the app or in case it loads the app with angular. Loading different files is made possible by the fact that the <code>ConfigService</code> method <code>loadExternalConfig()</code> looks for the path <code>/config</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="docker-optional"><a class="anchor" href="#docker-optional"></a>Docker (Optional)</h4>
<div class="paragraph">
<p>1.- This step is going to be for docker. Add <code>docker-external-config.json</code> to Nginx configuration (<code>/nginx.conf</code>) that is in the root of the application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>....
  location  ~ ^/config {
        alias /usr/share/nginx/html/docker-external-config.json;
  }
....</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="external-configuration"><a class="anchor" href="#external-configuration"></a>External Configuration</h4>
<div class="paragraph">
<p>1.- Now the file <code>/proxy.conf.json</code>, needs to be created/modified this file can be found in the root of the application. In this file you can add the route of the external configuration in <code>target</code> and the name of the file in <code>^/config:</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">....
  "/config": {
    "target": "http://localhost:4200",
    "secure": false,
    "pathRewrite": {
      "^/config": "/external-config.json"
    }
  }
....</code></pre>
</div>
</div>
<div class="paragraph">
<p>2.- The file <code>package.json</code> found in the root of the application is gonna use the start script to load the proxy config that was just created :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">  "scripts": {
....
    "start": "ng serve --proxy-config proxy.conf.json -o",
....</code></pre>
</div>
</div>
<div class="paragraph">
<p>If using Nx, you need to run the command manually:</p>
</div>
<div class="paragraph">
<p><code>nx run angular-app-initializer:serve:development --proxyConfig=proxy.conf.json --o</code></p>
</div>
</div>
<div class="sect3">
<h4 id="adding-the-loadexternalconfig-boolean-to-the-environments"><a class="anchor" href="#adding-the-loadexternalconfig-boolean-to-the-environments"></a>Adding the <code>loadExternalConfig</code> Boolean to the environments</h4>
<div class="paragraph">
<p>In order to load an external config we need to add the <code>loadExternalConfig</code> Boolean to the environments. To do so, inside the folder <code>environments/</code> the files are going to get modified adding this Boolean to each environment that is going to be used. In this case, only two environments are going to be modified (<code>environment.ts</code> and <code>environment.prod.ts</code>). Down below there is an example of the modification being done in the <code>environment.prod.ts</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">export const environment: {
  production: boolean;
  loadExternalConfig: boolean;
} = { production: false, loadExternalConfig: false };</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the file in first instance there is the declaration of the types of the variables. After that, there is the definition of those variables. This variable <code>loadExternalConfig</code> is going to be used by the service, allowing to setup a external config just by switching the <code>loadExternalConfig</code> to true.</p>
</div>
</div>
<div class="sect3">
<h4 id="creating-core-configuration-service"><a class="anchor" href="#creating-core-configuration-service"></a>Creating core configuration service</h4>
<div class="paragraph">
<p>In order to create the whole configuration module three are going to be created:</p>
</div>
<div class="paragraph">
<p>1.- Create in the core <code>app/core/config/</code> a <code>config.ts</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">  export interface Config {
    version: string;
  }

  export const config: Config = {
    version: 'dev'
  };</code></pre>
</div>
</div>
<div class="paragraph">
<p>Taking a look to this file, it creates a interface (<code>Config</code>) that is going to be used by the variable that exports (<code>export const config: Config</code>). This variable <code>config</code> is going to be used by the service that is going to be created.</p>
</div>
<div class="paragraph">
<p>2.- Create in the core <code>app/core/config/</code> a <code>config.service.ts</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">import { Injectable } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { Config, config } from './config';

@Injectable()
export class ConfigService {
  constructor(private httpClient: HttpClient) {}

  static factory(appLoadService: ConfigService) {
    return () =&gt; appLoadService.loadExternalConfig();
  }

  // this method gets external configuration calling /config endpoint
  // and merges into config object
  loadExternalConfig(): Promise&lt;any&gt; {
    if (!environment.loadExternalConfig) {
      return Promise.resolve({});
    }

    const promise = this.httpClient
      .get('/config')
      .toPromise()
      .then((settings) =&gt; {
        Object.keys(settings || {}).forEach((k) =&gt; {
          config[k] = settings[k];
        });
        return settings;
      })
      .catch((error) =&gt; {
        return 'ok, no external configuration';
      });

    return promise;
  }

  getValues(): Config {
    return config;
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As it was explained in previous steps, at first, there is a factory that uses the method <code>loadExternalConfig()</code>, this factory is going to be used in later steps in the module. After that, the <code>loadExternalConfig()</code> method checks if the Boolean in the environment is false. If it is false it will return the promise resolved with the normal config. Else, it is going to load the external config in the path (<code>/config</code>), and overwrite the values from the external config to the config that&#8217;s going to be used by the app, this is all returned in a promise.</p>
</div>
<div class="paragraph">
<p>3.- Create in the core a module for the config <code>app/core/config/</code> a <code>config.module.ts</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">import { NgModule, APP_INITIALIZER } from '@angular/core';
import { HttpClientModule } from '@angular/common/http';

import { ConfigService } from './config.service';

@NgModule({
  imports: [HttpClientModule],
  providers: [
    ConfigService,
    {
      provide: APP_INITIALIZER,
      useFactory: ConfigService.factory,
      deps: [ConfigService],
      multi: true,
    },
  ],
})
export class ConfigModule {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As seen earlier, the <code>ConfigService</code> is added to the module. In this addition, the app is initialized(<code>provide</code>) and it uses the factory that was created in the <code>ConfigService</code> loading the config with or without the external values depending on the Boolean in the <code>config</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="using-the-config-service"><a class="anchor" href="#using-the-config-service"></a>Using the Config Service</h4>
<div class="paragraph">
<p>As a first step, in the file <code>/app/app.module.ts</code> the <code>ConfigModule</code> created earlier in the other step is going to be imported:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">  imports: [
    ....
    ConfigModule,
    ....
  ]</code></pre>
</div>
</div>
<div class="paragraph">
<p>After that, the <code>ConfigService</code> is going to be injected into the <code>app.component.ts</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">....
import { ConfigService } from './core/config/config.service';
....
export class AppComponent {
....
  constructor(public configService: ConfigService) { }
....</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, for this demonstration app, the component <code>app/app.component.html</code> is going to show the version of the config it is using at that moment.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;div style="text-align:center"&gt;
  &lt;h1&gt;
    Welcome to {{ title }}!
  &lt;/h1&gt;
&lt;/div&gt;
&lt;h2&gt;Here is the configuration version that is using angular right now: {{configService.getValues().version}}&lt;/h2&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="final-steps"><a class="anchor" href="#final-steps"></a>Final steps</h4>
<div class="paragraph">
<p>The script <code>start</code> that was created earlier in the <code>package.json</code> (<code>npm start</code>) is going to be used to start the application. After that, modifying the Boolean <code>loadExternalConfig</code> inside the corresponding environment file inside <code>/app/environments/</code> should show the different config versions.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/loadExternalConfigFalse.png"><img src="../_images/images/app-initializer/loadExternalConfigFalse.png" alt="loadExternalConfigFalse"></a>
</div>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/loadExternalConfigTrue.png"><img src="../_images/images/app-initializer/loadExternalConfigTrue.png" alt="loadExternalConfigTrue"></a>
</div>
</div>
<!-- toc disabled -->
</div>
<div class="sect3">
<h4 id="component-decomposition"><a class="anchor" href="#component-decomposition"></a>Component Decomposition</h4>
<div class="paragraph">
<p>When implementing a new requirement there are a few design decisions, which need to be considered.
A decomposition in <em>Smart</em> and <em>Dumb Components</em> should be done first.
This includes the definition of state and responsibilities.
Implementing a new dialog will most likely be done by defining a new <em>Smart Component</em> with multiple <em>Dumb Component</em> children.</p>
</div>
<div class="paragraph">
<p>In the component tree this would translate to the definition of a new sub-tree.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/component-tree-highlighted-subtree.svg"><img src="../_images/images/component-tree-highlighted-subtree.svg" alt="Component Tree With Highlighted Sub Tree" width="450"></a>
</div>
<div class="title">Figure 34. Component Tree with highlighted sub-tree</div>
</div>
</div>
<div class="sect3">
<h4 id="defining-components"><a class="anchor" href="#defining-components"></a>Defining Components</h4>
<div class="paragraph">
<p>The following gives an example for component decomposition.
Shown is a screenshot from a style guide to be implemented.
It is a widget called <code>Listpicker</code>.</p>
</div>
<div class="paragraph">
<p>The basic function is an <code>input</code> field accepting direct input.
So typing <code>otto</code> puts <code>otto</code> inside the <code>FormControl</code>.
With arrow down key or by clicking the icon displayed in the inputs right edge a dropdown is opened.
Inside possible values can be selected and filtered beforehand.
After pressing arrow down key the focus should move into the filter input field.
Up and down arrow keys can be used to select an element from the list.
Typing into the filter input field filters the list from which the elements can be selected.
The current selected element is highlighted with green background color.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/component-decomposition-example-1.svg"><img src="../_images/images/component-decomposition-example-1.svg" alt="Component Decomposition Example 1v2" width="450"></a>
</div>
<div class="title">Figure 35. Component decomposition example before</div>
</div>
<div class="paragraph">
<p>What should be done, is to define small reusable <em>Dumb Components</em>.
This way the complexity becomes manageable.
In the example every colored box describes a component with the purple box being a <em>Smart Component</em>.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/component-decomposition-example-2.svg"><img src="../_images/images/component-decomposition-example-2.svg" alt="Component Decomposition Example 2v2" width="450"></a>
</div>
<div class="title">Figure 36. Component decomposition example after</div>
</div>
<div class="paragraph">
<p>This leads to the following component tree.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/component-decomposition-example-component-tree.svg"><img src="../_images/images/component-decomposition-example-component-tree.svg" alt="Component Decomposition Example component tree" width="450"></a>
</div>
<div class="title">Figure 37. Component decomposition example component tree</div>
</div>
<div class="paragraph">
<p>Note the uppermost component is a <em>Dumb Component</em>.
It is a wrapper for the label and the component to be displayed inside a form.
The <em>Smart Component</em> is <code>Listpicker</code>.
This way the widget can be reused without a form needed.</p>
</div>
<div class="paragraph">
<p>A widgets is a typical <em>Smart Component</em> to be shared across feature modules.
So the <code>SharedModule</code> is the place for it to be defined.</p>
</div>
</div>
<div class="sect3">
<h4 id="defining-state"><a class="anchor" href="#defining-state"></a>Defining state</h4>
<div class="paragraph">
<p>Every UI has state.
There are different kinds of state, for example</p>
</div>
<div class="ulist">
<ul>
<li>
<p>View State: e.g. is a panel open, a css transition pending, etc.</p>
</li>
<li>
<p>Application State: e.g. is a payment pending, current URL, user info, etc.</p>
</li>
<li>
<p>Business Data: e.g. products loaded from back-end</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It is good practice to base the component decomposition on the state handled by a component and to define a simplified state model beforehand.
Starting with the parent - the <em>Smart Component</em>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>What overall state does the dialog have: e.g. loading, error, valid data loaded, valid input, invalid input, etc.
Every defined value should correspond to an overall appearance of the whole dialog.</p>
</li>
<li>
<p>What events can occur to the dialog: e.g. submitting a form, changing a filter, pressing buttons, pressing keys, etc.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For every <em>Dumb Component</em>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>What data does a component display: e.g. a header text, user information to be displayed, a loading flag, etc.<br>
This will be a slice of the overall state of the parent <em>Smart Component</em>.
In general a <em>Dumb Component</em> presents a slice of its parent <em>Smart Components</em> state to the user.</p>
</li>
<li>
<p>What events can occur: keyboard events, mouse events, etc.<br>
These events are all handled by its parent <em>Smart Component</em> - every event is passed up the tree to be handled by a <em>Smart Component</em>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These information should be reflected inside the modeled state.
The implementation is a TypeScript type - an interface or a class describing the model.</p>
</div>
<div class="paragraph">
<p>So there should be a type describing all state relevant for a <em>Smart Component</em>.
An instance of that type is send down the component tree at runtime.
Not every <em>Dumb Component</em> will need the whole state.
For instance a single <em>Dumb Component</em> could only need a single string.</p>
</div>
<div class="paragraph">
<p>The state model for the previous <code>Listpicker</code> example is shown in the following listing.</p>
</div>
<div class="listingblock">
<div class="title">Listing 32. <code>Listpicker</code> state model</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">export class ListpickerState {

  items: {}[]|undefined;
  columns = ['key', 'value'];
  keyColumn = 'key';
  displayValueColumn = 'value';
  filteredItems: {}[]|undefined;
  filter = '';
  placeholder = '';
  caseSensitive = true;
  isDisabled = false;
  isDropdownOpen = false;
  selectedItem: {}|undefined;
  displayValue = '';

}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>Listpicker</code> holds an instance of <code>ListpickerState</code> which is passed down the component tree via <code>@Input()</code> bindings in the <em>Dumb Components</em>.
Events emitted by children - <em>Dumb Components</em> - create a new instance of <code>ListpickerState</code> based on the current instance and the event and its data.
So a state transition is just setting a new instance of <code>ListpickerState</code>.
Angular Bindings propagate the value down the tree after exchanging the state.</p>
</div>
<div class="listingblock">
<div class="title">Listing 33. <code>Listpicker</code> State transition</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">export class ListpickerComponent {

  // initial default values are set
  state = new ListpickerState();

  /** User changes filter */
  onFilterChange(filter: string): void {
    // apply filter ...
    const filteredList = this.filterService.filter(...);

    // important: A new instance is created, instead of altering the existing one.
    //            This makes change detection easier and prevents hard to find bugs.
    this.state = Object.assing({}, this.state, {
      filteredItems: filteredList,
      filter: filter
    });
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Note:</div>
<p>It is not always necessary to define the model as independent type.
So there would be no state property and just properties for every state defined directly in the component class.
When complexity grows and state becomes larger this is usually a good idea.
If the state should be shared between <em>Smart Components</em> a store is to be used.</p>
</div>
</div>
<div class="sect3">
<h4 id="when-are-dumb-components-needed"><a class="anchor" href="#when-are-dumb-components-needed"></a>When are Dumb Components needed</h4>
<div class="paragraph">
<p>Sometimes it is not necessary to perform a full decomposition. The architecture does not enforce it generally. What you should keep in mind is, that there is always a point when it becomes recommendable.</p>
</div>
<div class="paragraph">
<p>For example a template with 800 line of code is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>not understandable</p>
</li>
<li>
<p>not maintainable</p>
</li>
<li>
<p>not testable</p>
</li>
<li>
<p>not reusable</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>So when implementing a template with more than 50 line of code you should think about decomposition.</p>
</div>
<!-- toc disabled -->
</div>
<div class="sect3">
<h4 id="consuming-rest-services"><a class="anchor" href="#consuming-rest-services"></a>Consuming REST services</h4>
<div class="paragraph">
<p>A good introduction to working with <code>Angular HttpClient</code> can be found in <a href="https://angular.io/guide/http">Angular Docs</a></p>
</div>
<div class="paragraph">
<p>This guide will cover, how to embed <code>Angular HttpClient</code> in the application architecture.
For back-end request a special service with the suffix <code>Adapter</code> needs to be defined.</p>
</div>
</div>
<div class="sect3">
<h4 id="defining-adapters"><a class="anchor" href="#defining-adapters"></a>Defining Adapters</h4>
<div class="paragraph">
<p>It is a good practice to have a Angular service whose single responsibility is to call the back-end and parse the received value to a transfer data model (e.g. Swagger generated TOs).
Those services need to have the suffix <code>Adapter</code> to make them easy to recognize.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/rest-adapter.svg"><img src="../_images/images/rest-adapter.svg" alt="Adapters handle back-end communication" width="450"></a>
</div>
<div class="title">Figure 38. Adapters handle back-end communication</div>
</div>
<div class="paragraph">
<p>As illustrated in the figure a Use Case service does not use <code>Angular HttpClient</code> directly but uses an adapter.
A basic adapter could look like this:</p>
</div>
<div class="listingblock">
<div class="title">Listing 34. Example adapter</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">import { Injectable } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { Observable } from 'rxjs/Observable';

import { FlightTo } from './flight-to';

@Injectable({
 providedIn: 'root',
})
export class FlightsAdapter {

  constructor(
    private httpClient: HttpClient
  ) {}

  getFlights(): Observable&lt;FlightTo&gt; {
    return this.httpClient.get&lt;FlightTo&gt;('/relative/url/to/flights');
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The adapters should use a well-defined transfer data model.
This could be generated from server endpoints with CobiGen, Swagger, typescript-maven-plugin, etc.
If inside the application there is a business model defined, the adapter has to parse to the transfer model.
This is illustrated in the following listing.</p>
</div>
<div class="listingblock">
<div class="title">Listing 35. Example adapter mapping from business model to transfer model</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">import { Injectable } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { Observable } from 'rxjs/Observable';
import { map } from 'rxjs/operators';

import { FlightTo } from './flight-to';
import { Flight } from '../../../model/flight';

@Injectable({
 providedIn: 'root',
})
export class FlightsAdapter {

  constructor(
    private httpClient: HttpClient
  ) {}

  updateFlight(flight: Flight): Observable&lt;Flight&gt; {
    const to = this.mapFlight(flight);

    return this.httpClient.post&lt;FlightTo&gt;('/relative/url/to/flights', to).pipe(
      map(to =&gt; this.mapFlightTo(to))
    );
  }

  private mapFlight(flight: Flight): FlightTo {
    // mapping logic
  }

  private mapFlightTo(flightTo: FlightTo): Flight {
    // mapping logic
  }

}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="token-management"><a class="anchor" href="#token-management"></a>Token management</h4>
<div class="paragraph">
<p>In most cases the access to back-end API is secured using well known mechanisms as <strong>CSRF</strong>, <strong>JWT</strong> or both. In these cases the front-end application must manage the tokens that are generated when the user authenticates. More concretely it must store them to include them in every request automatically. Obviously, when user logs out these tokens must be removed from <code>localStorage</code>, memory, etc.</p>
</div>
</div>
<div class="sect3">
<h4 id="store-security-token"><a class="anchor" href="#store-security-token"></a>Store security token</h4>
<div class="paragraph">
<p>In order to make this guide simple we are going to store the token in memory. Therefore, if we consider that we already have a login mechanism implemented we would like to store the token using a <code>auth.service.ts</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { Injectable } from '@angular/core';
import { Router } from '@angular/router';

@Injectable({
  providedIn: 'root',
})
export class AuthService {
  private loggedIn = false;
  private token: string;

  constructor(public router: Router) {}

  public isLogged(): boolean {
    return this.loggedIn || false;
  }

  public setLogged(login: boolean): void {
    this.loggedIn = login;
  }

  public getToken(): string {
    return this.token;
  }

  public setToken(token: string): void {
    this.token = token;
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using the previous service we will be able to store the token obtained in the login request using the method <code>setToken(token)</code>. Please consider that, if you want a more sophisticated approach using <code>localStorage</code> API, you will need to modify this service accordingly.</p>
</div>
</div>
<div class="sect3">
<h4 id="include-token-in-every-request"><a class="anchor" href="#include-token-in-every-request"></a>Include token in every request</h4>
<div class="paragraph">
<p>Now that the token is available in the application it is necessary to include it in every request to a protected API endpoint. Instead of modifying all the HTTP requests in our application, Angular provides a class to intercept every request (and every response if we need to) called <code>HttpInterceptor</code>. Let&#8217;s create a service called <code>http-interceptor.service.ts</code> to implement the <code>intercept</code> method of this class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import {
  HttpEvent,
  HttpHandler,
  HttpInterceptor,
  HttpRequest,
} from '@angular/common/http';
import { Injectable } from '@angular/core';
import { Observable } from 'rxjs';
import { environment } from '../../../environments/environment';
import { AuthService } from './auth.service';

@Injectable()
export class HttpRequestInterceptorService implements HttpInterceptor {

  constructor(private auth: AuthService) {}

  intercept(
    req: HttpRequest&lt;any&gt;,
    next: HttpHandler,
  ): Observable&lt;HttpEvent&lt;any&gt;&gt; {
    // Get the auth header from the service.
    const authHeader: string = this.auth.getToken();
    if (authHeader) {
      let authReq: HttpRequest&lt;any&gt;;

      // CSRF
      if (environment.security == 'csrf') {
        authReq = req.clone({
          withCredentials: true,
          setHeaders: { 'x-csrf-token': authHeader },
        });
      }

      // JWT
      if (environment.security == 'jwt') {
        authReq = req.clone({
          setHeaders: { Authorization: authHeader },
        });
      }

      return next.handle(authReq);
    } else {
      return next.handle(req);
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you may notice, this service is making use of an environment field <code>environment.security</code> to determine if we are using JWT or CSRF in order to inject the token accordingly. In your application you can combine both if necessary.</p>
</div>
<div class="paragraph">
<p>Configure environment.ts file to use the CSRF/JWT.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>security: 'csrf'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>authHeader</code> used is obtained using the injected service <code>AuthService</code> already presented above.</p>
</div>
<div class="paragraph">
<p>In order to activate the interceptor we need to provide it in our <code>app.module.ts</code> or <code>core.module.ts</code> depending on the application structure. Let&#8217;s assume that we are using the latter and the interceptor file is inside a <code>security</code> folder:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">...
import { HttpRequestInterceptorService } from './security/http-request-interceptor.service';
...

@NgModule({
  imports: [...],
  exports: [...],
  declarations: [],
  providers: [
    ...
    {
      provide: HTTP_INTERCEPTORS,
      useClass: HttpRequestInterceptorService,
      multi: true,
    },
  ],
})
export class CoreModule {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Angular automatically will now modify every request and include in the header the token if it is convenient.</p>
</div>
<!-- toc disabled -->
</div>
<div class="sect3">
<h4 id="error-handler-in-angular"><a class="anchor" href="#error-handler-in-angular"></a>Error Handler in angular</h4>
<div class="paragraph">
<p>Angular allows us to set up a custom error handler that can be used to control the different errors and them in a correct way. Using a global error handler will avoid mistakes and provide a use friendly interface allowing us to indicate the user what problem is happening.</p>
</div>
</div>
<div class="sect3">
<h4 id="what-is-errorhandler"><a class="anchor" href="#what-is-errorhandler"></a>What is <code>ErrorHandler</code></h4>
<div class="paragraph">
<p><code>ErrorHandler</code> is the class that <code>Angular</code> uses by default to control the errors. This means that, even if the application doesn&#8217;t have a <code>ErrorHandler</code> it is going to use the one setup by default in <code>Angular</code>. This can be tested by trying to find a page not existing in any app, instantly <code>Angular</code> will print the error in the console.</p>
</div>
</div>
<div class="sect3">
<h4 id="creating-your-custom-errorhandler-step-by-step"><a class="anchor" href="#creating-your-custom-errorhandler-step-by-step"></a>Creating your custom <code>ErrorHandler</code> step by step</h4>
<div class="paragraph">
<p>In order to create a custom <code>ErrorHandler</code> three steps are going to be needed:</p>
</div>
</div>
<div class="sect3">
<h4 id="creating-the-custom-errorhandler-class"><a class="anchor" href="#creating-the-custom-errorhandler-class"></a>Creating the custom <code>ErrorHandler</code> class</h4>
<div class="paragraph">
<p>In this first step the custom <code>ErrorHandler</code> class is going to be created inside the folder <code>/app/core/errors/errors-handler.ts</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">import { ErrorHandler, Injectable, Injector } from '@angular/core';
import { HttpErrorResponse } from '@angular/common/http';

@Injectable()
export class ErrorsHandler implements ErrorHandler {

    constructor(private injector: Injector) {}

    handleError(error: Error | HttpErrorResponse) {
      //  To do: Use injector to get the necessary services to redirect or
      // show a message to the user
      const classname  = error.constructor.name;
      switch ( classname )  {
        case 'HttpErrorResponse':
          console.error('HttpError:' + error.message);
          if (!navigator.onLine) {
            console.error('There's no internet connection');
            // To do: control here in internet what you wanna do if user has no internet
          } else {
            console.error('Server Error:' + error.message);
            // To do: control here if the server gave an error
          }
          break;
        default:
          console.error('Error:' + error.message);
          // To do: control here if the client/other things gave an error
      }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This class can be used to control the different type of errors. If wanted, the <code>classname</code> variable could be used to add more switch cases. This would allow control of more specific situations.</p>
</div>
</div>
<div class="sect3">
<h4 id="creating-a-errorinterceptor"><a class="anchor" href="#creating-a-errorinterceptor"></a>Creating a <code>ErrorInterceptor</code></h4>
<div class="paragraph">
<p>Inside the same folder created in the last step we are going to create the <code>ErrorInterceptor</code>(<code>errors-handler-interceptor.ts</code>). This <code>ErrorInterceptor</code> is going to retry any failed calls to the server to make sure it is not being found before showing the error:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">import { HttpInterceptor, HttpRequest, HttpHandler, HttpEvent } from '@angular/common/http';
import { Injectable } from '@angular/core';
import { Observable } from 'rxjs';
import { retry } from 'rxjs/operators';

@Injectable()
export class ErrorsHandlerInterceptor implements HttpInterceptor {

    constructor() {}
    intercept(req: HttpRequest&lt;any&gt;, next: HttpHandler): Observable&lt;HttpEvent&lt;any&gt;&gt; {
        return next.handle(req).pipe(
            retryWhen((errors: Observable&lt;any&gt;) =&gt; errors.pipe(
                delay(500),
                take(5),
                concatMap((error: any, retryIndex: number) =&gt; {
                    if (++retryIndex == 5) {
                        throw error;
                    }
                    return of(error);
                })
            ))
        );
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This custom made interceptor is implementing the <code>HttpInterceptor</code> and inside the method <code>intercept</code> using the method <code>pipe</code>,<code>retryWhen</code>,<code>delay</code>,<code>take</code> and <code>concatMap</code> from <a href="https://rxjs-dev.firebaseapp.com/api">RxJs</a> it is going to do the next things if there is errors:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>With <code>delay(500)</code> do a delay to allow some time in between requests</p>
</li>
<li>
<p>With <code>take(5)</code> retry five times.</p>
</li>
<li>
<p>With <code>concatMap</code> if the index that <code>take()</code> gives is not 5 it returns the error, else, it throws the error.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="creating-a-error-module"><a class="anchor" href="#creating-a-error-module"></a>Creating a Error Module</h4>
<div class="paragraph">
<p>Finally, creating a module(<code>errors-handler.module.ts</code>) is necessary to include the <code>interceptor</code> and the custom error handler. In this case, the module is going to be created in the same folder as the last two:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">import { NgModule, ErrorHandler } from '@angular/core';
import { CommonModule } from '@angular/common';
import { ErrorsHandler } from './errors-handler';
import { HTTP_INTERCEPTORS } from '@angular/common/http';
import { ErrorsHandlerInterceptor } from './errors-handler-interceptor';

@NgModule({
  declarations: [], // Declare here component if you want to use routing to error component
  imports: [
    CommonModule
  ],
  providers: [
    {
      provide: ErrorHandler,
      useClass: ErrorsHandler,
    },
    {
      provide: HTTP_INTERCEPTORS,
      useClass: ErrorsHandlerInterceptor,
      multi: true,
    }
  ]
})
export class ErrorsHandlerModule { }</code></pre>
</div>
</div>
<div class="paragraph">
<p>This module simply is providing the services that are implemented by our custom classes and then telling angular to use our custom made classes instead of the default ones. After doing this, the module has to be included in the app module <code>app.module.ts</code> in order to be used.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">....
  imports: [
    ErrorsHandlerModule,
    ....</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="handling-errors"><a class="anchor" href="#handling-errors"></a>Handling Errors</h4>
<div class="paragraph">
<p>As a final step, handling these errors is necessary. There are different ways that can be used to control the errors, here are a few:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Creating a custom page and using with <code>Router</code> to redirect to a page showing an error.</p>
</li>
<li>
<p>Creating a service in the server side or <code>Backend</code> to create a log with the error and calling it with <code>HttpClient</code>.</p>
</li>
<li>
<p>Showing a custom made <code>SnackBar</code> with the error message.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="using-snackbarservice-and-ngzone"><a class="anchor" href="#using-snackbarservice-and-ngzone"></a>==  Using <code>SnackBarService</code> and <code>NgZone</code></h4>
<div class="paragraph">
<p>If the <a href="https://material.angular.io/components/snack-bar/overview">SnackBar</a> is used directly, some errors can occur, this is due to <code>SnackBar</code> being out of the <code>Angular</code> zone. In order to use this service properly, <a href="https://angular.io/api/core/NgZone">NgZone</a> is necessary. The method <code>run()</code> from <code>NgZone</code> will allow the service to be inside the <code>Angular Zone</code>. An example on how to use it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">import { ErrorHandler, Injectable, Injector, NgZone } from '@angular/core';
import { HttpErrorResponse } from '@angular/common/http';
import { MatSnackBar } from '@angular/material';

@Injectable()
export class ErrorsHandler implements ErrorHandler {

    constructor(private injector: Injector, private zone: NgZone) {}

    handleError(error: Error | HttpErrorResponse) {
      // Use injector to get the necessary services to redirect or
      const snackBar: MatSnackBar = this.injector.get(MatSnackBar);
      const classname  = error.constructor.name;
      let message: string;
      switch ( classname )  {
        case 'HttpErrorResponse':
          message = !(navigator.onLine) ? 'There is no internet connection' : error.message;
          break;
        default:
          message = error.message;
      }
      this.zone.run(
        () =&gt; snackBar.open(message, 'danger', { duration : 4000})
      );
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using <code>Injector</code> the <code>MatSnackBar</code> is obtained, then the correct message is obtained inside the switch. Finally, using <code>NgZone</code> and <code>run()</code>, we open the <code>SnackBar</code> passing the message, and the parameters wanted.</p>
</div>
<div class="paragraph">
<p>You can find a working example of this guide in <a href="https://github.com/devonfw-sample/devon4ts-samples/tree/master/apps/angular-error-handler">devon4ts-samples</a>.</p>
</div>
<!-- toc disabled -->
</div>
<div class="sect3">
<h4 id="file-structure"><a class="anchor" href="#file-structure"></a>File Structure</h4>

</div>
<div class="sect3">
<h4 id="top-level"><a class="anchor" href="#top-level"></a>Top-level</h4>
<div class="paragraph">
<p>The top-level file structure is defined by Angular CLI. You might put this "top-level file structure" into a sub-directory to facilitate your build, but this is not relevant for this guide. So the applications file structure relevant to this guide is the folder <code>/src/app</code> inside the part managed by Angular CLI.</p>
</div>
<div class="listingblock">
<div class="title">Listing 36. Top-level file structure shows feature modules</div>
<div class="content">
<pre class="highlightjs highlight"><code>    /src
    └── /app
        ├── /account-management
        ├── /billing
        ├── /booking
        ├── /core
        ├── /shared
        ├── /status
        |
        ├── app.module.ts
        ├── app.component.spec.ts
        ├── app.component.ts
        └── app.routing-module.ts</code></pre>
</div>
</div>
<div class="paragraph">
<p>Besides the definition of app module the <code>app</code> folder has feature modules on top-level.
The special modules <em>shared</em> and <em>core</em> are present as well.</p>
</div>
</div>
<div class="sect3">
<h4 id="feature-modules"><a class="anchor" href="#feature-modules"></a>Feature Modules</h4>
<div class="paragraph">
<p>A feature module contains the modules definition and two folders representing both layers.</p>
</div>
<div class="listingblock">
<div class="title">Listing 37. Feature module file structure has both layers</div>
<div class="content">
<pre class="highlightjs highlight"><code>    /src
    └── /app
        └── /account-management
            ├── /components
            ├── /services
            |
            ├── account-management.module.ts
            ├── account-management.component.spec.ts
            ├── account-management.component.ts
            └── account-management.routing-module.ts</code></pre>
</div>
</div>
<div class="paragraph">
<p>Additionally an entry component is possible. This would be the case in lazy loading scenarios.
So <code>account-management.component.ts</code> would be only present if <code>account-management</code> is lazy loaded.
Otherwise, the module&#8217;s routes would be defined <em>Component-less</em>
(see <a href="http://vsavkin.tumblr.com/post/146722301646/angular-router-empty-paths-componentless-routes">vsavkin blog post</a>).</p>
</div>
</div>
<div class="sect3">
<h4 id="components-layer-2"><a class="anchor" href="#components-layer-2"></a>Components Layer</h4>
<div class="paragraph">
<p>The component layer reflects the distinction between <em>Smart Components</em> and <em>Dumb Components</em>.</p>
</div>
<div class="listingblock">
<div class="title">Listing 38. Components layer file structure shows Smart Components on top-level</div>
<div class="content">
<pre class="highlightjs highlight"><code>    /src
    └── /app
        └── /account-management
            └── /components
                ├── /account-overview
                ├── /confirm-modal
                ├── /create-account
                ├── /forgot-password
                └── /shared</code></pre>
</div>
</div>
<div class="paragraph">
<p>Every folder inside the <code>/components</code> folder represents a smart component. The only exception is <code>/shared</code>.
<code>/shared</code> contains <em>Dumb Components</em> shared across <em>Smart Components</em> inside the components layer.</p>
</div>
<div class="listingblock">
<div class="title">Listing 39. Smart components contain Dumb components</div>
<div class="content">
<pre class="highlightjs highlight"><code>    /src
    └── /app
        └── /account-management
            └── /components
                └── /account-overview
                    ├── /user-info-panel
                    |   ├── /address-tab
                    |   ├── /last-activities-tab
                    |   |
                    |   ├── user-info-panel.component.html
                    |   ├── user-info-panel.component.scss
                    |   ├── user-info-panel.component.spec.ts
                    |   └── user-info-panel.component.ts
                    |
                    ├── /user-header
                    ├── /user-toolbar
                    |
                    ├── account-overview.component.html
                    ├── account-overview.component.scss
                    ├── account-overview.component.spec.ts
                    └── account-overview.component.ts</code></pre>
</div>
</div>
<div class="paragraph">
<p>Inside the folder of a <em>Smart Component</em> the component is defined.
Besides that are folders containing the <em>Dumb Components</em> the <em>Smart Component</em> consists of.
This can be recursive - a <em>Dumb Component</em> can consist of other <em>Dumb Components</em>.
This is reflected by the file structure as well. This way the structure of a view becomes very readable.
As mentioned before, if a <em>Dumb Component</em> is used by multiple <em>Smart Components</em> inside the components layer
it is put inside the <code>/shared</code> folder inside the components layer.</p>
</div>
<div class="paragraph">
<p>With this way of thinking the <em>shared</em> module makes a lot of sense. If a <em>Dumb Component</em> is used by multiple <em>Smart Components</em>
from different feature modules, the <em>Dumb Component</em> is placed into the <em>shared</em> module.</p>
</div>
<div class="listingblock">
<div class="title">Listing 40. The shared module contains Dumb Components shared across Smart Components from different feature modules</div>
<div class="content">
<pre class="highlightjs highlight"><code>    /src
    └── /app
        └── /shared
            └── /user-panel
                |
                ├── user-panel.component.html
                ├── user-panel.component.scss
                ├── user-panel.component.spec.ts
                └── user-panel.component.ts</code></pre>
</div>
</div>
<div class="paragraph">
<p>The layer folder <code>/components</code> is not necessary inside the <em>shared</em> module.
The <em>shared</em> module only contains components!</p>
</div>
<!-- toc disabled -->
</div>
<div class="sect3">
<h4 id="internationalization"><a class="anchor" href="#internationalization"></a>Internationalization</h4>
<div class="paragraph">
<p>Nowadays, a common scenario in front-end applications is to have the ability to translate labels and locate numbers, dates, currency and so on when the user clicks over a language selector or similar. devon4ng and specifically Angular has a default mechanism in order to fill the gap of such features, and besides there are some wide used libraries that make even easier to translate applications.</p>
</div>
<div class="paragraph">
<p>More info at <a href="https://angular.io/guide/i18n">Angular i18n official documentation</a></p>
</div>
</div>
<div class="sect3">
<h4 id="devon4ng-i18n-approach"><a class="anchor" href="#devon4ng-i18n-approach"></a>devon4ng i18n approach</h4>
<div class="paragraph">
<p>The official approach could be a bit complicated, therefore the recommended one is to use the recommended library <strong>Transloco</strong> from <a href="https://github.com/ngneat/transloco/" class="bare">https://github.com/ngneat/transloco/</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="install-and-configure-transloco"><a class="anchor" href="#install-and-configure-transloco"></a>Install and configure Transloco</h4>
<div class="paragraph">
<p>In order to include this library in your devon4ng <strong>Angular &gt;= 7.2</strong> project you will need to execute in a terminal:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ng add @ngneat/transloco</code></pre>
</div>
</div>
<div class="paragraph">
<p>As part of the installation process you&#8217;ll be presented with questions; Once you answer them, everything you need will automatically be created for you.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>First, Transloco creates boilerplate files for the requested translations.</p>
</li>
<li>
<p>Next, it will create a new file, <code>transloco-root.module.ts</code> which exposes an Angular&#8217;s <code>module</code> with a default configuration, and inject it into the <code>AppModule</code>.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { HttpClient } from '@angular/common/http';
import {
  TRANSLOCO_LOADER,
  Translation,
  TranslocoLoader,
  TRANSLOCO_CONFIG,
  translocoConfig,
  TranslocoModule
} from '@ngneat/transloco';
import { Injectable, NgModule } from '@angular/core';
import { environment } from '../environments/environment';

@Injectable({ providedIn: 'root' })
export class TranslocoHttpLoader implements TranslocoLoader {
  constructor(private http: HttpClient) {}

  getTranslation(lang: string) {
    return this.http.get&lt;Translation&gt;(`/assets/i18n/${lang}.json`);
  }
}

@NgModule({
  exports: [ TranslocoModule ],
  providers: [
    {
      provide: TRANSLOCO_CONFIG,
      useValue: translocoConfig({
        availableLangs: ['en', 'es'],
        defaultLang: 'en',
        // Remove this option if your application doesn't support changing language in runtime.
        reRenderOnLangChange: true,
        prodMode: environment.production,
      })
    },
    { provide: TRANSLOCO_LOADER, useClass: TranslocoHttpLoader }
  ]
})
export class TranslocoRootModule {}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
As you might have noticed it also set an <code>HttpLoader</code> into the module&#8217;s providers. The <code>HttpLoader</code> is a class that implements the <code>TranslocoLoader</code> interface. It&#8217;s responsible for instructing Transloco how to load the translation files. It uses Angular HTTP client to fetch the files, based on the given path.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="usage"><a class="anchor" href="#usage"></a>Usage</h4>
<div class="paragraph">
<p>In order to translate any label in any HTML template you will need to use the <code>transloco</code> pipe available:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">{{ 'HELLO' | transloco }}</code></pre>
</div>
</div>
<div class="paragraph">
<p>An <strong>optional</strong> parameter from the component TypeScript class could be included as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">{{ 'HELLO' | transloco: { value: dynamic } }}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is possible to use with <code>inputs</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;span [attr.alt]="'hello' | transloco"&gt;Attribute&lt;/span&gt;
&lt;span [title]="'hello' | transloco"&gt;Property&lt;/span&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In order to change the language used you will need to create a button or selector that calls the <code>this.translocoService.use(language: string)</code> method from <code>TranslocoService</code>. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">export class AppComponent {
  constructor(private translocoService: TranslocoService) {}

  changeLanguage(lang) {
      this.translocoService.setActiveLang(lang);
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The translations will be included in the <code>en.json</code>, <code>es.json</code>, <code>de.json</code>, etc. files inside the <code>/assets/i18n</code> folder. For example <code>en.json</code> would be (using the previous parameter):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "HELLO": "hello"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or with an <strong>optional parameter</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "HELLO": "hello {{value}}"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Transloco understands nested JSON objects. This means that you can have a translation that looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "HOME": {
        "HELLO": "hello {{value}}"
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In order to access access the value, use the dot notation, in this case <code>HOME.HELLO</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="using-the-service-pipe-or-directive"><a class="anchor" href="#using-the-service-pipe-or-directive"></a>Using the service, pipe or directive</h4>

</div>
<div class="sect3">
<h4 id="structural-directive"><a class="anchor" href="#structural-directive"></a>==  Structural Directive</h4>
<div class="paragraph">
<p>Using a structural directive is the <strong>recommended</strong> approach. It&#8217;s DRY and efficient, as it creates <strong>one</strong> subscription per template:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">&lt;ng-container *transloco="let t"&gt;
  &lt;p&gt;{{ t('title') }}&lt;/p&gt;

  &lt;comp [title]="t('title')"&gt;&lt;/comp&gt;
&lt;/ng-container&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the <code>t</code> function is <strong>memoized</strong>. It means that given the same <code>key</code> it will return the result directly from the cache.</p>
</div>
<div class="paragraph">
<p>We can pass a <code>params</code> object as the second parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">&lt;ng-container *transloco="let t"&gt;
  &lt;p&gt;{{ t('name', { name: 'Transloco' }) }}&lt;/p&gt;
&lt;/ng-container&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can instruct the directive to use a different language in our template:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">&lt;ng-container *transloco="let t; lang: 'es'"&gt;
  &lt;p&gt;{{ t('title') }}&lt;/p&gt;
&lt;/ng-container&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="pipe"><a class="anchor" href="#pipe"></a>==  Pipe</h4>
<div class="paragraph">
<p>The use of pipes can be possible too:</p>
</div>
<div class="paragraph">
<p>template:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">&lt;div&gt;{{ 'HELLO' | transloco:param }}&lt;/div&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>component:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">param = {value: 'world'};</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="attribute-directive"><a class="anchor" href="#attribute-directive"></a>==  Attribute Directive</h4>
<div class="paragraph">
<p>The last option available with <code>transloco</code> is the attribute directive:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">&lt;div transloco="HELLO" [translocoParams]="{ value: 'world' }"&gt;&lt;/div&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="service"><a class="anchor" href="#service"></a>==  Service</h4>
<div class="paragraph">
<p>If you need to access translations in any component or service you can do it injecting the <code>TranslocoService</code> into them:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">// Sync translation
translocoService.translate('HELLO', {value: 'world'});

// Async translation
translocoService.selectTranslate('HELLO', { value: 'world' }).subscribe(res =&gt; {
    console.log(res);
    //=&gt; 'hello world'
});</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
You can find a complete example at <a href="https://github.com/devonfw/devon4ng-application-template" class="bare">https://github.com/devonfw/devon4ng-application-template</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Please, visit <a href="https://github.com/ngneat/transloco/" class="bare">https://github.com/ngneat/transloco/</a> for more info.</p>
</div>
<!-- toc disabled -->
</div>
<div class="sect3">
<h4 id="routing"><a class="anchor" href="#routing"></a>Routing</h4>
<div class="paragraph">
<p>A basic introduction to the Angular Router can be found in <a href="https://angular.io/guide/router">Angular Docs</a>.</p>
</div>
<div class="paragraph">
<p>This guide will show common tasks and best practices.</p>
</div>
</div>
<div class="sect3">
<h4 id="defining-routes"><a class="anchor" href="#defining-routes"></a>Defining Routes</h4>
<div class="paragraph">
<p>For each feature module and the app module all routes should be defined in a separate module with the suffix <code>RoutingModule</code>.
This way the routing modules are the only place where routes are defined.
This pattern achieves a clear separation of concerns.
The following figure illustrates this.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/module-declaration.svg"><img src="../_images/images/module-declaration.svg" alt="Routing module declaration" width="450"></a>
</div>
<div class="title">Figure 39. Routing module declaration</div>
</div>
<div class="paragraph">
<p>It is important to define routes inside app routing module with <code>.forRoot()</code> and in feature routing modules with <code>.forChild()</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="example-1-no-lazy-loading"><a class="anchor" href="#example-1-no-lazy-loading"></a>Example 1 - No Lazy Loading</h4>
<div class="paragraph">
<p>In this example two modules need to be configured with routes - <code>AppModule</code> and <code>FlightModule</code>.</p>
</div>
<div class="paragraph">
<p>The following routes will be configured</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>/</code> will redirect to <code>/search</code></p>
</li>
<li>
<p><code>/search</code> displays <code>FlightSearchComponent</code> (<code>FlightModule</code>)</p>
</li>
<li>
<p><code>/search/print/:flightId/:date</code> displays <code>FlightPrintComponent</code> (<code>FlightModule</code>)</p>
</li>
<li>
<p><code>/search/details/:flightId/:date</code> displays <code>FlightDetailsComponent</code> (<code>FlightModule</code>)</p>
</li>
<li>
<p>All other routes will display <code>ErrorPage404</code> (<code>AppModule</code>)</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Listing 41. app-routing.module.ts</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">const routes: Routes = [
  { path: '', redirectTo: 'search', pathMatch: 'full' },
  { path: '**', component: ErrorPage404 }
];

@NgModule({
  imports: [RouterModule.forRoot(routes)],
  exports: [RouterModule]
})
export class AppRoutingModule { }</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Listing 42. flight-search-routing.module.ts</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">const routes: Routes = [
  {
    path: 'search', children: [
      { path: '', component: FlightSearchComponent },
      { path: 'print/:flightId/:date', component: FlightPrintComponent },
      { path: 'details/:flightId/:date', component: FlightDetailsComponent }
    ]
  }
];

@NgModule({
  imports: [RouterModule.forChild(routes)],
  exports: [RouterModule],
})
export class FlightSearchRoutingModule { }</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The import order inside <code>AppModule</code> is important.
<code>AppRoutingModule</code> needs to be imported <strong>after</strong> <code>FlightModule</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="example-2-lazy-loading"><a class="anchor" href="#example-2-lazy-loading"></a>Example 2 - Lazy Loading</h4>
<div class="paragraph">
<p>Lazy Loading is a good practice when the application has multiple feature areas and a user might not visit every dialog.
Or at least he might not need every dialog up front.</p>
</div>
<div class="paragraph">
<p>The following example will configure the same routes as example 1 but will lazy load <code>FlightModule</code>.</p>
</div>
<div class="listingblock">
<div class="title">Listing 43. app-routing.module.ts</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">const routes: Routes = [
  { path: '/search', loadChildren: 'app/flight-search/flight-search.module#FlightSearchModule' },
  { path: '**', component: ErrorPage404 }
];

@NgModule({
  imports: [RouterModule.forRoot(routes)],
  exports: [RouterModule]
})
export class AppRoutingModule { }</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Listing 44. flight-search-routing.module.ts</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">const routes: Routes = [
  {
    path: '', children: [
      { path: '', component: FlightSearchComponent },
      { path: 'print/:flightId/:date', component: FlightPrintComponent },
      { path: 'details/:flightId/:date', component: FlightDetailsComponent }
    ]
  }
];

@NgModule({
  imports: [RouterModule.forChild(routes)],
  exports: [RouterModule],
})
export class FlightSearchRoutingModule { }</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="triggering-route-changes"><a class="anchor" href="#triggering-route-changes"></a>Triggering Route Changes</h4>
<div class="paragraph">
<p>With Angular you have two ways of triggering route changes.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Declarative with bindings in component HTML templates</p>
</li>
<li>
<p>Programmatic with Angular <code>Router</code> service inside component classes</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>On the one hand, architecture-wise it is a much cleaner solution to trigger route changes in <em>Smart Components</em>.
This way you have every UI event that should trigger a navigation handled in one place - in a <em>Smart Component</em>.
It becomes very easy to look inside the code for every navigation, that can occur.
Refactoring is also much easier, as there are no navigation events "hidden" in the HTML templates</p>
</div>
<div class="paragraph">
<p>On the other hand, in terms of accessibility and <code>SEO</code> it is a better solution to rely on bindings in the view - e.g. by using Angular router-link directive.
This way screen readers and the Google crawler can move through the page easily.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you do not have to support accessibility (screen readers, etc.) and to care about <code>SEO</code> (Google rank, etc.),
then you should aim for triggering navigation only in <em>Smart Components</em>.
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/triggering-navigation.svg"><img src="../_images/images/triggering-navigation.svg" alt="Triggering navigation" width="350" height="200"></a>
</div>
<div class="title">Figure 40. Triggering navigation</div>
</div>
</div>
<div class="sect3">
<h4 id="guards"><a class="anchor" href="#guards"></a>Guards</h4>
<div class="paragraph">
<p>Guards are Angular services implemented on routes which determines whether a user can navigate to/from the route. There are examples below which will explain things better. We have the following types of Guards:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong><code>CanActivate</code></strong>: It is used to determine whether a user can visit a route. The most common scenario for this guard is to check if the user is authenticated. For example, if we want only logged in users to be able to go to a particular route, we will implement the <code>CanActivate</code> guard on this route.</p>
</li>
<li>
<p><code><strong>CanActivateChild</strong></code>: Same as above, only implemented on child routes.</p>
</li>
<li>
<p><strong><code>CanDeactivate</code></strong>: It is used to determine if a user can navigate away from a route. Most common example is when a user tries to go to a different page after filling up a form and does not save/submit the changes, we can use this guard to confirm whether the user really wants to leave the page without saving/submitting.</p>
</li>
<li>
<p><strong>Resolve</strong>: For resolving dynamic data.</p>
</li>
<li>
<p><strong><code>CanLoad</code></strong>: It is used to determine whether an <em>Angular module</em> can be loaded lazily. Example below will be helpful to understand it.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Let&#8217;s have a look at some examples.</p>
</div>
</div>
<div class="sect3">
<h4 id="example-1-canactivate-and-canactivatechild-guards"><a class="anchor" href="#example-1-canactivate-and-canactivatechild-guards"></a>Example 1 - <code>CanActivate</code> and <code>CanActivateChild</code> guards</h4>

</div>
<div class="sect3">
<h4 id="canactivate-guard"><a class="anchor" href="#canactivate-guard"></a>==  <code>CanActivate</code> guard</h4>
<div class="paragraph">
<p>As mentioned earlier, a guard is an Angular service and services are simply <code>TypeScript</code> classes. So we begin by creating a class. This class has to implement the <code>CanActivate</code> interface (imported from <code>angular/router</code>), and therefore, must have a <code>canActivate</code> function. The logic of this function determines whether the requested route can be navigated to or not. It returns either a Boolean value or an <code>Observable</code> or a <code>Promise</code> which resolves to a Boolean value. If it is true, the route is loaded, else not.</p>
</div>
<div class="listingblock">
<div class="title">Listing 45. <code>CanActivate</code> example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">...
import {CanActivate} from "@angular/router";

@Injectable()
class ExampleAuthGuard implements CanActivate {
  constructor(private authService: AuthService) {}

  canActivate(route: ActivatedRouterSnapshot, state: RouterStateSnapshot) {
	if (this.authService.isLoggedIn()) {
      return true;
    } else {
	  window.alert('Please log in first');
      return false;
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example, let&#8217;s assume we have a <code>AuthService</code> which has a <code>isLoggedIn()</code> method which returns a Boolean value depending on whether the user is logged in. We use it to return <code>true</code> or <code>false</code> from the <code>canActivate</code> function.
The <code>canActivate</code> function accepts two parameters (provided by Angular). The first parameter of type <code>ActivatedRouterSnapshot</code> is the snapshot of the route the user is trying to navigate to (where the guard is implemented); we can extract the route parameters from this instance. The second parameter of type <code>RouterStateSnapshot</code> is a snapshot of the router state the user is trying to navigate to; we can fetch the <code>URL</code> from it&#8217;s <code>url</code> property.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
We can also redirect the user to another page (maybe a login page) if the <code>authService</code> returns false. To do that, inject <code>Router</code> and use it&#8217;s <code>navigate</code> function to redirect to the appropriate page.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Since it is a service, it needs to be provided in our module:</p>
</div>
<div class="listingblock">
<div class="title">Listing 46. provide the guard in a module</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">@NgModule({
  ...
  providers: [
    ...
    ExampleAuthGuard
  ]
})</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now this guard is ready to use on our routes. We implement it where we define our array of routes in the application:</p>
</div>
<div class="listingblock">
<div class="title">Listing 47. Implementing the guard</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">...
const routes: Routes = [
  { path: '', redirectTo: 'home', pathMatch: 'full' },
  { path: 'home', component: HomeComponent },
  { path: 'page1', component: Page1Component, canActivate: [ExampleAuthGuard] }
];</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, the <code>canActivate</code> property accepts an array of guards. So we can implement more than one guard on a route.</p>
</div>
</div>
<div class="sect3">
<h4 id="canactivatechild-guard"><a class="anchor" href="#canactivatechild-guard"></a>==  <code>CanActivateChild</code> guard</h4>
<div class="paragraph">
<p>To use the guard on nested (children) routes, we add it to the <code>canActivateChild</code> property like so:</p>
</div>
<div class="listingblock">
<div class="title">Listing 48. Implementing the guard on child routes</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">...
const routes: Routes = [
  { path: '', redirectTo: 'home', pathMatch: 'full' },
  { path: 'home', component: HomeComponent },
  { path: 'page1', component: Page1Component, canActivateChild: [ExampleAuthGuard], children: [
	{path: 'sub-page1', component: SubPageComponent},
    {path: 'sub-page2', component: SubPageComponent}
  ] }
];</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="example-2-canload-guard"><a class="anchor" href="#example-2-canload-guard"></a>Example 2 - <code>CanLoad</code> guard</h4>
<div class="paragraph">
<p>Similar to <code>CanActivate</code>, to use this guard we implement the <code>CanLoad</code> interface and overwrite it&#8217;s <code>canLoad</code> function. Again, this function returns either a Boolean value or an <code>Observable</code> or a <code>Promise</code> which resolves to a Boolean value. The fundamental difference between <code>CanActivate</code> and <code>CanLoad</code> is that <code>CanLoad</code> is used to determine whether an entire module can be lazily loaded or not. If the guard returns <code>false</code> for a module protected by <code>CanLoad</code>, the entire module is not loaded.</p>
</div>
<div class="listingblock">
<div class="title">Listing 49. <code>CanLoad</code> example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">...
import {CanLoad, Route} from "@angular/router";

@Injectable()
class ExampleCanLoadGuard implements CanLoad {
  constructor(private authService: AuthService) {}

  canLoad(route: Route) {
	if (this.authService.isLoggedIn()) {
      return true;
    } else {
	  window.alert('Please log in first');
      return false;
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Again, let&#8217;s assume we have a <code>AuthService</code> which has a <code>isLoggedIn()</code> method which returns a Boolean value depending on whether the user is logged in. The <code>canLoad</code> function accepts a parameter of type Route which we can use to fetch the path a user is trying to navigate to (using the <code>path</code> property of <code>Route</code>).</p>
</div>
<div class="paragraph">
<p>This guard needs to be provided in our module like any other service.</p>
</div>
<div class="paragraph">
<p>To implement the guard, we use the <code>canLoad</code> property:</p>
</div>
<div class="listingblock">
<div class="title">Listing 50. Implementing the guard</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">...
const routes: Routes = [
  { path: 'home', component: HomeComponent },
  { path: 'admin', loadChildren: 'app/admin/admin.module#AdminModule', canLoad: [ExampleCanLoadGuard] }
];</code></pre>
</div>
</div>
<!-- toc disabled -->
</div>
<div class="sect3">
<h4 id="testing"><a class="anchor" href="#testing"></a>Testing</h4>
<div class="paragraph">
<p>This guide will cover the basics of testing logic inside your code with unit test cases.
The guide assumes that you are familiar with Angular CLI (<a href="guide-working-with-angular-cli">see the guide</a>)</p>
</div>
<div class="paragraph">
<p>For testing your Angular application with unit test cases there are two main strategies:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Isolated unit test cases<br>
Isolated unit tests examine an instance of a class all by itself without any dependence on Angular or any injected values.
The amount of code and effort needed to create such tests in minimal.</p>
</li>
<li>
<p>Angular Testing Utilities<br>
Let you test components including their interaction with Angular.
The amount of code and effort needed to create such tests is a little higher.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="testing-concept"><a class="anchor" href="#testing-concept"></a>Testing Concept</h4>
<div class="paragraph">
<p>The following figure shows you an overview of the application architecture divided in testing areas.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/testing-areas.svg"><img src="../_images/images/testing-areas.svg" alt="Testing Areas" width="450"></a>
</div>
<div class="title">Figure 41. Testing Areas</div>
</div>
<div class="paragraph">
<p>There are three areas, which need to be covered by different testing strategies.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Components:<br>
Smart Components need to be tested because they contain view logic.
Also the interaction with 3rd party components needs to be tested.
When a 3rd party component changes with an upgrade a test will be failing and warn you, that there is something wrong with the new version.
Most of the time Dumb Components do not need to be tested because they mainly display data and do not contain any logic.
Smart Components are always tested with <strong>Angular Testing Utilities</strong>.
For example selectors, which select data from the store and transform it further, need to be tested.</p>
</li>
<li>
<p>Stores:<br>
A store contains methods representing state transitions.
If these methods contain logic, they need to be tested.
Stores are always tested using <strong>Isolated unit tests</strong>.</p>
</li>
<li>
<p>Services:<br>
Services contain Business Logic, which needs to be tested.
UseCase Services represent a whole business use case.
For instance this could be initializing a store with all the data that is needed for a dialog - loading, transforming, storing.
Often <strong>Angular Testing Utilities</strong> are the optimal solution for testing UseCase Services, because they allow for an easy stubbing of the back-end.
All other services should be tested with <strong>Isolated unit tests</strong> as they are much easier to write and maintain.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="testing-smart-components"><a class="anchor" href="#testing-smart-components"></a>Testing Smart Components</h4>
<div class="paragraph">
<p>Testing Smart Components should assure the following.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Bindings are correct.</p>
</li>
<li>
<p>Selectors which load data from the store are correct.</p>
</li>
<li>
<p>Asynchronous behavior is correct (loading state, error state, "normal" state).</p>
</li>
<li>
<p>Oftentimes through testing one realizes, that important edge cases are forgotten.</p>
</li>
<li>
<p>Do these test become very complex, it is often an indicator for poor code quality in the component.
Then the implementation is to be adjusted / refactored.</p>
</li>
<li>
<p>When testing values received from the native DOM, you will test also that 3rd party libraries did not change with a version upgrade.
A failing test will show you what part of a 3rd party library has changed.
This is much better than the users doing this for you.
For example a binding might fail because the property name was changed with a newer version of a 3rd party library.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In the function <code>beforeEach()</code> the TestBed imported from <strong>Angular Testing Utilities</strong> needs to be initialized.
The goal should be to define a minimal test-module with TestBed.
The following code gives you an example.</p>
</div>
<div class="listingblock">
<div class="title">Listing 51. Example test setup for Smart Components</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">describe('PrintFlightComponent', () =&gt; {

  let fixture: ComponentFixture&lt;PrintCPrintFlightComponentomponent&gt;;
  let store: FlightStore;
  let printServiceSpy: jasmine.SpyObj&lt;FlightPrintService&gt;;

  beforeEach(() =&gt; {
    const urlParam = '1337';
    const activatedRouteStub = { params: of({ id: urlParam }) };
    printServiceSpy = jasmine.createSpyObj('FlightPrintService', ['initializePrintDialog']);
    TestBed.configureTestingModule({
      imports: [
        TranslateModule.forRoot(),
        RouterTestingModule
      ],
      declarations: [
        PrintFlightComponent,
        PrintContentComponent,
        GeneralInformationPrintPanelComponent,
        PassengersPrintPanelComponent
      ],
      providers: [
        FlightStore,
        {provide: FlightPrintService, useValue: printServiceSpy},
        {provide: ActivatedRoute, useValue: activatedRouteStub}
      ]
    });
    fixture = TestBed.createComponent(PrintFlightComponent);
    store = fixture.debugElement.injector.get(FlightStore);
    fixture.detectChanges();
  });

  // ... test cases
})</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is important:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use <code>RouterTestingModule</code> instead of <code>RouterModule</code></p>
</li>
<li>
<p>Use <code>TranslateModule.forRoot()</code> without translations
This way you can test language-neutral without translation marks.</p>
</li>
<li>
<p>Do not add a whole module from your application - in declarations add the tested Smart Component with all its Dumb Components</p>
</li>
<li>
<p>The store should never be stubbed.
If you need a complex test setup, just use the regular methods defined on the store.</p>
</li>
<li>
<p>Stub all services used by the Smart Component.
These are mostly UseCase services.
They should not be tested by these tests.
Only the correct call to their functions should be assured.
The logic inside the UseCase services is tested with separate tests.</p>
</li>
<li>
<p><code>detectChanges()</code> performance an Angular Change Detection cycle (Angular refreshes all the bindings present in the view)</p>
</li>
<li>
<p><code>tick()</code> performance a virtual macro task, <code>tick(1000)</code> is equal to the virtual passing of 1s.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following test cases show the testing strategy in action.</p>
</div>
<div class="listingblock">
<div class="title">Listing 52. Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">it('calls initializePrintDialog for url parameter 1337', fakeAsync(() =&gt; {
  expect(printServiceSpy.initializePrintDialog).toHaveBeenCalledWith(1337);
}));

it('creates correct loading subtitle', fakeAsync(() =&gt; {
  store.setPrintStateLoading(123);
  tick();
  fixture.detectChanges();

  const subtitle = fixture.debugElement.query(By.css('app-header-element .print-header-container span:last-child'));
  expect(subtitle.nativeElement.textContent).toBe('PRINT_HEADER.FLIGHT STATE.IS_LOADING');
}));

it('creates correct subtitle for loaded flight', fakeAsync(() =&gt; {
  store.setPrintStateLoadedSuccess({
    id: 123,
    description: 'Description',
    iata: 'FRA',
    name: 'Frankfurt',
    // ...
  });
  tick();
  fixture.detectChanges();

  const subtitle = fixture.debugElement.query(By.css('app-header-element .print-header-container span:last-child'));
  expect(subtitle.nativeElement.textContent).toBe('PRINT_HEADER.FLIGHT "FRA (Frankfurt)" (ID: 123)');
}));</code></pre>
</div>
</div>
<div class="paragraph">
<p>The examples show the basic testing method</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Set the store to a well-defined state</p>
</li>
<li>
<p>check if the component displays the correct values</p>
</li>
<li>
<p>&#8230;&#8203; via checking values inside the native DOM.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="testing-state-transitions-performed-by-stores"><a class="anchor" href="#testing-state-transitions-performed-by-stores"></a>Testing state transitions performed by stores</h4>
<div class="paragraph">
<p>Stores are always tested with <strong>Isolated unit tests</strong>.</p>
</div>
<div class="paragraph">
<p>Actions triggered by <code>dispatchAction()</code> calls are asynchronously performed to alter the state.
A good solution to test such a state transition is to use the done callback from Jasmine.</p>
</div>
<div class="listingblock">
<div class="title">Listing 53. Example for testing a store</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">let sut: FlightStore;

beforeEach(() =&gt; {
  sut = new FlightStore();
});

it('setPrintStateLoading sets print state to loading', (done: Function) =&gt; {
  sut.setPrintStateLoading(4711);

  sut.state$.pipe(first()).subscribe(result =&gt; {
    expect(result.print.isLoading).toBe(true);
    expect(result.print.loadingId).toBe(4711);
    done();
  });
});

it('toggleRowChecked adds flight with given id to selectedValues Property', (done: Function) =&gt; {
  const flight: FlightTO = {
    id: 12
    // dummy data
  };
  sut.setRegisterabgleichListe([flight]);
  sut.toggleRowChecked(12);

  sut.state$.pipe(first()).subscribe(result =&gt; {
    expect(result.selectedValues).toContain(flight);
    done();
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="testing-services"><a class="anchor" href="#testing-services"></a>Testing services</h4>
<div class="paragraph">
<p>When testing services both strategies - <strong>Isolated unit tests</strong> and <strong>Angular Testing Utilities</strong> - are valid options.</p>
</div>
<div class="paragraph">
<p>The goal of such tests are</p>
</div>
<div class="ulist">
<ul>
<li>
<p>assuring the behavior for valid data.</p>
</li>
<li>
<p>assuring the behavior for invalid data.</p>
</li>
<li>
<p>documenting functionality</p>
</li>
<li>
<p>save performing refactoring</p>
</li>
<li>
<p>thinking about edge case behavior while testing</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For simple services <strong>Isolated unit tests</strong> can be written.
Writing these tests takes lesser effort and they can be written very fast.</p>
</div>
<div class="paragraph">
<p>The following listing gives an example of such tests.</p>
</div>
<div class="listingblock">
<div class="title">Listing 54. Testing a simple services with <strong>Isolated unit tests</strong></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">let sut: IsyDatePipe;

beforeEach(() =&gt; {
  sut = new IsyDatePipe();
});

it('transform should return empty string if input value is empty', () =&gt; {
  expect(sut.transform('')).toBe('');
});

it('transform should return empty string if input value is null', () =&gt; {
  expect(sut.transform(undefined)).toBe('');
});

// ...more tests</code></pre>
</div>
</div>
<div class="paragraph">
<p>For testing Use Case services the Angular Testing Utilities should be used.
The following listing gives an example.</p>
</div>
<div class="listingblock">
<div class="title">Listing 55. Test setup for testing use case services with Angular Testing Utilities</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">let sut: FlightPrintService;
let store: FlightStore;
let httpController: HttpTestingController;
let flightCalculationServiceStub: jasmine.SpyObj&lt;FlightCalculationService&gt;;
const flight: FlightTo = {
  // ... valid dummy data
};

beforeEach(() =&gt; {
  flightCalculationServiceStub = jasmine.createSpyObj('FlightCalculationService', ['getFlightType']);
  flightCalculationServiceStub.getFlightType.and.callFake((catalog: string, type: string, key: string) =&gt; of(`${key}_long`));
  TestBed.configureTestingModule({
    imports: [
      HttpClientTestingModule,
      RouterTestingModule,
    ],
    providers: [
      FlightPrintService,
      FlightStore,
      FlightAdapter,
      {provide: FlightCalculationService, useValue: flightCalculationServiceStub}
    ]
  });

  sut = TestBed.get(FlightPrintService);
  store = TestBed.get(FlightStore);
  httpController = TestBed.get(HttpTestingController);
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>When using TestBed, it is important</p>
</div>
<div class="ulist">
<ul>
<li>
<p>to import <code>HttpClientTestingModule</code> for stubbing the back-end</p>
</li>
<li>
<p>to import <code>RouterTestingModule</code> for stubbing the Angular router</p>
</li>
<li>
<p>not to stub stores, adapters and business services</p>
</li>
<li>
<p>to stub services from libraries like <code>FlightCalculationService</code> - the correct implementation of libraries should not be tested by these tests.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Testing back-end communication looks like this:</p>
</div>
<div class="listingblock">
<div class="title">Listing 56. Testing back-end communication with <code>Angular HttpTestingController</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">it('loads flight if not present in store', fakeAsync(() =&gt; {
  sut.initializePrintDialog(1337);
  const processRequest = httpController.expectOne('/path/to/flight');
  processRequest.flush(flight);

  httpController.verify();
}));

it('does not load flight if present in store', fakeAsync(() =&gt; {
  const flight = {...flight, id: 4711};
  store.setRegisterabgleich(flight);

  sut.initializePrintDialog(4711);
  httpController.expectNone('/path/to/flight');

  httpController.verify();
}));</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first test assures a correct XHR request is performed if <code>initializePrintDialog()</code> is called and no data is in the store.
The second test assures no XHR request IST performed if the needed data is already in the store.</p>
</div>
<div class="paragraph">
<p>The next steps are checks for the correct implementation of logic.</p>
</div>
<div class="listingblock">
<div class="title">Listing 57. Example testing a Use Case service</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">it('creates flight destination for valid key in svz', fakeAsync(() =&gt; {
  const flightTo: FlightTo = {
    ...flight,
    id: 4712,
    profile: '77'
  };
  store.setFlight(flightTo);
  let result: FlightPrintContent|undefined;

  sut.initializePrintDialog(4712);
  store.select(s =&gt; s.print.content).subscribe(content =&gt; result = content);
  tick();

  expect(result!.destination).toBe('77_long (ID: 77)');
}));</code></pre>
</div>
</div>
<!-- toc disabled -->
</div>
<div class="sect3">
<h4 id="update-angular-cli"><a class="anchor" href="#update-angular-cli"></a>Update Angular CLI</h4>

</div>
<div class="sect3">
<h4 id="angular-cli-common-issues"><a class="anchor" href="#angular-cli-common-issues"></a>Angular CLI common issues</h4>
<div class="paragraph">
<p>There are constant updates for the official Angular framework dependencies. These dependencies are directly related with the Angular CLI package. Since this package comes installed by default inside the devonfw distribution folder for Windows OS and the distribution is updated every few months it needs to be updated in order to avoid known issues.</p>
</div>
</div>
<div class="sect3">
<h4 id="angular-cli-update-guide"><a class="anchor" href="#angular-cli-update-guide"></a>Angular CLI update guide</h4>
<div class="paragraph">
<p>For <strong>Linux users</strong> is as easy as updating the global package:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ npm unistall -g @angular/cli
$ npm install -g @angular/cli</code></pre>
</div>
</div>
<div class="paragraph">
<p>For <strong>Windows users</strong> the process is only a bit harder. Open the <strong>devonfw bundled console</strong> and do as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ cd [devonfw_dist_folder]
$ cd software/nodejs
$ npm uninstall @angular/cli --no-save
$ npm install @angular/cli --no-save</code></pre>
</div>
</div>
<div class="paragraph">
<p>After following these steps you should have the latest Angular CLI version installed in your system. In order to check it run in the distribution console:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
At the time of this writing, the Angular CLI is at 1.7.4 version.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">λ ng version

     _                      _                 ____ _     ___
    / \   _ __   __ _ _   _| | __ _ _ __     / ___| |   |_ _|
   / △ \ | '_ \ / _` | | | | |/ _` | '__|   | |   | |    | |
  / ___ \| | | | (_| | |_| | | (_| | |      | |___| |___ | |
 /_/   \_\_| |_|\__, |\__,_|_|\__,_|_|       \____|_____|___|
                |___/


Angular CLI: 7.2.3
Node: 10.13.0
OS: win32 x64
Angular:
...</code></pre>
</div>
</div>
<!-- toc disabled -->
</div>
<div class="sect3">
<h4 id="upgrade-devon4ng-angular-and-ionicangular-applications"><a class="anchor" href="#upgrade-devon4ng-angular-and-ionicangular-applications"></a>Upgrade devon4ng Angular and Ionic/Angular applications</h4>
<div class="paragraph">
<p>Angular CLI provides a powerful tool to upgrade Angular based applications to the current stable release of the core framework.</p>
</div>
<div class="paragraph">
<p>This tool is <code>ng update</code>. It will not only upgrade dependencies and their related ones but also will perform some fixes in your code if available thanks to the provided <em>schematics</em>. It will check even if the update is not possible as there is another library or libraries that are not compatible with the versions of the upgraded dependencies. In this case it will keep your application untouched.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The repository must be in a clean state before executing a <code>ng update</code>. So, remember to commit your changes first.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="basic-usage"><a class="anchor" href="#basic-usage"></a>Basic usage</h4>
<div class="paragraph">
<p>In order to perform a basic upgrade we will execute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ng update @angular/cli @angular/core</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="upgrade-to-new-angular-version"><a class="anchor" href="#upgrade-to-new-angular-version"></a>Upgrade to new Angular version</h4>
<div class="paragraph">
<p>The process will be the same, but first we need to make sure that our devon4ng application is in the lates version of Angular 8, so the <code>ng update</code> command can perform the upgrade not only in the dependencies but also making code changes to reflect the new features and fixes.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>First, upgrade to latest Angular 9 version:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ng update @angular/cli@9 @angular/core@9</code></pre>
</div>
</div>
<div class="paragraph">
<p>Optionally the flag <code>-C</code> can be added to previous command to make a commit automatically. This is also valid for the next steps.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Then, upgrade Angular:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ng update @angular/cli @angular/core</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>In case you use Angular Material:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ng update @angular/material</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>If the application depends on third party libraries, the new tool <code>ngcc</code> can be run to make them compatible with the new <strong>Ivy compiler</strong>. In this case it is recommended to include a <code>postinstall</code> script in the <code>package.json</code>:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "scripts": {
    "postinstall": "ngcc --properties es2015 browser module main --first-only --create-ivy-entry-points"
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>More information at <a href="https://angular.io/guide/updating-to-version-9" class="bare">https://angular.io/guide/updating-to-version-9</a> and <a href="https://angular.io/guide/ivy" class="bare">https://angular.io/guide/ivy</a>.</p>
</div>
<div class="paragraph">
<p><strong>Important use cases:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>To update to the next beta or pre-release version, use the <code>--next=true</code> option.</p>
</li>
<li>
<p>To update from one major version to another, use the format <code>ng update @angular/cli@^&lt;major_version&gt; @angular/core@^&lt;major_version&gt;</code>.</p>
</li>
<li>
<p>In case your Angular application uses <code>@angular/material</code> include it in the first command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ng update @angular/cli @angular/core @angular/material</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="ionicangular-applications"><a class="anchor" href="#ionicangular-applications"></a>Ionic/Angular applications</h4>
<div class="paragraph">
<p>Just following the same procedure we can upgrade Angular applications, but we must take care of important specific Ionic dependencies:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ng update @angular/cli @angular/core @ionic/angular @ionic/angular-toolkit [@ionic/...]</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="other-dependencies"><a class="anchor" href="#other-dependencies"></a>Other dependencies</h4>
<div class="paragraph">
<p>Every application will make use of different dependencies. Angular CLI <code>ng upgrade</code> will also take care of these ones. For example, if you need to upgrade <code>@capacitor</code> you will perform:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ng update @capacitor/cli @capacitor/core [@capacitor/...]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Another example could be that you need to upgrade <code>@ngx-translate</code> packages. As always in this case you will execute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ng update @ngx-translate/core @ngx-translate/http-loader</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="angular-update-guide-online-tool"><a class="anchor" href="#angular-update-guide-online-tool"></a>Angular Update Guide online tool</h4>
<div class="paragraph">
<p>It is recommended to use the Angular Update Guide tool at <a href="https://update.angular.io/" class="bare">https://update.angular.io/</a> that will provide the necessary steps to upgrade any Angular application depending on multiple criteria.</p>
</div>
<!-- toc disabled -->
</div>
<div class="sect3">
<h4 id="working-with-angular-cli"><a class="anchor" href="#working-with-angular-cli"></a>Working with Angular CLI</h4>
<div class="paragraph">
<p>Angular CLI provides a facade for building, testing, linting, debugging and generating code.
Under the hood Angular CLI uses specific tools to achieve these tasks.
The user does no need to maintain them and can rely on Angular to keep them up to date and maybe switch to other tools which come up in the future.</p>
</div>
<div class="paragraph">
<p>The Angular CLI provides a wiki with common tasks you encounter when working on applications with the Angular CLI.
<a href="https://github.com/angular/angular-cli/wiki">The Angular CLI Wiki can be found here.</a></p>
</div>
<div class="paragraph">
<p>In this guide we will go through the most important tasks.
To go into more details, please visit the Angular CLI wiki.</p>
</div>
</div>
<div class="sect3">
<h4 id="installing-angular-cli"><a class="anchor" href="#installing-angular-cli"></a>Installing Angular CLI</h4>
<div class="paragraph">
<p>Angular CLI should be added as global and local dependency.
The following commands add Angular CLI as global Dependency.</p>
</div>
<div class="paragraph">
<p>yarn command</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">yarn global add @angular/cli</code></pre>
</div>
</div>
<div class="paragraph">
<p>npm command</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">npm install -g @angular/cli</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can check a successful installtion with <code>ng --version</code>.
This should print out the version installed.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/install-cli-success.png"><img src="../_images/images/install-cli-success.png" alt="Printing Angular CLI Version" width="450"></a>
</div>
<div class="title">Figure 42. Printing Angular CLI Version</div>
</div>
</div>
<div class="sect3">
<h4 id="running-a-live-development-server"><a class="anchor" href="#running-a-live-development-server"></a>Running a live development server</h4>
<div class="paragraph">
<p>The Angular CLI can be used to start a live development server.
First your application will be compiled and then the server will be started.
If you change the code of a file, the server will reload the displayed page.
Run your application with the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ng serve -o</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="running-unit-tests"><a class="anchor" href="#running-unit-tests"></a>Running Unit Tests</h4>
<div class="paragraph">
<p>All unit tests can be executed with the command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ng test</code></pre>
</div>
</div>
<div class="paragraph">
<p>To make a single run and create a code coverage file use the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ng test -sr -cc</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can configure the output format for code coverage files to match your requirements in the file <code>karma.conf.js</code> which can be found on toplevel of your project folder.
For instance, this can be useful for exporting the results to a SonarQube.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="linting-the-code-quality"><a class="anchor" href="#linting-the-code-quality"></a>Linting the code quality</h4>
<div class="paragraph">
<p>You can lint your files with the command</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ng lint --type-check</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can adjust the linting rules in the file tslint.json which can be found on toplevel of your project folder.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="generating-code"><a class="anchor" href="#generating-code"></a>Generating Code</h4>

</div>
<div class="sect3">
<h4 id="creating-a-new-angular-cli-project"><a class="anchor" href="#creating-a-new-angular-cli-project"></a>Creating a new Angular CLI project</h4>
<div class="paragraph">
<p>For creating a new Angular CLI project the command <code>ng new</code> is used.</p>
</div>
<div class="paragraph">
<p>The following command creates a new application named my-app.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ng create my-app</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="creating-a-new-feature-module"><a class="anchor" href="#creating-a-new-feature-module"></a>Creating a new feature module</h4>
<div class="paragraph">
<p>A new feature module can be created via <code>ng generate module`</code> command.</p>
</div>
<div class="paragraph">
<p>The following command generates a new feature module named todo.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ng generate module todo</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/generate-module.png"><img src="../_images/images/generate-module.png" alt="Generate a module with Angular CLI" width="450"></a>
</div>
<div class="title">Figure 43. Generate a module with Angular CLI</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The created feature module needs to be added to the AppModule by hand.
Other option would be to define a lazy route in AppRoutingModule to make this a lazy loaded module.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="creating-a-new-component"><a class="anchor" href="#creating-a-new-component"></a>Creating a new component</h4>
<div class="paragraph">
<p>To create components the command <code>ng generate component</code> can be used.</p>
</div>
<div class="paragraph">
<p>The following command will generate the component todo-details inside the components layer of todo module.
It will generate a class, a html file, a css file and a test file.
Also, it will register this component as declaration inside the nearest module - this ist TodoModule.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ng generate component todo/components/todo-details</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/generate-component.png"><img src="../_images/images/generate-component.png" alt="Generate a component with Angular CLI" width="450"></a>
</div>
<div class="title">Figure 44. Generate a component with Angular CLI</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you want to export the component, you have to add the component to exports array of the module.
This would be the case if you generate a component inside shared module.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="configuring-an-angular-cli-project"><a class="anchor" href="#configuring-an-angular-cli-project"></a>Configuring an Angular CLI project</h4>
<div class="paragraph">
<p>Inside an Angular CLI project the file <code>.angular-cli.json</code> can be used to configure the Angular CLI.</p>
</div>
<div class="paragraph">
<p>The following options are very important to understand.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The property <code>defaults`</code> can be used to change the default style extension.
The following settings will make the Angular CLI generate <code>.less</code> files, when a new component is generated.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">"defaults": {
  "styleExt": "less",
  "component": {}
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The property <code>apps</code> contains all applications maintained with Angular CLI.
Most of the time you will have only one.</p>
<div class="ulist">
<ul>
<li>
<p><code>assets</code> configures all the static files, that the application needs - this can be images, fonts, json files, etc.
When you add them to assets the Angular CLI will put these files to the build target and serve them while debugging.
The following will put all files in <code>/i18n</code> to the output folder <code>/i18n</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">"assets": [
  { "glob": "**/*.json", "input": "./i18n", "output": "./i18n" }
]</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>styles</code> property contains all style files that will be globally available.
The Angular CLI will create a styles bundle that goes directly into index.html with it.
The following will make all styles in <code>styles.less</code> globally available.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">"styles": [
  "styles.less"
]</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>environmentSource</code> and <code>environments</code> are used to configure configuration with the Angular CLI.
Inside the code always the file specified in <code>environmentSource</code> will be referenced.
You can define different environments - eg. production, staging, etc. - which you list in <code>enviroments</code>.
At compile time the Angular CLI will override all values in <code>environmentSource</code> with the values from the matching environment target.
The following code will build the application for the environment staging.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ng build --environment=staging</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ionic-2"><a class="anchor" href="#ionic-2"></a>Ionic</h2>
<div class="sectionbody">
<!-- toc disabled -->
<div class="sect3">
<h4 id="ionic-5-getting-started"><a class="anchor" href="#ionic-5-getting-started"></a>Ionic 5 Getting started</h4>
<div class="paragraph">
<p>Ionic is a front-end focused framework which offers different tools for developing hybrid mobile applications. The web technologies used for this purpose are CSS, Sass, HTML5 and Typescript.</p>
</div>
</div>
<div class="sect3">
<h4 id="why-ionic"><a class="anchor" href="#why-ionic"></a>Why Ionic?</h4>
<div class="paragraph">
<p>Ionic is used for developing hybrid applications, which means not having to rely on a specific IDE such as Android Studio or Xcode. Furthermore, development of native apps require learning different languages (Java/Kotlin for Android and Objective-C/Swift for Apple), with Ionic, a developer does not have to code the same functionality for multiple platforms, just use the adequate libraries and components.</p>
</div>
</div>
<div class="sect3">
<h4 id="basic-environment-set-up"><a class="anchor" href="#basic-environment-set-up"></a>Basic environment set up</h4>

</div>
<div class="sect3">
<h4 id="install-ionic-cli"><a class="anchor" href="#install-ionic-cli"></a>Install Ionic CLI</h4>
<div class="paragraph">
<p>Although the devonfw distribution comes with and already installed Ionic CLI, here are the steps to install it. The installation of Ionic is easy, just one command has to be written:</p>
</div>
<div class="paragraph">
<p><code>$ npm install -g @ionic/cli</code></p>
</div>
</div>
<div class="sect3">
<h4 id="update-ionic-cli"><a class="anchor" href="#update-ionic-cli"></a>Update Ionic CLI</h4>
<div class="paragraph">
<p>If there was a previous installation of the Ionic CLI, it will need to be uninstalled due to a change in package name.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ npm uninstall -g ionic
$ npm install -g @ionic/cli</code></pre>
</div>
</div>
<div class="paragraph">
<p>##Basic project set up
The set up of an ionic application is pretty immediate and can be done in one line:</p>
</div>
<div class="paragraph">
<p><code>ionic start &lt;name&gt; &lt;template&gt; --type=angular</code></p>
</div>
<div class="ulist">
<ul>
<li>
<p>ionic start: Command to create an app.</p>
</li>
<li>
<p>&lt;name&gt;: Name of the application.</p>
</li>
<li>
<p>&lt;template&gt;: Model of the application.</p>
</li>
<li>
<p>--type=angular: With this flag, the app produced will be based on angular.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To create an empty project, the following command can be used:</p>
</div>
<div class="paragraph">
<p><code>ionic start MyApp blank --type=angular</code></p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/ionic-getting-started/ionic-blank-project.PNG"><img src="../_images/images/ionic-getting-started/ionic-blank-project.PNG" alt="Ionic blank project"></a>
</div>
</div>
<div class="paragraph">
<p>The image above shows the directory structure generated.</p>
</div>
<div class="paragraph">
<p>There are more templates available that can be seen with the command
<code>ionic start --list</code></p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/ionic-getting-started/ionic-start-list.png"><img src="../_images/images/ionic-getting-started/ionic-start-list.png" alt="List of ionic templates"></a>
</div>
</div>
<div class="paragraph">
<p>The templates surrounded by red line are based on angular and comes with Ionic v5, while the others belong to earlier versions (before v4).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
More info at <a href="https://ionicframework.com/docs" class="bare">https://ionicframework.com/docs</a>. Remember to select <strong>Angular documentation</strong>, since Ionic supports React, Vue and Vanilla JS.
</td>
</tr>
</table>
</div>
<!-- toc disabled -->
</div>
<div class="sect3">
<h4 id="ionic-to-android"><a class="anchor" href="#ionic-to-android"></a>Ionic to android</h4>
<div class="paragraph">
<p>This page is written to help developers to go from the source code of an ionic application to an android one, with this in mind, topics such as: environment, commands, modifications,&#8230;&#8203;  are covered.</p>
</div>
</div>
<div class="sect3">
<h4 id="assumptions-2"><a class="anchor" href="#assumptions-2"></a>Assumptions</h4>
<div class="paragraph">
<p>This document assumes that the reader has already:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Source code of an Ionic application and wants to build it on an android device,</p>
</li>
<li>
<p>A working installation of NodeJS</p>
</li>
<li>
<p>An Ionic CLI installed and up-to-date.</p>
</li>
<li>
<p>Android Studio and Android SDK.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="from-ionic-to-android-project"><a class="anchor" href="#from-ionic-to-android-project"></a>From Ionic to Android project</h4>
<div class="paragraph">
<p>When a native application is being designed, sometimes, functionalities that uses camera, geolocation, push notification, &#8230;&#8203; are requested. To resolve these requests, Capacitor can be used.</p>
</div>
<div class="paragraph">
<p>In general terms, Capacitor wraps apps made with Ionic (HTML, SCSS, Typescript) into WebViews that can be displayed in native applications (Android, IOS) and allows the developer to access native functionalities like the ones said before.</p>
</div>
<div class="paragraph">
<p>Installing capacitor is as easy as installing any node module, just a few commands have to be run in a console:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>cd name-of-ionic-4-app</code></p>
</li>
<li>
<p><code>npm install --save @capacitor/core @capacitor/cli</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Then, it is necessary to initialize capacitor with some information: app id, name of the app and the directory where your app is stored. To fill this information, run:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>npx cap init</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="modifications"><a class="anchor" href="#modifications"></a>Modifications</h4>
<div class="paragraph">
<p>Throughout the development process, usually back-end and front-end are on a local computer, so it&#8217;s a common practice to have different configuration files for each environment (commonly production and development). Ionic uses an angular.json file to store those configurations and some rules to be applied.</p>
</div>
<div class="paragraph">
<p>If a back-end is hosted on <code><a href="http://localhost:8081" class="bare">http://localhost:8081</a></code>, and that direction is used in every environment, the application built for android will not work because computer and device do not have the same localhost. Fortunately, different configurations can be defined.</p>
</div>
<div class="paragraph">
<p>Android Studio uses 10.0.0.2 as alias for 127.0.0.1 (computer&#8217;s localhost) so adding <code><a href="http://10.0.0.2:8081" class="bare">http://10.0.0.2:8081</a></code> in a new environment file and modifying angular.json accordingly, will make possible connect front-end and back-end.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/ionic-to-android/environments.png"><img src="../_images/images/ionic-to-android/environments.png" alt="Android environment and angular.json"></a>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>    "build": {
    ...
        "configurations": {
            ...
            "android": {
                "fileReplacements": [
                    {
                        "replace": "src/environments/environment.ts",
                        "with": "src/environments/environment.android.ts"
                    }
                ]
            },
        }
    }</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="build"><a class="anchor" href="#build"></a>Build</h4>
<div class="paragraph">
<p>Once configured, it is necessary to build the Ionic app using this new configuration:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ionic build --configuration=android</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The next commands copy the build application on a folder named android and open android studio.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>npx cap add android</code></p>
</li>
<li>
<p><code>npx cap copy</code></p>
</li>
<li>
<p><code>npx cap open android</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="from-android-project-to-emulated-device"><a class="anchor" href="#from-android-project-to-emulated-device"></a>From Android project to emulated device</h4>
<div class="paragraph">
<p>Once Android Studio is opened, follow these steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click on "Build" &#8594; Make project.</p>
</li>
<li>
<p>Click on "Build" &#8594; Make Module 'app' (default name).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><span class="image"><a class="image" href="images/ionic-to-android/and-vsc-make.png"><img src="../_images/images/ionic-to-android/and-vsc-make.png" alt="Click on make project" width="400"></a></span>
<span class="image"><a class="image" href="images/ionic-to-android/and-vsc-make-app.png"><img src="../_images/images/ionic-to-android/and-vsc-make-app.png" alt="click on make app" width="400"></a></span></p>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Click on" Build" &#8594; Build Bundle(s) / APK(s) &#8594; Build APK(s).</p>
</li>
<li>
<p>Click on run and choose a device.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><span class="image"><a class="image" href="images/ionic-to-android/and-vsc-build-apk.png"><img src="../_images/images/ionic-to-android/and-vsc-build-apk.png" alt="click on build APK" width="400"></a></span>
<span class="image"><a class="image" href="images/ionic-to-android/and-vsc-build-run.png"><img src="../_images/images/ionic-to-android/and-vsc-build-run.png" alt="click on running device" width="400"></a></span></p>
</div>
<div class="paragraph">
<p>If there are no devices available, a new one can be created:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click on "Create new device"</p>
</li>
<li>
<p>Select hardware and click "Next". For example: Phone &#8594; Nexus 5X.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><span class="image"><a class="image" href="images/ionic-to-android/create-new-device.png"><img src="../_images/images/ionic-to-android/create-new-device.png" alt="Create new device" width="400"></a></span>
<span class="image"><a class="image" href="images/ionic-to-android/new-phone-nexus.png"><img src="../_images/images/ionic-to-android/new-phone-nexus.png" alt="Select hardware" width="400"></a></span></p>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Download a system image.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Click on download.</p>
</li>
<li>
<p>Wait until the installation finished and then click "Finish".</p>
</li>
<li>
<p>Click "Next".</p>
</li>
</ol>
</div>
</li>
<li>
<p>Verify configuration (default configuration should be enough) and click "Next".</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><span class="image"><a class="image" href="images/ionic-to-android/download-so.png"><img src="../_images/images/ionic-to-android/download-so.png" alt="Download system image" width="400"></a></span>
<span class="image"><a class="image" href="images/ionic-to-android/config-device.png"><img src="../_images/images/ionic-to-android/config-device.png" alt="Check configuration" width="400"></a></span></p>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Check that the new device is created correctly.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/ionic-to-android/new-phone-created.png"><img src="../_images/images/ionic-to-android/new-phone-created.png" alt="New created device" width="400"></a>
</div>
</div>
</div>
<div class="sect3">
<h4 id="from-android-project-to-real-device"><a class="anchor" href="#from-android-project-to-real-device"></a>From Android project to real device</h4>
<div class="paragraph">
<p>To test on a real android device, an easy approach to communicate a smartphone (front-end) and computer (back-end) is to configure a WiFi hotspot and connect the computer to it. A guide about this process can be found <a href="https://support.google.com/nexus/answer/9059108?hl=en">here</a>.</p>
</div>
<div class="paragraph">
<p>Once connected, run <code>ipconfig</code> on a console if you are using windows or <code>ifconfig</code> on a Linux machine to get the IP address of your machine&#8217;s Wireless LAN adapter WiFi.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/ionic-to-android/ipconfig-short.png"><img src="../_images/images/ionic-to-android/ipconfig-short.png" alt="Result of `ipconfig` command on Windows 10" width="700"></a>
</div>
</div>
<div class="paragraph">
<p>This obtained IP must be used instead of "localhost" or "10.0.2.2" at environment.android.ts.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/ionic-to-android/new-backend-url.PNG"><img src="../_images/images/ionic-to-android/new-backend-url.PNG" alt="Android environment file server URL" width="700"></a>
</div>
</div>
<div class="paragraph">
<p>After this configuration, follow the build steps in "From Ionic to Android project" and the first three steps in "From Android project to emulated device".</p>
</div>
</div>
<div class="sect3">
<h4 id="send-apk-to-android-through-usb"><a class="anchor" href="#send-apk-to-android-through-usb"></a>Send APK to Android through USB</h4>
<div class="paragraph">
<p>To send the built application to a device, you can connect computer and mobile through USB, but first, it is necessary to unlock developer options.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open "Settings" and go to "System".</p>
</li>
<li>
<p>Click on "About".</p>
</li>
<li>
<p>Click "Build number" seven times to unlock developer options.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/ionic-to-android/enable-developer-options1_2_3.png"><img src="../_images/images/ionic-to-android/enable-developer-options1_2_3.png" alt="Steps to enable developer options: 1, 2, 3" width="700"></a>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Go to "System" again an then to "Developer options"</p>
</li>
<li>
<p>Check that the options are "On".</p>
</li>
<li>
<p>Check that "USB debugging" is activated.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/ionic-to-android/enable-developer-options4_5_6.png"><img src="../_images/images/ionic-to-android/enable-developer-options4_5_6.png" alt="Steps to enable developer options: 4, 5, 6" width="700"></a>
</div>
</div>
<div class="paragraph">
<p>After this, do the step four in "From Android project to emulated device" and choose the connected smartphone.</p>
</div>
</div>
<div class="sect3">
<h4 id="send-apk-to-android-through-email"><a class="anchor" href="#send-apk-to-android-through-email"></a>Send APK to Android through email</h4>
<div class="paragraph">
<p>When you build an APK, a dialog gives two options: locate or analyze. If the first one is chosen, Windows file explorer will be opened showing an APK that can be send using email. Download the APK on your phone and click it to install.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/ionic-to-android/locate-apk.png"><img src="../_images/images/ionic-to-android/locate-apk.png" alt="Steps to enable developer options: 4, 5, 6" width="300"></a>
</div>
</div>
</div>
<div class="sect3">
<h4 id="result"><a class="anchor" href="#result"></a>Result</h4>
<div class="paragraph">
<p>If everything goes correctly, the Ionic application will be ready to be tested.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/ionic-to-android/real-device.png"><img src="../_images/images/ionic-to-android/real-device.png" alt="Application running on a real device" width="300"></a>
</div>
</div>
<!-- toc disabled -->
</div>
<div class="sect3">
<h4 id="ionic-progressive-web-app"><a class="anchor" href="#ionic-progressive-web-app"></a>Ionic Progressive Web App</h4>
<div class="paragraph">
<p>This guide is a continuation of the guide <a href="guide-angular-pwa">Angular PWAs</a>, therefore, valid concepts explained there are still valid in this page but focused on Ionic.</p>
</div>
</div>
<div class="sect3">
<h4 id="assumptions-3"><a class="anchor" href="#assumptions-3"></a>Assumptions</h4>
<div class="paragraph">
<p>This guide assumes that you already have installed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>NodeJS</p>
</li>
<li>
<p>npm package manager</p>
</li>
<li>
<p>Angular CLI / Nx CLI</p>
</li>
<li>
<p>Ionic 5 CLI</p>
</li>
<li>
<p>Capacitor</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Also, it is a good idea to read the document about PWA using Angular.</p>
</div>
</div>
<div class="sect3">
<h4 id="sample-application-2"><a class="anchor" href="#sample-application-2"></a>Sample Application</h4>
<div class="imageblock">
<div class="content">
<img src="../_images/images/ionic/ionic-pwa/base.png" alt="Ionic 5 PWA Base" width="250 link="images/ionic/ionic-pwa/base.png"">
</div>
<div class="title">Figure 45. Basic ionic PWA.</div>
</div>
<div class="paragraph">
<p>To explain how to build progressive web apps (PWA) using Ionic, a basic application is going to be built. This app will be able to take photos even without network using PWA elements.</p>
</div>
</div>
<div class="sect3">
<h4 id="step-1-create-a-new-project-2"><a class="anchor" href="#step-1-create-a-new-project-2"></a>Step 1: Create a new project</h4>
<div class="paragraph">
<p>This step can be completed with one simple command: <code>ionic start &lt;name&gt; &lt;template&gt;</code>, where <code>&lt;name&gt;</code> is the name and <code>&lt;template&gt;</code> a model for the app. In this case, the app is going to be named <code><strong>basic-ion-pwa</strong></code>.</p>
</div>
<div class="paragraph">
<p>If you are using Nx, there is a pre-requisite to this step. And that is, you have to add the <code>@nxtend/ionic-angular</code> plugin to your Nx workspace. The command for that is <code>npm install --save-dev @nxtend/ionic-angular</code>. Once you have the plugin installed, you can generate an ionic app in your Nx workspace with the command <code>nx generate @nxtend/ionic-angular:app basic-ion-pwa</code>. (You can refer <a href="https://github.com/devonfw/devon4ng/wiki/guide-creating-angular-app-with-nx-cli">this guide</a> if you want to get started with Nx).</p>
</div>
</div>
<div class="sect3">
<h4 id="step-2-structures-and-styles"><a class="anchor" href="#step-2-structures-and-styles"></a>Step 2: Structures and styles</h4>
<div class="paragraph">
<p>The styles (scss) and structures (html) do not have anything specially relevant, just colors and ionic web components. The code can be found in <a href="https://github.com/devonfw-sample/devon4ts-samples/tree/master/apps/ionic-basic-pwa">devon4ts-samples</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="step-3-add-functionality"><a class="anchor" href="#step-3-add-functionality"></a>Step 3: Add functionality</h4>
<div class="paragraph">
<p>After this step, the app will allow users to take photos and display them in the main screen.
First we have to import three important elements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>DomSanitizer</code>: Sanitizes values to be safe to use.</p>
</li>
<li>
<p><code>SafeResourceUrl</code>: Interface for values that are safe to use as URL.</p>
</li>
<li>
<p>Plugins: Capacitor constant value used to access to the device&#8217;s camera and toast dialogs.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>  import { DomSanitizer, SafeResourceUrl } from '@angular/platform-browser';
  import { Plugins, CameraResultType } from '@capacitor/core';</code></pre>
</div>
</div>
<div class="paragraph">
<p>The process of taking a picture is enclosed in a <code>takePicture()</code> method. <code>takePicture()</code> calls the Camera&#8217;s <code>getPhoto()</code> function which returns an URL or an exception. If a photo is taken then the image displayed in the main page will be changed for the new picture, else, if the app is closed without changing it, a toast message will be displayed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>  export class HomePage {
    image: SafeResourceUrl;
    ...

    async takePicture() {
      try {
        const image = await Plugins.Camera.getPhoto({
          quality: 90,
          allowEditing: true,
          resultType: CameraResultType.Uri,
        });

        // Change last picture shown
        this.image = this.sanitizer.bypassSecurityTrustResourceUrl(image.webPath);
      } catch (e) {
        this.show('Closing camera');
      }
    }

    async show(message: string) {
      await Plugins.Toast.show({
        text: message,
      });
    }
  }</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="step-4-pwa-elements"><a class="anchor" href="#step-4-pwa-elements"></a>Step 4: PWA Elements</h4>
<div class="paragraph">
<p>When Ionic apps are not running natively, some resources like Camera do not work by default but can be enabled using PWA Elements. To use Capacitor&#8217;s PWA elements run <code>npm install @ionic/pwa-elements</code> and modify src/main.ts as shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>...

// Import for PWA elements
import { defineCustomElements } from '@ionic/pwa-elements/loader';

if (environment.production) {
  enableProdMode();
}

platformBrowserDynamic().bootstrapModule(AppModule)
  .catch(err =&gt; console.log(err));

// Call the element loader after the platform has been bootstrapped
defineCustomElements(window);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="step-5-make-it-progressive-2"><a class="anchor" href="#step-5-make-it-progressive-2"></a>Step 5: Make it Progressive.</h4>
<div class="paragraph">
<p>Turning an Ionic 5 app into a PWA is pretty easy. The same module used to turn Angular apps into PWAs has to be added. To do so, run: <code>ng add @angular/pwa</code>. This command also creates an <strong>icons</strong> folder inside <strong>src/assets</strong> and contains angular icons for multiple resolutions. (Note: In an Nx workspace, you have to add it like a normal package using <code>npm install @angular/pwa</code>, and you have to manually add the icons). If you want to use other images, be sure that they have the same resolution, the names can be different but the file <strong>manifest.json</strong> has to be changed accordingly.</p>
</div>
</div>
<div class="sect3">
<h4 id="step-6-configure-the-app-2"><a class="anchor" href="#step-6-configure-the-app-2"></a>Step 6: Configure the app</h4>
<div class="paragraph">
<p><strong>manifest.json</strong></p>
</div>
<div class="paragraph">
<p>Default configuration.</p>
</div>
<div class="paragraph">
<p><strong>ngsw-config.json</strong></p>
</div>
<div class="paragraph">
<p>At <code>assetGroups</code> &#8594; <code>resources</code> add a URLs field and a pattern to match PWA Elements scripts and other resources (images, styles, &#8230;&#8203;):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>  "urls": ["https://unpkg.com/@ionic/pwa-elements@1.0.2/dist/**"]</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="step-7-check-that-your-app-is-a-pwa-2"><a class="anchor" href="#step-7-check-that-your-app-is-a-pwa-2"></a>Step 7: Check that your app is a PWA</h4>
<div class="paragraph">
<p>To check if an app is a PWA lets compare its normal behavior against itself but built for production. Run in the project&#8217;s root folder the commands below:</p>
</div>
<div class="paragraph">
<p><code>ionic build --configuration production</code> to build the app using production settings. (<code>nx build basic-ion-pwa --configuration production</code> in your Nx workspace root).</p>
</div>
<div class="paragraph">
<p><code>npm install http-server</code> to install an npm module that can serve your built application. Documentation <a href="https://www.npmjs.com/package/http-server">here</a>. A good alternative is also <code>npm install serve</code>. It can be checked <a href="https://github.com/zeit/serve">here</a>.</p>
</div>
<div class="paragraph">
<p>Go to the <code><strong>www</strong></code> folder running <code>cd www</code>.</p>
</div>
<div class="paragraph">
<p><code>http-server -o</code> or <code>serve</code> to serve your built app.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In order not to install anything not necessary <code>npx</code> can be used directly to serve the app. i.e run <code>npx serve [folder]</code> will automatically download and run this HTTP server without installing it in the project dependencies.
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/ionic/ionic-pwa/http-server.png" alt="Http server running" width="600 link="images/ionic/ionic-pwa/http-server.png"">
</div>
<div class="title">Figure 46. Http server running on localhost:8081.</div>
</div>
<div class="paragraph">
<p>&#160;<br>
In another console instance run <code>ionic serve</code> (<code>nx serve basic-ion-pwa</code> if using Nx CLI) to open the common app (not built).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/ionic/ionic-pwa/ionic-serve.png" alt="Ionic serve on Visual Studio Code console" width="600 link="images/ionic/ionic-pwa/ionic-serve.png"">
</div>
<div class="title">Figure 47. Ionic server running on localhost:8100.</div>
</div>
<div class="paragraph">
<p>&#160;<br>
The first difference can be found on <em>Developer tools &#8594; application</em>, here it is seen that the PWA application (left) has a service worker and the common one does not.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/ionic/ionic-pwa/pwa-nopwa-app.png" alt="Application comparison" width="800 link="images/ionic/ionic-pwa/pwa-nopwa-app.png"">
</div>
<div class="title">Figure 48. Application service worker comparison.</div>
</div>
<div class="paragraph">
<p>&#160;<br>
If the "offline" box is checked, it will force a disconnection from network. In situations where users do not have connectivity or have a slow, one the PWA can still be accessed and used.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/ionic/ionic-pwa/online-offline.png" alt="Online offline apps" width="800 link="images/ionic/ionic-pwa/online-offline.png"">
</div>
<div class="title">Figure 49. Offline application.</div>
</div>
<div class="paragraph">
<p>&#160;<br>
Finally, plugins like <a href="https://chrome.google.com/webstore/detail/lighthouse/blipmdconlkpinefehnmjammfjpmpbjk">Lighthouse</a> can be used to test whether an application is progressive or not.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/ionic/ionic-pwa/lighthouse.png" alt="Lighthouse report" width="800 link="images/ionic/ionic-pwa/lighthouse.png"">
</div>
<div class="title">Figure 50. Lighthouse report.</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="layouts-2"><a class="anchor" href="#layouts-2"></a>Layouts</h2>
<div class="sectionbody">
<!-- toc disabled -->
<div class="sect3">
<h4 id="angular-material-layout"><a class="anchor" href="#angular-material-layout"></a>Angular Material Layout</h4>
<div class="paragraph">
<p>The purpose of this guide is to get a basic understanding of creating layouts using <a href="https://material.angular.io">Angular Material</a> in a devon4ng application. We will create an application with a header containing some menu links and a sidenav with some navigation links.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<a class="image" href="images/layout-angular-material/1-finished-application.png"><img src="../_images/images/layout-angular-material/1-finished-application.png" alt="Finished application" width="700"></a>
</div>
<div class="title">Figure 51. This is what the finished application will look like</div>
</div>
</div>
<div class="sect3">
<h4 id="create-a-new-angular-application"><a class="anchor" href="#create-a-new-angular-application"></a>Create a new angular application</h4>
<div class="paragraph">
<p>We start with opening the devonfw IDE(right-click anywhere in your workspace and click "Open devonfw CMD shell here") and running the following command to start a project named devon4ng-mat-layout</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ng new devon4ng-mat-layout --routing --style=scss</code>. If you are using Nx, the command would be <code>nx generate @nrwl/angular:app devon4ng-mat-layout --routing --style=scss</code> in your Nx workspace. <a href="https://github.com/devonfw/devon4ng/wiki/guide-creating-angular-app-with-nx-cli">Click here</a> to get started with using Nx.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We are providing the <code>routing</code> flag so that a routing module is generated, and we are also setting the style sheet format to SCSS with <code>--style=scss</code>.</p>
</div>
<div class="paragraph">
<p>Once the creation process is complete, open your newly created application in Visual Studio Code. Try running the empty application by running the following command in the integrated terminal:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ng serve</code>. (If you are using Nx, you have to specify the project name along with the --project flag, so the command becomes <code>ng serve --project=devon4ng-mat-layout</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Angular will spin up a server and you can check your application by visiting <a href="http://localhost:4200/" class="bare">http://localhost:4200/</a> in your browser.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<a class="image" href="images/layout-angular-material/2-blank-application.png"><img src="../_images/images/layout-angular-material/2-blank-application.png" alt="Blank application" width="700"></a>
</div>
<div class="title">Figure 52. Blank application</div>
</div>
</div>
<div class="sect3">
<h4 id="adding-angular-material-library-to-the-project"><a class="anchor" href="#adding-angular-material-library-to-the-project"></a>Adding Angular Material library to the project</h4>
<div class="paragraph">
<p>Next we will add Angular Material to our application. In the integrated terminal, press <code>Ctrl + C</code> to terminate the running application and run the following command:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>npm install --save @angular/material @angular/cdk @angular/animations</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can also use Yarn to install the dependencies if you prefer that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>yarn add @angular/material @angular/cdk @angular/animations</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Once the dependencies are installed, we need to import the <code>BrowserAnimationsModule</code> in our <code>AppModule</code> for animations support.</p>
</div>
<div class="listingblock">
<div class="title">Listing 58. Importing <code>BrowserAnimationsModule</code> in <code>AppModule</code></div>
<div class="content">
<pre class="highlightjs highlight"><code>import {BrowserAnimationsModule} from '@angular/platform-browser/animations';

@NgModule({
  ...
  imports: [BrowserAnimationsModule],
  ...
})
export class AppModule { }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Angular Material provides a host of components for designing our application. All the components are well structured into individual <code>NgModules</code>. For each component from the Angular Material library that we want to use, we have to import the respective <code>NgModule</code>.</p>
</div>
<div class="listingblock">
<div class="title">Listing 59. We will be using the following components in our application:</div>
<div class="content">
<pre class="highlightjs highlight"><code>import { MatIconModule, MatButtonModule, MatMenuModule, MatListModule, MatToolbarModule, MatSidenavModule } from '@angular/material';

@NgModule({
  ...
  imports: [
	...
    MatIconModule,
    MatButtonModule,
    MatMenuModule,
    MatListModule,
    MatToolbarModule,
    MatSidenavModule,
	...
	],
  ...
})
export class AppModule { }</code></pre>
</div>
</div>
<div class="paragraph">
<p>A better approach is to import and then export all the required components in a shared  module. But for the sake of simplicity, we are importing all the required components in the <code>AppModule</code> itself.</p>
</div>
</div>
<div class="sect3">
<h4 id="-5"><a class="anchor" href="#-5"></a>==</h4>
<div class="literalblock">
<div class="content">
<pre>  You can find a working copy of this application https://github.com/devonfw-sample/devon4ts-samples/tree/master/apps/angular-material-basic-layout[here]. The sample application is part of a Nx workspace, which means it is one of the many apps in a monorepo and capable of importing reusable code from a shared library. This guide describes the implementaion by assuming a stand-alone single-repo application, but the pages and layout described in this sample app are similar to the ones used in another sample app in the monorepo (https://github.com/devonfw-sample/devon4ts-samples/tree/master/apps/angular-material-theming[angular-material-theming]), which is why we have exported the required components from a shared library and reused them in both the apps. As a result, the code in our monorepo will be slightly different. It would still help you in following this guide.
== ==</pre>
</div>
</div>
<div class="paragraph">
<p>Next, we include a theme in our application. Angular Material comes with four pre-defined themes: <code>indigo-pink</code>, <code>deeppurple-amber</code>, <code>pink-bluegrey</code> and <code>purple-green</code>. It is also possible to create our own custom theme, but that is beyond the scope of this guide. Including a theme is required to apply all of the core and theme styles to your application.
We will include the indigo-pink theme in our application by importing the <code>indigo-pink.css</code> file in our <code>src/styles.scss</code>:</p>
</div>
<div class="listingblock">
<div class="title">Listing 60. In <code>src/styles.scss</code>:</div>
<div class="content">
<pre class="highlightjs highlight"><code>@import "~@angular/material/prebuilt-themes/indigo-pink.css";</code></pre>
</div>
</div>
<div class="paragraph">
<p>To use <a href="https://material.io/icons/">Material Design Icons</a> along with the <code>mat-icon</code> component, we will load the Material Icons library in our <code>src/index.html</code> file</p>
</div>
<div class="listingblock">
<div class="title">Listing 61. In src/index.html:</div>
<div class="content">
<pre class="highlightjs highlight"><code>&lt;link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="development"><a class="anchor" href="#development"></a>Development</h4>
<div class="paragraph">
<p>Now that we have all the Angular Material related dependencies set up in our project, we can start coding. Let&#8217;s begin by adding a suitable <code>margin</code> and <code>font</code> to the <code>body</code> element of our single page application. We will add it in the <code>src/styles.scss</code> file to apply it globally:</p>
</div>
<div class="listingblock">
<div class="title">Listing 62. In <code>src/styles.scss</code>:</div>
<div class="content">
<pre class="highlightjs highlight"><code>body {
  margin: 0;
  font-family: "Segoe UI", Roboto, sans-serif;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>At this point, if we run our application, this is how it will look like:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<a class="image" href="images/layout-angular-material/3-material-added.png"><img src="../_images/images/layout-angular-material/3-material-added.png" alt="Angular Material added to the application" width="700"></a>
</div>
<div class="title">Figure 53. Application with Angular Material set up</div>
</div>
<div class="paragraph">
<p>We will clear the <code>app.component.html</code> file and setup a header with a menu button and some navigational links. We will use <code>mat-toolbar</code>, <code>mat-button</code>, <code>mat-menu</code>, <code>mat-icon</code> and <code>mat-icon-button</code> for this:</p>
</div>
<div class="listingblock">
<div class="title">Listing 63. app.component.html:</div>
<div class="content">
<pre class="highlightjs highlight"><code>&lt;mat-toolbar color="primary"&gt;
  &lt;button mat-icon-button aria-label="menu"&gt;
    &lt;mat-icon&gt;menu&lt;/mat-icon&gt;
  &lt;/button&gt;
  &lt;button mat-button [matMenuTriggerFor]="submenu"&gt;Menu 1&lt;/button&gt;
  &lt;button mat-button&gt;Menu 2&lt;/button&gt;
  &lt;button mat-button&gt;Menu 3&lt;/button&gt;

  &lt;mat-menu #submenu="matMenu"&gt;
    &lt;button mat-menu-item&gt;Sub-menu 1&lt;/button&gt;
    &lt;button mat-menu-item [matMenuTriggerFor]="submenu2"&gt;Sub-menu 2&lt;/button&gt;
  &lt;/mat-menu&gt;

  &lt;mat-menu #submenu2="matMenu"&gt;
    &lt;button mat-menu-item&gt;Menu Item 1&lt;/button&gt;
    &lt;button mat-menu-item&gt;Menu Item 2&lt;/button&gt;
    &lt;button mat-menu-item&gt;Menu Item 3&lt;/button&gt;
  &lt;/mat-menu&gt;

&lt;/mat-toolbar&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The color attribute on the <code>mat-toolbar</code> element will give it the primary (indigo) color as defined by our theme. The color attribute works with most Angular Material components; the possible values are 'primary', 'accent' and 'warn'.
The mat-toolbar is a suitable component to represent a header. It serves as a placeholder for elements we want in our header.
Inside the mat-toolbar, we start with a button having mat-icon-button attribute, which itself contains a mat-icon element having the value <code>menu</code>. This will serve as a menu button which we can use to toggle the sidenav.
We follow it with some sample buttons having the mat-button attribute. Notice the first button has a property <code>matMenuTriggerFor</code> bound to a local reference <code>submenu</code>. As the property name suggests, the click of this button will display the <code>mat-menu</code> element with the specified local reference as a drop-down menu. The rest of the code is self explanatory.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<a class="image" href="images/layout-angular-material/4-header.png"><img src="../_images/images/layout-angular-material/4-header.png" alt="Header added to the application" width="700"></a>
</div>
<div class="title">Figure 54. This is how our application looks with the first menu button (Menu 1) clicked.</div>
</div>
<div class="paragraph">
<p>We want to keep the sidenav toggling menu button on the left and move the rest to the right to make it look better. To do this we add a class to the menu icon button:</p>
</div>
<div class="listingblock">
<div class="title">Listing 64. app.component.html:</div>
<div class="content">
<pre class="highlightjs highlight"><code>...
  &lt;button mat-icon-button aria-label="menu" class="menu"&gt;
    &lt;mat-icon&gt;menu&lt;/mat-icon&gt;
  &lt;/button&gt;
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>And in the <code>app.component.scss</code> file, we add the following style:</p>
</div>
<div class="listingblock">
<div class="title">Listing 65. <code>app.component.scss</code>:</div>
<div class="content">
<pre class="highlightjs highlight"><code>.menu {
    margin-right: auto;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The mat-toolbar element already has it&#8217;s display property set to <code>flex</code>. Setting the menu icon button&#8217;s <code>margin-right</code> property to <code>auto</code> keeps itself on the left and pushes the other elements to the right.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<a class="image" href="images/layout-angular-material/5-header-layout-final.png"><img src="../_images/images/layout-angular-material/5-header-layout-final.png" alt="Final look of the header" width="700"></a>
</div>
<div class="title">Figure 55. Final look of the header.</div>
</div>
<div class="paragraph">
<p>Next, we will create a sidenav. But before that lets create a couple of components to navigate between, the links of which we will add to the sidenav.
We will use the <code>ng generate component</code> (or <code>ng g c</code> command for short) to create <em>Home</em> and <em>Data</em> components. (Append <code>--project=devon4ng-mat-layout</code> to the command in a Nx workspace). We nest them in the <code>pages</code> sub-directory since they represent our pages.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ng g c pages/home</code></p>
</li>
<li>
<p><code>ng g c pages/data;</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Let us set up the routing such that when we visit <code><a href="http://localhost:4200/" class="bare">http://localhost:4200/</a></code> root url we see the <code>HomeComponent</code> and when we visit <code><a href="http://localhost:4200/data" class="bare">http://localhost:4200/data</a></code> url we see the  <code>DataComponent</code>.
We had opted for routing while creating the application, so we have the routing module <code>app-routing.module.ts</code> setup for us. In this file, we have the empty <code>routes</code> array where we set up our routes.</p>
</div>
<div class="listingblock">
<div class="title">Listing 66. app-routing.module.ts:</div>
<div class="content">
<pre class="highlightjs highlight"><code>import { HomeComponent } from './pages/home/home.component';
import { DataComponent } from './pages/data/data.component';

	const routes: Routes = [
	  { path: '', component: HomeComponent },
	  { path: 'data', component: DataComponent }
	];</code></pre>
</div>
</div>
<div class="paragraph">
<p>We need to provide a hook where the components will be loaded when their respective URLs are loaded. We do that by using the <code>router-outlet</code> directive in the <code>app.component.html</code>.</p>
</div>
<div class="listingblock">
<div class="title">Listing 67. app.component.html:</div>
<div class="content">
<pre class="highlightjs highlight"><code>...
	&lt;/mat-toolbar&gt;
	&lt;router-outlet&gt;&lt;/router-outlet&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now when we visit the defined URLs we see the appropriate components rendered on screen.</p>
</div>
<div class="paragraph">
<p>Lets change the contents of the components to have something better.</p>
</div>
<div class="listingblock">
<div class="title">Listing 68. home.component.html:</div>
<div class="content">
<pre class="highlightjs highlight"><code>&lt;h2&gt;Home Page&lt;/h2&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Listing 69. <code>home.component.scss</code>:</div>
<div class="content">
<pre class="highlightjs highlight"><code>h2 {
    text-align: center;
    margin-top: 50px;
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Listing 70. data.component.html:</div>
<div class="content">
<pre class="highlightjs highlight"><code>&lt;h2&gt;Data Page&lt;/h2&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Listing 71. <code>data.component.scss</code>:</div>
<div class="content">
<pre class="highlightjs highlight"><code>h2 {
    text-align: center;
    margin-top: 50px;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The pages look somewhat better now:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<a class="image" href="images/layout-angular-material/6-home-page.png"><img src="../_images/images/layout-angular-material/6-home-page.png" alt="Home page" width="700"></a>
</div>
<div class="title">Figure 56. Home page</div>
</div>
<div class="imageblock text-center">
<div class="content">
<a class="image" href="images/layout-angular-material/7-data-page.png"><img src="../_images/images/layout-angular-material/7-data-page.png" alt="Data page" width="700"></a>
</div>
<div class="title">Figure 57. Data page</div>
</div>
<div class="paragraph">
<p>Let us finally create the sidenav. To implement the sidenav we need to use 3 Angular Material components: <code>mat-sidenav-container</code>, <code>mat-sidenav</code> and <code>mat-sidenav-content</code>.
The <code>mat-sidenav-container</code>, as the name suggests, acts as a container for the sidenav and the associated content. So it is the parent element, and <code>mat-sidenav</code> and <code>mat-sidenav-content</code> are the children sibling elements. <code>mat-sidenav</code> represents the sidenav. We can put any content we want, though it is usually used to contain a list of navigational links. The <code>mat-sidenav-content</code> element is for containing the contents of our current page. Since we need the sidenav application-wide, we will put it in the <code>app.component.html</code>.</p>
</div>
<div class="listingblock">
<div class="title">Listing 72. app.component.html:</div>
<div class="content">
<pre class="highlightjs highlight"><code>...
&lt;/mat-toolbar&gt;

&lt;mat-sidenav-container&gt;
  &lt;mat-sidenav mode="over" [disableClose]="false" #sidenav&gt;
    Sidenav
  &lt;/mat-sidenav&gt;
  &lt;mat-sidenav-content&gt;
    &lt;router-outlet&gt;&lt;/router-outlet&gt;
  &lt;/mat-sidenav-content&gt;
&lt;/mat-sidenav-container&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>mat-sidenav</code> has a <code>mode</code> property, which accepts one of the 3 values: <code>over</code>, <code>push</code> and <code>side</code>. It decides the behavior of the sidenav. <code>mat-sidenav</code> also has a <code>disableClose</code> property which accents a boolean value. It toggles the behavior where we click on the backdrop or press the <code>Esc</code> key to close the sidenav. There are other properties which we can use to customize the appearance, behavior and position of the sidenav. You can find the properties documented online at <a href="https://material.angular.io/components/sidenav/api" class="bare">https://material.angular.io/components/sidenav/api</a>
We moved the <code>router-outlet</code> directive inside the <code>mat-sidenav-content</code> where it will render the routed component.
But if you check the running application in the browser, we don&#8217;t see the sidenav yet. That is because it is closed. We want to have the sidenav opened/closed at the click of the menu icon button on the left side of the header we implemented earlier. Notice we have set a local reference <code>#sidenav</code> on the <code>mat-sidenav</code> element. We can access this element and call its <code>toggle()</code> function to toggle open or close the sidenav.</p>
</div>
<div class="listingblock">
<div class="title">Listing 73. app.component.html:</div>
<div class="content">
<pre class="highlightjs highlight"><code>...
  &lt;button mat-icon-button aria-label="menu" class="menu" (click)="sidenav.toggle()"&gt;
    &lt;mat-icon&gt;menu&lt;/mat-icon&gt;
  &lt;/button&gt;
...</code></pre>
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<a class="image" href="images/layout-angular-material/8-sidenav-started.png"><img src="../_images/images/layout-angular-material/8-sidenav-started.png" alt="Sidenav works" width="700"></a>
</div>
<div class="title">Figure 58. Sidenav is implemented</div>
</div>
<div class="paragraph">
<p>We can now open the sidenav by clicking the menu icon button. But it does not look right. The sidenav is only as wide as its content. Also the page does not stretch the entire viewport due to lack of content.
Let&#8217;s add the following styles to make the page fill the viewport:</p>
</div>
<div class="listingblock">
<div class="title">Listing 74. app.component.scss:</div>
<div class="content">
<pre class="highlightjs highlight"><code>...
mat-sidenav-container {
    position: absolute;
    top: 64px;
    left: 0;
    right: 0;
    bottom: 0;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The sidenav width will be corrected when we add the navigational links to it. That is the only thing remaining to be done. Lets implement it now:</p>
</div>
<div class="listingblock">
<div class="title">Listing 75. app.component.html:</div>
<div class="content">
<pre class="highlightjs highlight"><code>...
  &lt;mat-sidenav [disableClose]="false" mode="over" #sidenav&gt;
	&lt;mat-nav-list&gt;
      &lt;a
        id="home"
        mat-list-item
        [routerLink]="['./']"
        (click)="sidenav.close()"
        routerLinkActive="active"
        [routerLinkActiveOptions]="{exact: true}"
      &gt;
        &lt;mat-icon matListAvatar&gt;home&lt;/mat-icon&gt;
        &lt;h3 matLine&gt;Home&lt;/h3&gt;
        &lt;p matLine&gt;sample home page&lt;/p&gt;
      &lt;/a&gt;
      &lt;a
        id="sampleData"
        mat-list-item
        [routerLink]="['./data']"
        (click)="sidenav.close()"
        routerLinkActive="active"
      &gt;
        &lt;mat-icon matListAvatar&gt;grid_on&lt;/mat-icon&gt;
        &lt;h3 matLine&gt;Data&lt;/h3&gt;
        &lt;p matLine&gt;sample data page&lt;/p&gt;
      &lt;/a&gt;
    &lt;/mat-nav-list&gt;
  &lt;/mat-sidenav&gt;
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>We use the <code>mat-nav-list</code> element to set a list of navigational links. We use the <code>a</code> tags with <code>mat-list-item</code> directive. We implement a <code>click</code> listener on each link to close the sidenav when it is clicked. The <code>routerLink</code> directive is used to provide the URLs to navigate to. The <code>routerLinkActive</code> directive is used to provide the class name which will be added to the link when it&#8217;s URL is visited. Here we name the class`active`. To style it, let' modify the <code>app.component.scss</code> file:</p>
</div>
<div class="listingblock">
<div class="title">Listing 76. <code>app.component.scss</code>:</div>
<div class="content">
<pre class="highlightjs highlight"><code>...
mat-sidenav-container {
...
	a.active {
        background: #8e8d8d;
        color: #fff;

        p {
            color: #4a4a4a;
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we have a working application with a basic layout: a header with some menu and a sidenav with some navigational links.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<a class="image" href="images/layout-angular-material/9-finished.png"><img src="../_images/images/layout-angular-material/9-finished.png" alt="Finished application" width="700"></a>
</div>
<div class="title">Figure 59. Finished application</div>
</div>
</div>
<div class="sect3">
<h4 id="conclusion-2"><a class="anchor" href="#conclusion-2"></a>Conclusion</h4>
<div class="paragraph">
<p>The purpose of this guide was to provide a basic understanding of creating layouts with Angular Material. The Angular Material library has a huge collection of ready to use components which can be found at <a href="https://material.angular.io/components/categories" class="bare">https://material.angular.io/components/categories</a>
It has provided documentation and example usage for each of its components.  Going through the documentation will give a better understanding of using Angular Material components in our devon4ng applications.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ngrx-2"><a class="anchor" href="#ngrx-2"></a>NgRx</h2>
<div class="sectionbody">
<!-- toc disabled -->
<div class="sect3">
<h4 id="introduction-to-ngrx"><a class="anchor" href="#introduction-to-ngrx"></a>Introduction to NgRx</h4>
<div class="paragraph">
<p><a href="https://github.com/ngrx">NgRx</a> is a state management framework for Angular based on the <a href="https://redux.js.org/">Redux</a> pattern.</p>
</div>
</div>
<div class="sect3">
<h4 id="the-need-for-client-side-state-management"><a class="anchor" href="#the-need-for-client-side-state-management"></a>The need for client side state management</h4>
<div class="paragraph">
<p>You may wonder why you should bother with state management. Usually data resides in a back-end storage system, e.g. a database, and is retrieved by the client on a per-need basis. To add, update, or delete entities from this store, clients have to invoke API endpoints at the back-end. Mimicking database-like transactions on the client side may seem redundant. However, there are many use cases for which a global client-side state is appropriate:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the client has some kind of global state which should survive the destruction of a component, but does not warrant server side persistence, for example: volume level of media, expansion status of menus</p>
</li>
<li>
<p>sever side data should not be retrieved every time it is needed, either because multiple components consume it, or because it should be cached, e.g. the personal watchlist in an online streaming app</p>
</li>
<li>
<p>the app provides a rich experience with offline functionality, e.g. a native app built with <a href="guilde-ionic-getting-started">Ionic</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Saving global states inside the services they originates from results in a data flow that is hard to follow and state becoming inconsistent due to unordered state mutations. Following the <em>single source of truth</em> principle, there should be a central location holding all your application&#8217;s state, just like a server side database does. State management libraries for Angular provide tools for storing, retrieving, and updating client-side state.</p>
</div>
</div>
<div class="sect3">
<h4 id="why-ngrx"><a class="anchor" href="#why-ngrx"></a>Why NgRx?</h4>
<div class="paragraph">
<p>As stated in the <a href="home">introduction</a>, devon4ng does not stipulate a particular state library, or require using one at all. However, NgRx has proven to be a robust, mature solution for this task, with good tooling and 3rd-party library support. Albeit introducing a level of indirection that requires additional effort even for simple features, the Redux concept enforces a clear separation of concerns leading to a cleaner architecture.</p>
</div>
<div class="paragraph">
<p>Nonetheless, you should always compare different approaches to state management and pick the best one suiting your use case. Here&#8217;s a (non-exhaustive) list of competing state management libraries:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Plain RxJS using the simple store described in <a href="cookbook-abstract-class-store">Abstract Class Store</a></p>
</li>
<li>
<p><a href="https://github.com/ngxs">NgXS</a> reduces some boilerplate of NgRx by leveraging the power of decorators and moving side effects to the store</p>
</li>
<li>
<p><a href="https://github.com/mobxjs/mobx">MobX</a> follows a more imperative approach in contrast to the functional Redux pattern</p>
</li>
<li>
<p><a href="https://github.com/datorama/akita">Akita</a> also uses an imperative approach with direct setters in the store, but keeps the concept of immutable state transitions</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="setup"><a class="anchor" href="#setup"></a>Setup</h4>
<div class="paragraph">
<p>To get a quick start, use the provided <a href="https://github.com/devonfw-forge/devon4ng-ngrx-template">template for devon4ng + NgRx</a>.</p>
</div>
<div class="paragraph">
<p>To manually install the core store package together with a set of useful extensions:</p>
</div>
<div class="paragraph">
<p>NPM:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>`npm install @ngrx/store @ngrx/effects @ngrx/entity @ngrx/store-devtools --save`</pre>
</div>
</div>
<div class="paragraph">
<p>Yarn:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>`yarn add @ngrx/store @ngrx/effects @ngrx/entity @ngrx/store-devtools`</pre>
</div>
</div>
<div class="paragraph">
<p>We recommend to add the NgRx schematics to your project so you can create code artifacts from the command line:</p>
</div>
<div class="paragraph">
<p>NPM:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>`npm install @ngrx/schematics --save-dev`</pre>
</div>
</div>
<div class="paragraph">
<p>Yarn:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>`yarn add @ngrx/schematics --dev`</pre>
</div>
</div>
<div class="paragraph">
<p>Afterwards, make NgRx your default schematics provider, so you don&#8217;t have to type the qualified package name every time:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>`ng config cli.defaultCollection @ngrx/schematics`</pre>
</div>
</div>
<div class="paragraph">
<p>If you have custom settings for Angular schematics, you have to <a href="https://ngrx.io/guide/schematics">configure them as described here</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="concept"><a class="anchor" href="#concept"></a>Concept</h4>
<div class="imageblock text-center">
<div class="content">
<a class="image" href="images/ngrx-concept.svg"><img src="../_images/images/ngrx-concept.svg" alt="NgRx Architecture"></a>
</div>
<div class="title">Figure 60. NgRx architecture overview</div>
</div>
<div class="paragraph">
<p>Figure 1 gives an overview of the NgRx data flow. The single source of truth is managed as an immutable state object by the store. Components dispatch actions to trigger state changes. Actions are handed over to reducers, which take the current state and action data to compute the next state. Actions are also consumed by-effects, which perform side-effects such as retrieving data from the back-end, and may dispatch new actions as a result. Components subscribe to state changes using selectors.</p>
</div>
<div class="paragraph">
<p>Continue with <a href="guide-ngrx-simple-store">Creating a Simple Store</a>.</p>
</div>
<!-- toc disabled -->
</div>
<div class="sect3">
<h4 id="state-selection-and-reducers"><a class="anchor" href="#state-selection-and-reducers"></a>State, Selection and Reducers</h4>

</div>
<div class="sect3">
<h4 id="creating-a-simple-store"><a class="anchor" href="#creating-a-simple-store"></a>Creating a Simple Store</h4>
<div class="paragraph">
<p>In the following pages we use the example of an online streaming service. We will model a particular feature, a watchlist that can be populated by the user with movies she or he wants to see in the future.</p>
</div>
</div>
<div class="sect3">
<h4 id="initializing-ngrx"><a class="anchor" href="#initializing-ngrx"></a>Initializing NgRx</h4>
<div class="paragraph">
<p>If you&#8217;re starting fresh, you first have to initialize NgRx and create a root state. The fastest way to do this is using the schematic:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>`ng generate @ngrx/schematics:store State --root --module app.module.ts`</pre>
</div>
</div>
<div class="paragraph">
<p>This will automatically generate a root store and register it in the app module. Next we generate a feature module for the watchlist:</p>
</div>
<div class="paragraph">
<p>` ng generate module watchlist`</p>
</div>
<div class="paragraph">
<p>and create a corresponding feature store:</p>
</div>
<div class="paragraph">
<p>` ng generate store watchlist/Watchlist -m watchlist.module.ts`</p>
</div>
<div class="paragraph">
<p>This generates a file <code>watchlist/reducers/index.ts</code> with the reducer function, and registers the store in the watchlist module declaration.</p>
</div>
</div>
<div class="sect3">
<h4 id="-6"><a class="anchor" href="#-6"></a>== =</h4>
<div class="paragraph">
<p>If you&#8217;re getting an error <em>Schematic "store" not found in collection "@schematics/angular"</em>, this means you forgot to register the NgRx schematics as default.
== == =</p>
</div>
<div class="paragraph">
<p>Next, add the <code>WatchlistModule</code> to the <code>AppModule</code> imports so the feature store is registered when the application starts. We also added the <strong>store devtools</strong> which we will use later, resulting in the following file:</p>
</div>
<div class="paragraph">
<p><strong>app.module.ts</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { BrowserModule } from '@angular/platform-browser';
import { NgModule } from '@angular/core';

import { AppComponent } from './app.component';
import { EffectsModule } from '@ngrx/effects';
import { AppEffects } from './app.effects';
import { StoreModule } from '@ngrx/store';
import { reducers, metaReducers } from './reducers';
import { StoreDevtoolsModule } from '@ngrx/store-devtools';
import { environment } from '../environments/environment';
import { WatchlistModule } from './watchlist/watchlist.module';

@NgModule({
  declarations: [
    AppComponent
  ],
  imports: [
    BrowserModule,
    WatchlistModule,
    StoreModule.forRoot(reducers, { metaReducers }),
    // Instrumentation must be imported after importing StoreModule (config is optional)
    StoreDevtoolsModule.instrument({
      maxAge: 25, // Retains last 25 states
      logOnly: environment.production, // Restrict extension to log-only mode
    }),
    !environment.production ? StoreDevtoolsModule.instrument() : []
  ],
  providers: [],
  bootstrap: [AppComponent]
})
export class AppModule { }</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="create-an-entity-model-and-initial-state"><a class="anchor" href="#create-an-entity-model-and-initial-state"></a>Create an entity model and initial state</h4>
<div class="paragraph">
<p>We need a simple model for our list of movies. Create a file <code>watchlist/models/movies.ts</code> and insert the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">export interface Movie {
    id: number;
    title: string;
    releaseYear: number;
    runtimeMinutes: number;
    genre: Genre;
}

export type Genre = 'action' | 'fantasy' | 'sci-fi' | 'romantic' | 'comedy' | 'mystery';

export interface WatchlistItem {
    id: number;
    movie: Movie;
    added: Date;
    playbackMinutes: number;
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="-7"><a class="anchor" href="#-7"></a>== =</h4>
<div class="paragraph">
<p>We discourage putting several types into the same file and do this only for the sake of keeping this tutorial brief.
== == =</p>
</div>
<div class="paragraph">
<p>Later we will learn how to retrieve data from the back-end using effects. For now we will create an initial state for the user with a default movie.</p>
</div>
<div class="paragraph">
<p>State is defined and transforms by a reducer function. Let&#8217;s create a watchlist reducer:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>```
cd watchlist/reducers
ng g reducer WatchlistData --reducers index.ts
```</pre>
</div>
</div>
<div class="paragraph">
<p>Open the generated file <code>watchlist-data.reducer.ts</code>. You see three exports: The <strong>State</strong> interface defines the shape of the state. There is only one instance of a feature state in the store at all times. The <code><strong>initialState</strong></code> constant is the state at application creation time. The <strong>reducer</strong> function will later be called by the store to produce the next state instance based on the current state and an action object.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s put a movie into the user&#8217;s watchlist:</p>
</div>
<div class="paragraph">
<p><strong>watchlist-data.reducer.ts</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">export interface State {
  items: WatchlistItem[];
}

export const initialState: State = {
  items: [
    {
      id: 42,
      movie: {
        id: 1,
        title: 'Die Hard',
        genre: 'action',
        releaseYear: 1988,
        runtimeMinutes: 132
      },
      playbackMinutes: 0,
      added: new Date(),
    }
  ]
};</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="select-the-current-watchlist"><a class="anchor" href="#select-the-current-watchlist"></a>Select the current watchlist</h4>
<div class="paragraph">
<p>State slices can be retrieved from the store using selectors.</p>
</div>
<div class="paragraph">
<p>Create a watchlist component:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>`ng g c watchlist/Watchlist`</pre>
</div>
</div>
<div class="paragraph">
<p>and add it to the exports of <code>WatchlistModule</code>. Also, replace <code>app.component.html</code> with</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;app-watchlist&gt;&lt;/app-watchlist&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>State observables are obtained using selectors. They are memoized by default, meaning that you don&#8217;t have to worry about performance if you use complicated calculations when deriving state&#8201;&#8212;&#8201;these are only performed once per state emission.</p>
</div>
<div class="paragraph">
<p>Add a selector to <code>watchlist-data.reducer.ts</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>`export const getAllItems = (state: State) =&gt; state.items;`</pre>
</div>
</div>
<div class="paragraph">
<p>Next, we have to re-export the selector for this sub-state in the feature reducer. Modify the <code>watchlist/reducers/index.ts</code> like this:</p>
</div>
<div class="paragraph">
<p><strong>watchlist/reducers/index.ts</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import {
  ActionReducer,
  ActionReducerMap,
  createFeatureSelector,
  createSelector,
  MetaReducer
} from '@ngrx/store';
import { environment } from 'src/environments/environment';
import * as fromWatchlistData from './watchlist-data.reducer';
import * as fromRoot from 'src/app/reducers/index';

export interface WatchlistState { <i class="conum" data-value="1"></i><b>(1)</b>
  watchlistData: fromWatchlistData.State;
}

export interface State extends fromRoot.State { <i class="conum" data-value="2"></i><b>(2)</b>
  watchlist: WatchlistState;
}

export const reducers: ActionReducerMap&lt;WatchlistState&gt; = { <i class="conum" data-value="3"></i><b>(3)</b>
  watchlistData: fromWatchlistData.reducer,
};

export const metaReducers: MetaReducer&lt;WatchlistState&gt;[] = !environment.production ? [] : [];

export const getFeature = createFeatureSelector&lt;State, WatchlistState&gt;('watchlist'); <i class="conum" data-value="4"></i><b>(4)</b>

export const getWatchlistData = createSelector( <i class="conum" data-value="5"></i><b>(5)</b>
  getFeature,
  state =&gt; state.watchlistData
);

export const getAllItems = createSelector( <i class="conum" data-value="6"></i><b>(6)</b>
  getWatchlistData,
  fromWatchlistData.getAllItems
);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The feature state, each member is managed by a different reducer</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Feature states are registered by the <code>forFeature</code> method. This interface provides a typesafe path from root to feature state.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Tie sub-states of a feature state to the corresponding reducers</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Create a selector to access the 'watchlist' feature state</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>select the <code>watchlistData</code> sub state</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>re-export the selector</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note how <code>createSelector</code> allows to chain selectors. This is a powerful tool that also allows for selecting from multiple states.</p>
</div>
<div class="paragraph">
<p>You can use selectors as pipeable operators:</p>
</div>
<div class="paragraph">
<p><strong>watchlist.component.ts</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">export class WatchlistComponent {
  watchlistItems$: Observable&lt;WatchlistItem[]&gt;;

  constructor(
    private store: Store&lt;fromWatchlist.State&gt;
  ) {
    this.watchlistItems$ = this.store.pipe(select(fromWatchlist.getAllItems));
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>watchlist.component.html</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">&lt;h1&gt;Watchlist&lt;/h1&gt;
&lt;ul&gt;
    &lt;li *ngFor="let item of watchlistItems$ | async"&gt;{{item.movie.title}} ({{item.movie.releaseYear}}): {{item.playbackMinutes}}/{{item.movie.runtimeMinutes}} min watched&lt;/li&gt;
&lt;/ul&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="dispatching-an-action-to-update-watched-minutes"><a class="anchor" href="#dispatching-an-action-to-update-watched-minutes"></a>Dispatching an action to update watched minutes</h4>
<div class="paragraph">
<p>We track the user&#8217;s current progress at watching a movie as the <code>playbackMinutes</code> property. After closing a video, the watched minutes have to be updated. In NgRx, state is being updated by dispatching actions. An action is an option with a (globally unique) type discriminator and an optional payload.</p>
</div>
</div>
<div class="sect3">
<h4 id="creating-the-action"><a class="anchor" href="#creating-the-action"></a>==  Creating the action</h4>
<div class="paragraph">
<p>Create a file <code>playback/actions/index.ts</code>. In this example, we do not further separate the actions per sub state. Actions can be defined by using action creators:</p>
</div>
<div class="paragraph">
<p><strong>playback/actions/index.ts</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { createAction, props, union } from '@ngrx/store';

export const playbackFinished = createAction('[Playback] Playback finished', props&lt;{ movieId: number, stoppedAtMinute: number }&gt;());

const actions = union({
    playbackFinished
});

export type ActionsUnion = typeof actions;</code></pre>
</div>
</div>
<div class="paragraph">
<p>First we specify the type, followed by a call to the payload definition function. Next, we create a union of all possible actions for this file using <code>union</code>, which allows us a to access action payloads in the reducer in a typesafe way.</p>
</div>
</div>
<div class="sect3">
<h4 id="-8"><a class="anchor" href="#-8"></a>== =</h4>
<div class="paragraph">
<p>Action types should follow the naming convention <code>[Source] Event</code>, e.g. <code>[Recommended List] Hide Recommendation</code> or <code>[Auth API] Login Success</code>. Think of actions rather as events than commands. You should never use the same action at two different places (you can still handle multiple actions the same way). This facilitate tracing the source of an action. For details see <a href="https://www.youtube.com/watch?v=JmnsEvoy-gY">Good Action Hygiene with NgRx</a> by Mike Ryan (video).
== == =</p>
</div>
</div>
<div class="sect3">
<h4 id="dispatch"><a class="anchor" href="#dispatch"></a>==  Dispatch</h4>
<div class="paragraph">
<p>We skip the implementation of an actual video playback page and simulate watching a movie in 10 minute segments by adding a link in the template:</p>
</div>
<div class="paragraph">
<p><strong>watchlist-component.html</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">&lt;li *ngFor="let item of watchlistItems$ | async"&gt;... &lt;button (click)="stoppedPlayback(item.movie.id, item.playbackMinutes + 10)"&gt;Add 10 Minutes&lt;/button&gt;&lt;/li&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>watchlist-component.ts</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import * as playbackActions from 'src/app/playback/actions';
...
  stoppedPlayback(movieId: number, stoppedAtMinute: number) {
    this.store.dispatch(playbackActions.playbackFinished({ movieId, stoppedAtMinute }));
  }</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="state-reduction"><a class="anchor" href="#state-reduction"></a>==  State reduction</h4>
<div class="paragraph">
<p>Next, we handle the action inside the <code>watchlistData</code> reducer. Note that actions can be handled by multiple reducers and effects at the same time to update different states, for example if we&#8217;d like to show a rating modal after playback has finished.</p>
</div>
<div class="paragraph">
<p><strong>watchlist-data.reducer.ts</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">export function reducer(state = initialState, action: playbackActions.ActionsUnion): State {
  switch (action.type) {
    case playbackActions.playbackFinished.type:
      return {
        ...state,
        items: state.items.map(updatePlaybackMinutesMapper(action.movieId, action.stoppedAtMinute))
      };

    default:
      return state;
  }
}

export function updatePlaybackMinutesMapper(movieId: number, stoppedAtMinute: number) {
  return (item: WatchlistItem) =&gt; {
    if (item.movie.id == movieId) {
      return {
        ...item,
        playbackMinutes: stoppedAtMinute
      };
    } else {
      return item;
    }
  };
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note how we changed the reducer&#8217;s function signature to reference the actions union. The switch-case handles all incoming actions to produce the next state. The default case handles all actions a reducer is not interested in by returning the state unchanged. Then we find the watchlist item corresponding to the movie with the given id and update the playback minutes. Since state is immutable, we have to clone all objects down to the one we would like to change using the object spread operator (<code>&#8230;&#8203;</code>).</p>
</div>
</div>
<div class="sect3">
<h4 id="-9"><a class="anchor" href="#-9"></a>== =</h4>
<div class="paragraph">
<p>Selectors rely on object identity to decide whether the value has to be recalculated. Do not clone objects that are not on the path to the change you want to make. This is why <code>updatePlaybackMinutesMapper</code> returns the same item if the movie id does not match.
== == =</p>
</div>
</div>
<div class="sect3">
<h4 id="alternative-state-mapping-with-immer"><a class="anchor" href="#alternative-state-mapping-with-immer"></a>==  Alternative state mapping with Immer</h4>
<div class="paragraph">
<p>It can be hard to think in immutable changes, especially if your team has a strong background in imperative programming. In this case, you may find the <a href="https://github.com/immerjs/immer">Immer</a> library convenient, which allows to produce immutable objects by manipulating a proxied draft. The same reducer can then be written as:</p>
</div>
<div class="paragraph">
<p><strong>watchlist-data.reducer.ts</strong> with Immer</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { produce } from 'immer';
...
case playbackActions.playbackFinished.type:
      return produce(state, draft =&gt; {
        const itemToUpdate = draft.items.find(item =&gt; item.movie.id == action.movieId);
        if (itemToUpdate) {
          itemToUpdate.playbackMinutes = action.stoppedAtMinute;
        }
      });</code></pre>
</div>
</div>
<div class="paragraph">
<p>Immer works out of the box with plain objects and arrays.</p>
</div>
</div>
<div class="sect3">
<h4 id="redux-devtools"><a class="anchor" href="#redux-devtools"></a>==  Redux devtools</h4>
<div class="paragraph">
<p>If the <code>StoreDevToolsModule</code> is instrumented as described above, you can use the browser extension <a href="https://github.com/reduxjs/redux-devtools">Redux devtools</a> to see all dispatched actions and the resulting state diff, as well as the current state, and even travel back in time by undoing actions.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<a class="image" href="images/ngrx-devtools.png"><img src="../_images/images/ngrx-devtools.png" alt="Redux Devtools"></a>
</div>
<div class="title">Figure 61. Redux devtools</div>
</div>
<div class="paragraph">
<p>Continue with <a href="guide-ngrx-effects">learning about effects</a></p>
</div>
<!-- toc disabled -->
</div>
<div class="sect3">
<h4 id="side-effects-with-ngrxeffects"><a class="anchor" href="#side-effects-with-ngrxeffects"></a>Side effects with NgRx/Effects</h4>
<div class="paragraph">
<p>Reducers are pure functions, meaning they are side-effect free and deterministic. Many actions however have side effects like sending messages or displaying a toast notification. NgRx encapsulates these actions in effects.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s build a recommended movies list so the user can add movies to their watchlist.</p>
</div>
</div>
<div class="sect3">
<h4 id="obtaining-the-recommendation-list-from-the-server"><a class="anchor" href="#obtaining-the-recommendation-list-from-the-server"></a>Obtaining the recommendation list from the server</h4>
<div class="paragraph">
<p>Create a module for recommendations and add stores and states as in the previous chapter. Add <code>EffectsModule.forRoot([])</code> to the imports in <code>AppModule</code> below <code>StoreModule.forRoot()</code>. Add effects to the feature module:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>ng generate effect recommendation/Recommendation -m recommendation/recommendation.module.ts</pre>
</div>
</div>
<div class="paragraph">
<p>We need actions for loading the movie list, success and failure cases:</p>
</div>
<div class="paragraph">
<p><strong>recommendation/actions/index.ts</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { createAction, props, union } from '@ngrx/store';
import { Movie } from 'src/app/watchlist/models/movies';

export const loadRecommendedMovies = createAction('[Recommendation List] Load movies');
export const loadRecommendedMoviesSuccess = createAction('[Recommendation API] Load movies success', props&lt;{movies: Movie[]}&gt;());
export const loadRecommendedMoviesFailure = createAction('[Recommendation API] Load movies failure', props&lt;{error: any}&gt;());

const actions = union({
    loadRecommendedMovies,
    loadRecommendedMoviesSuccess,
    loadRecommendedMoviesFailure
});

export type ActionsUnion = typeof actions;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the reducer, we use a loading flag so the UI can show a loading spinner. The store is updated with arriving data.</p>
</div>
<div class="paragraph">
<p><strong>recommendation/actions/index.ts</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">export interface State {
  items: Movie[];
  loading: boolean;
}

export const initialState: State = {
  items: [],
  loading: false
};

export function reducer(state = initialState, action: recommendationActions.ActionsUnion): State {
  switch (action.type) {
    case '[Recommendation List] Load movies':
      return {
        ...state,
        items: [],
        loading: true
      };

    case '[Recommendation API] Load movies failure':
      return {
        ...state,
          loading: false
      };

    case '[Recommendation API] Load movies success':
      return {
        ...state,
        items: action.movies,
        loading: false
      };

    default:
      return state;
  }
}

export const getAll = (state: State) =&gt; state.items;
export const isLoading = (state: State) =&gt; state.loading;</code></pre>
</div>
</div>
<div class="paragraph">
<p>We need an API service to talk to the server. For demonstration purposes, we simulate an answer delayed by one second:</p>
</div>
<div class="paragraph">
<p><code>recommendation/services/recommendation-api.service.ts</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">@Injectable({
  providedIn: 'root'
})
export class RecommendationApiService {

  private readonly recommendedMovies: Movie[] = [
    {
      id: 2,
      title: 'The Hunger Games',
      genre: 'sci-fi',
      releaseYear: 2012,
      runtimeMinutes: 144
    },
    {
      id: 4,
      title: 'Avengers: Endgame',
      genre: 'fantasy',
      releaseYear: 2019,
      runtimeMinutes: 181
    }
  ];

  loadRecommendedMovies(): Observable&lt;Movie[]&gt; {
    return of(this.recommendedMovies).pipe(delay(1000));
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here are the effects:</p>
</div>
<div class="paragraph">
<p><code>recommendation/services/recommendation-api.service.ts</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">@Injectable()
export class RecommendationEffects {

  constructor(
    private actions$: Actions,
    private recommendationApi: RecommendationApiService,
  ) { }

  @Effect()
  loadBooks$ = this.actions$.pipe(
    ofType(recommendationActions.loadRecommendedMovies.type),
    switchMap(() =&gt; this.recommendationApi.loadRecommendedMovies().pipe(
      map(movies =&gt; recommendationActions.loadRecommendedMoviesSuccess({ movies })),
      catchError(error =&gt; of(recommendationActions.loadRecommendedMoviesFailure({ error })))
    ))
  );
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Effects are always observables and return actions. In this example, we consume the actions observable provided by NgRx and listen only for the <code>loadRecommendedMovies</code> actions by using the <code>ofType</code> operator. Using <code>switchMap</code>, we map to a new observable, one that loads movies and maps the successful result to a new <code>loadRecommendedMoviesSuccess</code> action or a failure to <code>loadRecommendedMoviesFailure</code>. In a real application we would show a notification in the error case.</p>
</div>
</div>
<div class="sect3">
<h4 id="-10"><a class="anchor" href="#-10"></a>==</h4>
<div class="paragraph">
<p>If an effect should not dispatch another action, return an empty observable.
== ==</p>
</div>
<div class="paragraph">
<p><a href="guide-ngrx-entity">Continue reading how to simplify CRUD (Create Read Update Delete) operations using <code>@ngrx/entity</code></a>.</p>
</div>
<!-- toc disabled -->
</div>
<div class="sect3">
<h4 id="simplifying-crud-with-ngrxentity"><a class="anchor" href="#simplifying-crud-with-ngrxentity"></a>Simplifying CRUD with NgRx/Entity</h4>
<div class="paragraph">
<p>Most of the time when manipulating entries in the store, we like to create, add, update, or delete entries (CRUD). NgRx/Entity provides convenience functions if each item of a collection has an id property. Luckily all our entities already have this property.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s add functionality to add a movie to the <code>watchlist</code>. First, create the required action:</p>
</div>
<div class="paragraph">
<p><strong>recommendation/actions/index.ts</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">export const addToWatchlist = createAction('[Recommendation List] Add to watchlist',
    props&lt;{ watchlistItemId: number, movie: Movie, addedAt: Date }&gt;());</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="-11"><a class="anchor" href="#-11"></a>==</h4>
<div class="paragraph">
<p>You may wonder why the Date object is not created inside the reducer instead, since it should always be the current time. However, remember that reducers should be deterministic state machines&#8201;&#8212;&#8201;State A + Action B should always result in the same State C. This makes reducers easily testable.
== ==</p>
</div>
<div class="paragraph">
<p>Then, rewrite the <code>watchlistData</code> reducer to make use of NgRx/Entity:</p>
</div>
<div class="paragraph">
<p><strong>recommendation/actions/index.ts</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">export interface State extends EntityState&lt;WatchlistItem&gt; { <i class="conum" data-value="1"></i><b>(1)</b>
}

export const entityAdapter = createEntityAdapter&lt;WatchlistItem&gt;(); <i class="conum" data-value="2"></i><b>(2)</b>

export const initialState: State = entityAdapter.getInitialState(); <i class="conum" data-value="3"></i><b>(3)</b>

const entitySelectors = entityAdapter.getSelectors();

export function reducer(state = initialState, action: playbackActions.ActionsUnion | recommendationActions.ActionsUnion): State {
  switch (action.type) {
    case playbackActions.playbackFinished.type:
      const itemToUpdate = entitySelectors
      .selectAll(state) <i class="conum" data-value="4"></i><b>(4)</b>
      .find(item =&gt; item.movie.id == action.movieId);
      if (itemToUpdate) {
        return entityAdapter.updateOne({ <i class="conum" data-value="5"></i><b>(5)</b>
          id: itemToUpdate.id,
          changes: { playbackMinutes: action.stoppedAtMinute } <i class="conum" data-value="6"></i><b>(6)</b>
        }, state);
      } else {
        return state;
      }

    case recommendationActions.addToWatchlist.type:
      return entityAdapter.addOne({id: action.watchlistItemId, movie: action.movie, added: action.addedAt, playbackMinutes: 0}, state);

    default:
      return state;
  }
}


export const getAllItems = entitySelectors.selectAll;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>NgRx/Entity requires state to extend <code>EntityState</code>. It provides a list of ids and a dictionary of id &#8658; entity entries</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The entity adapter provides data manipulation operations and selectors</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The state can be initialized with <code>getInitialState()</code>, which accepts an optional object to define any additional state beyond <code>EntityState</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><code>selectAll</code> returns an array of all entities</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>All adapter operations consume the state object as the last argument and produce a new state</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Update methods accept a partial change definition; you don&#8217;t have to clone the object</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This concludes the tutorial on NgRx. If you want to learn about advanced topics such as selectors with arguments, testing, or router state, head over to the <a href="https://ngrx.io/docs">official NgRx documentation</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cookbook-2"><a class="anchor" href="#cookbook-2"></a>Cookbook</h2>
<div class="sectionbody">
<!-- toc disabled -->
<div class="sect3">
<h4 id="abstract-class-store"><a class="anchor" href="#abstract-class-store"></a>Abstract Class Store</h4>
<div class="paragraph">
<p>The following solution presents a base class for implementing stores which handle state and its transitions.
Working with the base class achieves:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>common API across all stores</p>
</li>
<li>
<p>logging (when activated in the constructor)</p>
</li>
<li>
<p>state transitions are asynchronous by design - sequential order problems are avoided</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Listing 77. Usage Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">@Injectable()
export class ModalStore extends Store&lt;ModalState&gt; {

  constructor() {
    super({ isOpen: false }, !environment.production);
  }

  closeDialog() {
    this.dispatchAction('Close Dialog', (currentState) =&gt; ({...currentState, isOpen: false}));
  }

  openDialog() {
    this.dispatchAction('Open Dialog', (currentState) =&gt; ({...currentState, isOpen: true}));
  }

}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Listing 78. Abstract Base Class Store</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">import { OnDestroy } from '@angular/core';
import { BehaviorSubject } from 'rxjs/BehaviorSubject';
import { Observable } from 'rxjs/Observable';
import { intersection, difference } from 'lodash';
import { map, distinctUntilChanged, observeOn } from 'rxjs/operators';
import { Subject } from 'rxjs/Subject';
import { queue } from 'rxjs/scheduler/queue';
import { Subscription } from 'rxjs/Subscription';

interface Action&lt;T&gt; {
  name: string;
  actionFn: (state: T) =&gt; T;
}

/** Base class for implementing stores. */
export abstract class Store&lt;T&gt; implements OnDestroy {

  private actionSubscription: Subscription;
  private actionSource: Subject&lt;Action&lt;T&gt;&gt;;
  private stateSource: BehaviorSubject&lt;T&gt;;
  state$: Observable&lt;T&gt;;

  /**
   * Initializes a store with initial state and logging.
   * @param initialState Initial state
   * @param logChanges When true state transitions are logged to the console.
   */
  constructor(initialState: T, public logChanges = false) {
    this.stateSource = new BehaviorSubject&lt;T&gt;(initialState);
    this.state$ = this.stateSource.asObservable();
    this.actionSource = new Subject&lt;Action&lt;T&gt;&gt;();

    this.actionSubscription = this.actionSource.pipe(observeOn(queue)).subscribe(action =&gt; {
      const currentState = this.stateSource.getValue();
      const nextState = action.actionFn(currentState);

      if (this.logChanges) {
        this.log(action.name, currentState, nextState);
      }

      this.stateSource.next(nextState);
    });
  }

  /**
   * Selects a property from the stores state.
   * Will do distinctUntilChanged() and map() with the given selector.
   * @param selector Selector function which selects the needed property from the state.
   * @returns Observable of return type from selector function.
   */
  select&lt;TX&gt;(selector: (state: T) =&gt; TX): Observable&lt;TX&gt; {
    return this.state$.pipe(
      map(selector),
      distinctUntilChanged()
    );
  }

  protected dispatchAction(name: string, action: (state: T) =&gt; T) {
    this.actionSource.next({ name, actionFn: action });
  }

  private log(actionName: string, before: T, after: T) {
    const result: { [key: string]: { from: any, to: any} } = {};
    const sameProbs = intersection(Object.keys(after), Object.keys(before));
    const newProbs = difference(Object.keys(after), Object.keys(before));
    for (const prop of newProbs) {
      result[prop] = { from: undefined, to: (&lt;any&gt;after)[prop] };
    }

    for (const prop of sameProbs) {
      if ((&lt;any&gt;before)[prop] !==  (&lt;any&gt;after)[prop]) {
        result[prop] = { from: (&lt;any&gt;before)[prop], to: (&lt;any&gt;after)[prop] };
      }
    }

    console.log(this.constructor.name, actionName, result);
  }

  ngOnDestroy() {
    this.actionSubscription.unsubscribe();
  }

}</code></pre>
</div>
</div>
<!-- toc disabled -->
</div>
<div class="sect3">
<h4 id="add-electron-to-an-angular-application-using-angular-cli"><a class="anchor" href="#add-electron-to-an-angular-application-using-angular-cli"></a>Add Electron to an Angular application using Angular CLI</h4>
<div class="paragraph">
<p>This cookbook recipe explains how to integrate Electron in an Angular 10+ application. <a href="https://electronjs.org/">Electron</a> is a framework for creating native applications with web technologies like JavaScript, HTML, and CSS. As an example, very well known applications as Visual Studio Code, Atom, Slack or Skype (and many more) are using Electron too.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
At the moment of this writing Angular 11.2.0, Electron 11.2.3 and Electron-builder 22.9.1 were the versions available.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Here are the steps to achieve this goal. Follow them in order.</p>
</div>
</div>
<div class="sect3">
<h4 id="add-electron-and-other-relevant-dependencies"><a class="anchor" href="#add-electron-and-other-relevant-dependencies"></a>Add Electron and other relevant dependencies</h4>
<div class="paragraph">
<p>There are two different approaches to add the dependencies in the <code>package.json</code> file:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Writing the dependencies directly in that file.</p>
</li>
<li>
<p>Installing using <code>npm install</code> or <code>yarn add</code>.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Please remember if the project has a <code>package-lock.json</code> or <code>yarn.lock</code> file use <code>npm</code> or <code>yarn</code> respectively.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In order to add the dependencies directly in the <code>package.json</code> file, include the following lines in the <code>devDependencies</code> section:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">"devDependencies": {
...
    "electron": "^11.2.3",
    "electron-builder": "^22.9.1",
...
},</code></pre>
</div>
</div>
<div class="paragraph">
<p>As indicated above, instead of this <code>npm install</code> can be used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ npm install -D electron electron-builder</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or with <code>yarn</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ yarn add -D electron electron-builder</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="create-the-necessary-typescript-configurations"><a class="anchor" href="#create-the-necessary-typescript-configurations"></a>Create the necessary typescript configurations</h4>
<div class="paragraph">
<p>In order to initiate electron in an angular app we need to modify the <code>tsconfig.json</code> file and create a <code>tsconfig.serve.json</code> and a <code>tsconfig.base.json</code> in the root folder.</p>
</div>
</div>
<div class="sect3">
<h4 id="tsconfig-json"><a class="anchor" href="#tsconfig-json"></a>==  <code>tsconfig.json</code></h4>
<div class="paragraph">
<p>This file needs to be modified to create references to <code>./src/tsconfig.app.json</code> and <code>./src/tsconfig.spec.json</code> to support different configurations.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "files": [],
  "references": [
    {
      "path": "./src/tsconfig.app.json"
    },
    {
      "path": "./src/tsconfig.spec.json"
    }
  ]
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="tsconfig-app-json"><a class="anchor" href="#tsconfig-app-json"></a>==  <code>tsconfig.app.json</code></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "extends": "../tsconfig.base.json",
  "compilerOptions": {
    "outDir": "../app",
    "module": "es2015",
    "baseUrl": "",
    "types": []
  },
  "include": [
    "**/*.ts",
  ],
  "exclude": [
    "**/*.spec.ts"
  ],
  "angularCompilerOptions": {
    "fullTemplateTypeCheck": true,
    "strictInjectionParameters": true,
    "preserveWhitespaces": true
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="tsconfig-spec-json"><a class="anchor" href="#tsconfig-spec-json"></a>==  <code>tsconfig.spec.json</code></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "extends": "../tsconfig.base.json",
  "compilerOptions": {
    "outDir": "../spec",
    "module": "commonjs",
    "types": [
      "jasmine",
      "node"
    ]
  },
  "files": [
    "test.ts",
  ],
  "include": [
    "**/*.spec.ts",
    "**/*.d.ts"
  ],
  "exclude": [
    "dist",
    "release",
    "node_modules"
  ]
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="tsconfig-base-json"><a class="anchor" href="#tsconfig-base-json"></a>==  <code>tsconfig.base.json</code></h4>
<div class="paragraph">
<p>This is shared between <code>tsconfig.app.json</code> and <code>tsconfig.spec.json</code> and it will be extended on each config file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "compileOnSave": false,
  "compilerOptions": {
    "outDir": "./dist",
    "sourceMap": true,
    "declaration": false,
    "moduleResolution": "node",
    "emitDecoratorMetadata": true,
    "experimentalDecorators": true,
    "target": "es5",
    "typeRoots": [
      "node_modules/@types"
    ],
    "lib": [
      "es2017",
      "es2016",
      "es2015",
      "dom"
    ]
  },
  "files": [
    "electron-main.ts"
    "src/polyfills.ts"
  ],
  "include": [
    "src/**/*.d.ts"
  ],
  "exclude": [
    "node_modules"
  ]
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="tsconfig-serve-json"><a class="anchor" href="#tsconfig-serve-json"></a>==  <code>tsconfig.serve.json</code></h4>
<div class="paragraph">
<p>In the root, <code>tsconfig.serve.json</code> needs to be created. This typescript config file is going to be used when we serve electron:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "compilerOptions": {
    "outDir": ".",
    "sourceMap": true,
    "declaration": false,
    "moduleResolution": "node",
    "emitDecoratorMetadata": true,
    "experimentalDecorators": true,
    "target": "es5",
    "typeRoots": [
      "node_modules/@types"
    ],
    "lib": [
      "es2017",
      "dom"
    ]
  },
  "include": [
    "electron-main.ts"
  ],
  "exclude": [
    "node_modules",
    "**/*.spec.ts"
  ]
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="add-electron-build-configuration"><a class="anchor" href="#add-electron-build-configuration"></a>Add Electron build configuration</h4>
<div class="paragraph">
<p>In order to configure electron builds properly we need to create a new json on our application, let&#8217;s call it electron-builder.json. For more information and fine tuning please refer to the <a href="https://www.electron.build/configuration/configuration">Electron Builder official documentation</a>.</p>
</div>
<div class="paragraph">
<p>The contents of the file will be something similar to the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "productName": "devon4ngElectron",
  "directories":{
    "output": "./builder-release"
  },
  "win": {
    "icon": "dist/assets/icons",
    "target": [
      "portable"
    ]
  },
  "mac": {
    "icon": "dist/assets/icons",
    "target": [
      "dmg"
    ]
  },
  "linux": {
    "icon": "dist/assets/icons",
    "target": [
      "AppImage"
    ]
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are two important things in this files:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>"output": this is where electron builder is going to build our application</p>
</li>
<li>
<p>"icon": in every OS possible there is an icon parameter, the route to the icon folder that will be created after building with angular needs to be used here. This will make it so the electron builder can find the icons and build.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="modify-angular-json"><a class="anchor" href="#modify-angular-json"></a>Modify angular.json</h4>
<div class="paragraph">
<p><code>angular.json</code> has to to be modified so the project is build inside <em>/dist</em> without an intermediate folder.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "architect": {
    "build": {
      "outputPath": "dist"
    }
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="create-the-electron-window-in-electron-main-ts"><a class="anchor" href="#create-the-electron-window-in-electron-main-ts"></a>Create the electron window in <code>electron-main.ts</code></h4>
<div class="paragraph">
<p>In order to use electron, a file needs to be created at the root of the application (<code>main.ts</code>). This file will create a window with different settings checking if we are using <code>--serve</code> as an argument:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">import { app, BrowserWindow } from 'electron';
import * as path from 'path';
import * as url from 'url';

let win: any;
const args: any = process.argv.slice(1);
const serve: any = args.some((val) =&gt; val == '--serve');

const createWindow:any = ()=&gt;{
  // Create the browser window.
  win = new BrowserWindow({
    fullscreen: true,
    webPreferences: {
      nodeIntegration: true,
    }
  });

  if (serve) {
    require('electron-reload')(__dirname, {
      electron: require(`${__dirname}/node_modules/electron`)
    });
    win.loadURL('http://localhost:4200');
  } else {
    win.loadURL(
      url.format({
        pathname: path.join(__dirname, 'dist/index.html'),
        protocol: 'file:',
        slashes: true
      })
    );
  }

  if (serve) {
    win.webContents.openDevTools();
  }

  // Emitted when the window is closed.
  win.on('closed', () =&gt; {
    // Dereference the window object, usually you would store window
    // in an array if your app supports multi windows, this is the time
    // when you should delete the corresponding element.
    // tslint:disable-next-line:no-null-keyword
    win = null;
  });
}

try {
  // This method will be called when Electron has finished
  // initialization and is ready to create browser windows.
  // Some APIs can only be used after this event occurs.
  app.on('ready', createWindow);

   // Quit when all windows are closed.
  app.on('window-all-closed', () =&gt; {
    // On OS X it is common for applications and their menu bar
    // to stay active until the user quits explicitly with Cmd + Q
    if (process.platform !==  'darwin') {
      app.quit();
    }
  });

   app.on('activate', () =&gt; {
    // On OS X it's common to re-create a window in the app when the
    // dock icon is clicked and there are no other windows open.
    if (win == null) {
      createWindow();
    }
  });
} catch (e) {
  // Catch Error
  // throw e;
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="add-the-electron-window-and-improve-the-package-json-scripts"><a class="anchor" href="#add-the-electron-window-and-improve-the-package-json-scripts"></a>Add the electron window and improve the <code>package.json</code> scripts</h4>
<div class="paragraph">
<p>Inside <code>package.json</code> the electron window that will be transformed to <code>electron-main.js</code> when building needs to be added.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  ....
  "main": "electron-main.js",
  "scripts": {...}
  ....
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>scripts</code> section in the <code>package.json</code> can be improved to avoid running too verbose commands. As a very complete example we can take a look to the My Thai Star&#8217;s <code>scripts</code> section and copy the lines useful in your project. In any case, at least we recommend to add the following lines:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">  "scripts": {
    "ng": "ng",
    "start": "ng serve",
    "build": "ng build",
    "test": "ng test",
    "lint": "ng lint",
    "e2e": "ng e2e",
    "electron:tsc": "tsc -p tsconfig.serve.json",
    "electron:run": "npm run electron:tsc &amp;&amp; ng build --base-href ./ &amp;&amp; npx electron .",
    "electron:serve": "npm run electron:tsc &amp;&amp; npx electron . --serve",
    "electron:pack": "npm run electron:tsc &amp;&amp; electron-builder --dir --config electron-builder.json",
    "electron:build": "npm run electron:tsc &amp;&amp; electron-builder --config electron-builder.json build"
  },</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>electron:</code> scripts do the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>electron:tsc</code>: Compiles electron TS files.</p>
</li>
<li>
<p><code>electron:run</code>: Serves Angular app and runs electron.</p>
</li>
<li>
<p><code>electron:serve</code>: Serves electron with an already running angular app (i.e. a <code>ng serve</code> command running on another terminal).</p>
</li>
<li>
<p><code>electron:pack</code>: Packs electron app.</p>
</li>
<li>
<p><code>electron:build</code>: Builds electron app.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="add-electron-to-an-angular-application-using-nx-cli"><a class="anchor" href="#add-electron-to-an-angular-application-using-nx-cli"></a>Add Electron to an Angular application using Nx CLI</h4>
<div class="paragraph">
<p>Creating an Electron app is very easy and straight-forward if you are using Nx CLI. As a pre-requisite, you should already have an application in your Nx workspace which you want to run as a front-end in your Electron app. (You can follow <a href="https://github.com/devonfw/devon4ng/wiki/guide-creating-angular-app-with-nx-cli">this guide</a> if you want to get started with Nx).</p>
</div>
<div class="paragraph">
<p>Follow the steps below to develop an Electron app in your Nx workspace:</p>
</div>
</div>
<div class="sect3">
<h4 id="install-nx-electron"><a class="anchor" href="#install-nx-electron"></a>Install <code>nx-electron</code></h4>
<div class="paragraph">
<p>Install <code>nx-electron</code> using the command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>  npm install -D nx-electron</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will add the packages <code>electron</code> and <code>nx-electron</code> as dev dependencies to your Nx workspace. This will help us generate our Electron app in the next step.</p>
</div>
</div>
<div class="sect3">
<h4 id="generate-your-electron-app"><a class="anchor" href="#generate-your-electron-app"></a>Generate your Electron app</h4>
<div class="paragraph">
<p>Once you have installed <code>nx-electron</code>, you can generate your electron app using the command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>  nx g nx-electron:app &lt;electron-app-name&gt; --frontendProject=&lt;frontend-app-name&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>And that is it! You have generated your Electron app already. All the configuration files (<code>tsconfig.*</code>) are generated for you under &lt;electron-app-name&gt; in your Nx workspace.</p>
</div>
</div>
<div class="sect3">
<h4 id="serving-your-app"><a class="anchor" href="#serving-your-app"></a>Serving your app</h4>
<div class="paragraph">
<p>You can use this command to serve your Electron app:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>  nx run-many --target=serve --projects=&lt;frontend-app-name&gt;,&lt;electron-app-name&gt; --parallel</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you see a blank application, it is because the Electron app was served before the front-end was served. To avoid this, you can serve the front-end and back-end separately, (that is, serve the back-end only after the front-end is served).</p>
</div>
</div>
<div class="sect3">
<h4 id="building-your-app"><a class="anchor" href="#building-your-app"></a>Building your app</h4>
<div class="paragraph">
<p>The command for building your Electron app in Nx is similar to the <code>serve</code> command above, you only change the target from <code>serve</code> to <code>build</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>  nx run-many --target=build --projects=&lt;frontend-app-name&gt;,&lt;electron-app-name&gt; --parallel</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="packaging-your-app"><a class="anchor" href="#packaging-your-app"></a>Packaging your app</h4>
<div class="paragraph">
<p>Make sure you have build your app before you try to package it using the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>  nx run &lt;electron-app-name&gt;:package [--options]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The options that can be passed can be found <a href="https://github.com/bennymeg/nx-electron/blob/master/src/builders/package/schema.json">here</a>.</p>
</div>
<div class="paragraph">
<p>You can find a working example of an Electron app in <a href="https://github.com/devonfw-sample/devon4ts-samples/tree/master/apps/angular-electron-test">devon4ts-samples</a>.</p>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/devon4ng.wiki/master-devon4ng.adoc - include::guide-angular-mock-service.adoc.adoc[]</p>
</div>
<!-- toc disabled -->
</div>
<div class="sect3">
<h4 id="testing-e2e-with-cypress"><a class="anchor" href="#testing-e2e-with-cypress"></a>Testing e2e with Cypress</h4>
<div class="paragraph">
<p>This guide will cover the basics of e2e testing using Cypress.</p>
</div>
<div class="paragraph">
<p>Cypress is a framework “all in one” that provides the necessary libraries to write specific e2e tests, without the need of Selenium.</p>
</div>
<div class="paragraph">
<p>Why Cypress?</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Uses JavaScript</p>
</li>
<li>
<p>It works directly with the browser so the compatibility with the front-end framework the project uses (in this case Angular) is not a problem.</p>
</li>
<li>
<p>Easy cross browser testing</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="setup-2"><a class="anchor" href="#setup-2"></a>Setup</h4>
<div class="paragraph">
<p><strong>Install</strong>
First of all we need to install it, we can use <code>npm install</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ npm install -D cypress</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or we can install it with <code>yarn</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ yarn add -D cypress</code></pre>
</div>
</div>
<div class="paragraph">
<p>We need to run Cypress in order to get the folder tree downloaded, then create a <code>tsconfig.json</code> file inside <code>cypress folder</code> to add the typescript configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ . /node_modules/.bin/cypress open</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Listing 79. <code>tsconfig.json</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "compilerOptions": {
    "strict": true,
    "baseUrl": "../node_modules",
    "target": "es5",
    "lib": ["es5", "dom"],
    "types": ["cypress"]
  },
  "include": [
    "**/*.ts"
  ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong><code>BaseUrl</code></strong></p>
</div>
<div class="paragraph">
<p>Let&#8217;s setup the base URL so when we run the tests cypress will "navigate" to the right place, go to <code>cypress.json</code> on the root of the project.</p>
</div>
<div class="listingblock">
<div class="title">Listing 80. cypress.json</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "baseUrl": "http://localhost:4200"
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="files-structure"><a class="anchor" href="#files-structure"></a>Files / Structure</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">/cypress
  tsconfig.json
  /fixtures
    - example.json
  /integration
    - button.spec.ts
    - test.spec.ts
    /examples
  /plugins
    - index.js
  /support
    - commands.js
    - index.js</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>tsconfig.json</code> for typescript configuration.</p>
</div>
<div class="paragraph">
<p><code>fixtures</code> to store our mock data or files (images, mp3&#8230;&#8203;) to use on our tests.</p>
</div>
<div class="paragraph">
<p><code>integration</code> is where our tests go, by default it comes with an examples folder with tested samples.</p>
</div>
<div class="paragraph">
<p><code>plugins</code> is where the configuration files of the plugins go.</p>
</div>
<div class="paragraph">
<p><code>support</code> to add custom commands.</p>
</div>
</div>
<div class="sect3">
<h4 id="-12"><a class="anchor" href="#-12"></a>== =</h4>
<div class="paragraph">
<p>If you are using Nx, it automatically generates a e2e cypress project for every project that you generate. So you already get the configuration files like <code>tsconfig.json</code> and <code>cypress.json</code> and also get the folder structure described above. This helps you focus more on writing your tests rather than setting up Cypress.</p>
</div>
</div>
<div class="sect3">
<h4 id="-13"><a class="anchor" href="#-13"></a>== =</h4>

</div>
<div class="sect3">
<h4 id="tests"><a class="anchor" href="#tests"></a>Tests</h4>
<div class="paragraph">
<p>The structure is the same than Mocha.</p>
</div>
<div class="paragraph">
<p>First, we create a file, for example <code>form.spec.ts</code>, inside we define a context to group all our tests referred to the same subject.</p>
</div>
<div class="listingblock">
<div class="title">Listing 81. form.spec.ts</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">context('Button page', () =&gt; {
  beforeEach(() =&gt; {
    cy.visit('/');
  });
  it('should have button',()=&gt;{
    cy.get('button').should('exist');
  });
  it('should contain PRESS',()=&gt;{
    cy.contains('button', 'PRESS');
  });
});</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title"><code>beforeEach</code></div>
<p>Visit '/' before every test.</p>
</div>
<div class="paragraph">
<div class="title">it</div>
<p>Inside we write the test.</p>
</div>
<div class="paragraph">
<p>The result:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/cypress/contextImg.jpg" alt="contextImg">
</div>
</div>
<div class="paragraph">
<p>For more info check <a href="docs.cypress.io/guides/core-concepts/writing-and-organizing-tests.html#Folder-Structure">Cypress documentation</a></p>
</div>
<div class="paragraph">
<p>On <a href="https://github.com/cypress-io/cypress-example-kitchensink">kitchensink</a>
you can find an official cypress demo with all the commands being used.</p>
</div>
</div>
<div class="sect3">
<h4 id="fixtures"><a class="anchor" href="#fixtures"></a>Fixtures</h4>
<div class="paragraph">
<p>We use fixtures to mock data, it can be a json, an image, video&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "name": "Dummy name",
  "phone": 999 99 99 99,
  "body": "Mock data"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can store multiple mocks on the same fixture file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "create":{"name": "e2etestBox"},
  "boxFruit":{
    "uuid":"3376339576e33dfb9145362426a33333",
    "name":"e2etestBox",
    "visibility":true,
    "items":[
      {"name":"apple","units":3},
      {"name":"kiwi","units":2},
    ]
  },
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To access data we don&#8217;t need to import any file, we just call <code>cy.fixture(filename)</code> inside the <code>**.spec.ts</code>. We can name it as we want.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">cy.fixture('box.json').as('fruitBox')</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>cy.fixture('box.json')</code> we get access to <code>box.json</code>
<code>.as(fruitBox)</code> is used to create an alias <code>(fruitBox)</code> to the fixture.</p>
</div>
<div class="paragraph">
<p>For more info check <a href="https://docs.cypress.io/api/commands/fixture.html#Syntax">Fixtures documentation</a></p>
</div>
</div>
<div class="sect3">
<h4 id="request-route"><a class="anchor" href="#request-route"></a>Request / Route</h4>
<div class="paragraph">
<p>With cypress you can test your application with real data or with mocks.</p>
</div>
<div class="paragraph">
<p>Not using mocks guarantees that your tests are real e2e test but makes them vulnerable to external issues.
When you mock data you don&#8217;t know exactly if the data and the structure received from the backend is correct because you are forcing a mock on the response, but you can avoid external issues, run test faster and have better control on the structure and status.</p>
</div>
<div class="paragraph">
<p>To get more information go to <a href="https://docs.cypress.io/guides/guides/network-requests.html#Testing-Strategies">Testing Strategies</a></p>
</div>
</div>
<div class="sect3">
<h4 id="route"><a class="anchor" href="#route"></a>Route</h4>
<div class="paragraph">
<p>Cypress can intercept a XHR request and interact with it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">cy.server();
cy.route(
  'GET',
  '/apiUrl/list',
  [{"name":"apple", "units":3},{"name":"kiwi", "units":2}]
)</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>cy.server(options)</code> start a server to interact with the responses.</p>
</div>
<div class="ulist">
<div class="title"><code>cy.route(options)</code> intercepts a <code>XMLHttpRequests</code></div>
<ul>
<li>
<p>method <code>GET</code></p>
</li>
<li>
<p>URL <code>/apiUrl/list'</code></p>
</li>
<li>
<p>response <code>[{"name":"apple", "units":3},{"name":"kiwi", "units":2}]</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Waits</strong></p>
</div>
<div class="paragraph">
<p>Every cypress action has a default await time to avoid asynchronous issues, but this time can be short for some particular actions like API calls, for those cases we can use <code>cy.wait()</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">cy.server();
cy.route('/apiUrl/list').as('list');
cy.visit('/boxList');
cy.wait('@list');</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can find more information about <code>cy.wait()</code> <a href="https://docs.cypress.io/guides/guides/network-requests.html#Waiting">here</a></p>
</div>
<div class="paragraph">
<p>To mock data with fixtures:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">cy.fixture('box')
  .then(({boxFruit}) =&gt; {
    cy.route(
      'GET',
      '/apiUrl/list',
      boxFruit
    ).as('boxFruit');
    cy.get('#button').click();
    cy.wait('@journalsList');
    cy.get('#list').contains('apple');
  })</code></pre>
</div>
</div>
<div class="paragraph">
<p>We get <code>boxFruit</code> data from the box fixture and then we mock the API call with it so now the response of the call is <code>boxFruit</code> object.
When the button is clicked, it waits to receive the response of the call and then checks if the list contains one of the elements of the <code>fruitBox</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="request"><a class="anchor" href="#request"></a>Request</h4>
<div class="paragraph">
<p>Make a HTTP request.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">cy.server();
cy.request('http://localhost:4200/')
  .its('body')
  .should('include', '&lt;h1&gt;Welcome to Devon4ngAngularElementsTest!&lt;/h1&gt;');</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we have <code>'http://localhost:4200'</code> as <code>baseUrl</code> on <code>cypress.json</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">cy.server();
cy.request('/')
  .its('body')
  .should('include', '&lt;h1&gt;Welcome to Devon4ngAngularElementsTest!&lt;/h1&gt;');
// Goes to http://localhost:4200/</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can add other options, like we can send the body of a form.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">cy.server();
cy.request({
  method: 'POST',
  url: '/send',
  form: true,
  body: {
    name: 'name task',
    description: 'description of the task'
  }
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="custom-commands"><a class="anchor" href="#custom-commands"></a>Custom commands</h4>
<div class="paragraph">
<p>If you see yourself writing the same test more than once (login is a common one), you can create a custom command to make things faster.</p>
</div>
<div class="paragraph">
<p><code>Cypress.Commands.add('name', ()&#8658;{})</code> to create the test.</p>
</div>
<div class="listingblock">
<div class="title">Listing 82. commands.ts</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">Cypress.Commands.add('checkPlaceholder', (name) =&gt; {
  cy.get(`[name='${name}']`).click();
  cy.get('mat-form-field.mat-focused').should('exist');
});</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">index.ts</div>
<p>To use the commands we need to import the files on support/index.ts</p>
</div>
<div class="listingblock">
<div class="title">Listing 83. index.ts</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">import './commands'
import './file1'
import './folder/file2'</code></pre>
</div>
</div>
<div class="paragraph">
<p>index.ts is where all our custom commands files unite so Cypress knows where to find them.</p>
</div>
<div class="paragraph">
<p>And as we are using typescript we need to define a <code>namespace</code>, <code>interface</code> and define our function.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>index.d.ts</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>declare namespace Cypress {
  interface Chainable&lt;Subject&gt; {
    checkPlaceholder(name:string):Chainable&lt;void&gt;
  }
}</pre>
</div>
</div>
<div class="paragraph">
<p>Check <a href="https://docs.cypress.io/guides/tooling/typescript-support.html#Types-for-custom-commands">typescript custom commands</a></p>
</div>
</div>
<div class="sect3">
<h4 id="cross-browser-testing"><a class="anchor" href="#cross-browser-testing"></a>Cross browser testing</h4>
<div class="paragraph">
<p>By default the browser used by Cypress is Chrome, it has compatibility with it&#8217;s family browsers (including Microsoft Edge) and has beta support for Mozilla Firefox.</p>
</div>
<div class="paragraph">
<p>To change the browser on the panel we can do it by selecting the desired one on the browsers tab before running the spec file.</p>
</div>
<div class="paragraph">
<p><code>Cypress will detect and display, except electron, only the browsers that you have already installed on your machine.</code></p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/cypress/browserTab.jpg" alt="browserTab">
</div>
</div>
<div class="paragraph">
<p>Once the browser is selected, you can run your tests.</p>
</div>
<div class="paragraph">
<p>To change the browser on the automatic test run, you can add a flag on the node command</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cypress run --browser edge</code></pre>
</div>
</div>
<div class="paragraph">
<p>Only if we use the <code>cypress run</code> command.</p>
</div>
<div class="paragraph">
<p>Or we can change the script file.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>cypress/script.js</code></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">const runTests= async ()=&gt;{
  ...
  const {totalFailed} = await cypress.run({browser:'edge'});
  ...
};</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="https://docs.cypress.io/guides/guides/cross-browser-testing.html#Continuous-Integration-Strategies">Cypress documentation</a></p>
</div>
</div>
<div class="sect3">
<h4 id="viewport"><a class="anchor" href="#viewport"></a>Viewport</h4>
<div class="paragraph">
<p>Cypress allow us to create tests depending on the Viewport, so we can test responsiveness.</p>
</div>
<div class="paragraph">
<p>There are different ways to use it:</p>
</div>
<div class="paragraph">
<p>Inside a test case</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Typescript hljs" data-lang="Typescript">it('should change title when viewport is less than 320px', ()=&gt;{
  cy.get('.title-l').should('be.visible');
  cy.get('.title-s').should('not.be.visible');
  cy.viewport(320, 480);
  cy.get('.title-l').should('not.be.visible');
  cy.get('.title-s').should('be.visible');
})</code></pre>
</div>
</div>
<div class="paragraph">
<p>Passing the configuration as an option</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Typescript hljs" data-lang="Typescript">describe('page display on medium size screen', {
  viewportHeight: 1000,
  viewportWidth: 400
}, () =&gt; {
  ...
})</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or we can set a default</p>
</div>
<div class="ulist">
<ul>
<li>
<p>cypress.json</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>...
{
 "viewportHeight": 1000
 "viewportWidth": 400,
}
...</pre>
</div>
</div>
<div class="paragraph">
<p><a href="https://docs.cypress.io/api/commands/viewport.html#Syntax">Viewport documentation</a></p>
</div>
</div>
<div class="sect3">
<h4 id="test-retries"><a class="anchor" href="#test-retries"></a>Test retries</h4>
<div class="paragraph">
<p>We can get false negatives intermittently due external issues that can affect our tests, because of that we can add, in the configuration, a retries entry so Cypress can run again a certain failed test the selected number of times to verify that the error is real.</p>
</div>
<div class="paragraph">
<p>We can set retries for run or open mode.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>cypress.json</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>...
"retries": {
    "runMode": 3,
    "openMode": 3
  }
...</pre>
</div>
</div>
<div class="paragraph">
<p>The retries can be configured on the <code>cypress.json</code> or directly on a specific test.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Typescript hljs" data-lang="Typescript">it('should get button', {
  retries: {
    runMode: 2,
    openMode: 2
  }
}, () =&gt; {
  ...
})</code></pre>
</div>
</div>
<div class="paragraph">
<p>This retries those not shown on the test log.</p>
</div>
<div class="paragraph">
<p>Check more on <a href="https://docs.cypress.io/guides/guides/test-retries.html#Introduction">retries documentation</a></p>
</div>
</div>
<div class="sect3">
<h4 id="reporter"><a class="anchor" href="#reporter"></a>Reporter</h4>
<div class="paragraph">
<p>The tests results appear on the terminal, but to have a more friendly view we can add a reporter.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/cypress/reporter.jpg" alt="reporter">
</div>
</div>
</div>
<div class="sect3">
<h4 id="mochawesome"><a class="anchor" href="#mochawesome"></a>Mochawesome</h4>
<div class="paragraph">
<p>In this case we are going to use Mochawesome, initially its a Mocha reporter but as Cypress uses Mocha it works the same.</p>
</div>
<div class="paragraph">
<p><strong>Install</strong></p>
</div>
<div class="paragraph">
<p>npm</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">npm install --save-dev mochawesome</code></pre>
</div>
</div>
<div class="paragraph">
<p>yarn</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">yarn add -D mochawesome</code></pre>
</div>
</div>
<div class="paragraph">
<p>To run the reporter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cypress run --reporter mochawesome</code></pre>
</div>
</div>
<div class="paragraph">
<p>Mochawesome saves by default the generated files on <em>`./mochawesome-report/`</em> but we can add options to change this behavior.</p>
</div>
<div class="paragraph">
<p>Options can be passed to the reporter in two ways</p>
</div>
<div class="paragraph">
<p>Using a flag</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cypress run --reporter mochawesome --reporter-options reportDir=report</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or on <em>cypress.json</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "baseUrl": "http://localhost:4200",
  "reporter": "mochawesome",
  "reporterOptions": {
    "overwrite": false,
    "html": false,
    "json": true,
    "reportDir": "cypress/report"
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>Overwrite:false</code> to not overwrite every **:spec.ts test report, we want them to create a merged version later.</p>
</div>
<div class="paragraph">
<p><code>reportDir</code> to set a custom directory.</p>
</div>
<div class="paragraph">
<p><code>html:false</code> because we don&#8217;t need it.</p>
</div>
<div class="paragraph">
<p><code>json:true</code> to save them on json.</p>
</div>
<div class="paragraph">
<p>Mochawesome only creates the html file of the last .spec.ts file that the tests run, that&#8217;s why we don&#8217;t generate html reports directly, in order to stack them all on the same final html we need to merge the reports.</p>
</div>
<div class="paragraph">
<p>Check the <a href="https://www.npmjs.com/package/mochawesome-report-generator">mochawesome documentation</a></p>
</div>
<div class="paragraph">
<p><strong><code>mochawesome-merge</code></strong></p>
</div>
<div class="paragraph">
<p><code>Mochawesome-merge</code> is a library that helps us to merge the different json.</p>
</div>
<div class="paragraph">
<p>npm</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">npm install --save-dev mochawesome-merge
npm install --save-dev mochawesome-report-generator</code></pre>
</div>
</div>
<div class="paragraph">
<p>yarn</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">yarn add -D mochawesome-merge
yarn add -D mochawesome-report-generator</code></pre>
</div>
</div>
<div class="paragraph">
<p>To merge the files we execute this command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mochawesome-merge cypress/report/*.json &gt; cypress/reportFinal.json</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>reportFinal.json</code> is the result of this merge, whit that we have the data of all the spec files in one json.</p>
</div>
<div class="paragraph">
<p>We can also automate the test, merge and conversion to html using a script.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">const cypress = require('cypress');
const fse = require('fs-extra');
const { merge } = require('mochawesome-merge');
const generator = require('mochawesome-report-generator');
const runTests= async ()=&gt;{
  await fse.remove('mochawesome-report');
  await fse.remove('cypress/report');
  const {totalFailed} = await cypress.run();
  const reporterOptions = {
    files: ["cypress/report/*.json"]
  };
  await generateReport(reporterOptions);
  if(totalFailed !==  0){
    process.exit(2);
  };
};
const generateReport = (options)=&gt; {
  return merge(options).then((jsonReport)=&gt;{
    generator.create(jsonReport).then(()=&gt;{
      process.exit();
    });
  });
};
runTests();</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>fse.remove()</code> to remove older reports data.</p>
</div>
<div class="paragraph">
<p><code>cypress.run()</code> to run the tests.</p>
</div>
<div class="paragraph">
<p><code>merge(options)</code> we merge the <code>json</code> output from running the tests.</p>
</div>
<div class="paragraph">
<p><code>generator.create(jsonReport)</code> then we generate the html view of the report.</p>
</div>
<div class="paragraph">
<p>Check the <a href="https://www.npmjs.com/package/mochawesome-merge"><code>mochawesome-merge</code> documentation</a></p>
</div>
<div class="paragraph">
<p>On <a href="https://github.com/cypress-io/cypress-example-kitchensink">kitchensink</a>
you can find an official cypress demo with all the commands being used.</p>
</div>
<!-- toc disabled -->
</div>
<div class="sect3">
<h4 id="angular-eslint-support"><a class="anchor" href="#angular-eslint-support"></a>Angular ESLint support</h4>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
ESLint is supported in Angular 10.1.0 onward.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="what-about-tslint"><a class="anchor" href="#what-about-tslint"></a>What about TSLint?</h4>
<div class="paragraph">
<p>TSLint is a fantastic tool. It is a linter that was written specifically to work based on the TypeScript <code>AST</code> format. This has advantages and disadvantages, as with most decisions we are faced with in software engineering!</p>
</div>
<div class="paragraph">
<p>One advantage is there is no tooling required to reconcile differences between ESLint and TypeScript <code>AST</code> formats, but the major disadvantage is that the tool is therefore unable to reuse any of the previous work which has been done in the JavaScript ecosystem around linting, and it has to re-implement everything from scratch. Everything from rules to auto-fixing capabilities and more.</p>
</div>
<div class="paragraph">
<p>However, the backers behind TSLint announced in 2019 that <strong>they would be deprecating TSLint in favor of supporting</strong> <code>typescript-eslint</code> in order to benefit the community. You can read more about that <a href="https://medium.com/palantir/tslint-in-2019-1a144c2317a9">here</a></p>
</div>
<div class="paragraph">
<p>The TypeScript Team themselves also announced their plans to move the TypeScript codebase from TSLint to <code>typescript-eslint</code>, and they have been big supporters of this project. More details at <a href="https://github.com/microsoft/TypeScript/issues/30553" class="bare">https://github.com/microsoft/TypeScript/issues/30553</a></p>
</div>
<div class="paragraph">
<p>Angular ESLint support comes from the <a href="https://github.com/angular-eslint/angular-eslint">angular-eslint</a> tooling package. Angular documentation also links to this repository as you can check in the <a href="https://angular.io/cli/lint"><code>ng lint</code> section</a> of the Angular CLI documentation.</p>
</div>
</div>
<div class="sect3">
<h4 id="quick-start-with-angular-and-eslint"><a class="anchor" href="#quick-start-with-angular-and-eslint"></a>Quick start with Angular and ESLint</h4>
<div class="paragraph">
<p>In order to create a brand new Angular CLI workspace which uses ESLint instead of TSLint and Codelyzer, simply run the following commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">##Install the Angular CLI and @angular-eslint/schematics globally however you want (e.g. npm, yarn, volta etc)

$ npm i -g @angular/cli @angular-devkit/core @angular-devkit/schematics @angular-eslint/schematics

##Create a new Angular CLI workspace using the @angular-eslint/schematics collection (instead of the default)

$ ng new --collection=@angular-eslint/schematics</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="migrating-an-angular-cli-project-from-codelyzer-and-tslint"><a class="anchor" href="#migrating-an-angular-cli-project-from-codelyzer-and-tslint"></a>Migrating an Angular CLI project from Codelyzer and TSLint</h4>

</div>
<div class="sect3">
<h4 id="1-add-relevant-dependencies"><a class="anchor" href="#1-add-relevant-dependencies"></a>1 - Add relevant dependencies</h4>
<div class="paragraph">
<p>The first step is to run the schematic to add <code>@angular-eslint</code> to your project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ng add @angular-eslint/schematics</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will handle installing the latest version of all the relevant packages for you and adding them to the <code>devDependencies</code> of your package.json.</p>
</div>
</div>
<div class="sect3">
<h4 id="2-run-the-convert-tslint-to-eslint-schematic-on-a-project"><a class="anchor" href="#2-run-the-convert-tslint-to-eslint-schematic-on-a-project"></a>2 - Run the <code>convert-tslint-to-eslint</code> schematic on a project</h4>
<div class="paragraph">
<p>The next thing to do is consider which "project" you want to migrate to use ESLint. If you have a single application in your workspace you will likely have just a single entry in the projects configuration object within your <code>angular.json</code> file. If you have a <code>projects/`</code> directory in your workspace, you will have multiple entries in your <code>projects</code> configuration and you will need to chose which one you want to migrate using the <code>convert-tslint-to-eslint</code> schematic.</p>
</div>
<div class="paragraph">
<p>You can run it like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ng g @angular-eslint/schematics:convert-tslint-to-eslint {{YOUR_PROJECT_NAME_GOES_HERE}}</code></pre>
</div>
</div>
<div class="paragraph">
<p>From now on, <code>ng lint</code> will use ESLint!</p>
</div>
</div>
<div class="sect3">
<h4 id="3-remove-root-tslint-configuration-and-use-only-eslint"><a class="anchor" href="#3-remove-root-tslint-configuration-and-use-only-eslint"></a>3 - Remove root TSLint configuration and use only ESLint</h4>
<div class="paragraph">
<p>Once you are happy with your ESLint setup, you simply need to remove the root-level <code>tslint.json</code> and potentially uninstall TSLint and any TSLint-related plugins/dependencies if your Angular CLI workspace is now no longer using TSLint at all.</p>
</div>
<div class="paragraph">
<p>More info at <a href="https://github.com/angular-eslint/angular-eslint" class="bare">https://github.com/angular-eslint/angular-eslint</a></p>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. A package is a file or directory that is described by a package.json. .
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
